var rn=Object.defineProperty,ln=Object.defineProperties;var an=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var un=Object.prototype.hasOwnProperty,cn=Object.prototype.propertyIsEnumerable;var nt=(t,e,n)=>e in t?rn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,j=(t,e)=>{for(var n in e||(e={}))un.call(e,n)&&nt(t,n,e[n]);if(tt)for(var n of tt(e))cn.call(e,n)&&nt(t,n,e[n]);return t},V=(t,e)=>ln(t,an(e));function po(){import("data:text/javascript,")}const fn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};fn();function X(){}function Pe(t,e){for(const n in e)t[n]=e[n];return t}function Mt(t){return t()}function st(){return Object.create(null)}function le(t){t.forEach(Mt)}function de(t){return typeof t=="function"}function ae(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function dn(t){return Object.keys(t).length===0}function me(t,...e){if(t==null)return X;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Lt(t,e,n,s){if(t){const o=Rt(t,e,n,s);return t[0](o)}}function Rt(t,e,n,s){return t[1]&&s?Pe(n.ctx.slice(),t[1](s(e))):n.ctx}function Dt(t,e,n,s){if(t[2]&&s){const o=t[2](s(n));if(e.dirty===void 0)return o;if(typeof o=="object"){const i=[],r=Math.max(e.dirty.length,o.length);for(let l=0;l<r;l+=1)i[l]=e.dirty[l]|o[l];return i}return e.dirty|o}return e.dirty}function Ft(t,e,n,s,o,i){if(o){const r=Rt(e,n,s,i);t.p(r,o)}}function jt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let s=0;s<n;s++)e[s]=-1;return e}return-1}function ge(t){return t==null?"":t}function d(t,e){t.appendChild(e)}function F(t,e,n){t.insertBefore(e,n||null)}function R(t){t.parentNode.removeChild(t)}function Ye(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function b(t){return document.createElement(t)}function G(t){return document.createTextNode(t)}function W(){return G(" ")}function qe(){return G("")}function K(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function _(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function ie(t){return t===""?null:+t}function hn(t){return Array.from(t.childNodes)}function ne(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function te(t,e){t.value=e==null?"":e}function pn(t,e,n,s){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,s?"important":"")}function ot(t,e){for(let n=0;n<t.options.length;n+=1){const s=t.options[n];if(s.__value===e){s.selected=!0;return}}t.selectedIndex=-1}function mn(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}let Ce;function Ie(t){Ce=t}function Ve(){if(!Ce)throw new Error("Function called outside component initialization");return Ce}function Ge(t){Ve().$$.on_mount.push(t)}function Bt(t){Ve().$$.after_update.push(t)}function Ze(t){Ve().$$.on_destroy.push(t)}const Te=[],Ke=[],Le=[],rt=[],gn=Promise.resolve();let Je=!1;function _n(){Je||(Je=!0,gn.then(Wt))}function Fe(t){Le.push(t)}const Xe=new Set;let Ae=0;function Wt(){const t=Ce;do{for(;Ae<Te.length;){const e=Te[Ae];Ae++,Ie(e),bn(e.$$)}for(Ie(null),Te.length=0,Ae=0;Ke.length;)Ke.pop()();for(let e=0;e<Le.length;e+=1){const n=Le[e];Xe.has(n)||(Xe.add(n),n())}Le.length=0}while(Te.length);for(;rt.length;)rt.pop()();Je=!1,Xe.clear(),Ie(t)}function bn(t){if(t.fragment!==null){t.update(),le(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Fe)}}const Re=new Set;let be;function ke(){be={r:0,c:[],p:be}}function Ee(){be.r||le(be.c),be=be.p}function Y(t,e){t&&t.i&&(Re.delete(t),t.i(e))}function $(t,e,n,s){if(t&&t.o){if(Re.has(t))return;Re.add(t),be.c.push(()=>{Re.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}else s&&s()}function je(t,e){const n={},s={},o={$$scope:1};let i=t.length;for(;i--;){const r=t[i],l=e[i];if(l){for(const u in r)u in l||(s[u]=1);for(const u in l)o[u]||(n[u]=l[u],o[u]=1);t[i]=l}else for(const u in r)o[u]=1}for(const r in s)r in n||(n[r]=void 0);return n}function Be(t){return typeof t=="object"&&t!==null?t:{}}function re(t){t&&t.c()}function se(t,e,n,s){const{fragment:o,on_mount:i,on_destroy:r,after_update:l}=t.$$;o&&o.m(e,n),s||Fe(()=>{const u=i.map(Mt).filter(de);r?r.push(...u):le(u),t.$$.on_mount=[]}),l.forEach(Fe)}function oe(t,e){const n=t.$$;n.fragment!==null&&(le(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function vn(t,e){t.$$.dirty[0]===-1&&(Te.push(t),_n(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ue(t,e,n,s,o,i,r,l=[-1]){const u=Ce;Ie(t);const a=t.$$={fragment:null,ctx:null,props:i,update:X,not_equal:o,bound:st(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:st(),dirty:l,skip_bound:!1,root:e.target||u.$$.root};r&&r(a.root);let c=!1;if(a.ctx=n?n(t,e.props||{},(f,p,...h)=>{const m=h.length?h[0]:p;return a.ctx&&o(a.ctx[f],a.ctx[f]=m)&&(!a.skip_bound&&a.bound[f]&&a.bound[f](m),c&&vn(t,f)),p}):[],a.update(),c=!0,le(a.before_update),a.fragment=s?s(a.ctx):!1,e.target){if(e.hydrate){const f=hn(e.target);a.fragment&&a.fragment.l(f),f.forEach(R)}else a.fragment&&a.fragment.c();e.intro&&Y(t.$$.fragment),se(t,e.target,e.anchor,e.customElement),Wt()}Ie(u)}class ce{$destroy(){oe(this,1),this.$destroy=X}$on(e,n){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const o=s.indexOf(n);o!==-1&&s.splice(o,1)}}$set(e){this.$$set&&!dn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const yn=t=>({config:t&1}),it=t=>({config:t[0]});function wn(t){let e,n,s,o,i,r,l,u,a,c,f,p,h,m,v,w,g,y,S,B,q,N,O,A,M,T,I;const L=t[5]["algorithm-config"],D=Lt(L,t,t[4],it);return{c(){e=b("form"),n=b("div"),s=b("div"),o=b("label"),o.textContent="Network Delay",i=W(),r=b("div"),l=b("input"),u=W(),a=b("span"),a.textContent="ms",c=W(),f=b("div"),p=b("label"),p.textContent="Command Delay",h=W(),m=b("div"),v=b("input"),w=W(),g=b("span"),g.textContent="ms",y=W(),S=b("div"),B=b("label"),B.textContent="Use WebWorkers",q=W(),N=b("input"),O=W(),D&&D.c(),_(o,"for","NetworkDelayInput"),_(o,"class","svelte-1yd6c5a"),_(l,"id","NetworkDelayInput"),_(l,"type","number"),_(l,"min","0"),_(l,"max","60000"),_(r,"class","svelte-1yd6c5a"),_(s,"class","input-group svelte-1yd6c5a"),_(p,"for","CommandDelayInput"),_(p,"class","svelte-1yd6c5a"),_(v,"id","CommandDelayInput"),_(v,"type","number"),_(v,"min","0"),_(v,"max","60000"),_(m,"class","svelte-1yd6c5a"),_(f,"class","input-group svelte-1yd6c5a"),_(B,"for","UseWebWorkersInput"),_(B,"class","svelte-1yd6c5a"),_(N,"id","UseWebWorkersInput"),N.disabled=!0,_(N,"type","checkbox"),_(N,"class","svelte-1yd6c5a"),_(S,"class","input-group svelte-1yd6c5a"),_(n,"class","options svelte-1yd6c5a"),_(e,"class",A=ge("config-form"+t[1]?" full-layout":"")+" svelte-1yd6c5a")},m(P,H){F(P,e,H),d(e,n),d(n,s),d(s,o),d(s,i),d(s,r),d(r,l),te(l,t[2].networkDelay),d(r,u),d(r,a),d(n,c),d(n,f),d(f,p),d(f,h),d(f,m),d(m,v),te(v,t[2].commandDelay),d(m,w),d(m,g),d(n,y),d(n,S),d(S,B),d(S,q),d(S,N),N.checked=t[2].useWorkers,d(e,O),D&&D.m(e,null),M=!0,T||(I=[K(l,"input",t[6]),K(v,"input",t[7]),K(N,"change",t[8]),K(e,"submit",t[3])],T=!0)},p(P,[H]){H&4&&ie(l.value)!==P[2].networkDelay&&te(l,P[2].networkDelay),H&4&&ie(v.value)!==P[2].commandDelay&&te(v,P[2].commandDelay),H&4&&(N.checked=P[2].useWorkers),D&&D.p&&(!M||H&17)&&Ft(D,L,P,P[4],M?Dt(L,P[4],H,yn):jt(P[4]),it),(!M||H&2&&A!==(A=ge("config-form"+P[1]?" full-layout":"")+" svelte-1yd6c5a"))&&_(e,"class",A)},i(P){M||(Y(D,P),M=!0)},o(P){$(D,P),M=!1},d(P){P&&R(e),D&&D.d(P),T=!1,le(I)}}}function kn(t,e,n){let s,o=X,i=()=>(o(),o=me(u,m=>n(2,s=m)),u);t.$$.on_destroy.push(()=>o());let{$$slots:r={},$$scope:l}=e,{configStore:u}=e;i();let{fullLayout:a=!1}=e;const c=m=>{m.preventDefault()};function f(){s.networkDelay=ie(this.value),u.set(s)}function p(){s.commandDelay=ie(this.value),u.set(s)}function h(){s.useWorkers=this.checked,u.set(s)}return t.$$set=m=>{"configStore"in m&&i(n(0,u=m.configStore)),"fullLayout"in m&&n(1,a=m.fullLayout),"$$scope"in m&&n(4,l=m.$$scope)},[u,a,s,c,l,r,f,p,h]}class En extends ce{constructor(e){super(),ue(this,e,kn,wn,ae,{configStore:0,fullLayout:1})}}const ve=[];function De(t,e=X){let n;const s=new Set;function o(l){if(ae(t,l)&&(t=l,n)){const u=!ve.length;for(const a of s)a[1](),ve.push(a,t);if(u){for(let a=0;a<ve.length;a+=2)ve[a][0](ve[a+1]);ve.length=0}}}function i(l){o(l(t))}function r(l,u=X){const a=[l,u];return s.add(a),s.size===1&&(n=e(o)||X),l(t),()=>{s.delete(a),s.size===0&&(n(),n=null)}}return{set:o,update:i,subscribe:r}}function Ht(t,e){const n=new Date(t.sent).getTime(),s=new Date(e.sent).getTime();return n<s?-1:n>s?1:Sn(t,e)}function Sn(t,e){return t.id>e.id?-1:t.id<e.id?1:0}function On(t,e){return(n,s)=>{const o=u=>e(s,u)&&Math.abs(new Date(u.sent).getTime()-new Date(s.sent).getTime())<t,i=u=>u.findIndex(a=>o(a)),l=(()=>n.findIndex(u=>Array.isArray(u)?i(u)!==-1:o(u)))();return l!==-1&&n[l]&&Array.isArray(n[l])?n[l].push(s):l!==-1&&l?n[l]=[n[l],s]:n.push(s),n}}const pe={disabledNode:"",messageFill:"#FA3",messageOutline:"#000",highlight:"#F497A4",messageLine:"#DDD"},lt={nodeRadius:24,messageRadius:8,paintNodeText:t=>t.id,isLeader:()=>{},paintMessageText:()=>{},arrowLength:6};function We(t,e,n,s=lt){if(t.save(),s=j(j({},lt),s),!e)return[t.canvas.width,t.canvas.height];let o=0,i=0;return e.messages.filter(r=>!r.done&&r.pos).forEach(r=>{t.beginPath();let l=e.nodes.filter(a=>a.id===r.fromId)[0].pos,u=e.nodes.filter(a=>a.id===r.toId)[0].pos;r.id===e.selectedElementId&&(t.lineWidth=4,t.strokeStyle=pe.highlight,t.moveTo(...l),t.lineTo(...u),t.stroke()),t.lineWidth=1,t.strokeStyle="#DDD",t.moveTo(...l),t.lineTo(...u),t.stroke(),t.closePath()}),e.messages.filter(r=>!r.done&&r.pos).sort(Ht).forEach(r=>{r.id===e.selectedElementId&&(t.beginPath(),t.fillStyle=pe.highlight,t.arc(r.pos[0],r.pos[1],s.messageRadius+5,0,2*Math.PI),t.fill(),t.closePath()),t.beginPath();const l=e.nodes.filter(g=>g.id===r.fromId)[0].pos,u=e.nodes.filter(g=>g.id===r.toId)[0].pos,a=Math.sqrt(Math.pow(l[0]-u[0],2)+Math.pow(l[1]-u[1],2)),c=s.messageRadius+s.arrowLength,f=[r.pos[0]+c/a*(u[0]-l[0]),r.pos[1]+c/a*(u[1]-l[1])],p=[r.pos[0]+s.messageRadius/a*(l[0]-u[0]),r.pos[1]+s.messageRadius/a*(l[1]-u[1])],h=(g,y)=>[Math.cos(y)*g[0]-Math.sin(y)*g[1],Math.sin(y)*g[0]+Math.cos(y)*g[1]],m=(g,y)=>{let S=[g[0]-r.pos[0],g[1]-r.pos[1]];return S=h(S,y),[S[0]+r.pos[0],S[1]+r.pos[1]]},v=m(p,Math.PI/2+.5),w=m(p,-Math.PI/2-.5);t.fillStyle=pe.messageOutline,t.strokeStyle=pe.messageOutline,t.moveTo(...v),t.lineTo(...f),t.lineTo(...w),t.stroke(),t.fill(),t.closePath(),t.beginPath(),t.lineWidth=2,t.strokeStyle=pe.messageOutline,t.fillStyle=pe.messageFill,t.arc(r.pos[0],r.pos[1],s.messageRadius,0,2*Math.PI),t.stroke(),t.fill(),t.isPointInPath(n.position[0],n.position[1])&&(t.canvas.style.setProperty("cursor","pointer","important"),n.hits.map(g=>g.id).indexOf(r.id)===-1&&n.hits.push(r)),t.closePath()}),e.nodes.filter(r=>r&&r.pos&&r.id).forEach(r=>{t.beginPath(),t.lineWidth=5,t.fillStyle="#ADD495",t.strokeStyle="#80B7A2",r.connected?s.isLeader(r)&&(t.fillStyle="#EE2",t.strokeStyle="#DD0"):(t.fillStyle="#DDD",t.strokeStyle="#AAA"),t.arc(r.pos[0],r.pos[1],s.nodeRadius,0,2*Math.PI),t.stroke(),o=Math.max(o,r.pos[0]),i=Math.max(i,r.pos[1]),t.fill(),t.isPointInPath(n.position[0],n.position[1])&&(t.canvas.style.setProperty("cursor","pointer","important"),n.hits.map(l=>l.id).indexOf(r.id)===-1&&n.hits.push(r)),t.closePath(),s.paintNodeText(t,r),t.beginPath(),t.fillStyle="#FFF",r.connected?s.isLeader(r)&&(t.fillStyle="#000"):t.fillStyle="#000",t.font="bold 20px courier new",t.fillText(r.id,r.pos[0]-12,r.pos[1]+5),t.closePath()}),e.selectedElementId&&e.nodes.filter(r=>r.id===e.selectedElementId).forEach(r=>{t.beginPath(),t.strokeStyle="#F497A4",t.lineWidth=5,t.arc(r.pos[0],r.pos[1],s.nodeRadius+5,0,2*Math.PI),t.stroke(),t.closePath()}),t.restore(),[o,i]}function Tn(t,e,{subscribe:n},s=We,o={autoAlign:"CENTER"},{onHover:i,onHoverEnd:r,onClick:l,updateState:u}={}){let a=1,c=[0,0],f=!1,p=null;n(T=>{p=T});const h=t.getContext("2d",{alpha:!1});var m=1,v=t.getBoundingClientRect();t.width=v.width*m,t.height=v.height*m,h.scale(m,m);const w={hits:[],position:[0,0]},g=T=>{if(t.style.cursor="default",w.hits.length>0){const D=w.hits[0];i&&i(D)}else r&&r();let I=T.clientX+document.body.scrollLeft-t.offsetLeft,L=T.clientY+document.body.scrollTop-t.offsetTop;w.position=[I+window.scrollX,L+window.scrollY],w.hits=[]};t.addEventListener("mousemove",g);const y=()=>{if(w.hits[0]){let T=w.hits[0];p.selectedElementId=T.id,u&&u(I=>V(j({},I),{selectedElementId:T.id})),l&&l(T)}};t.addEventListener("mousedown",y);let S={fps:0},B=[0,0],q=0,N=0,O=!1;var A=[];t.width!==t.parentElement.clientWidth&&(t.width=t.parentElement.clientWidth,t.height=t.parentElement.clientHeight);function M(){switch(o.autoAlign){case"TOP_TO_BOTTOM":N>t.height?(t.height=N,t.parentElement.style.overflowY="scroll",f&&t.parentElement.scrollTo(0,t.parentElement.scrollHeight)):N<t.height&&(t.height=t.parentElement.clientHeight);break}h.fillStyle="#FFF",h.fillRect(0,0,t.width,t.height),h.scale(a/m,a/m);let T=c[0],I=c[1];switch(o.autoAlign){case"TOP_TO_BOTTOM":T=c[0]+B[0]/2-q/2,I=10;break;case"CENTER":T=c[0]+B[0]/2-q/2,I=c[1]+B[1]/2-N/2;break}h.translate(T,I),B=[t.width/2,t.height/2],[q,N]=s(h,p,w,o);const L=performance.now();for(;A.length>0&&A[0]<=L-1e3;)A.shift();A.push(L),S.fps=A.length,h.translate(-T,-I),h.scale(m*1/a,m*1/a),O||requestAnimationFrame(M)}return M(),{context:h,debugInfo:S,zoom:T=>{a=T||1},pan:T=>{c=T},setLock:T=>{f=T},remove:()=>{O=!0,h.fillStyle="#FFF",h.fillRect(0,0,640,480),t.removeEventListener("mousedown",y),t.removeEventListener("mousemove",g)}}}const In=t=>({offsetX:t[0]&16,offsetY:t[0]&32}),at=t=>({hoveredElement:t[12],offsetX:t[4],offsetY:t[5]});function Nn(t){let e;return{c(){e=b("p"),_(e,"class","svelte-1jb7q7x")},m(n,s){F(n,e,s)},p:X,d(n){n&&R(e)}}}function Pn(t){let e;return{c(){e=b("span"),e.textContent="unlock"},m(n,s){F(n,e,s)},d(n){n&&R(e)}}}function Cn(t){let e;return{c(){e=b("span"),e.textContent="lock"},m(n,s){F(n,e,s)},d(n){n&&R(e)}}}function An(t){let e,n,s,o,i,r,l,u,a,c,f,p,h,m,v,w,g,y,S,B,q,N,O,A;function M(E,U){return Nn}let I=M()(t);function L(E,U){return E[7]?Cn:Pn}let D=L(t),P=D(t);const H=t[28].hover,k=Lt(H,t,t[27],at);return{c(){e=b("div"),n=b("div"),I.c(),s=W(),o=b("button"),P.c(),i=W(),r=b("button"),r.textContent="Reset",l=W(),u=b("div"),a=b("button"),a.textContent="-",c=W(),f=b("p"),p=G(t[10]),h=G("x"),m=W(),v=b("button"),v.textContent="+",w=W(),g=b("canvas"),S=W(),k&&k.c(),B=W(),q=b("div"),q.innerHTML=`<span>Pan: <kbd>LeftCtrl</kbd> + Hold <kbd>MouseLeft</kbd></span> 
    <span>Zoom: <kbd>LeftCtrl</kbd> + <kbd>MouseWheel</kbd></span>`,_(f,"class","svelte-1jb7q7x"),_(u,"class","zoom svelte-1jb7q7x"),_(n,"class","controls-section svelte-1jb7q7x"),_(g,"class",y=ge(t[11].hoveredElement?"clickable":t[9]?"moving":t[7]&&t[8]?"movable":"")+" svelte-1jb7q7x"),_(g,"id",t[0]),_(g,"width","640"),_(g,"height","480"),_(e,"class","canvas-wrapper svelte-1jb7q7x"),_(q,"class","help svelte-1jb7q7x")},m(E,U){F(E,e,U),d(e,n),I.m(n,null),d(n,s),d(n,o),P.m(o,null),d(n,i),d(n,r),d(n,l),d(n,u),d(u,a),d(u,c),d(u,f),d(f,p),d(f,h),d(u,m),d(u,v),d(e,w),d(e,g),t[31](g),d(e,S),k&&k.m(e,null),F(E,B,U),F(E,q,U),N=!0,O||(A=[K(o,"click",t[13]),K(r,"click",t[18]),K(a,"click",t[29]),K(v,"click",t[30]),K(g,"mousemove",t[16]),K(g,"mousedown",t[14]),K(g,"mouseup",t[15]),K(g,"mouseleave",t[17]),K(e,"drop",Rn),K(e,"dragover",Dn)],O=!0)},p(E,U){I.p(E,U),D!==(D=L(E))&&(P.d(1),P=D(E),P&&(P.c(),P.m(o,null))),(!N||U[0]&1024)&&ne(p,E[10]),(!N||U[0]&2944&&y!==(y=ge(E[11].hoveredElement?"clickable":E[9]?"moving":E[7]&&E[8]?"movable":"")+" svelte-1jb7q7x"))&&_(g,"class",y),(!N||U[0]&1)&&_(g,"id",E[0]),k&&k.p&&(!N||U[0]&134217776)&&Ft(k,H,E,E[27],N?Dt(H,E[27],U,In):jt(E[27]),at)},i(E){N||(Y(k,E),N=!0)},o(E){$(k,E),N=!1},d(E){E&&R(e),I.d(),P.d(),t[31](null),k&&k.d(E),E&&R(B),E&&R(q),O=!1,le(A)}}}const Mn=.5,Ln=2;function ut(t){return t.preventDefault(),t.stopPropagation(),!1}function Rn(t){}function Dn(t){}function Fn(t,e,n){let s,o=X,i=()=>(o(),o=me(p,C=>n(35,s=C)),p),r,l=X,u=()=>(l(),l=me(h,C=>n(11,r=C)),h);t.$$.on_destroy.push(()=>o()),t.$$.on_destroy.push(()=>l());let{$$slots:a={},$$scope:c}=e,{id:f}=e,{configStore:p}=e;i();let{stateStore:h}=e;u();let{paintFn:m=We}=e,{minWidth:v=100}=e,{minHeight:w=100}=e,{paintOptions:g=void 0}=e,{onElementSelected:y=C=>{}}=e,{onElementHovered:S=C=>{}}=e,{onElementHoverEnd:B=()=>{}}=e,q=De(void 0);const N=C=>{q.update(fe=>C),S(C)},O=()=>{q.set(void 0),B()};function A(C){h.update(fe=>V(j({},fe),{selectedElementId:C.id})),y(C),q.set(void 0)}let M=null,T=null,I,L=50,D=0,P=!0;function H(){n(7,P=!P),M&&M.setLock(!P)}let k=!1;function E(C){C.keyCode===17&&n(8,k=!0)}function U(C){C.keyCode===17&&n(8,k=!1)}const z=C=>h.update(C),J=()=>{M&&M.remove(),M=Tn(T,s,{subscribe:C=>h.subscribe(C)},m,g,{onHover:N,onHoverEnd:O,onClick:A,updateState:z}),he=[T.width/5,T.height/5],M.pan(he)};function x(){const C=document.getElementById(f),fe=C.parentElement;C&&fe&&(C.height=Math.max(w,fe.clientHeight),C.width=Math.max(v,fe.clientWidth))}let Z=!1;function Q(){!P||!k||n(9,Z=!0)}function ee(){n(9,Z=!1)}let he=[0,0];function xt(C){if(Z&&P&&k){const fe=1/_e;he=[he[0]+fe*C.movementX,g.autoAlign==="TOP_TO_BOTTOM"?0:he[1]+fe*C.movementY],M.pan(he)}}function en(){n(9,Z=!1)}function tn(){n(10,_e=1),M.zoom(_e),he=[0,0],M.pan(he)}let _e=1;function $e(C){!P||!k||(C.preventDefault(),C.stopPropagation(),Oe(C.deltaY*-.001))}function Oe(C){n(10,_e=Math.round(Math.min(Math.max(Mn,_e+C),Ln)*10)/10),M.zoom(_e)}Ge(()=>{const C=document.getElementById(f);n(4,I=C.offsetLeft),n(5,L=C.offsetTop),C.addEventListener("wheel",$e,{passive:!1}),window.addEventListener("scroll",ut,!1),window.addEventListener("resize",x,!0),document.addEventListener("keydown",E),document.addEventListener("keyup",U),p.subscribe(J),x()});let xe=g;Bt(()=>{xe!==g&&(J(),Oe(0),xe=g)});let et=setInterval(()=>{n(6,D=M.debugInfo.fps)},500);Ze(()=>{window.removeEventListener("resize",x),T.removeEventListener("wheel",$e),window.removeEventListener("scroll",ut),document.removeEventListener("keydown",E),document.removeEventListener("keyup",U),M&&M.remove(),et&&clearInterval(et)});const nn=()=>Oe(-.1),sn=()=>Oe(.1);function on(C){Ke[C?"unshift":"push"](()=>{T=C,n(3,T)})}return t.$$set=C=>{"id"in C&&n(0,f=C.id),"configStore"in C&&i(n(1,p=C.configStore)),"stateStore"in C&&u(n(2,h=C.stateStore)),"paintFn"in C&&n(20,m=C.paintFn),"minWidth"in C&&n(21,v=C.minWidth),"minHeight"in C&&n(22,w=C.minHeight),"paintOptions"in C&&n(23,g=C.paintOptions),"onElementSelected"in C&&n(24,y=C.onElementSelected),"onElementHovered"in C&&n(25,S=C.onElementHovered),"onElementHoverEnd"in C&&n(26,B=C.onElementHoverEnd),"$$scope"in C&&n(27,c=C.$$scope)},[f,p,h,T,I,L,D,P,k,Z,_e,r,q,H,Q,ee,xt,en,tn,Oe,m,v,w,g,y,S,B,c,a,nn,sn,on]}class Qe extends ce{constructor(e){super(),ue(this,e,Fn,An,ae,{id:0,configStore:1,stateStore:2,paintFn:20,minWidth:21,minHeight:22,paintOptions:23,onElementSelected:24,onElementHovered:25,onElementHoverEnd:26},null,[-1,-1])}}function jn(t){let e;return{c(){e=G("pause")},m(n,s){F(n,e,s)},d(n){n&&R(e)}}}function Bn(t){let e;return{c(){e=G("resume")},m(n,s){F(n,e,s)},d(n){n&&R(e)}}}function Wn(t){let e,n,s,o,i,r,l,u,a,c,f,p,h,m,v,w=t[2]*we+"",g,y,S,B;function q(A,M){return A[1]?Bn:jn}let N=q(t),O=N(t);return{c(){e=b("div"),n=b("button"),n.textContent="reset",s=W(),o=b("button"),O.c(),i=W(),r=b("button"),l=G("step forward"),a=W(),c=b("div"),f=b("label"),f.textContent="Speed",p=W(),h=b("input"),m=W(),v=b("span"),g=G(w),y=G("x"),_(n,"type","button"),_(n,"class","svelte-air56o"),_(o,"type","button"),_(o,"class","svelte-air56o"),_(r,"type","button"),r.disabled=u=!t[1],_(r,"class","svelte-air56o"),_(f,"for","SpeedInput"),_(h,"id","SpeedInput"),_(h,"type","range"),_(h,"min","0"),_(h,"max",5/we),h.value=t[2],_(c,"class","svelte-air56o"),_(e,"class","anim-controls svelte-air56o")},m(A,M){F(A,e,M),d(e,n),d(e,s),d(e,o),O.m(o,null),d(e,i),d(e,r),d(r,l),d(e,a),d(e,c),d(c,f),d(c,p),d(c,h),d(c,m),d(c,v),d(v,g),d(v,y),S||(B=[K(n,"click",function(){de(t[0].reset)&&t[0].reset.apply(this,arguments)}),K(o,"click",function(){de(t[0].pauseOrPlay)&&t[0].pauseOrPlay.apply(this,arguments)}),K(r,"click",function(){de(t[0].stepForwards)&&t[0].stepForwards.apply(this,arguments)}),K(h,"change",t[3])],S=!0)},p(A,[M]){t=A,N!==(N=q(t))&&(O.d(1),O=N(t),O&&(O.c(),O.m(o,null))),M&2&&u!==(u=!t[1])&&(r.disabled=u),M&4&&(h.value=t[2]),M&4&&w!==(w=t[2]*we+"")&&ne(g,w)},i:X,o:X,d(A){A&&R(e),O.d(),S=!1,le(B)}}}const we=.25;function Hn(t,e,n){let{stateStore:s}=e,{controls:o}=e,i=!1,r=1/we;const l=c=>{try{n(2,r=parseInt(c.target.value))}catch{console.error("Failed to parse speed")}o.setSpeed(r*we)};function u(c){(c.key===" "||c.code==="Space"||c.keyCode===32)&&(c.preventDefault(),c.stopPropagation(),o&&o.pauseOrPlay())}let a;return Ge(()=>{a=s.subscribe(c=>{if(!c){n(1,i=!0);return}n(1,i=c.paused),n(2,r=c.speed/we)}),document.addEventListener("keydown",u)}),Ze(()=>{a&&a(),document.removeEventListener("keydown",u)}),t.$$set=c=>{"stateStore"in c&&n(4,s=c.stateStore),"controls"in c&&n(0,o=c.controls)},[o,i,r,l,s]}class qn extends ce{constructor(e){super(),ue(this,e,Hn,Wn,ae,{stateStore:4,controls:0})}}const He={linePadding:50,initialLineLength:200,lengthPerTimeStep:10,groupOffset:30,messageOffset:8,maxMessageLength:30,maxMessageOffset:100,vertical:!1,autoAlign:"TOP_TO_BOTTOM",spaceBetweenBroadcasts:!1,getText:t=>t.type};function ct(t,e,n,s=He){if(s=j(j({},He),s),!e)return[t.canvas.width,t.canvas.height];s.internal={},s.internal.nodeToXMap={},e.nodes.forEach((i,r)=>{s.internal.nodeToXMap[i.id]=10+r*s.linePadding,s.internal.furthestLineX=s.internal.nodeToXMap[i.id]});const o=(i,r)=>s.getText(i)===s.getText(r);return t.save(),s.internal.lastLineOffset=25,s.internal.maxWidth=s.internal.furthestLineX,e.messages.sort(Ht).reduce(On(1e3,o),[]).forEach(qt(t,e,s)),t.restore(),t.save(),e.nodes.forEach((i,r)=>{let l=10+r*s.linePadding;if(s.internal.nodeToXMap[i.id]=l,e.selectedElementId===i.id){t.beginPath(),t.lineWidth=10,t.strokeStyle=pe.highlight;let f=[s.internal.nodeToXMap[e.selectedElementId],25],p=[s.internal.nodeToXMap[e.selectedElementId],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(f=f.reverse(),p=p.reverse()),t.moveTo(...f),t.lineTo(...p),t.stroke(),t.closePath()}t.beginPath(),t.lineWidth=1,t.setLineDash(i.connected?[0]:[5,5]),t.strokeStyle=i.connected?"#000":"#AAA";let u=[s.internal.nodeToXMap[i.id],25],a=[s.internal.nodeToXMap[i.id],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(u=u.reverse(),a=a.reverse()),t.moveTo(...u),t.lineTo(...a),t.stroke(),t.closePath(),t.setLineDash([0]),t.beginPath(),t.fillStyle="#000",t.font="bold 20px courier new",t.fontWeight="bold";let c=[l-7.5,20];s.vertical&&(c=c.reverse()),t.fillText(i.id,...c),t.closePath()}),t.restore(),[s.internal.maxWidth,s.internal.lastLineOffset+s.messageOffset]}function qt(t,e,n,s=0,o=!0){return(i,r)=>{if(Array.isArray(i)){i.forEach((p,h)=>qt(t,e,n,h,h===i.length-1)(p,r));return}const{nodeToXMap:l,furthestLineX:u}=n.internal;t.beginPath();let a=n.internal.lastLineOffset;r===0&&(a+=n.messageOffset),n.spaceBetweenBroadcasts&&s!==0&&(a+=n.messageOffset);let c=[l[i.fromId],a],f=[l[i.toId],c[1]+(n.spaceBetweenBroadcasts?0:n.maxMessageLength)];if((o||n.spaceBetweenBroadcasts)&&(n.internal.lastLineOffset=f[1],o&&n.spaceBetweenBroadcasts?n.internal.lastLineOffset+=n.groupOffset:n.internal.lastLineOffset+=n.messageOffset),n.vertical&&(c=c.reverse(),f=f.reverse()),i.id===e.selectedElementId&&(t.lineWidth=8,t.strokeStyle=pe.highlight,t.moveTo(...c),t.lineTo(...f),t.stroke()),t.lineWidth=1,t.strokeStyle="#000",t.moveTo(...c),t.lineTo(...f),t.stroke(),t.closePath(),s===0){t.beginPath(),t.fillStyle="#000",t.font="15px arial";let p=[u+20,c[1]+(f[1]-c[1])/2];n.spaceBetweenBroadcasts&&(p[1]=c[1]+(n.internal.lastLineOffset-c[1])/2),n.vertical&&(p=p.reverse());const h=n.getText(i);n.internal.maxWidth=Math.max(n.internal.maxWidth,p[0]+h.length*15),t.fillText(h,...p),t.closePath()}}}function ft(t){let e,n,s,o,i,r;const l=[Un,Gn],u=[];function a(c,f){return c[11]?0:c[8]?1:-1}return~(o=a(t))&&(i=u[o]=l[o](t)),{c(){e=b("section"),n=b("h1"),n.textContent="State",s=W(),i&&i.c(),_(n,"class","svelte-1y74lh9"),_(e,"class","state-section svelte-1y74lh9")},m(c,f){F(c,e,f),d(e,n),d(e,s),~o&&u[o].m(e,null),r=!0},p(c,f){let p=o;o=a(c),o===p?~o&&u[o].p(c,f):(i&&(ke(),$(u[p],1,1,()=>{u[p]=null}),Ee()),~o?(i=u[o],i?i.p(c,f):(i=u[o]=l[o](c),i.c()),Y(i,1),i.m(e,null)):i=null)},i(c){r||(Y(i),r=!0)},o(c){$(i),r=!1},d(c){c&&R(e),~o&&u[o].d()}}}function Gn(t){let e,n;const s=[t[5],{id:"Canvas_"+t[14].algorithm+"_State"},{paintFn:t[8]},{paintOptions:{autoAlign:"CENTER"}}];let o={};for(let i=0;i<s.length;i+=1)o=Pe(o,s[i]);return e=new Qe({props:o}),{c(){re(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,r){const l=r&16672?je(s,[r&32&&Be(i[5]),r&16384&&{id:"Canvas_"+i[14].algorithm+"_State"},r&256&&{paintFn:i[8]},s[3]]):{};e.$set(l)},i(i){n||(Y(e.$$.fragment,i),n=!0)},o(i){$(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function Un(t){let e,n,s;var o=t[11];function i(r){return{props:{stateStore:r[0],configStore:r[1]}}}return o&&(e=new o(i(t))),{c(){e&&re(e.$$.fragment),n=qe()},m(r,l){e&&se(e,r,l),F(r,n,l),s=!0},p(r,l){const u={};if(l&1&&(u.stateStore=r[0]),l&2&&(u.configStore=r[1]),o!==(o=r[11])){if(e){ke();const a=e;$(a.$$.fragment,1,0,()=>{oe(a,1)}),Ee()}o?(e=new o(i(r)),re(e.$$.fragment),Y(e.$$.fragment,1),se(e,n.parentNode,n)):e=null}else o&&e.$set(u)},i(r){s||(e&&Y(e.$$.fragment,r),s=!0)},o(r){e&&$(e.$$.fragment,r),s=!1},d(r){r&&R(n),e&&oe(e,r)}}}function Xn(t){let e,n,s;var o=t[6];function i(r){return{props:{slot:"algorithm-config",config:r[18]}}}return o&&(e=new o(i(t))),{c(){e&&re(e.$$.fragment),n=qe()},m(r,l){e&&se(e,r,l),F(r,n,l),s=!0},p(r,l){const u={};if(l&262144&&(u.config=r[18]),o!==(o=r[6])){if(e){ke();const a=e;$(a.$$.fragment,1,0,()=>{oe(a,1)}),Ee()}o?(e=new o(i(r)),re(e.$$.fragment),Y(e.$$.fragment,1),se(e,n.parentNode,n)):e=null}else o&&e.$set(u)},i(r){s||(e&&Y(e.$$.fragment,r),s=!0)},o(r){e&&$(e.$$.fragment,r),s=!1},d(r){r&&R(n),e&&oe(e,r)}}}function zn(t){let e,n,s,o,i,r,l,u,a,c,f,p,h,m,v,w,g,y,S,B,q,N,O,A;const M=[t[5],{id:"Canvas_"+t[14].algorithm+"_Nodes"},{paintFn:We},{paintOptions:t[10]}];let T={};for(let k=0;k<M.length;k+=1)T=Pe(T,M[k]);r=new Qe({props:T});const I=[t[5],{id:"Canvas_"+t[14].algorithm+"_Sequence"},{paintFn:ct},{paintOptions:t[9]}];let L={};for(let k=0;k<I.length;k+=1)L=Pe(L,I[k]);f=new Qe({props:L});var D=t[7];function P(k){return{props:{element:k[12],actions:k[4]}}}D&&(w=new D(P(t)));let H=(t[8]||t[11])&&ft(t);return B=new qn({props:{stateStore:t[0],controls:t[13]&&t[13].simulation}}),O=new En({props:{configStore:t[1],fullLayout:!0,updateOnChange:!0,algorithm:t[3],$$slots:{"algorithm-config":[Xn,({config:k})=>({18:k}),({config:k})=>k?262144:0]},$$scope:{ctx:t}}}),{c(){e=b("article"),n=b("section"),s=b("section"),o=b("h1"),o.textContent="Node Graph",i=W(),re(r.$$.fragment),l=W(),u=b("section"),a=b("h1"),a.textContent="Sequence Diagram",c=W(),re(f.$$.fragment),p=W(),h=b("section"),m=b("h1"),m.textContent="Actions",v=W(),w&&re(w.$$.fragment),g=W(),H&&H.c(),y=W(),S=b("section"),re(B.$$.fragment),q=W(),N=b("section"),re(O.$$.fragment),_(o,"class","svelte-1y74lh9"),_(s,"class","raised graph-panel svelte-1y74lh9"),_(a,"class","svelte-1y74lh9"),_(u,"class","raised graph-panel svelte-1y74lh9"),_(m,"class","svelte-1y74lh9"),_(h,"class","raised actions-panel svelte-1y74lh9"),_(n,"class","canvas-section svelte-1y74lh9"),_(S,"class","controls-section svelte-1y74lh9"),_(N,"class","config-section svelte-1y74lh9"),_(e,"class","full-algorithm svelte-1y74lh9")},m(k,E){F(k,e,E),d(e,n),d(n,s),d(s,o),d(s,i),se(r,s,null),d(n,l),d(n,u),d(u,a),d(u,c),se(f,u,null),d(n,p),d(n,h),d(h,m),d(h,v),w&&se(w,h,null),d(e,g),H&&H.m(e,null),d(e,y),d(e,S),se(B,S,null),d(e,q),d(e,N),se(O,N,null),A=!0},p(k,[E]){const U=E&17440?je(M,[E&32&&Be(k[5]),E&16384&&{id:"Canvas_"+k[14].algorithm+"_Nodes"},E&0&&{paintFn:We},E&1024&&{paintOptions:k[10]}]):{};r.$set(U);const z=E&16928?je(I,[E&32&&Be(k[5]),E&16384&&{id:"Canvas_"+k[14].algorithm+"_Sequence"},E&0&&{paintFn:ct},E&512&&{paintOptions:k[9]}]):{};f.$set(z);const J={};if(E&4096&&(J.element=k[12]),E&16&&(J.actions=k[4]),D!==(D=k[7])){if(w){ke();const Q=w;$(Q.$$.fragment,1,0,()=>{oe(Q,1)}),Ee()}D?(w=new D(P(k)),re(w.$$.fragment),Y(w.$$.fragment,1),se(w,h,null)):w=null}else D&&w.$set(J);k[8]||k[11]?H?(H.p(k,E),E&2304&&Y(H,1)):(H=ft(k),H.c(),Y(H,1),H.m(e,y)):H&&(ke(),$(H,1,1,()=>{H=null}),Ee());const x={};E&1&&(x.stateStore=k[0]),E&8192&&(x.controls=k[13]&&k[13].simulation),B.$set(x);const Z={};E&2&&(Z.configStore=k[1]),E&8&&(Z.algorithm=k[3]),E&4456512&&(Z.$$scope={dirty:E,ctx:k}),O.$set(Z)},i(k){A||(Y(r.$$.fragment,k),Y(f.$$.fragment,k),w&&Y(w.$$.fragment,k),Y(H),Y(B.$$.fragment,k),Y(O.$$.fragment,k),A=!0)},o(k){$(r.$$.fragment,k),$(f.$$.fragment,k),w&&$(w.$$.fragment,k),$(H),$(B.$$.fragment,k),$(O.$$.fragment,k),A=!1},d(k){k&&R(e),oe(r),oe(f),w&&oe(w),H&&H.d(),oe(B),oe(O)}}}function Kn(t,e,n){let s,o=X,i=()=>(o(),o=me(m,I=>n(13,s=I)),m),r,l=X,u=()=>(l(),l=me(p,I=>n(17,r=I)),p),a,c=X,f=()=>(c(),c=me(h,I=>n(14,a=I)),h);t.$$.on_destroy.push(()=>o()),t.$$.on_destroy.push(()=>l()),t.$$.on_destroy.push(()=>c());let{stateStore:p}=e;u();let{configStore:h}=e;f();let{controlsStore:m}=e;i();let{algorithm:v}=e,{algorithms:w}=e,g={},y,S={stateStore:p,configStore:h},B=v.components.Configuration,q=v.components.Actions,N=v.drawing.paintState,O=v.drawing.seqPaintingOptions||{},A=v.drawing.nodePaintingOptions||{},M=v.components.StateGraph,T=null;return Ge(()=>{h.subscribe(I=>{let L=w[I.algorithm];n(6,B=L.components.Configuration),n(11,M=L.components.StateGraph),n(7,q=L.components.Actions),n(8,N=L.drawing.paintState),n(9,O=L.drawing.seqPaintingOptions?j({},L.drawing.seqPaintingOptions):{}),n(9,O.autoAlign="TOP_TO_BOTTOM",O),n(10,A=L.drawing.nodePaintingOptions?j({},L.drawing.nodePaintingOptions):{}),n(10,A.autoAlign="CENTER",A)}),p.subscribe(I=>{!s||!I||(y!==I.selectedElementId&&(y=I.selectedElementId),y&&y.indexOf&&y.indexOf("M_")===0?n(12,T=r.messages.find(L=>L.id===y)):n(12,T=r.nodes.find(L=>L.id===y)),T&&n(4,g=s.element(I.nodes.find(L=>L.id===y))))}),p.update(I=>V(j({},I),{selectedElementId:I.nodes.filter(L=>L.type==="client")[0]})),n(5,S={stateStore:p,configStore:h})}),t.$$set=I=>{"stateStore"in I&&u(n(0,p=I.stateStore)),"configStore"in I&&f(n(1,h=I.configStore)),"controlsStore"in I&&i(n(2,m=I.controlsStore)),"algorithm"in I&&n(3,v=I.algorithm),"algorithms"in I&&n(15,w=I.algorithms)},[p,h,m,v,g,S,B,q,N,O,A,M,T,s,a,w]}class Jn extends ce{constructor(e){super(),ue(this,e,Kn,zn,ae,{stateStore:0,configStore:1,controlsStore:2,algorithm:3,algorithms:15})}}const Gt={algorithm:"paxos",commandDelay:0,networkDelay:5e3,speed:1,useWorkers:!0,useGlobalState:!1};function Qn(){return new Worker("assets/NodeRunnerWorker.45ac4748.js",{type:"module"})}function Ne(){return typeof crypto!="undefined"&&crypto.randomUUID?crypto.randomUUID():Yn()}function Yn(t=6,e=36){return Math.random().toString(e).substring(2,t)}class Vn{constructor(e,n){this.neighbors=[],this.node=e,this.neighbors=n&&this.neighbors.concat(n)}getAllNeighbors(){return this.neighbors}getNeighborsOfType(e){return this.neighbors.filter(n=>n.type===e)}getRandomNeighborOfType(e){const n=this.getNeighborsOfType(e),s=Math.floor(Math.random()*n.length);return n[s]}broadcast(e,n){const s=Ne(),o=this.node.id;for(const i of n)i!==o&&this.emit(V(j({},e),{sent:new Date().toISOString(),id:this.getRandomId(),broadcastKey:s,fromId:o,toId:i}))}broadcastToAll(e){const n=this.neighbors.map(s=>s.id);this.broadcast(e,n)}broadcastToType(e,n){const s=this.neighbors.filter(o=>o.type===n).map(o=>o.id);this.broadcast(e,s)}sendTo(e,n){const s=this.node.id;this.emit(V(j({},n),{sent:new Date().toISOString(),fromId:s,toId:e,id:this.getRandomId()}))}sendToSync(e,n){const s=this.node.id;return this.emitSync(V(j({},n),{sent:new Date().toISOString(),fromId:s,toId:e,id:this.getRandomId()}))}emit(e){window.dispatchEvent(new CustomEvent("NetworkEvent",{detail:V(j({},e),{nodeId:this.node.id})}))}emitSync(e){const n=Ne();return new Promise(s=>{this.emit(V(j({},e),{resKey:n}));const o=this.listen(i=>{i.resKey===n&&(o(),s(i))})})}listen(e){const s=(o=>i=>i.detail.toId===this.node.id&&o(i.detail))(e);return window.addEventListener("NetworkEvent",s),()=>{window.removeEventListener("NetworkEvent",s)}}async receive(){return new Promise(e=>{this.listen(n=>{e(n)})})}getRandomId(){return"M_"+Ne()}}class Ue{constructor(e,n,s,o){this.id=e,this.config=n,this.state=s,this.network=o,this.running=!0,this.connected=!0,this.executedCommands=[],this.scheduledCommands=[]}stop(){this.running=!1}restart(){this.running=!0,this.scheduledCommands.forEach(e=>{e.do(),this.executedCommands.push(e)})}reconnect(){this.connected=!0}disconnect(){this.connected=!1}invoke(e){const n=Ne();let s=e;typeof s=="function"?s={id:n,do:e,undo:()=>console.warn("Undo not implemented")}:s.id=n,this.running?(s.do(),this.executedCommands.push(s)):this.scheduledCommands.push(s),this.updateState()}step(e=!0){if(e&&this.scheduledCommands.length>0){const n=this.scheduledCommands.shift();n.do(),this.executedCommands.push(n)}else if(this.executedCommands.length>0){const n=this.executedCommands.pop();n.undo(),this.scheduledCommands.push(n)}this.updateState()}invokeDo(e){const n=j({},this.state),s={do:()=>{e()},undo:()=>{this.state=n}};this.invoke(s)}updateState(){this.network.sendTo(void 0,{type:"STATE_CHANGED",isFlow:!0,data:V(j({},this.state),{scheduledCommands:this.scheduledCommands.map(({id:e})=>({id:e})),executedCommands:this.executedCommands.map(({id:e})=>({id:e}))})})}}class Zn extends Ue{constructor(e,n,s,o){super(e,n,s,o),this.type="client"}request(e,n){const s=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{method:"REQUEST",v:n}),this.updateState()},undo:()=>{this.state.text=s}}}onmessage(e){e.method==="RESPONSE"&&this.invoke(this.onAck())}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}requestRandom(e){const n=this.network.getRandomNeighborOfType("proposer")||this.network.getRandomNeighborOfType("node");this.invoke(this.request(n.id,e))}}class $n{constructor(e,n,s,o){this.id=e,this.config=s,this.parentNode=o,this.network=n,this.state={greatestN:-1,text:"IDLE"}}onPrepare(e){let n={state:j({},this.state),parentState:j({},this.parentNode.state)};return{do:()=>{if(e.n<=this.parentNode.state.greatestN){this.state.text="IDLE",this.network.sendTo(e.fromId,{clientId:e.clientId,n:this.parentNode.state.greatestN,method:"IGNORED"});return}this.parentNode.state.greatestN=e.n,this.state.text="PROMISED",this.network.sendTo(e.fromId,{method:"PROMISE",clientId:e.clientId,n:e.n})},undo:()=>{this.state=n,this.parentNode.state=n.parentState}}}onAccept(e){let n={state:j({},this.state),parentState:j({},this.parentNode.state)};return{do:()=>{if(e.n>this.parentNode.state.greatestN){this.state.text="IDLE";const s={clientId:e.clientId,n:this.parentNode.state.greatestN,v:e.v,method:"IGNORED"};this.network.sendTo(e.fromId,s);return}this.state.text="ACCEPTED",this.config.learnerImpl==="contactAllAcceptors"?this.network.broadcastToType({clientId:e.clientId,n:e.n,v:e.v,method:"ACCEPTED"},"node"):(this.network.sendTo(e.fromId,{clientId:e.clientId,n:e.n,v:e.v,method:"ACCEPTED"}),this.parentNode.state.log[e.n-1]=e.v),this.parentNode.state.greatestN=e.n},undo:()=>{this.state=n.state,this.parentNode.state=n.parentState}}}}class xn{constructor(e,n,s,o){this.network=n,this.config=s,this.parentNode=o,this.id=e,this.state={v:null,n:null}}onAccepted(e){const n=this.state.v,s=[...this.parentNode.state.log];return{do:()=>{e.v===this.state.v&&e.n===this.state.n||(this.state.v=e.v,this.state.n=e.n,this.parentNode.state.log[e.n-1]=e.v,this.network.sendTo(e.clientId,{clientId:e.clientId,n:e.n,v:e.v,method:"RESPONSE"}))},undo:()=>{this.state.v=n,this.parentNode.state.log=s}}}}class es{constructor(e,n,s,o){this.id=e,this.config=s,this.parentNode=o,this.network=n,this.type="proposer",this.state={proposals:[],text:"IDLE"}}hasMajority(e,n="promises"){const s=this.state.proposals.find(i=>i.n===e);if(!s)return;const o=this.network.getNeighborsOfType("acceptors").length||this.network.getNeighborsOfType("node").length;return s[n].length>=Math.floor(.5*o)+1}onRequest(e){let n={state:j({},this.state),parentState:j({},this.parentNode.state)};return{do:()=>{this.state.isProposer=!0,this.state.text="PREPARING",this.parentNode.state.greatestN+=1,this.state.proposals.push({clientId:e.fromId,v:e.v,n:this.parentNode.state.greatestN,promises:[],acceptances:[],ignoredBy:[]});let s=this.network.getNeighborsOfType("acceptor");(!s||s.length===0)&&(s=this.network.getNeighborsOfType("node")),this.parentNode.state.log[this.parentNode.state.greatestN-1]=e.v,this.network.broadcast({clientId:e.fromId,method:"PREPARE",n:this.parentNode.state.greatestN},s.map(o=>o.id))},undo:()=>{this.state=n.state,this.parentNode.state=n.parentState}}}onPromise(e){const n=j({},this.state);return{do:()=>{const s=this.state.proposals.find(o=>o.n===e.n);if(!!s){if(this.hasMajority(e.n)){s.promises.push(e.fromId);return}else s.promises.push(e.fromId);this.hasMajority(e.n)&&(this.network.broadcastToType({clientId:e.clientId,method:"ACCEPT",n:s.n,v:s.v},"node"),this.state.text="PROMISED")}},undo:()=>{this.state=n}}}onAccepted(e){const n=j({},this.state);return{do:()=>{const s=this.state.proposals.find(o=>o.n===e.n);if(!!s){if(this.hasMajority(e.n,"acceptances")){s.acceptances.push(e.fromId);return}else s.acceptances.push(e.fromId);this.hasMajority(e.n,"acceptances")&&(this.state.text="IDLE"),this.state.isProposer=!1}},undo:()=>{this.state=n.state,this.parentNode.state=n.parentState}}}onIgnored(e){let n={state:j({},this.state),parentState:j({},this.parentNode.state)};return{do:()=>{if(e.n>this.parentNode.state.greatestN){this.parentNode.state.greatestN=e.n,this.state.isProposer=!1;return}else if(e.n<this.parentNode.state.greatestN)return;const s=this.state.proposals.findIndex(o=>o.n===e.n);s<0||!this.state.proposals[s]||(this.state.proposals=this.state.proposals.map(o=>o.n===e.n?V(j({},o),{acceptances:o.acceptances.filter(i=>i.acceptorId!==e.fromId),promises:o.promises.filter(i=>i.acceptorId!==e.fromId)}):o))},undo:()=>{this.state=n}}}}class ts extends Ue{constructor(e,n,s,o,i="node"){super(e,n,s,o),this.type=i,this.state.log=[],this.state.greatestN=0,(i==="node"||i==="acceptor")&&(this.acceptor=new $n(e,o,n,this),this.state.acceptor=this.acceptor.state),(i==="node"||i==="learner")&&(this.learner=new xn(e,o,n,this),this.state.learner=this.learner.state),(i==="node"||i==="proposer")&&(this.proposer=new es(e,o,n,this),this.state.proposer=this.proposer.state)}onmessage(e){this.proposer&&this.handleProposerMessage(e),this.acceptor&&this.handleAcceptorMessage(e),this.learner&&this.handleLearnerMessage(e)}handleProposerMessage(e){switch(e.method){case"REQUEST":this.invoke(this.proposer.onRequest(e));break;case"PROMISE":this.invoke(this.proposer.onPromise(e));break;case"ACCEPTED":this.invoke(this.proposer.onAccepted(e));break;case"IGNORED":this.invoke(this.proposer.onIgnored(e));break}}handleAcceptorMessage(e){switch(e.method){case"PREPARE":this.invoke(this.acceptor.onPrepare(e));break;case"ACCEPT":this.invoke(this.acceptor.onAccept(e));break}}handleLearnerMessage(e){switch(e.method){case"ACCEPTED":this.invoke(this.learner.onAccepted(e));break}}}function Ut(t,e,n,s){return n.type==="client"?new Zn(n.id,t,n,s):new ts(n.id,t,n,s,n.type||"all")}class ns extends Ue{constructor(e,n,s,o){super(e,n,s,o),this.type="client"}request(e,n){const s=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{command:"REQUEST",tx:n,timestamp:new Date().getTime()}),this.updateState()},undo:()=>{this.state.text=s}}}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}onmessage(e){e.method==="RESPONSE"&&this.invoke(this.onAck())}requestRandom(e){const n=this.network.getRandomNeighborOfType("node");this.invoke(this.request(n.id,e))}}const ss={header:{prevHeaderHash:null,merkleRoot:null},height:0,timestamp:new Date("2009-01-03T19:15:00.000Z").getTime(),transactions:[]};async function Xt(t,e="",n="sha-256"){if(typeof crypto=="undefined"||!crypto||!crypto.subtle)return JSON.stringify(t)+e;const s=os(JSON.stringify(t)+e),o=await crypto.subtle.digest(n,s);return Array.from(new Uint8Array(o)).map(r=>r.toString(16).padStart(2,"0")).join("")}async function dt(t,e,n="",s="sha-256"){return typeof crypto=="undefined"||!crypto||!crypto.subtle?JSON.stringify(e)+n===t:await Xt(e,n,s)===t}function os(t){return new TextEncoder().encode(t)}const ht=5e3,Me=1e3;class rs extends Ue{constructor(e,n,s,o){super(e,n,s,o),this.type="node",this.state.text="IDLE",this.state.chain=[ss],this.state.mempool=[],this.getBlocks(),this.sync=!0}onmessage(e){switch(e.command){case"getblocks":super.invoke(this.onGetBlocks(e));break;case"REQUEST":super.invokeDo(this.sendRawTransaction(e));break;case"blocks":super.invoke(this.onBlocks(e));break;case"rawtransaction":super.invokeDo(this.onRawTransaction(e));break;case"submitblock":super.invokeDo(this.onSubmitBlock(e));break}}onBlocks(e){return{do:async()=>{for(let n of e.entries){if(!await dt(n.header.prevHeaderHash,this.state.chain.at(-1).header))return;this.state.chain.push(n)}},undo:()=>{}}}onGetBlocks(e){return{do:()=>{this.network.sendTo(e.fromId,{command:"blocks",entries:this.state.chain})},undo:()=>{}}}getBlocks(){if(this.network.neighbors.length===0)return;const e=this.network.getNeighborsOfType("node");if(e.length===0)return;const n=Math.floor(Math.random()*e.length),s=e[n];this.network.sendTo(s.id,{command:"getblocks",headerHashes:[this.state.chain.at(-1).hash]})}sendRawTransaction(e){return()=>{const n=this.state.mempool.find(o=>e.tx===o),s=this.state.chain.find(o=>o.transactions.find(i=>i===e.tx));if(!n&&!s){this.timeout&&clearTimeout(this.timeout);const o=Math.random()*(ht-Me)+Me;this.timeout=setTimeout(this.tryMining(),o),this.state.mempool.push(e.tx),this.network.broadcastToType({timestamp:e.timestamp,tx:e.tx,command:"rawtransaction"},"node")}}}onRawTransaction(e){return()=>{this.sendRawTransaction(e)()}}onSubmitBlock(e){return()=>{const n=(o,i)=>()=>o.transactions.filter((r,l)=>r!==i.transactions[l]).length===0;this.state.chain.find(o=>o===e.block||n(e.block,o))||(this.state.mempool=this.state.mempool.filter(o=>!e.block.transactions.find(i=>i!==o)),this.state.chain.push(e.block))}}stop(){super.stop(),this.timeout&&clearTimeout(this.timeout)}restart(){super.restart();const e=Math.random()*(ht-Me)+Me;this.timeout=setTimeout(this.tryMining(),e)}tryMining(){return async()=>{if(this.state.mempool.length===0)return;const e=Math.random().toFixed(8),s={header:{prevHeaderHash:await Xt(this.state.chain.at(-1),e),merkleRoot:null,nonce:e},height:this.state.chain.length,timestamp:new Date().getTime(),transactions:this.state.mempool};this.state.mempool=[],this.state.chain.push(s),this.network.broadcastToType({block:s,command:"submitblock"},"node")}}validate(e){return dt(e.header.prevHeaderHash,V(j({},e),{hash:void 0}))}}function is(t,e,n,s){switch(n.type){case"client":return new ns(n.id,t,n,s);case"node":return new rs(n.id,t,n,s)}}function ls(t,...e){switch(t){case"paxos":return Ut(...e);case"bitcoin_pow":return is(...e);default:throw"Algorithm not implemented"}}class as{constructor(e,n){this.setupNetwork=(s,o)=>new Vn(s,o),this.id=Ne(),this.config=e,this.network=null,this.nodeStates=n,this.nodes=[]}terminate(){this.stopListening&&this.stopListening()}buildMessageEventHandler(){return e=>{const n=e.data;if(console.log(`NodeRunner for "${this.nodeStates?this.nodeStates.map(s=>s.id).join(", "):"?"}" got:`,n),n.isFlow){this.onFlowMessage(n);return}if(n.toId){const s=this.nodes.find(o=>o.id===n.toId);s&&s.running&&s.connected&&s.onmessage(n)}}}setupNodes(e,n,s){this.nodeStates=n,n.forEach(async o=>{const i=this.setupNetwork(o,s),r=ls(e.algorithm,e,null,o,i);r&&(r.updateState(),this.nodes.push(r),console.log("Starting node with id ",r.id,"and type",r.type))})}onFlowMessage(e){const{nodeId:n}=e;switch(e.type){case"CLIENT_REQUEST":if(n){const s=this.nodes.find(o=>o.id===n);if(s&&s.type==="client"){const{v:o}=e;s.requestRandom(o)}}break;case"SETUP":case"RESET":this.setupNodes(e.config,e.nodes,e.neighbors),this.postMessageToMain({isFlow:!0,type:"STATE_CHANGED",state:"IDLE"});break;case"STEP":this.nodes.forEach(s=>s.step(e.forward));break;case"DISCONNECT":case"RECONNECT":case"STOP":case"RESTART":if(n){const s=this.nodes.find(o=>o.id===n);s&&(e.type==="RECONNECT"?s.reconnect():e.type==="DISCONNECT"?s.disconnect():e.type==="RESTART"?s.restart():e.type==="STOP"&&(this.postMessageToMain({isFlow:!0,type:"COMMANDS",commands:s.executedCommands}),s.stop()))}break;default:console.error("Flow message type not recognized");break}}onmessage(){console.warn("onmessage is not implemented")}onerror(){console.warn("onerror is not implemented")}postMessage(e){this.messageEventHandler||(this.messageEventHandler=this.buildMessageEventHandler());const n={data:e};this.messageEventHandler(n)}postMessageToMain(e){window.dispatchEvent(new CustomEvent("NodeRunnerEvent",{detail:V(j({},e),{nodeRunnerId:this.id})}))}startListening(){const e=o=>o.detail.nodeRunnerId===this.id||this.nodeStates.filter(i=>i.id===o.detail.nodeId||i.id===o.detail.toId).length!==0,s=(o=>i=>e(i)&&o({data:i.detail}))(this.onmessage);window.addEventListener("NodeRunnerEvent",s),window.addEventListener("NetworkEvent",s),this.stopListening=()=>{window.removeEventListener("NodeRunnerEvent",s),window.removeEventListener("NetworkEvent",s)}}}const zt=10;function us(t,e){const n={"0":()=>{}};let s=[];function o(){return()=>{t(r=>{const l=[...s];s=[],Object.keys(n).forEach(a=>{!r.messages.find(c=>c.id===a)&&!l.find(c=>c.id===a)&&(n[a]=void 0)});const u=(a,c,f)=>f.findIndex(p=>p.id===a.id)===c;return V(j({},r),{messages:r.messages.concat(...l).map(cs(r,e,n)).filter(u)})})}}const i=setInterval(o(),zt);return{stop:()=>clearInterval(i),push:async(r,l,u)=>new Promise(a=>{n[l.id]={resolve:a,onCompleted:u};const c=j({},l);c.progress=0,c.id=l.id,s.push(c),c.pos=r.nodes.filter(f=>f.id===l.fromId)[0].pos})}}function cs(t,e,n){return s=>{var a,c;if(s.done&&n[s.id]&&!n[s.id].resolved&&(n[s.id].onCompleted(s),n[s.id].resolved=!0,(a=n[s.id])==null||a.resolve(s)),s.done)return s;const o=fs(t,e,zt,s.progress),i=t.nodes.filter(f=>f.id===s.fromId)[0],r=t.nodes.filter(f=>f.id===s.toId)[0];if(!i||!r)return alert(`got ${s.fromId} ${s.toId}`),s;const l=i.pos,u=r.pos;return s.pos=[l[0]+Math.min(o,1)*(u[0]-l[0]),l[1]+Math.min(o,1)*(u[1]-l[1])],o>=1&&(s.done=!0,n[s.id]?s.progress<1&&(n[s.id].onCompleted(s),n[s.id].resolved=!0,(c=n[s.id])==null||c.resolve(V(j({},s),{done:!0}))):console.warn("onCompletedMap missing key")),s.progress=o,s}}function fs(t,e,n,s){const o=e<=0?1:n/(e/t.speed);return Math.min(s+(t.paused?0:o),1)}function ds(t,e,n,s,o){const i=a=>n(c=>{const f=a(c);return j(j({},c),f)}),r={setSpeed:a=>n(c=>V(j({},c),{speed:a})),stepForwards:()=>i(t.useGlobalState?pt(t,e,!0):mt(t,e,!0)),stepBackwards:()=>i(t.useGlobalState?pt(t,e,!1):mt(t,e,!1)),pauseOrPlay:()=>i(ps(t,e,void 0)),reset:()=>i(_t(t,e,void 0,s,o)),terminate:gs(t,e,s)},l=()=>({delete:()=>n(a=>V(j({},a),{selectedElementId:void 0,messages:a.messages.filter(c=>c.id!==a.selectedElementId)})),modify:a=>()=>n(c=>V(j({},c),{messages:c.messages.filter(f=>f.id!==c.selectedElementId).concat(a)}))}),u=a=>({connectOrDisconnect:()=>i(hs(t,e,a.id)),restart:()=>i(_t(t,e,a.id))});return{simulation:r,element:a=>V(j(j({},u(a)),l()),{createNewAction:c=>()=>{n(f=>{const p=c(t,f,e);return j(j({},f),p)})}})}}function hs(t,e,n){return s=>{if(!!n&&!!e[n])return e[n].postMessage({isFlow:!0,type:s.nodes.find(o=>o.id===n).connected?"DISCONNECT":"RECONNECT",nodeId:n}),{nodes:s.nodes.map(o=>V(j({},o),{connected:n&&o.id===n?!o.connected:o.connected}))}}}function ps(t,e,n=void 0){return s=>{if(Object.values(e).forEach(o=>o.postMessage({isFlow:!0,nodeId:n,type:s.paused?"RESTART":"STOP"})),s.paused){const o=s.messages.filter(i=>i.deleted).sort(Kt);if(o.length>0&&o[0]){const i=o[0].fromId;e[i].postMessage({isFlow:!0,nodeId:i,type:"STEP",forward:!0})}}return{paused:typeof s.paused=="undefined"?!0:!s.paused,messages:s.paused?s.messages.filter(o=>!o.deleted):s.messages,nodes:s.nodes.filter(o=>n?o.id===n:!0).map(o=>V(j({},o),{running:!o.running}))}}}function pt(t,e,n=!0){return s=>{if(window.states||(window.stateIdx=-1,window.states=[]),n&&(window.states.length===0||window.stateIdx===window.states.length-1)){const o={messages:ms([],s.messages),nodes:s.nodes};return window.states.push(o),o}else return n?(window.stateIdx+=1,window.states[window.stateIdx]):(window.stateIdx=Math.max(0,window.stateIdx-1),window.states[window.stateIdx])}}function mt(t,e,n=!0){return s=>{if(n)return{messages:s.messages.map(i=>(i.done||i.deleted||(i.progress=i.progress<.5?.5:1,i.done=i.progress>=1),i))};{const o=[],i=s.messages.sort(Kt(!0)),r=i.reduce(gt(i),[]),l=i.filter(a=>r.indexOf(a)===-1).reduce(gt(i),[]),u=s.messages.map(a=>(r.indexOf(a)!==-1?a.progress>.5?(a.progress=.5,a.done=!1,a.deleted=!1):(a.progress=0,a.deleted=!0,a.done=!0,o.push(a)):l.indexOf(a)!==-1&&(a.done=!1,a.progress=.5),a)).filter(a=>!a.deleted);return o.map(a=>a.fromId).filter(_s).forEach(a=>{e[a].postMessage({isFlow:!0,type:"STEP",forward:!1})}),{messages:u}}}}function gt(t){return(e,n)=>{if(t.length===0)return[];const s=t[0].broadcastKey;return s?(s&&s===n.broadcastKey&&e.push(n),e):[t[0]]}}function Kt(t=!1){return(e,n)=>{const s=new Date(e.sent).getTime(),o=new Date(n.sent).getTime();return s>o?t?-1:1:s<o?t?1:-1:0}}function ms(t,e){return e.map(n=>{const s=t.findIndex(o=>o.id===n.id)==-1;return n.done||n.deleted&&s||(n.deleted=!1,n.progress=n.progress<.5?.5:1,n.done=n.progress>=1),n})}function gs(t,e,n){return()=>{n(),Object.values(e).forEach(s=>s.terminate())}}function _t(t,e,n,s,o){return i=>{if(n&&e[n]){const r=i.nodes.find(l=>l.id===n);e[n].postMessage({config:t,isFlow:!0,type:"RESET",nodeId:n,nodes:[r],neighbors:i.nodes.filter(l=>l.id!==r.id)})}else if(!n)return s&&s(),o&&o();return{}}}const _s=(t,e,n)=>n.indexOf(t)===e;function bs({value:t,update:e},{value:n,update:s},o){const i=us(s,t.networkDelay/n.speed),r={};for(const u of n.nodes){const a=t.useWorkers?new Qn({type:"module",name:u.id}):new as(t,[u]),c=f=>{const p=f.data;if(p.isFlow)switch(p.type){case"STATE_CHANGED":if(!p.data)break;s(h=>V(j({},h),{commands:(h.commands||[]).concat(...p.data.scheduledCommands||[]),nodes:[...h.nodes.map(m=>m.id===u.id?j(j({},m),p.data):m)]}));break}else i.push(n,p,h=>{h.toId&&r[h.toId].postMessage(h)})};a.onmessage=c,a.onerror=f=>{console.error(f.message,f.error,f),e(p=>V(j({},p),{useWorkers:!1}))},t.useWorkers||a.startListening(),a.postMessage({isFlow:!0,type:"SETUP",config:t,nodes:[u],neighbors:n.nodes.filter(f=>f.id!==u.id)}),r[u.id]=a}const l=ds(t,r,s,i.stop,o);return[r,l]}function vs(t,e){const n=[];for(let s=0;s<t;s++){const o=2*Math.PI*((s+1)/t);n.push([e*Math.cos(o)+e,e*Math.sin(o)+e])}return n}const ys=1,ws=1,ks=1,Es=1,Ss=1;function Jt(t){const e={selectedElementId:void 0,started:new Date,speed:1,nodes:[],messages:[]};return e.nodes=Os(t),e}function Os(t){const e=[];if(t.numberOfClients<ys)throw"IllegalAmountOfClients";for(let n=0;n<t.numberOfClients;n++)e.push({id:"C"+(n+1),type:"client",running:!0,connected:!0,state:"IDLE",pos:[50+n*60,50]});if(t.useSingleNodes){if(t.numberOfNodes<ws)throw"IllegalAmountOfNodes";const n=130,s=vs(t.numberOfNodes,100);for(let o=0;o<t.numberOfNodes;o++)e.push({id:"N"+(o+1),type:"node",running:!0,connected:!0,state:"IDLE",pos:[s[o][0]+50,s[o][1]+n]});return e}if(t.numberOfProposers<ks)throw"IllegalAmountOfProposers";for(let n=0;n<t.numberOfProposers;n++)e.push({id:"P"+(n+1),type:"proposer",state:"IDLE",running:!0,connected:!0,pos:[100+n*60,150]});if(t.numberOfAcceptors<Es)throw"IllegalAmountOfAcceptors";for(let n=0;n<t.numberOfAcceptors;n++)e.push({id:"A"+(n+1),type:"acceptor",state:"IDLE",running:!0,connected:!0,pos:[100+n*60,250]});if(t.numberOfLearners<Ss)throw"IllegalAmountOfLearners";for(let n=0;n<t.numberOfLearners;n++)e.push({id:"L"+(n+1),type:"learner",state:"IDLE",running:!0,connected:!0,pos:[50+n*60,350]});return e}const Qt={algorithm:"paxos",numberOfClients:1,numberOfProposers:1,numberOfAcceptors:3,numberOfLearners:2,numberOfNodes:5,useSingleNodes:!0,learnerImpl:"none",electLeader:!0},Ts=V(j({},He),{getText:t=>{let e=t.method;switch(t.method){case"REQUEST":e+=` (${t.v})`;break;case"PROMISE":case"PREPARE":case"IGNORED":e+=` (${t.n})`;break;case"ACCEPT":case"ACCEPTED":e+=` (${t.n+", "+t.v})`;break}return e}}),Is={isLeader:t=>{var e;return(e=t.proposer)==null?void 0:e.isProposer}},ze={padding:2};function Ns(t,e,n,s=ze){if(!e)return[t.canvas.width,t.canvas.height];let o=0;return s=j(j({},ze),s),e.nodes.forEach((i,r)=>{var c;const l=30*r;t.beginPath(),t.fillStyle="#000",t.font="20px courier new";let u=[0,l+12];t.fillText(i.id,...u),t.closePath();let a=i.id.length*20+ze.padding;(c=i.proposer)!=null&&c.log&&i.proposer.log.filter(f=>f).forEach(f=>{t.beginPath(),t.lineWidth=2,t.strokeStyle="#000";const p=f.length*10;t.rect(a-s.padding,l,p+s.padding*2,10),t.stroke(),t.closePath(),t.beginPath(),t.fillStyle="#000",t.font="12px courier new";let h=a+f.length*12+2,m=[h,l+8];a=h,t.fillText(f,...m),t.closePath()})}),[o,30*(e.nodes.length+1)]}function Ps(t){let e,n,s,o,i,r,l,u,a,c,f,p,h,m,v,w;return{c(){e=b("div"),n=b("label"),s=G(`Number of Proposers\r
                `),o=b("input"),i=W(),r=b("div"),l=b("label"),u=G(`Number of Acceptors\r
                `),a=b("input"),c=W(),f=b("div"),p=b("label"),h=G(`Number of Learners\r
                `),m=b("input"),_(o,"type","number"),_(o,"min","1"),_(o,"max","10"),_(e,"class","input-group"),_(a,"type","number"),_(a,"min","1"),_(a,"max","10"),_(r,"class","input-group"),_(m,"type","number"),_(m,"min","1"),_(m,"max","10"),_(f,"class","input-group")},m(g,y){F(g,e,y),d(e,n),d(n,s),d(n,o),te(o,t[1].numberOfProposers),F(g,i,y),F(g,r,y),d(r,l),d(l,u),d(l,a),te(a,t[1].numberOfAcceptors),F(g,c,y),F(g,f,y),d(f,p),d(p,h),d(p,m),te(m,t[1].numberOfLearners),v||(w=[K(o,"input",t[4]),K(a,"input",t[5]),K(m,"input",t[6])],v=!0)},p(g,y){y&2&&ie(o.value)!==g[1].numberOfProposers&&te(o,g[1].numberOfProposers),y&2&&ie(a.value)!==g[1].numberOfAcceptors&&te(a,g[1].numberOfAcceptors),y&2&&ie(m.value)!==g[1].numberOfLearners&&te(m,g[1].numberOfLearners)},d(g){g&&R(e),g&&R(i),g&&R(r),g&&R(c),g&&R(f),v=!1,le(w)}}}function Cs(t){let e,n,s,o,i,r;return{c(){e=b("div"),n=b("label"),s=G(`Number of Nodes\r
                `),o=b("input"),_(o,"type","number"),_(o,"min","1"),_(o,"max",15),_(e,"class","input-group")},m(l,u){F(l,e,u),d(e,n),d(n,s),d(n,o),te(o,t[1].numberOfNodes),i||(r=K(o,"input",t[3]),i=!0)},p(l,u){u&2&&ie(o.value)!==l[1].numberOfNodes&&te(o,l[1].numberOfNodes)},d(l){l&&R(e),i=!1,r()}}}function As(t){let e,n,s,o,i,r,l,u,a,c,f,p,h,m,v;function w(S,B){return S[1].useSingleNodes?Cs:Ps}let g=w(t),y=g(t);return{c(){e=b("div"),n=b("div"),s=b("label"),o=G(`Number of Clients\r
            `),i=b("input"),r=W(),y.c(),l=W(),u=b("div"),a=b("label"),c=G(`Learner Implementation\r
            `),f=b("select"),p=b("option"),p.textContent="none",h=b("option"),h.textContent="contact all acceptors",_(i,"type","number"),_(i,"min","1"),_(i,"max",5),_(n,"class","input-group"),p.__value="none",p.value=p.__value,h.__value="contactAllAcceptors",h.value=h.__value,t[1].learnerImpl===void 0&&Fe(()=>t[7].call(f)),_(u,"class","input-group"),_(e,"class","algorithm-specific-options")},m(S,B){F(S,e,B),d(e,n),d(n,s),d(s,o),d(s,i),te(i,t[1].numberOfClients),d(e,r),y.m(e,null),d(e,l),d(e,u),d(u,a),d(a,c),d(a,f),d(f,p),d(f,h),ot(f,t[1].learnerImpl),m||(v=[K(i,"input",t[2]),K(f,"change",t[7])],m=!0)},p(S,[B]){B&2&&ie(i.value)!==S[1].numberOfClients&&te(i,S[1].numberOfClients),g===(g=w(S))&&y?y.p(S,B):(y.d(1),y=g(S),y&&(y.c(),y.m(e,l))),B&2&&ot(f,S[1].learnerImpl)},i:X,o:X,d(S){S&&R(e),y.d(),m=!1,le(v)}}}function Ms(t,e,n){let s,o=X,i=()=>(o(),o=me(r,h=>n(1,s=h)),r);t.$$.on_destroy.push(()=>o());let{config:r}=e;i();function l(){s.numberOfClients=ie(this.value),r.set(s)}function u(){s.numberOfNodes=ie(this.value),r.set(s)}function a(){s.numberOfProposers=ie(this.value),r.set(s)}function c(){s.numberOfAcceptors=ie(this.value),r.set(s)}function f(){s.numberOfLearners=ie(this.value),r.set(s)}function p(){s.learnerImpl=mn(this),r.set(s)}return t.$$set=h=>{"config"in h&&i(n(0,r=h.config))},[r,s,l,u,a,c,f,p]}class Ls extends ce{constructor(e){super(),ue(this,e,Ms,As,ae,{config:0})}}const ye={name:"Paxos",description:"Paxos is a consensus algorithm.",original:"http://lamport.azurewebsites.net/pubs/lamport-paxos.pdf",areas:["Distributed Databases"],applications:[{title:"AzureRSL",src:""}],info:{byNodeType:{leader:"A leader primarily has the role of the proposer.",follower:"A follower primarily has the role of the acceptor.",node:"A paxos Node follows the three roles of paxos: learner, proposer and acceptor.",proposer:"A proposer tries to have the acceptors agree on a value v send by a client.",acceptor:"An acceptor votes on proposals sent from the proposer. Only then a value can be stored",learner:"A learner makes sure an accepted value is stored and distributed.",client:"Clients want to store data or run actions inside the paxos network. The client is most likely another server system."},byNodeState:{},byMessageMethod:{RESPONSE:"Clients may be informed about the outcome of the voting.",REQUEST:"Clients send requests to the current proposer if they want to store an input to the replicated log of the cluster.",PREPARE:"A leader node (or proposer) sends followers its generation n. It prepares to commit a value v.",PROMISE:'Followers (or acceptors) answer to the PREPARE requests with a PROMISE message. They promise to "only" accept values from this proposer.',ACCEPT:"After getting all promises from the acceptor the proposer wants all acceptors to accept a value v.",ACCEPTED:"If an acceptor accepts a value v it sends an ACCEPTED message back to the proposer.",IGNORED:"If an acceptor does not accept a value v it sends an IGNORED message back to the proposer. The proposer must try again with a higher generation."}}};function Rs(t){let e,n,s=t[0].id+"",o,i,r,l,u=(ye.info.byNodeType[t[0].type]||"No information")+"",a,c,f,p=(ye.info.byNodeState[t[0].state]||"")+"",h,m,v,w,g,y,S=t[0].type+"",B,q,N,O,A,M=t[0].state+"",T,I,L,D,P,H,k,E=t[0].connected?"disconnect":"reconnect",U,z,J,x=t[0].type!=="client"&&bt(t),Z=t[0].type==="client"&&vt(t);return{c(){e=b("h1"),n=G("Node "),o=G(s),i=W(),r=b("p"),l=b("span"),a=G(u),c=W(),f=b("span"),h=G(p),m=W(),v=b("ul"),w=b("li"),g=G("type: "),y=b("span"),B=G(S),q=W(),N=b("li"),O=G("state: "),A=b("span"),T=G(M),I=W(),x&&x.c(),L=W(),Z&&Z.c(),D=W(),P=b("button"),P.textContent="restart",H=W(),k=b("button"),U=G(E),_(y,"class","svelte-1muk73i"),_(w,"class","svelte-1muk73i"),_(A,"class","svelte-1muk73i"),_(N,"class","svelte-1muk73i"),_(v,"class","property-list svelte-1muk73i")},m(Q,ee){F(Q,e,ee),d(e,n),d(e,o),F(Q,i,ee),F(Q,r,ee),d(r,l),d(l,a),d(r,c),d(r,f),d(f,h),F(Q,m,ee),F(Q,v,ee),d(v,w),d(w,g),d(w,y),d(y,B),d(v,q),d(v,N),d(N,O),d(N,A),d(A,T),d(v,I),x&&x.m(v,null),F(Q,L,ee),Z&&Z.m(Q,ee),F(Q,D,ee),F(Q,P,ee),F(Q,H,ee),F(Q,k,ee),d(k,U),z||(J=[K(P,"click",function(){de(t[1].restart)&&t[1].restart.apply(this,arguments)}),K(k,"click",function(){de(t[1].connectOrDisconnect)&&t[1].connectOrDisconnect.apply(this,arguments)})],z=!0)},p(Q,ee){t=Q,ee&1&&s!==(s=t[0].id+"")&&ne(o,s),ee&1&&u!==(u=(ye.info.byNodeType[t[0].type]||"No information")+"")&&ne(a,u),ee&1&&p!==(p=(ye.info.byNodeState[t[0].state]||"")+"")&&ne(h,p),ee&1&&S!==(S=t[0].type+"")&&ne(B,S),ee&1&&M!==(M=t[0].state+"")&&ne(T,M),t[0].type!=="client"?x?x.p(t,ee):(x=bt(t),x.c(),x.m(v,null)):x&&(x.d(1),x=null),t[0].type==="client"?Z?Z.p(t,ee):(Z=vt(t),Z.c(),Z.m(D.parentNode,D)):Z&&(Z.d(1),Z=null),ee&1&&E!==(E=t[0].connected?"disconnect":"reconnect")&&ne(U,E)},d(Q){Q&&R(e),Q&&R(i),Q&&R(r),Q&&R(m),Q&&R(v),x&&x.d(),Q&&R(L),Z&&Z.d(Q),Q&&R(D),Q&&R(P),Q&&R(H),Q&&R(k),z=!1,le(J)}}}function Ds(t){let e,n,s=t[0].id+"",o,i,r,l=t[0].toId+"",u,a,c=t[0].fromId+"",f,p,h,m=ye.info.byMessageMethod[t[0].method]+"",v,w,g,y,S,B,q=t[0].method+"",N,O,A=["REQUEST","ACCEPTED","ACCEPT"].indexOf(t[0].method)!==-1,M,T=["ACCEPT","ACCEPTED","PROMISE","PREPARE","IGNORED"].indexOf(t[0].method)!==-1,I,L,D,P,H,k,E=A&&yt(t),U=T&&wt(t);return{c(){e=b("h1"),n=G("Message "),o=G(s),i=W(),r=b("p"),u=G(l),a=G(" \u2192 "),f=G(c),p=W(),h=b("p"),v=G(m),w=W(),g=b("ul"),y=b("li"),S=G("method: "),B=b("span"),N=G(q),O=W(),E&&E.c(),M=W(),U&&U.c(),I=W(),L=b("button"),L.textContent="delete",D=W(),P=b("button"),P.textContent="modify",_(B,"class","svelte-1muk73i"),_(y,"class","svelte-1muk73i"),_(g,"class","property-list svelte-1muk73i")},m(z,J){F(z,e,J),d(e,n),d(e,o),F(z,i,J),F(z,r,J),d(r,u),d(r,a),d(r,f),F(z,p,J),F(z,h,J),d(h,v),F(z,w,J),F(z,g,J),d(g,y),d(y,S),d(y,B),d(B,N),d(g,O),E&&E.m(g,null),d(g,M),U&&U.m(g,null),F(z,I,J),F(z,L,J),F(z,D,J),F(z,P,J),H||(k=[K(L,"click",function(){de(t[1].delete)&&t[1].delete.apply(this,arguments)}),K(P,"click",function(){de(t[1].modify)&&t[1].modify.apply(this,arguments)})],H=!0)},p(z,J){t=z,J&1&&s!==(s=t[0].id+"")&&ne(o,s),J&1&&l!==(l=t[0].toId+"")&&ne(u,l),J&1&&c!==(c=t[0].fromId+"")&&ne(f,c),J&1&&m!==(m=ye.info.byMessageMethod[t[0].method]+"")&&ne(v,m),J&1&&q!==(q=t[0].method+"")&&ne(N,q),J&1&&(A=["REQUEST","ACCEPTED","ACCEPT"].indexOf(t[0].method)!==-1),A?E?E.p(t,J):(E=yt(t),E.c(),E.m(g,M)):E&&(E.d(1),E=null),J&1&&(T=["ACCEPT","ACCEPTED","PROMISE","PREPARE","IGNORED"].indexOf(t[0].method)!==-1),T?U?U.p(t,J):(U=wt(t),U.c(),U.m(g,null)):U&&(U.d(1),U=null)},d(z){z&&R(e),z&&R(i),z&&R(r),z&&R(p),z&&R(h),z&&R(w),z&&R(g),E&&E.d(),U&&U.d(),z&&R(I),z&&R(L),z&&R(D),z&&R(P),H=!1,le(k)}}}function Fs(t){let e;return{c(){e=b("span"),e.textContent="No valid element select"},m(n,s){F(n,e,s)},p:X,d(n){n&&R(e)}}}function bt(t){let e,n,s,o=(t[0].greatestN||0)+"",i;return{c(){e=b("li"),n=G("generation: "),s=b("span"),i=G(o),_(s,"class","svelte-1muk73i"),_(e,"class","svelte-1muk73i")},m(r,l){F(r,e,l),d(e,n),d(e,s),d(s,i)},p(r,l){l&1&&o!==(o=(r[0].greatestN||0)+"")&&ne(i,o)},d(r){r&&R(e)}}}function vt(t){let e,n,s,o,i;return{c(){e=b("input"),n=W(),s=b("button"),s.textContent="request",_(e,"type","text")},m(r,l){F(r,e,l),te(e,t[2]),F(r,n,l),F(r,s,l),o||(i=[K(e,"input",t[7]),K(s,"click",function(){de(t[4])&&t[4].apply(this,arguments)})],o=!0)},p(r,l){t=r,l&4&&e.value!==t[2]&&te(e,t[2])},d(r){r&&R(e),r&&R(n),r&&R(s),o=!1,le(i)}}}function yt(t){let e,n,s,o,i;return{c(){e=b("li"),n=G("value: "),s=b("input"),_(s,"type","text"),_(e,"class","svelte-1muk73i")},m(r,l){F(r,e,l),d(e,n),d(e,s),te(s,t[0].v),o||(i=K(s,"input",t[5]),o=!0)},p(r,l){l&1&&s.value!==r[0].v&&te(s,r[0].v)},d(r){r&&R(e),o=!1,i()}}}function wt(t){let e,n,s,o,i;return{c(){e=b("li"),n=G("generation: "),s=b("input"),_(s,"type","text"),_(e,"class","svelte-1muk73i")},m(r,l){F(r,e,l),d(e,n),d(e,s),te(s,t[0].n),o||(i=K(s,"input",t[6]),o=!0)},p(r,l){l&1&&s.value!==r[0].n&&te(s,r[0].n)},d(r){r&&R(e),o=!1,i()}}}function js(t){let e;function n(i,r){return i[0]?i[3]?Ds:Rs:Fs}let s=n(t),o=s(t);return{c(){e=b("div"),o.c(),_(e,"class","node-actions-panel")},m(i,r){F(i,e,r),o.m(e,null)},p(i,[r]){s===(s=n(i))&&o?o.p(i,r):(o.d(1),o=s(i),o&&(o.c(),o.m(e,null)))},i:X,o:X,d(i){i&&R(e),o.d()}}}function Bs(t,e,n){let{element:s}=e,{actions:o}=e;function i(h,m,v){v[s.id].postMessage({nodeId:s.id,isFlow:!0,type:"CLIENT_REQUEST",v:r})}let r="777",l="",u=!1,a=()=>{};Bt(()=>{o&&!u&&s&&s.type==="client"&&n(4,a=o.createNewAction(i)),s&&l!==s.id&&(n(2,r=s.id),l=s.id,n(3,u=s&&s.fromId))});function c(){s.v=this.value,n(0,s)}function f(){s.n=this.value,n(0,s)}function p(){r=this.value,n(2,r)}return t.$$set=h=>{"element"in h&&n(0,s=h.element),"actions"in h&&n(1,o=h.actions)},[s,o,r,u,a,c,f,p]}class Ws extends ce{constructor(e){super(),ue(this,e,Bs,js,ae,{element:0,actions:1})}}function kt(t,e,n){const s=t.slice();return s[2]=e[n],s}function Et(t,e,n){const s=t.slice();return s[5]=e[n],s}function St(t){let e,n=t[1].nodes.filter(It),s=[];for(let o=0;o<n.length;o+=1)s[o]=Tt(kt(t,n,o));return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=qe()},m(o,i){for(let r=0;r<s.length;r+=1)s[r].m(o,i);F(o,e,i)},p(o,i){if(i&2){n=o[1].nodes.filter(It);let r;for(r=0;r<n.length;r+=1){const l=kt(o,n,r);s[r]?s[r].p(l,i):(s[r]=Tt(l),s[r].c(),s[r].m(e.parentNode,e))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d(o){Ye(s,o),o&&R(e)}}}function Ot(t){let e,n=t[5]+"",s;return{c(){e=b("li"),s=G(n),_(e,"class","entry svelte-1o1yvcd")},m(o,i){F(o,e,i),d(e,s)},p(o,i){i&2&&n!==(n=o[5]+"")&&ne(s,n)},d(o){o&&R(e)}}}function Tt(t){let e,n,s=t[2].id+"",o,i,r,l,u,a=t[2].log,c=[];for(let f=0;f<a.length;f+=1)c[f]=Ot(Et(t,a,f));return{c(){e=b("li"),n=b("h1"),o=G(s),i=W(),r=b("ul");for(let f=0;f<c.length;f+=1)c[f].c();u=W(),_(n,"class","svelte-1o1yvcd"),_(r,"class",l=ge(t[1].selectedElementId===t[2].id?"selected":"")+" svelte-1o1yvcd"),_(e,"class","log svelte-1o1yvcd")},m(f,p){F(f,e,p),d(e,n),d(n,o),d(e,i),d(e,r);for(let h=0;h<c.length;h+=1)c[h].m(r,null);d(e,u)},p(f,p){if(p&2&&s!==(s=f[2].id+"")&&ne(o,s),p&2){a=f[2].log;let h;for(h=0;h<a.length;h+=1){const m=Et(f,a,h);c[h]?c[h].p(m,p):(c[h]=Ot(m),c[h].c(),c[h].m(r,null))}for(;h<c.length;h+=1)c[h].d(1);c.length=a.length}p&2&&l!==(l=ge(f[1].selectedElementId===f[2].id?"selected":"")+" svelte-1o1yvcd")&&_(r,"class",l)},d(f){f&&R(e),Ye(c,f)}}}function Hs(t){let e,n,s=t[0]&&St(t);return{c(){e=b("div"),n=b("ul"),s&&s.c(),_(n,"class","nodes svelte-1o1yvcd"),pn(e,"overflow","auto")},m(o,i){F(o,e,i),d(e,n),s&&s.m(n,null)},p(o,[i]){o[0]?s?s.p(o,i):(s=St(o),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:X,o:X,d(o){o&&R(e),s&&s.d()}}}const It=t=>t.type==="node"&&t.log;function qs(t,e,n){let s,o=X,i=()=>(o(),o=me(r,l=>n(1,s=l)),r);t.$$.on_destroy.push(()=>o());let{stateStore:r}=e;return i(),t.$$set=l=>{"stateStore"in l&&i(n(0,r=l.stateStore))},[r,s]}class Gs extends ce{constructor(e){super(),ue(this,e,qs,Hs,ae,{stateStore:0})}}const Us="Paxos",Yt="paxos",Xs={seqPaintingOptions:Ts,nodePaintingOptions:Is,paintState:Ns},zs={Configuration:Ls,Actions:Ws,StateGraph:Gs};var Ks=Object.freeze(Object.defineProperty({__proto__:null,title:Us,key:Yt,drawing:Xs,components:zs,setupNode:Ut,generateState:Jt,defaultConfig:Qt},Symbol.toStringTag,{value:"Module"}));V(j({},He),{getText:t=>t.command==="rawtransaction"?`${t.command} (${t.tx})`:t.command==="submitblock"&&t.block.transactions?`${t.command} (${t.block.transactions.join(", ")})`:`${t.command}`});const Se={[Yt]:Ks};function Js(t=Se.paxos){let e=j({},Gt);e=j(j({},e),t&&t.defaultConfig?t.defaultConfig:Qt);const n=De(e);n.subscribe(l=>{e=l});const s=t&&t.generateState?t.generateState:Jt,o=De(s(e));o.subscribe(l=>{});const i=De(null);i.subscribe(l=>{});const r=Qs(t,e,o,i,n);return n.subscribe(r),r(e),[n,o,i]}function Qs(t,e,n,s,o){let i=null;return r=>{if(i&&i.key===r.algorithm&&i.useWorkers===r.useWorkers)return i=r,r;if(i=r,t.key!==r.algorithm){t=Se[r.algorithm],t||console.error("algorithm not supported");const l={};Object.keys(Gt).forEach(u=>{l[u]=r[u]}),r=j(j({},l),t.defaultConfig)}return Vt(t,r,n,s,o),r}}function Vt(t,e,n,s,o){const i=()=>()=>Vt(t,e,n,s,o),l=t.generateState(e);n.update(()=>l);const[u,a]=bs(Nt(e,o),Nt(l,n),i());return s.update(c=>(c&&c.simulation&&c.simulation.terminate(),a)),l}function Nt(t,e){let n=t;return e.subscribe(s=>n=s),{value:n,update:e.update}}function Ys(t){let e,n,s,o;return{c(){e=b("span"),n=G("Layout '"),s=G(t[0]),o=G("' not supported")},m(i,r){F(i,e,r),d(e,n),d(e,s),d(e,o)},p(i,r){r&1&&ne(s,i[0])},i:X,o:X,d(i){i&&R(e)}}}function Vs(t){let e,n;const s=[t[1]];let o={};for(let i=0;i<s.length;i+=1)o=Pe(o,s[i]);return e=new Jn({props:o}),{c(){re(e.$$.fragment)},m(i,r){se(e,i,r),n=!0},p(i,r){const l=r&2?je(s,[Be(i[1])]):{};e.$set(l)},i(i){n||(Y(e.$$.fragment,i),n=!0)},o(i){$(e.$$.fragment,i),n=!1},d(i){oe(e,i)}}}function Zs(t){let e,n,s,o;const i=[Vs,Ys],r=[];function l(u,a){return u[0]==="full"?0:1}return e=l(t),n=r[e]=i[e](t),{c(){n.c(),s=qe()},m(u,a){r[e].m(u,a),F(u,s,a),o=!0},p(u,[a]){let c=e;e=l(u),e===c?r[e].p(u,a):(ke(),$(r[c],1,1,()=>{r[c]=null}),Ee(),n=r[e],n?n.p(u,a):(n=r[e]=i[e](u),n.c()),Y(n,1),n.m(s.parentNode,s))},i(u){o||(Y(n),o=!0)},o(u){$(n),o=!1},d(u){r[e].d(u),u&&R(s)}}}function $s(t,e,n){let{layout:s="full"}=e,{registerAlgorithm:o}=e,{unregisterAlgorithm:i}=e;const[r,l,u]=Js();let a,c;r.subscribe(p=>{a=Se[p.algorithm],a.labels}),l.subscribe(p=>{window.states||(window.stateIdx=-1,window.states=[]);const{nodes:h,messages:m}=p;window.stateIdx+=1,window.states.push({nodes:h,messages:m})}),u.subscribe(p=>{c=p}),Ge(()=>{o&&o(r,l)}),Ze(()=>{i&&i(r,l),c&&c.simulation.terminate()});const f={configStore:r,stateStore:l,controlsStore:u,algorithm:a,algorithms:Se};return t.$$set=p=>{"layout"in p&&n(0,s=p.layout),"registerAlgorithm"in p&&n(2,o=p.registerAlgorithm),"unregisterAlgorithm"in p&&n(3,i=p.unregisterAlgorithm)},[s,f,o,i]}class xs extends ce{constructor(e){super(),ue(this,e,$s,Zs,ae,{layout:0,registerAlgorithm:2,unregisterAlgorithm:3})}}function eo(t){let e;return{c(){e=b("footer"),e.innerHTML=`<div class="content svelte-4jochn"><div class="brand svelte-4jochn"><img alt="logo" src="/favicon/android-icon-48x48.png" class="svelte-4jochn"/><span class="svelte-4jochn">Visual Consensus</span></div> 
        <div class="links svelte-4jochn"><p>Links</p> 
            <a href="https://github.com/jojahn/visual-consensus" class="svelte-4jochn">Source Code</a> 
            <a href="https://github.com/jojahn/visual-consensus/blob/main/latex/thesis.pdf" class="svelte-4jochn">Thesis</a> 
            <a href="about.html#ThirdPartyLicenses" class="svelte-4jochn">Third Party Licenses</a></div></div> 
    <div><p class="rights svelte-4jochn">Licensed under <a href="https://github.com/jojahn/visual-consensus/LICENSE" class="svelte-4jochn">MIT</a></p> 
        <p class="rights svelte-4jochn">2022 <a href="https://github.com/jojahn/visual-consensus/graphs/contributors" class="svelte-4jochn">contributers</a></p></div>`,_(e,"class","svelte-4jochn")},m(n,s){F(n,e,s)},p:X,i:X,o:X,d(n){n&&R(e)}}}class to extends ce{constructor(e){super(),ue(this,e,null,eo,ae,{})}}function Pt(t,e,n){const s=t.slice();return s[5]=e[n],s}function Ct(t){let e,n,s=t[5].title+"",o,i,r,l;return{c(){e=b("li"),n=b("button"),o=G(s),_(n,"class","svelte-1slpat4"),_(e,"class",i=ge(t[0]===t[5].key?"active":"")+" svelte-1slpat4")},m(u,a){F(u,e,a),d(e,n),d(n,o),r||(l=K(n,"click",t[1](t[5].key)),r=!0)},p(u,a){t=u,a&1&&i!==(i=ge(t[0]===t[5].key?"active":"")+" svelte-1slpat4")&&_(e,"class",i)},d(u){u&&R(e),r=!1,l()}}}function no(t){let e,n,s,o,i,r=Object.values(Se),l=[];for(let u=0;u<r.length;u+=1)l[u]=Ct(Pt(t,r,u));return{c(){e=b("header"),n=b("nav"),s=b("ul");for(let u=0;u<l.length;u+=1)l[u].c();o=W(),i=b("li"),i.innerHTML='<a href="/about.html" class="svelte-1slpat4">About</a>',_(i,"class","svelte-1slpat4"),_(s,"class","svelte-1slpat4"),_(n,"class","svelte-1slpat4"),_(e,"class","svelte-1slpat4")},m(u,a){F(u,e,a),d(e,n),d(n,s);for(let c=0;c<l.length;c+=1)l[c].m(s,null);d(s,o),d(s,i)},p(u,[a]){if(a&3){r=Object.values(Se);let c;for(c=0;c<r.length;c+=1){const f=Pt(u,r,c);l[c]?l[c].p(f,a):(l[c]=Ct(f),l[c].c(),l[c].m(s,o))}for(;c<l.length;c+=1)l[c].d(1);l.length=r.length}},i:X,o:X,d(u){u&&R(e),Ye(l,u)}}}function so(t,e,n){let{selectedAlgorithm:s}=e,{changeAlgorithm:o}=e,{share:i}=e;const r=l=>()=>o(l);return t.$$set=l=>{"selectedAlgorithm"in l&&n(0,s=l.selectedAlgorithm),"changeAlgorithm"in l&&n(2,o=l.changeAlgorithm),"share"in l&&n(3,i=l.share)},[s,r,o,i]}class oo extends ce{constructor(e){super(),ue(this,e,so,no,ae,{selectedAlgorithm:0,changeAlgorithm:2,share:3})}}var Zt={};(function(t){(function(e){e([],function(){var n=-1,s=-2,o=-3,i=-4,r=-5,l=function(m,v){v=v||{};var w=v.verbose||!1;w&&console.log("Normalize the JSON Object"),m=typeof m=="string"?this.JSON.parse(m):m,w&&console.log("Creating a empty dictionary");var g={strings:[],integers:[],floats:[]};w&&console.log("Creating the AST");var y=function N(O){w&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(O));var A=typeof O;if(O===null)return{type:"null",index:o};if(typeof O=="undefined")return{type:"undefined",index:r};if(O instanceof Array){var M=["@"];for(var T in O)!O.hasOwnProperty(T)||M.push(N(O[T]));return M}if(A==="object"){var M=["$"];for(var I in O)!O.hasOwnProperty(I)||(M.push(N(I)),M.push(N(O[I])));return M}if(O==="")return{type:"empty",index:i};if(A==="string"){var L=h.call(g.strings,O);return L==-1&&(g.strings.push(a(O)),L=g.strings.length-1),{type:"strings",index:L}}if(A==="number"&&O%1===0){var L=h.call(g.integers,O);return L==-1&&(g.integers.push(f(O)),L=g.integers.length-1),{type:"integers",index:L}}if(A==="number"){var L=h.call(g.floats,O);return L==-1&&(g.floats.push(O),L=g.floats.length-1),{type:"floats",index:L}}if(A==="boolean")return{type:"boolean",index:O?n:s};throw new Error("Unexpected argument of type "+typeof O)}(m),S=g.strings.length,B=g.integers.length;g.floats.length,w&&console.log("Parsing the dictionary");var q=g.strings.join("|");return q+="^"+g.integers.join("|"),q+="^"+g.floats.join("|"),w&&console.log("Parsing the structure"),q+="^"+function N(O){if(w&&console.log("Calling a recursiveParser with "+this.JSON.stringify(O)),O instanceof Array){var A=O.shift();for(var M in O)!O.hasOwnProperty(M)||(A+=N(O[M])+"|");return(A[A.length-1]==="|"?A.slice(0,-1):A)+"]"}var T=O.type,I=O.index;if(T==="strings")return f(I);if(T==="integers")return f(S+I);if(T==="floats")return f(S+B+I);if(T==="boolean")return O.index;if(T==="null")return o;if(T==="undefined")return r;if(T==="empty")return i;throw new TypeError("The item is alien!")}(y),w&&console.log("Ending parser"),v.debug?{dictionary:g,ast:y,packed:q}:q},u=function(m,v){v=v||{};var w=m.split("^");v.verbose&&console.log("Building dictionary");var g=[],y=w[0];if(y!==""){y=y.split("|"),v.verbose&&console.log("Parse the strings dictionary");for(var S=0,B=y.length;S<B;S++)g.push(c(y[S]))}if(y=w[1],y!==""){y=y.split("|"),v.verbose&&console.log("Parse the integers dictionary");for(var S=0,B=y.length;S<B;S++)g.push(p(y[S]))}if(y=w[2],y!==""){y=y.split("|"),v.verbose&&console.log("Parse the floats dictionary");for(var S=0,B=y.length;S<B;S++)g.push(parseFloat(y[S]))}y=null,v.verbose&&console.log("Tokenizing the structure");for(var q="",N=[],O=w[3].length,S=0;S<O;S++){var A=w[3].charAt(S);A==="|"||A==="$"||A==="@"||A==="]"?(q&&(N.push(p(q)),q=""),A!=="|"&&N.push(A)):q+=A}var M=N.length,T=0;return v.verbose&&console.log("Starting recursive parser"),function I(){var L=N[T++];if(v.verbose&&console.log("Reading collection type "+(L==="$"?"object":"Array")),L==="@"){for(var D=[];T<M;T++){var P=N[T];if(v.verbose&&console.log("Read "+P+" symbol"),P==="]")return D;if(P==="@"||P==="$")D.push(I());else switch(P){case n:D.push(!0);break;case s:D.push(!1);break;case o:D.push(null);break;case r:D.push(void 0);break;case i:D.push("");break;default:D.push(g[P])}}return v.verbose&&console.log("Parsed "+this.JSON.stringify(D)),D}if(L==="$"){for(var D={};T<M;T++){var H=N[T];if(H==="]")return D;H===i?H="":H=g[H];var P=N[++T];if(P==="@"||P==="$")D[H]=I();else switch(P){case n:D[H]=!0;break;case s:D[H]=!1;break;case o:D[H]=null;break;case r:D[H]=void 0;break;case i:D[H]="";break;default:D[H]=g[P]}}return v.verbose&&console.log("Parsed "+this.JSON.stringify(D)),D}throw new TypeError("Bad token "+L+" isn't a type")}()},a=function(m){return typeof m!="string"?m:m.replace(/[\+ \|\^\%]/g,function(v){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[v]})},c=function(m){return typeof m!="string"?m:m.replace(/\+|%2B|%7C|%5E|%25/g,function(v){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[v]})},f=function(m){return Number.prototype.toString.call(m,36).toUpperCase()},p=function(m){return parseInt(m,36)},h=Array.prototype.indexOf||function(m,v){for(var w=v||0,g=this.length;w<g;w++)if(this[w]===m)return w;return-1};return{JSON,pack:l,unpack:u}})})(function(e,n){var s=n();for(var o in s)t[o]=s[o]})})(Zt);function At(t){let e=t;return e=Zt.pack(t),e=window.btoa?btoa(e):e,e}function ro(t,e){const n=At(t),s=At(e),o="/?config="+n+"&state="+s;io(),navigator.clipboard.writeText(location.origin+o)}function io(t){const e="Visual Consensus",n={additionalInformation:"URL"};window.history.pushState(n,e,t)}function lo(t){let e;return{c(){e=b("span"),e.textContent="Layout not supported!"},m(n,s){F(n,e,s)},p:X,i:X,o:X,d(n){n&&R(e)}}}function ao(t){let e,n;return e=new xs({props:{registerAlgorithm:t[4],unregisterAlgorithm:t[5],layout:$t}}),{c(){re(e.$$.fragment)},m(s,o){se(e,s,o),n=!0},p:X,i(s){n||(Y(e.$$.fragment,s),n=!0)},o(s){$(e.$$.fragment,s),n=!1},d(s){oe(e,s)}}}function uo(t){let e,n,s,o,i,r,l,u,a,c=!1;s=new oo({props:{layout:$t,changeAlgorithm:t[3],selectedAlgorithm:t[1],share:t[2]}});const f=[ao,lo],p=[];function h(m,v){return 0}return i=h(),r=p[i]=f[i](t),u=new to({}),{c(){e=b("main"),n=W(),re(s.$$.fragment),o=W(),r.c(),l=W(),re(u.$$.fragment)},m(m,v){F(m,e,v),d(e,n),se(s,e,null),d(e,o),p[i].m(e,null),d(e,l),se(u,e,null),a=!0},p(m,[v]){const w={};v&2&&(w.selectedAlgorithm=m[1]),s.$set(w),r.p(m,v)},i(m){a||(Y(c),Y(s.$$.fragment,m),Y(r),Y(u.$$.fragment,m),a=!0)},o(m){$(c),$(s.$$.fragment,m),$(r),$(u.$$.fragment,m),a=!1},d(m){m&&R(e),oe(s),p[i].d(),oe(u)}}}let $t="full";function co(t,e,n){let s=[],o="paxos";function i(){s&&s[0]&&ro(s[0])}function r(a){n(1,o=a),s&&s[0]&&s[0].config.update(c=>V(j({},c),{algorithm:a}))}function l(a,c){s.push({config:a,state:c})}function u(a,c){n(0,s=s.filter(f=>f.config!==a&&f.state&&c))}return[s,o,i,r,l,u]}class fo extends ce{constructor(e){super(),ue(this,e,co,uo,ae,{})}}new fo({target:document.getElementById("app")});export{po as __vite_legacy_guard};
