var Cn=Object.defineProperty,An=Object.defineProperties;var Mn=Object.getOwnPropertyDescriptors;var st=Object.getOwnPropertySymbols;var Ln=Object.prototype.hasOwnProperty,Rn=Object.prototype.propertyIsEnumerable;var it=(t,e,n)=>e in t?Cn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,X=(t,e)=>{for(var n in e||(e={}))Ln.call(e,n)&&it(t,n,e[n]);if(st)for(var n of st(e))Rn.call(e,n)&&it(t,n,e[n]);return t},te=(t,e)=>An(t,Mn(e));function ol(){import("data:text/javascript,")}const Dn=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};Dn();function Q(){}function Me(t,e){for(const n in e)t[n]=e[n];return t}function Zt(t){return t()}function lt(){return Object.create(null)}function re(t){t.forEach(Zt)}function ue(t){return typeof t=="function"}function ae(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function jn(t){return Object.keys(t).length===0}function de(t,...e){if(t==null)return Q;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function xt(t,e,n,s){if(t){const i=en(t,e,n,s);return t[0](i)}}function en(t,e,n,s){return t[1]&&s?Me(n.ctx.slice(),t[1](s(e))):n.ctx}function tn(t,e,n,s){if(t[2]&&s){const i=t[2](s(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],l=Math.max(e.dirty.length,i.length);for(let a=0;a<l;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function nn(t,e,n,s,i,o){if(i){const l=en(e,n,s,o);t.p(l,i)}}function sn(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let s=0;s<n;s++)e[s]=-1;return e}return-1}function be(t){return t==null?"":t}function c(t,e){t.appendChild(e)}function w(t,e,n){t.insertBefore(e,n||null)}function k(t){t.parentNode.removeChild(t)}function ve(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function M(t){return document.createTextNode(t)}function D(){return M(" ")}function we(){return M("")}function V(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function p(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function le(t){return t===""?null:+t}function Fn(t){return Array.from(t.childNodes)}function Z(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function ne(t,e){t.value=e==null?"":e}function ln(t,e,n,s){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,s?"important":"")}function ot(t,e){for(let n=0;n<t.options.length;n+=1){const s=t.options[n];if(s.__value===e){s.selected=!0;return}}t.selectedIndex=-1}function Hn(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}let Le;function Ce(t){Le=t}function Ve(){if(!Le)throw new Error("Function called outside component initialization");return Le}function Xe(t){Ve().$$.on_mount.push(t)}function Ze(t){Ve().$$.after_update.push(t)}function xe(t){Ve().$$.on_destroy.push(t)}const Pe=[],$e=[],je=[],rt=[],Bn=Promise.resolve();let Je=!1;function Wn(){Je||(Je=!0,Bn.then(on))}function Be(t){je.push(t)}const Ke=new Set;let Re=0;function on(){const t=Le;do{for(;Re<Pe.length;){const e=Pe[Re];Re++,Ce(e),qn(e.$$)}for(Ce(null),Pe.length=0,Re=0;$e.length;)$e.pop()();for(let e=0;e<je.length;e+=1){const n=je[e];Ke.has(n)||(Ke.add(n),n())}je.length=0}while(Pe.length);for(;rt.length;)rt.pop()();Je=!1,Ke.clear(),Ce(t)}function qn(t){if(t.fragment!==null){t.update(),re(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Be)}}const Fe=new Set;let ke;function pe(){ke={r:0,c:[],p:ke}}function me(){ke.r||re(ke.c),ke=ke.p}function x(t,e){t&&t.i&&(Fe.delete(t),t.i(e))}function ee(t,e,n,s){if(t&&t.o){if(Fe.has(t))return;Fe.add(t),ke.c.push(()=>{Fe.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}else s&&s()}function We(t,e){const n={},s={},i={$$scope:1};let o=t.length;for(;o--;){const l=t[o],a=e[o];if(a){for(const r in l)r in a||(s[r]=1);for(const r in a)i[r]||(n[r]=a[r],i[r]=1);t[o]=a}else for(const r in l)i[r]=1}for(const l in s)l in n||(n[l]=void 0);return n}function qe(t){return typeof t=="object"&&t!==null?t:{}}function oe(t){t&&t.c()}function se(t,e,n,s){const{fragment:i,on_mount:o,on_destroy:l,after_update:a}=t.$$;i&&i.m(e,n),s||Be(()=>{const r=o.map(Zt).filter(ue);l?l.push(...r):re(r),t.$$.on_mount=[]}),a.forEach(Be)}function ie(t,e){const n=t.$$;n.fragment!==null&&(re(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Gn(t,e){t.$$.dirty[0]===-1&&(Pe.push(t),Wn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ce(t,e,n,s,i,o,l,a=[-1]){const r=Le;Ce(t);const u=t.$$={fragment:null,ctx:null,props:o,update:Q,not_equal:i,bound:lt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(r?r.$$.context:[])),callbacks:lt(),dirty:a,skip_bound:!1,root:e.target||r.$$.root};l&&l(u.root);let f=!1;if(u.ctx=n?n(t,e.props||{},(d,_,...g)=>{const m=g.length?g[0]:_;return u.ctx&&i(u.ctx[d],u.ctx[d]=m)&&(!u.skip_bound&&u.bound[d]&&u.bound[d](m),f&&Gn(t,d)),_}):[],u.update(),f=!0,re(u.before_update),u.fragment=s?s(u.ctx):!1,e.target){if(e.hydrate){const d=Fn(e.target);u.fragment&&u.fragment.l(d),d.forEach(k)}else u.fragment&&u.fragment.c();e.intro&&x(t.$$.fragment),se(t,e.target,e.anchor,e.customElement),on()}Ce(r)}class fe{$destroy(){ie(this,1),this.$destroy=Q}$on(e,n){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const i=s.indexOf(n);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!jn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Un=t=>({config:t&1}),at=t=>({config:t[0]});function Xn(t){let e,n,s,i,o,l,a,r,u,f,d,_,g,m,v,E,b,y,A,H,G,j,I,L,S,N,P;const T=t[5]["algorithm-config"],R=xt(T,t,t[4],at);return{c(){e=h("form"),n=h("div"),s=h("div"),i=h("label"),i.textContent="Network Delay",o=D(),l=h("div"),a=h("input"),r=D(),u=h("span"),u.textContent="ms",f=D(),d=h("div"),_=h("label"),_.textContent="Command Delay",g=D(),m=h("div"),v=h("input"),E=D(),b=h("span"),b.textContent="ms",y=D(),A=h("div"),H=h("label"),H.textContent="Use WebWorkers",G=D(),j=h("input"),I=D(),R&&R.c(),p(i,"for","NetworkDelayInput"),p(i,"class","svelte-1yd6c5a"),p(a,"id","NetworkDelayInput"),p(a,"type","number"),p(a,"min","0"),p(a,"max","60000"),p(l,"class","svelte-1yd6c5a"),p(s,"class","input-group svelte-1yd6c5a"),p(_,"for","CommandDelayInput"),p(_,"class","svelte-1yd6c5a"),p(v,"id","CommandDelayInput"),p(v,"type","number"),p(v,"min","0"),p(v,"max","60000"),p(m,"class","svelte-1yd6c5a"),p(d,"class","input-group svelte-1yd6c5a"),p(H,"for","UseWebWorkersInput"),p(H,"class","svelte-1yd6c5a"),p(j,"id","UseWebWorkersInput"),j.disabled=!0,p(j,"type","checkbox"),p(j,"class","svelte-1yd6c5a"),p(A,"class","input-group svelte-1yd6c5a"),p(n,"class","options svelte-1yd6c5a"),p(e,"class",L=be("config-form"+t[1]?" full-layout":"")+" svelte-1yd6c5a")},m(F,W){w(F,e,W),c(e,n),c(n,s),c(s,i),c(s,o),c(s,l),c(l,a),ne(a,t[2].networkDelay),c(l,r),c(l,u),c(n,f),c(n,d),c(d,_),c(d,g),c(d,m),c(m,v),ne(v,t[2].commandDelay),c(m,E),c(m,b),c(n,y),c(n,A),c(A,H),c(A,G),c(A,j),j.checked=t[2].useWorkers,c(e,I),R&&R.m(e,null),S=!0,N||(P=[V(a,"input",t[6]),V(v,"input",t[7]),V(j,"change",t[8]),V(e,"submit",t[3])],N=!0)},p(F,[W]){W&4&&le(a.value)!==F[2].networkDelay&&ne(a,F[2].networkDelay),W&4&&le(v.value)!==F[2].commandDelay&&ne(v,F[2].commandDelay),W&4&&(j.checked=F[2].useWorkers),R&&R.p&&(!S||W&17)&&nn(R,T,F,F[4],S?tn(T,F[4],W,Un):sn(F[4]),at),(!S||W&2&&L!==(L=be("config-form"+F[1]?" full-layout":"")+" svelte-1yd6c5a"))&&p(e,"class",L)},i(F){S||(x(R,F),S=!0)},o(F){ee(R,F),S=!1},d(F){F&&k(e),R&&R.d(F),N=!1,re(P)}}}function zn(t,e,n){let s,i=Q,o=()=>(i(),i=de(r,m=>n(2,s=m)),r);t.$$.on_destroy.push(()=>i());let{$$slots:l={},$$scope:a}=e,{configStore:r}=e;o();let{fullLayout:u=!1}=e;const f=m=>{m.preventDefault()};function d(){s.networkDelay=le(this.value),r.set(s)}function _(){s.commandDelay=le(this.value),r.set(s)}function g(){s.useWorkers=this.checked,r.set(s)}return t.$$set=m=>{"configStore"in m&&o(n(0,r=m.configStore)),"fullLayout"in m&&n(1,u=m.fullLayout),"$$scope"in m&&n(4,a=m.$$scope)},[r,u,s,f,a,l,d,_,g]}class Kn extends fe{constructor(e){super(),ce(this,e,zn,Xn,ae,{configStore:0,fullLayout:1})}}const Ee=[];function He(t,e=Q){let n;const s=new Set;function i(a){if(ae(t,a)&&(t=a,n)){const r=!Ee.length;for(const u of s)u[1](),Ee.push(u,t);if(r){for(let u=0;u<Ee.length;u+=2)Ee[u][0](Ee[u+1]);Ee.length=0}}}function o(a){i(a(t))}function l(a,r=Q){const u=[a,r];return s.add(u),s.size===1&&(n=e(i)||Q),a(t),()=>{s.delete(u),s.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:l}}function rn(t,e){const n=new Date(t.sent).getTime(),s=new Date(e.sent).getTime();return n<s?-1:n>s?1:Qn(t,e)}function Qn(t,e){return t.id>e.id?-1:t.id<e.id?1:0}function $n(t,e){return(n,s)=>{const i=r=>e(s,r)&&Math.abs(new Date(r.sent).getTime()-new Date(s.sent).getTime())<t,o=r=>r.findIndex(u=>i(u)),a=(()=>n.findIndex(r=>Array.isArray(r)?o(r)!==-1:i(r)))();return a!==-1&&n[a]&&Array.isArray(n[a])?n[a].push(s):a!==-1&&a?n[a]=[n[a],s]:n.push(s),n}}const _e={disabledNode:"",messageFill:"#FA3",messageOutline:"#000",highlight:"#F497A4",messageLine:"#DDD"},ut={nodeRadius:24,messageRadius:8,paintNodeText:t=>t.id,isLeader:()=>{},paintMessageText:()=>{},arrowLength:6};function Ge(t,e,n,s=ut){if(t.save(),s=X(X({},ut),s),!e)return[t.canvas.width,t.canvas.height];let i=0,o=0;return e.messages.filter(l=>!l.done&&l.pos).forEach(l=>{t.beginPath();let a=e.nodes.filter(u=>u.id===l.fromId)[0].pos,r=e.nodes.filter(u=>u.id===l.toId)[0].pos;l.id===e.selectedElementId&&(t.lineWidth=4,t.strokeStyle=_e.highlight,t.moveTo(...a),t.lineTo(...r),t.stroke()),t.lineWidth=1,t.strokeStyle="#DDD",t.moveTo(...a),t.lineTo(...r),t.stroke(),t.closePath()}),e.messages.filter(l=>!l.done&&l.pos).sort(rn).forEach(l=>{l.id===e.selectedElementId&&(t.beginPath(),t.fillStyle=_e.highlight,t.arc(l.pos[0],l.pos[1],s.messageRadius+5,0,2*Math.PI),t.fill(),t.closePath()),t.beginPath();const a=e.nodes.filter(b=>b.id===l.fromId)[0].pos,r=e.nodes.filter(b=>b.id===l.toId)[0].pos,u=Math.sqrt(Math.pow(a[0]-r[0],2)+Math.pow(a[1]-r[1],2)),f=s.messageRadius+s.arrowLength,d=[l.pos[0]+f/u*(r[0]-a[0]),l.pos[1]+f/u*(r[1]-a[1])],_=[l.pos[0]+s.messageRadius/u*(a[0]-r[0]),l.pos[1]+s.messageRadius/u*(a[1]-r[1])],g=(b,y)=>[Math.cos(y)*b[0]-Math.sin(y)*b[1],Math.sin(y)*b[0]+Math.cos(y)*b[1]],m=(b,y)=>{let A=[b[0]-l.pos[0],b[1]-l.pos[1]];return A=g(A,y),[A[0]+l.pos[0],A[1]+l.pos[1]]},v=m(_,Math.PI/2+.5),E=m(_,-Math.PI/2-.5);t.fillStyle=_e.messageOutline,t.strokeStyle=_e.messageOutline,t.moveTo(...v),t.lineTo(...d),t.lineTo(...E),t.stroke(),t.fill(),t.closePath(),t.beginPath(),t.lineWidth=2,t.strokeStyle=_e.messageOutline,t.fillStyle=_e.messageFill,t.arc(l.pos[0],l.pos[1],s.messageRadius,0,2*Math.PI),t.stroke(),t.fill(),t.isPointInPath(n.position[0],n.position[1])&&(t.canvas.style.setProperty("cursor","pointer","important"),n.hits.map(b=>b.id).indexOf(l.id)===-1&&n.hits.push(l)),t.closePath()}),e.nodes.filter(l=>l&&l.pos&&l.id).forEach(l=>{t.beginPath(),t.lineWidth=5,t.fillStyle="#ADD495",t.strokeStyle="#80B7A2",l.connected?s.isLeader(l)&&(t.fillStyle="#EE2",t.strokeStyle="#DD0"):(t.fillStyle="#DDD",t.strokeStyle="#AAA"),t.arc(l.pos[0],l.pos[1],s.nodeRadius,0,2*Math.PI),t.stroke(),i=Math.max(i,l.pos[0]),o=Math.max(o,l.pos[1]),t.fill(),t.isPointInPath(n.position[0],n.position[1])&&(t.canvas.style.setProperty("cursor","pointer","important"),n.hits.map(a=>a.id).indexOf(l.id)===-1&&n.hits.push(l)),t.closePath(),s.paintNodeText(t,l),t.beginPath(),t.fillStyle="#FFF",l.connected?s.isLeader(l)&&(t.fillStyle="#000"):t.fillStyle="#000",t.font="bold 20px courier new",t.fillText(l.id,l.pos[0]-12,l.pos[1]+5),t.closePath()}),e.selectedElementId&&e.nodes.filter(l=>l.id===e.selectedElementId).forEach(l=>{t.beginPath(),t.strokeStyle="#F497A4",t.lineWidth=5,t.arc(l.pos[0],l.pos[1],s.nodeRadius+5,0,2*Math.PI),t.stroke(),t.closePath()}),t.restore(),[i,o]}function Jn(t,e,{subscribe:n},s=Ge,i={autoAlign:"CENTER"},{onHover:o,onHoverEnd:l,onClick:a,updateState:r}={}){let u=1,f=[0,0],d=!1,_=null;n(N=>{_=N});const g=t.getContext("2d",{alpha:!1});var m=1,v=t.getBoundingClientRect();t.width=v.width*m,t.height=v.height*m,g.scale(m,m);const E={hits:[],position:[0,0]},b=N=>{if(t.style.cursor="default",E.hits.length>0){const R=E.hits[0];o&&o(R)}else l&&l();let P=N.clientX+document.body.scrollLeft-t.offsetLeft,T=N.clientY+document.body.scrollTop-t.offsetTop;E.position=[P+window.scrollX,T+window.scrollY],E.hits=[]};t.addEventListener("mousemove",b);const y=()=>{if(E.hits[0]){let N=E.hits[0];_.selectedElementId=N.id,r&&r(P=>te(X({},P),{selectedElementId:N.id})),a&&a(N)}};t.addEventListener("mousedown",y);let A={fps:0},H=[0,0];t.width,t.height;let G=0,j=0,I=!1;var L=[];t.width!==t.parentElement.clientWidth&&(t.width=t.parentElement.clientWidth,t.height=t.parentElement.clientHeight,t.parentElement.clientHeight);function S(){switch(i.autoAlign){case"TOP_TO_BOTTOM":j>t.height&&(t.height=j,t.parentElement.style.overflowY="scroll",d&&t.parentElement.scrollTo(0,t.parentElement.scrollHeight));break}g.fillStyle="#FFF",g.fillRect(0,0,t.width,t.height),g.scale(u/m,u/m);let N=f[0],P=f[1];switch(i.autoAlign){case"TOP_TO_BOTTOM":N=f[0]+H[0]/2-G/2,P=10;break;case"CENTER":N=f[0]+H[0]/2-G/2,P=f[1]+H[1]/2-j/2;break}g.translate(N,P),H=[t.width/2,t.height/2],[G,j]=s(g,_,E,i);const T=performance.now();for(;L.length>0&&L[0]<=T-1e3;)L.shift();L.push(T),A.fps=L.length,g.translate(-N,-P),g.scale(m*1/u,m*1/u),I||requestAnimationFrame(S)}return S(),{context:g,debugInfo:A,zoom:N=>{u=N||1},pan:N=>{f=N},setLock:N=>{d=N},remove:()=>{I=!0,g.fillStyle="#FFF",g.fillRect(0,0,640,480),t.removeEventListener("mousedown",y),t.removeEventListener("mousemove",b)}}}const Yn=t=>({offsetX:t[0]&16,offsetY:t[0]&32}),ct=t=>({hoveredElement:t[12],offsetX:t[4],offsetY:t[5]});function Vn(t){let e;return{c(){e=h("p"),p(e,"class","svelte-1jb7q7x")},m(n,s){w(n,e,s)},p:Q,d(n){n&&k(e)}}}function Zn(t){let e;return{c(){e=h("span"),e.textContent="unlock"},m(n,s){w(n,e,s)},d(n){n&&k(e)}}}function xn(t){let e;return{c(){e=h("span"),e.textContent="lock"},m(n,s){w(n,e,s)},d(n){n&&k(e)}}}function es(t){let e,n,s,i,o,l,a,r,u,f,d,_,g,m,v,E,b,y,A,H,G,j,I,L;function S(C,K){return Vn}let P=S()(t);function T(C,K){return C[7]?xn:Zn}let R=T(t),F=R(t);const W=t[28].hover,O=xt(W,t,t[27],ct);return{c(){e=h("div"),n=h("div"),P.c(),s=D(),i=h("button"),F.c(),o=D(),l=h("button"),l.textContent="Reset",a=D(),r=h("div"),u=h("button"),u.textContent="-",f=D(),d=h("p"),_=M(t[10]),g=M("x"),m=D(),v=h("button"),v.textContent="+",E=D(),b=h("canvas"),A=D(),O&&O.c(),H=D(),G=h("div"),G.innerHTML=`<span>Pan: <kbd>LeftCtrl</kbd> + Hold <kbd>MouseLeft</kbd></span> 
    <span>Zoom: <kbd>LeftCtrl</kbd> + <kbd>MouseWheel</kbd></span>`,p(d,"class","svelte-1jb7q7x"),p(r,"class","zoom svelte-1jb7q7x"),p(n,"class","controls-section svelte-1jb7q7x"),p(b,"class",y=be(t[11].hoveredElement?"clickable":t[9]?"moving":t[7]&&t[8]?"movable":"")+" svelte-1jb7q7x"),p(b,"id",t[0]),p(b,"width","640"),p(b,"height","480"),p(e,"class","canvas-wrapper svelte-1jb7q7x"),p(G,"class","help svelte-1jb7q7x")},m(C,K){w(C,e,K),c(e,n),P.m(n,null),c(n,s),c(n,i),F.m(i,null),c(n,o),c(n,l),c(n,a),c(n,r),c(r,u),c(r,f),c(r,d),c(d,_),c(d,g),c(r,m),c(r,v),c(e,E),c(e,b),t[31](b),c(e,A),O&&O.m(e,null),w(C,H,K),w(C,G,K),j=!0,I||(L=[V(i,"click",t[13]),V(l,"click",t[18]),V(u,"click",t[29]),V(v,"click",t[30]),V(b,"mousemove",t[16]),V(b,"mousedown",t[14]),V(b,"mouseup",t[15]),V(b,"mouseleave",t[17]),V(e,"drop",ss),V(e,"dragover",is)],I=!0)},p(C,K){P.p(C,K),R!==(R=T(C))&&(F.d(1),F=R(C),F&&(F.c(),F.m(i,null))),(!j||K[0]&1024)&&Z(_,C[10]),(!j||K[0]&2944&&y!==(y=be(C[11].hoveredElement?"clickable":C[9]?"moving":C[7]&&C[8]?"movable":"")+" svelte-1jb7q7x"))&&p(b,"class",y),(!j||K[0]&1)&&p(b,"id",C[0]),O&&O.p&&(!j||K[0]&134217776)&&nn(O,W,C,C[27],j?tn(W,C[27],K,Yn):sn(C[27]),ct)},i(C){j||(x(O,C),j=!0)},o(C){ee(O,C),j=!1},d(C){C&&k(e),P.d(),F.d(),t[31](null),O&&O.d(C),C&&k(H),C&&k(G),I=!1,re(L)}}}const ts=.5,ns=2;function ft(t){return t.preventDefault(),t.stopPropagation(),!1}function ss(t){}function is(t){}function ls(t,e,n){let s,i=Q,o=()=>(i(),i=de(_,q=>n(35,s=q)),_),l,a=Q,r=()=>(a(),a=de(g,q=>n(11,l=q)),g);t.$$.on_destroy.push(()=>i()),t.$$.on_destroy.push(()=>a());let{$$slots:u={},$$scope:f}=e,{id:d}=e,{configStore:_}=e;o();let{stateStore:g}=e;r();let{paintFn:m=Ge}=e,{minWidth:v=100}=e,{minHeight:E=100}=e,{paintOptions:b=void 0}=e,{onElementSelected:y=q=>{}}=e,{onElementHovered:A=q=>{}}=e,{onElementHoverEnd:H=()=>{}}=e,G=He(void 0);const j=q=>{G.update(he=>q),A(q)},I=()=>{G.set(void 0),H()};function L(q){g.update(he=>te(X({},he),{selectedElementId:q.id})),y(q),G.set(void 0)}let S=null,N=null,P,T=50,R=0,F=!0;function W(){n(7,F=!F),S&&S.setLock(!F)}let O=!1;function C(q){q.keyCode===17&&n(8,O=!0)}function K(q){q.keyCode===17&&n(8,O=!1)}const J=q=>g.update(q),B=()=>{S&&S.remove(),S=Jn(N,s,{subscribe:q=>g.subscribe(q)},m,b,{onHover:j,onHoverEnd:I,onClick:L,updateState:J}),ge=[N.width/5,N.height/5],S.pan(ge)};function U(){const q=document.getElementById(d),he=q.parentElement;q&&he&&(q.height=Math.max(E,he.clientHeight),q.width=Math.max(v,he.clientWidth))}let $=!1;function z(){!F||!O||n(9,$=!0)}function Y(){n(9,$=!1)}let ge=[0,0];function Sn(q){if($&&F&&O){const he=1/ye;ge=[ge[0]+he*q.movementX,b.autoAlign==="TOP_TO_BOTTOM"?0:ge[1]+he*q.movementY],S.pan(ge)}}function On(){n(9,$=!1)}function Nn(){n(10,ye=1),S.zoom(ye),ge=[0,0],S.pan(ge)}let ye=1;function et(q){!F||!O||(q.preventDefault(),q.stopPropagation(),Ie(q.deltaY*-.001))}function Ie(q){n(10,ye=Math.round(Math.min(Math.max(ts,ye+q),ns)*10)/10),S.zoom(ye)}Xe(()=>{const q=document.getElementById(d);n(4,P=q.offsetLeft),n(5,T=q.offsetTop),q.addEventListener("wheel",et,{passive:!1}),window.addEventListener("scroll",ft,!1),window.addEventListener("resize",U,!0),document.addEventListener("keydown",C),document.addEventListener("keyup",K),_.subscribe(B),U()});let tt=b;Ze(()=>{tt!==b&&(B(),Ie(0),tt=b)});let nt=setInterval(()=>{n(6,R=S.debugInfo.fps)},500);xe(()=>{window.removeEventListener("resize",U),N.removeEventListener("wheel",et),window.removeEventListener("scroll",ft),document.removeEventListener("keydown",C),document.removeEventListener("keyup",K),S&&S.remove(),nt&&clearInterval(nt)});const Tn=()=>Ie(-.1),In=()=>Ie(.1);function Pn(q){$e[q?"unshift":"push"](()=>{N=q,n(3,N)})}return t.$$set=q=>{"id"in q&&n(0,d=q.id),"configStore"in q&&o(n(1,_=q.configStore)),"stateStore"in q&&r(n(2,g=q.stateStore)),"paintFn"in q&&n(20,m=q.paintFn),"minWidth"in q&&n(21,v=q.minWidth),"minHeight"in q&&n(22,E=q.minHeight),"paintOptions"in q&&n(23,b=q.paintOptions),"onElementSelected"in q&&n(24,y=q.onElementSelected),"onElementHovered"in q&&n(25,A=q.onElementHovered),"onElementHoverEnd"in q&&n(26,H=q.onElementHoverEnd),"$$scope"in q&&n(27,f=q.$$scope)},[d,_,g,N,P,T,R,F,O,$,ye,l,G,W,z,Y,Sn,On,Nn,Ie,m,v,E,b,y,A,H,f,u,Tn,In,Pn]}class Ye extends fe{constructor(e){super(),ce(this,e,ls,es,ae,{id:0,configStore:1,stateStore:2,paintFn:20,minWidth:21,minHeight:22,paintOptions:23,onElementSelected:24,onElementHovered:25,onElementHoverEnd:26},null,[-1,-1])}}function os(t){let e;return{c(){e=M("pause")},m(n,s){w(n,e,s)},d(n){n&&k(e)}}}function rs(t){let e;return{c(){e=M("resume")},m(n,s){w(n,e,s)},d(n){n&&k(e)}}}function as(t){let e,n,s,i,o,l,a,r,u,f,d,_,g,m,v,E,b,y,A,H=t[2]*Ne+"",G,j,I,L;function S(T,R){return T[1]?rs:os}let N=S(t),P=N(t);return{c(){e=h("div"),n=h("button"),n.textContent="reset",s=D(),i=h("button"),o=M("step backwards"),a=D(),r=h("button"),P.c(),u=D(),f=h("button"),d=M("step forward"),g=D(),m=h("div"),v=h("label"),v.textContent="Speed",E=D(),b=h("input"),y=D(),A=h("span"),G=M(H),j=M("x"),p(n,"type","button"),p(n,"class","svelte-air56o"),p(i,"type","button"),i.disabled=l=!t[1],p(i,"class","svelte-air56o"),p(r,"type","button"),p(r,"class","svelte-air56o"),p(f,"type","button"),f.disabled=_=!t[1],p(f,"class","svelte-air56o"),p(v,"for","SpeedInput"),p(b,"id","SpeedInput"),p(b,"type","range"),p(b,"min","0"),p(b,"max",5/Ne),b.value=t[2],p(m,"class","svelte-air56o"),p(e,"class","anim-controls svelte-air56o")},m(T,R){w(T,e,R),c(e,n),c(e,s),c(e,i),c(i,o),c(e,a),c(e,r),P.m(r,null),c(e,u),c(e,f),c(f,d),c(e,g),c(e,m),c(m,v),c(m,E),c(m,b),c(m,y),c(m,A),c(A,G),c(A,j),I||(L=[V(n,"click",function(){ue(t[0].reset)&&t[0].reset.apply(this,arguments)}),V(i,"click",function(){ue(t[0].stepBackwards)&&t[0].stepBackwards.apply(this,arguments)}),V(r,"click",function(){ue(t[0].pauseOrPlay)&&t[0].pauseOrPlay.apply(this,arguments)}),V(f,"click",function(){ue(t[0].stepForwards)&&t[0].stepForwards.apply(this,arguments)}),V(b,"change",t[3])],I=!0)},p(T,[R]){t=T,R&2&&l!==(l=!t[1])&&(i.disabled=l),N!==(N=S(t))&&(P.d(1),P=N(t),P&&(P.c(),P.m(r,null))),R&2&&_!==(_=!t[1])&&(f.disabled=_),R&4&&(b.value=t[2]),R&4&&H!==(H=t[2]*Ne+"")&&Z(G,H)},i:Q,o:Q,d(T){T&&k(e),P.d(),I=!1,re(L)}}}const Ne=.25;function us(t,e,n){let{stateStore:s}=e,{controls:i}=e,o=!1,l=1/Ne;const a=u=>{try{n(2,l=parseInt(u.target.value))}catch{console.error("Failed to parse speed")}i.setSpeed(l*Ne)};let r;return Xe(()=>{r=s.subscribe(u=>{if(!u){n(1,o=!0);return}n(1,o=u.paused),n(2,l=u.speed/Ne)})}),xe(()=>{r&&r()}),t.$$set=u=>{"stateStore"in u&&n(4,s=u.stateStore),"controls"in u&&n(0,i=u.controls)},[i,o,l,a,s]}class cs extends fe{constructor(e){super(),ce(this,e,us,as,ae,{stateStore:4,controls:0})}}const Ue={linePadding:50,initialLineLength:200,lengthPerTimeStep:10,groupOffset:30,messageOffset:8,maxMessageLength:30,maxMessageOffset:100,vertical:!1,autoAlign:"TOP_TO_BOTTOM",spaceBetweenBroadcasts:!1,getText:t=>t.type};function dt(t,e,n,s=Ue){if(s=X(X({},Ue),s),!e)return[t.canvas.width,t.canvas.height];s.internal={},s.internal.nodeToXMap={},e.nodes.forEach((o,l)=>{s.internal.nodeToXMap[o.id]=10+l*s.linePadding,s.internal.furthestLineX=s.internal.nodeToXMap[o.id]});const i=(o,l)=>s.getText(o)===s.getText(l);return t.save(),s.internal.lastLineOffset=25,s.internal.maxWidth=s.internal.furthestLineX,e.messages.sort(rn).reduce($n(1e3,i),[]).forEach(an(t,e,s)),t.restore(),t.save(),e.nodes.forEach((o,l)=>{let a=10+l*s.linePadding;if(s.internal.nodeToXMap[o.id]=a,e.selectedElementId===o.id){t.beginPath(),t.lineWidth=10,t.strokeStyle=_e.highlight;let d=[s.internal.nodeToXMap[e.selectedElementId],25],_=[s.internal.nodeToXMap[e.selectedElementId],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(d=d.reverse(),_=_.reverse()),t.moveTo(...d),t.lineTo(..._),t.stroke(),t.closePath()}t.beginPath(),t.lineWidth=1,t.setLineDash(o.connected?[0]:[5,5]),t.strokeStyle=o.connected?"#000":"#AAA";let r=[s.internal.nodeToXMap[o.id],25],u=[s.internal.nodeToXMap[o.id],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(r=r.reverse(),u=u.reverse()),t.moveTo(...r),t.lineTo(...u),t.stroke(),t.closePath(),t.setLineDash([0]),t.beginPath(),t.fillStyle="#000",t.font="bold 20px courier new",t.fontWeight="bold";let f=[a-7.5,20];s.vertical&&(f=f.reverse()),t.fillText(o.id,...f),t.closePath()}),t.restore(),[s.internal.maxWidth,s.internal.lastLineOffset+s.messageOffset]}function an(t,e,n,s=0,i=!0){return(o,l)=>{if(Array.isArray(o)){o.forEach((_,g)=>an(t,e,n,g,g===o.length-1)(_,l));return}const{nodeToXMap:a,furthestLineX:r}=n.internal;t.beginPath();let u=n.internal.lastLineOffset;l===0&&(u+=n.messageOffset),n.spaceBetweenBroadcasts&&s!==0&&(u+=n.messageOffset);let f=[a[o.fromId],u],d=[a[o.toId],f[1]+(n.spaceBetweenBroadcasts?0:n.maxMessageLength)];if((i||n.spaceBetweenBroadcasts)&&(n.internal.lastLineOffset=d[1],i&&n.spaceBetweenBroadcasts?n.internal.lastLineOffset+=n.groupOffset:n.internal.lastLineOffset+=n.messageOffset),n.vertical&&(f=f.reverse(),d=d.reverse()),o.id===e.selectedElementId&&(t.lineWidth=8,t.strokeStyle=_e.highlight,t.moveTo(...f),t.lineTo(...d),t.stroke()),t.lineWidth=1,t.strokeStyle="#000",t.moveTo(...f),t.lineTo(...d),t.stroke(),t.closePath(),s===0){t.beginPath(),t.fillStyle="#000",t.font="15px arial";let _=[r+20,f[1]+(d[1]-f[1])/2];n.spaceBetweenBroadcasts&&(_[1]=f[1]+(n.internal.lastLineOffset-f[1])/2),n.vertical&&(_=_.reverse());const g=n.getText(o);n.internal.maxWidth=Math.max(n.internal.maxWidth,_[0]+g.length*15),t.fillText(g,..._),t.closePath()}}}function ht(t){let e,n,s,i,o,l;const a=[ds,fs],r=[];function u(f,d){return f[11]?0:f[8]?1:-1}return~(i=u(t))&&(o=r[i]=a[i](t)),{c(){e=h("section"),n=h("h1"),n.textContent="State",s=D(),o&&o.c(),p(n,"class","svelte-1y74lh9"),p(e,"class","state-section svelte-1y74lh9")},m(f,d){w(f,e,d),c(e,n),c(e,s),~i&&r[i].m(e,null),l=!0},p(f,d){let _=i;i=u(f),i===_?~i&&r[i].p(f,d):(o&&(pe(),ee(r[_],1,1,()=>{r[_]=null}),me()),~i?(o=r[i],o?o.p(f,d):(o=r[i]=a[i](f),o.c()),x(o,1),o.m(e,null)):o=null)},i(f){l||(x(o),l=!0)},o(f){ee(o),l=!1},d(f){f&&k(e),~i&&r[i].d()}}}function fs(t){let e,n;const s=[t[5],{id:"Canvas_"+t[14].algorithm+"_State"},{paintFn:t[8]},{paintOptions:{autoAlign:"CENTER"}}];let i={};for(let o=0;o<s.length;o+=1)i=Me(i,s[o]);return e=new Ye({props:i}),{c(){oe(e.$$.fragment)},m(o,l){se(e,o,l),n=!0},p(o,l){const a=l&16672?We(s,[l&32&&qe(o[5]),l&16384&&{id:"Canvas_"+o[14].algorithm+"_State"},l&256&&{paintFn:o[8]},s[3]]):{};e.$set(a)},i(o){n||(x(e.$$.fragment,o),n=!0)},o(o){ee(e.$$.fragment,o),n=!1},d(o){ie(e,o)}}}function ds(t){let e,n,s;var i=t[11];function o(l){return{props:{stateStore:l[0],configStore:l[1]}}}return i&&(e=new i(o(t))),{c(){e&&oe(e.$$.fragment),n=we()},m(l,a){e&&se(e,l,a),w(l,n,a),s=!0},p(l,a){const r={};if(a&1&&(r.stateStore=l[0]),a&2&&(r.configStore=l[1]),i!==(i=l[11])){if(e){pe();const u=e;ee(u.$$.fragment,1,0,()=>{ie(u,1)}),me()}i?(e=new i(o(l)),oe(e.$$.fragment),x(e.$$.fragment,1),se(e,n.parentNode,n)):e=null}else i&&e.$set(r)},i(l){s||(e&&x(e.$$.fragment,l),s=!0)},o(l){e&&ee(e.$$.fragment,l),s=!1},d(l){l&&k(n),e&&ie(e,l)}}}function hs(t){let e,n,s;var i=t[6];function o(l){return{props:{slot:"algorithm-config",config:l[18]}}}return i&&(e=new i(o(t))),{c(){e&&oe(e.$$.fragment),n=we()},m(l,a){e&&se(e,l,a),w(l,n,a),s=!0},p(l,a){const r={};if(a&262144&&(r.config=l[18]),i!==(i=l[6])){if(e){pe();const u=e;ee(u.$$.fragment,1,0,()=>{ie(u,1)}),me()}i?(e=new i(o(l)),oe(e.$$.fragment),x(e.$$.fragment,1),se(e,n.parentNode,n)):e=null}else i&&e.$set(r)},i(l){s||(e&&x(e.$$.fragment,l),s=!0)},o(l){e&&ee(e.$$.fragment,l),s=!1},d(l){l&&k(n),e&&ie(e,l)}}}function ps(t){let e,n,s,i,o,l,a,r,u,f,d,_,g,m,v,E,b,y,A,H,G,j,I,L;const S=[t[5],{id:"Canvas_"+t[14].algorithm+"_Nodes"},{paintFn:Ge},{paintOptions:t[10]}];let N={};for(let O=0;O<S.length;O+=1)N=Me(N,S[O]);l=new Ye({props:N});const P=[t[5],{id:"Canvas_"+t[14].algorithm+"_Sequence"},{paintFn:dt},{paintOptions:t[9]}];let T={};for(let O=0;O<P.length;O+=1)T=Me(T,P[O]);d=new Ye({props:T});var R=t[7];function F(O){return{props:{element:O[12],actions:O[4]}}}R&&(E=new R(F(t)));let W=(t[8]||t[11])&&ht(t);return H=new cs({props:{stateStore:t[0],controls:t[13]&&t[13].simulation}}),I=new Kn({props:{configStore:t[1],fullLayout:!0,updateOnChange:!0,algorithm:t[3],$$slots:{"algorithm-config":[hs,({config:O})=>({18:O}),({config:O})=>O?262144:0]},$$scope:{ctx:t}}}),{c(){e=h("article"),n=h("section"),s=h("section"),i=h("h1"),i.textContent="Node Graph",o=D(),oe(l.$$.fragment),a=D(),r=h("section"),u=h("h1"),u.textContent="Sequence Diagram",f=D(),oe(d.$$.fragment),_=D(),g=h("section"),m=h("h1"),m.textContent="Actions",v=D(),E&&oe(E.$$.fragment),b=D(),W&&W.c(),y=D(),A=h("section"),oe(H.$$.fragment),G=D(),j=h("section"),oe(I.$$.fragment),p(i,"class","svelte-1y74lh9"),p(s,"class","raised graph-panel svelte-1y74lh9"),p(u,"class","svelte-1y74lh9"),p(r,"class","raised graph-panel svelte-1y74lh9"),p(m,"class","svelte-1y74lh9"),p(g,"class","raised actions-panel svelte-1y74lh9"),p(n,"class","canvas-section svelte-1y74lh9"),p(A,"class","controls-section svelte-1y74lh9"),p(j,"class","config-section svelte-1y74lh9"),p(e,"class","full-algorithm svelte-1y74lh9")},m(O,C){w(O,e,C),c(e,n),c(n,s),c(s,i),c(s,o),se(l,s,null),c(n,a),c(n,r),c(r,u),c(r,f),se(d,r,null),c(n,_),c(n,g),c(g,m),c(g,v),E&&se(E,g,null),c(e,b),W&&W.m(e,null),c(e,y),c(e,A),se(H,A,null),c(e,G),c(e,j),se(I,j,null),L=!0},p(O,[C]){const K=C&17440?We(S,[C&32&&qe(O[5]),C&16384&&{id:"Canvas_"+O[14].algorithm+"_Nodes"},C&0&&{paintFn:Ge},C&1024&&{paintOptions:O[10]}]):{};l.$set(K);const J=C&16928?We(P,[C&32&&qe(O[5]),C&16384&&{id:"Canvas_"+O[14].algorithm+"_Sequence"},C&0&&{paintFn:dt},C&512&&{paintOptions:O[9]}]):{};d.$set(J);const B={};if(C&4096&&(B.element=O[12]),C&16&&(B.actions=O[4]),R!==(R=O[7])){if(E){pe();const z=E;ee(z.$$.fragment,1,0,()=>{ie(z,1)}),me()}R?(E=new R(F(O)),oe(E.$$.fragment),x(E.$$.fragment,1),se(E,g,null)):E=null}else R&&E.$set(B);O[8]||O[11]?W?(W.p(O,C),C&2304&&x(W,1)):(W=ht(O),W.c(),x(W,1),W.m(e,y)):W&&(pe(),ee(W,1,1,()=>{W=null}),me());const U={};C&1&&(U.stateStore=O[0]),C&8192&&(U.controls=O[13]&&O[13].simulation),H.$set(U);const $={};C&2&&($.configStore=O[1]),C&8&&($.algorithm=O[3]),C&4456512&&($.$$scope={dirty:C,ctx:O}),I.$set($)},i(O){L||(x(l.$$.fragment,O),x(d.$$.fragment,O),E&&x(E.$$.fragment,O),x(W),x(H.$$.fragment,O),x(I.$$.fragment,O),L=!0)},o(O){ee(l.$$.fragment,O),ee(d.$$.fragment,O),E&&ee(E.$$.fragment,O),ee(W),ee(H.$$.fragment,O),ee(I.$$.fragment,O),L=!1},d(O){O&&k(e),ie(l),ie(d),E&&ie(E),W&&W.d(),ie(H),ie(I)}}}function ms(t,e,n){let s,i=Q,o=()=>(i(),i=de(m,P=>n(13,s=P)),m),l,a=Q,r=()=>(a(),a=de(_,P=>n(17,l=P)),_),u,f=Q,d=()=>(f(),f=de(g,P=>n(14,u=P)),g);t.$$.on_destroy.push(()=>i()),t.$$.on_destroy.push(()=>a()),t.$$.on_destroy.push(()=>f());let{stateStore:_}=e;r();let{configStore:g}=e;d();let{controlsStore:m}=e;o();let{algorithm:v}=e,{algorithms:E}=e,b={},y,A={stateStore:_,configStore:g},H=v.components.Configuration,G=v.components.Actions,j=v.drawing.paintState,I=v.drawing.seqPaintingOptions||{},L=v.drawing.nodePaintingOptions||{},S=v.components.StateGraph,N=null;return Xe(()=>{g.subscribe(P=>{let T=E[P.algorithm];n(6,H=T.components.Configuration),n(11,S=T.components.StateGraph),n(7,G=T.components.Actions),n(8,j=T.drawing.paintState),n(9,I=T.drawing.seqPaintingOptions?X({},T.drawing.seqPaintingOptions):{}),n(9,I.autoAlign="TOP_TO_BOTTOM",I),n(10,L=T.drawing.nodePaintingOptions?X({},T.drawing.nodePaintingOptions):{}),n(10,L.autoAlign="CENTER",L)}),_.subscribe(P=>{!s||!P||(y!==P.selectedElementId&&(y=P.selectedElementId),y&&y.indexOf&&y.indexOf("M_")===0?n(12,N=l.messages.find(T=>T.id===y)):n(12,N=l.nodes.find(T=>T.id===y)),N&&n(4,b=s.element(P.nodes.find(T=>T.id===y))))}),_.update(P=>te(X({},P),{selectedElementId:P.nodes.filter(T=>T.type==="client")[0]})),n(5,A={stateStore:_,configStore:g})}),t.$$set=P=>{"stateStore"in P&&r(n(0,_=P.stateStore)),"configStore"in P&&d(n(1,g=P.configStore)),"controlsStore"in P&&o(n(2,m=P.controlsStore)),"algorithm"in P&&n(3,v=P.algorithm),"algorithms"in P&&n(15,E=P.algorithms)},[_,g,m,v,b,A,H,G,j,I,L,S,N,s,u,E]}class gs extends fe{constructor(e){super(),ce(this,e,ms,ps,ae,{stateStore:0,configStore:1,controlsStore:2,algorithm:3,algorithms:15})}}const un={algorithm:"paxos",commandDelay:0,networkDelay:5e3,speed:1,useWorkers:!0,useGlobalState:!1};function _s(){return new Worker("assets/NodeRunnerWorker.88d3ddb9.js",{type:"module"})}function Ae(){return typeof crypto!="undefined"&&crypto.randomUUID?crypto.randomUUID():bs()}function bs(t=6,e=36){return Math.random().toString(e).substring(2,t)}class vs{constructor(e,n){this.neighbors=[],this.node=e,this.neighbors=n&&this.neighbors.concat(n)}getAllNeighbors(){return this.neighbors}getNeighborsOfType(e){return this.neighbors.filter(n=>n.type===e)}getRandomNeighborOfType(e){const n=this.getNeighborsOfType(e),s=Math.floor(Math.random()*n.length);return n[s]}broadcast(e,n){const s=Ae(),i=this.node.id;for(const o of n)o!==i&&this.emit(te(X({},e),{sent:new Date().toISOString(),id:this.getRandomId(),broadcastKey:s,fromId:i,toId:o}))}broadcastToAll(e){const n=this.neighbors.map(s=>s.id);this.broadcast(e,n)}broadcastToType(e,n){const s=this.neighbors.filter(i=>i.type===n).map(i=>i.id);this.broadcast(e,s)}sendTo(e,n){const s=this.node.id;this.emit(te(X({},n),{sent:new Date().toISOString(),fromId:s,toId:e,id:this.getRandomId()}))}sendToSync(e,n){const s=this.node.id;return this.emitSync(te(X({},n),{sent:new Date().toISOString(),fromId:s,toId:e,id:this.getRandomId()}))}emit(e){window.dispatchEvent(new CustomEvent("NetworkEvent",{detail:te(X({},e),{nodeId:this.node.id})}))}emitSync(e){const n=Ae();return new Promise(s=>{this.emit(te(X({},e),{resKey:n}));const i=this.listen(o=>{o.resKey===n&&(i(),s(o))})})}listen(e){const s=(i=>o=>o.detail.toId===this.node.id&&i(o.detail))(e);return window.addEventListener("NetworkEvent",s),()=>{window.removeEventListener("NetworkEvent",s)}}async receive(){return new Promise(e=>{this.listen(n=>{e(n)})})}getRandomId(){return"M_"+Ae()}}class ze{constructor(e,n,s,i){this.id=e,this.config=n,this.state=s,this.network=i,this.running=!0,this.connected=!0,this.executedCommands=[],this.scheduledCommands=[]}stop(){this.running=!1}restart(){this.running=!0,this.scheduledCommands.forEach(e=>{e.do(),this.executedCommands.push(e)})}reconnect(){this.connected=!0}disconnect(){this.connected=!1}invoke(e){const n=Ae();let s=e;typeof s=="function"?s={id:n,do:e,undo:()=>console.warn("Undo not implemented")}:s.id=n,this.running?(s.do(),this.executedCommands.push(s)):this.scheduledCommands.push(s),this.updateState()}step(e=!0){if(e&&this.scheduledCommands.length>0){const n=this.scheduledCommands.shift();n.do(),this.executedCommands.push(n)}else if(this.executedCommands.length>0){const n=this.executedCommands.pop();n.undo(),this.scheduledCommands.push(n)}this.updateState()}invokeDo(e){const n=X({},this.state),s={do:()=>{e()},undo:()=>{this.state=n}};this.invoke(s)}updateState(){this.network.sendTo(void 0,{type:"STATE_CHANGED",isFlow:!0,data:te(X({},this.state),{scheduledCommands:this.scheduledCommands.map(({id:e})=>({id:e})),executedCommands:this.executedCommands.map(({id:e})=>({id:e}))})})}}class ys extends ze{constructor(e,n,s,i){super(e,n,s,i),this.type="client"}request(e,n){const s=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{method:"REQUEST",v:n}),this.updateState()},undo:()=>{this.state.text=s}}}onmessage(e){e.method==="RESPONSE"&&this.invoke(this.onAck())}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}requestRandom(e){const n=this.network.getRandomNeighborOfType("proposer")||this.network.getRandomNeighborOfType("node");this.invoke(this.request(n.id,e))}}class ks{constructor(e,n,s,i){this.id=e,this.config=s,this.parentNode=i,this.network=n,this.state={greatestN:-1,text:"IDLE"}}onPrepare(e){let n={state:X({},this.state),parentState:X({},this.parentNode.state)};return{do:()=>{if(e.n<=this.parentNode.state.greatestN){this.state.text="IDLE",this.network.sendTo(e.fromId,{clientId:e.clientId,n:this.parentNode.state.greatestN,method:"IGNORED"});return}this.parentNode.state.greatestN=e.n,this.state.text="PROMISED",this.network.sendTo(e.fromId,{method:"PROMISE",clientId:e.clientId,n:e.n})},undo:()=>{this.state=n,this.parentNode.state=n.parentState}}}onAccept(e){let n={state:X({},this.state),parentState:X({},this.parentNode.state)};return{do:()=>{if(e.n>this.parentNode.state.greatestN){this.state.text="IDLE";const s={clientId:e.clientId,n:this.parentNode.state.greatestN,v:e.v,method:"IGNORED"};this.network.sendTo(e.fromId,s);return}this.state.text="ACCEPTED",this.config.learnerImpl==="contactAllAcceptors"?this.network.broadcastToType({clientId:e.clientId,n:e.n,v:e.v,method:"ACCEPTED"},"node"):(this.network.sendTo(e.fromId,{clientId:e.clientId,n:e.n,v:e.v,method:"ACCEPTED"}),this.parentNode.state.log[e.n-1]=e.v),this.parentNode.state.greatestN=e.n},undo:()=>{this.state=n.state,this.parentNode.state=n.parentState}}}}class ws{constructor(e,n,s,i){this.network=n,this.config=s,this.parentNode=i,this.id=e,this.state={v:null,n:null}}onAccepted(e){const n=this.state.v,s=[...this.parentNode.state.log];return{do:()=>{e.v===this.state.v&&e.n===this.state.n||(this.state.v=e.v,this.state.n=e.n,this.parentNode.state.log[e.n-1]=e.v,this.network.sendTo(e.clientId,{clientId:e.clientId,n:e.n,v:e.v,method:"RESPONSE"}))},undo:()=>{this.state.v=n,this.parentNode.state.log=s}}}}class Es{constructor(e,n,s,i){this.id=e,this.config=s,this.parentNode=i,this.network=n,this.type="proposer",this.state={proposals:[],text:"IDLE"}}hasMajority(e,n="promises"){const s=this.state.proposals.find(o=>o.n===e);if(!s)return;const i=this.network.getNeighborsOfType("acceptors").length||this.network.getNeighborsOfType("node").length;return s[n].length>=Math.floor(.5*i)+1}onRequest(e){let n={state:X({},this.state),parentState:X({},this.parentNode.state)};return{do:()=>{this.state.isProposer=!0,this.state.text="PREPARING",this.parentNode.state.greatestN+=1,this.state.proposals.push({clientId:e.fromId,v:e.v,n:this.parentNode.state.greatestN,promises:[],acceptances:[],ignoredBy:[]});let s=this.network.getNeighborsOfType("acceptor");(!s||s.length===0)&&(s=this.network.getNeighborsOfType("node")),this.parentNode.state.log[this.parentNode.state.greatestN-1]=e.v,this.network.broadcast({clientId:e.fromId,method:"PREPARE",n:this.parentNode.state.greatestN},s.map(i=>i.id))},undo:()=>{this.state=n.state,this.parentNode.state=n.parentState}}}onPromise(e){const n=X({},this.state);return{do:()=>{const s=this.state.proposals.find(i=>i.n===e.n);if(!!s){if(this.hasMajority(e.n)){s.promises.push(e.fromId);return}else s.promises.push(e.fromId);this.hasMajority(e.n)&&(this.network.broadcastToType({clientId:e.clientId,method:"ACCEPT",n:s.n,v:s.v},"node"),this.state.text="PROMISED")}},undo:()=>{this.state=n}}}onAccepted(e){const n=X({},this.state);return{do:()=>{const s=this.state.proposals.find(i=>i.n===e.n);if(!!s){if(this.hasMajority(e.n,"acceptances")){s.acceptances.push(e.fromId);return}else s.acceptances.push(e.fromId);this.hasMajority(e.n,"acceptances")&&(this.state.proposals.forEach(i=>{}),this.state.text="IDLE"),this.state.isProposer=!1}},undo:()=>{this.state=n.state,this.parentNode.state=n.parentState}}}onIgnored(e){let n={state:X({},this.state),parentState:X({},this.parentNode.state)};return{do:()=>{if(e.n>this.parentNode.state.greatestN){this.parentNode.state.greatestN=e.n,this.state.isProposer=!1;return}else if(e.n<this.parentNode.state.greatestN)return;const s=this.state.proposals.findIndex(i=>i.n===e.n);s<0||!this.state.proposals[s]||(this.state.proposals=this.state.proposals.map(i=>i.n===e.n?te(X({},i),{acceptances:i.acceptances.filter(o=>o.acceptorId!==e.fromId),promises:i.promises.filter(o=>o.acceptorId!==e.fromId)}):i))},undo:()=>{this.state=n}}}}class Ss extends ze{constructor(e,n,s,i,o="node"){super(e,n,s,i),this.type=o,this.state.log=[],this.state.greatestN=0,(o==="node"||o==="acceptor")&&(this.acceptor=new ks(e,i,n,this),this.state.acceptor=this.acceptor.state),(o==="node"||o==="learner")&&(this.learner=new ws(e,i,n,this),this.state.learner=this.learner.state),(o==="node"||o==="proposer")&&(this.proposer=new Es(e,i,n,this),this.state.proposer=this.proposer.state)}onmessage(e){this.proposer&&this.handleProposerMessage(e),this.acceptor&&this.handleAcceptorMessage(e),this.learner&&this.handleLearnerMessage(e)}handleProposerMessage(e){switch(e.method){case"REQUEST":this.invoke(this.proposer.onRequest(e));break;case"PROMISE":this.invoke(this.proposer.onPromise(e));break;case"ACCEPTED":this.invoke(this.proposer.onAccepted(e));break;case"IGNORED":this.invoke(this.proposer.onIgnored(e));break}}handleAcceptorMessage(e){switch(e.method){case"PREPARE":this.invoke(this.acceptor.onPrepare(e));break;case"ACCEPT":this.invoke(this.acceptor.onAccept(e));break}}handleLearnerMessage(e){switch(e.method){case"ACCEPTED":this.invoke(this.learner.onAccepted(e));break}}}function cn(t,e,n,s){return n.type==="client"?new ys(n.id,t,n,s):new Ss(n.id,t,n,s,n.type||"all")}class Os extends ze{constructor(e,n,s,i){super(e,n,s,i),this.type="client"}request(e,n){const s=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{command:"REQUEST",tx:n,timestamp:new Date().getTime()}),this.updateState()},undo:()=>{this.state.text=s}}}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}onmessage(e){e.method==="RESPONSE"&&this.invoke(this.onAck())}requestRandom(e){const n=this.network.getRandomNeighborOfType("node");this.invoke(this.request(n.id,e))}}const Ns={header:{prevHeaderHash:null,merkleRoot:null},height:0,timestamp:new Date("2009-01-03T19:15:00.000Z").getTime(),transactions:[]};async function fn(t,e="",n="sha-256"){if(typeof crypto=="undefined"||!crypto||!crypto.subtle)return JSON.stringify(t)+e;const s=Ts(JSON.stringify(t)+e),i=await crypto.subtle.digest(n,s);return Array.from(new Uint8Array(i)).map(l=>l.toString(16).padStart(2,"0")).join("")}async function pt(t,e,n="",s="sha-256"){return typeof crypto=="undefined"||!crypto||!crypto.subtle?JSON.stringify(e)+n===t:await fn(e,n,s)===t}function Ts(t){return new TextEncoder().encode(t)}const mt=5e3,De=1e3;class Is extends ze{constructor(e,n,s,i){super(e,n,s,i),this.type="node",this.state.text="IDLE",this.state.chain=[Ns],this.state.mempool=[],this.getBlocks(),this.sync=!0}onmessage(e){switch(e.command){case"getblocks":super.invoke(this.onGetBlocks(e));break;case"REQUEST":super.invokeDo(this.sendRawTransaction(e));break;case"blocks":super.invoke(this.onBlocks(e));break;case"rawtransaction":super.invokeDo(this.onRawTransaction(e));break;case"submitblock":super.invokeDo(this.onSubmitBlock(e));break}}onBlocks(e){return{do:async()=>{for(let n of e.entries){if(!await pt(n.header.prevHeaderHash,this.state.chain.at(-1).header))return;this.state.chain.push(n)}},undo:()=>{}}}onGetBlocks(e){return{do:()=>{this.network.sendTo(e.fromId,{command:"blocks",entries:this.state.chain})},undo:()=>{}}}getBlocks(){if(this.network.neighbors.length===0)return;const e=this.network.getNeighborsOfType("node");if(e.length===0)return;const n=Math.floor(Math.random()*e.length),s=e[n];this.network.sendTo(s.id,{command:"getblocks",headerHashes:[this.state.chain.at(-1).hash]})}sendRawTransaction(e){return()=>{const n=this.state.mempool.find(i=>e.tx===i),s=this.state.chain.find(i=>i.transactions.find(o=>o===e.tx));if(!n&&!s){this.timeout&&clearTimeout(this.timeout);const i=Math.random()*(mt-De)+De;this.timeout=setTimeout(this.tryMining(),i),this.state.mempool.push(e.tx),this.network.broadcastToType({timestamp:e.timestamp,tx:e.tx,command:"rawtransaction"},"node")}}}onRawTransaction(e){return()=>{this.sendRawTransaction(e)()}}onSubmitBlock(e){return()=>{const n=(i,o)=>()=>i.transactions.filter((l,a)=>l!==o.transactions[a]).length===0;this.state.chain.find(i=>i===e.block||n(e.block,i))||(this.state.mempool=this.state.mempool.filter(i=>!e.block.transactions.find(o=>o!==i)),this.state.chain.push(e.block))}}stop(){super.stop(),this.timeout&&clearTimeout(this.timeout)}restart(){super.restart();const e=Math.random()*(mt-De)+De;this.timeout=setTimeout(this.tryMining(),e)}tryMining(){return async()=>{if(this.state.mempool.length===0)return;const e=Math.random().toFixed(8),s={header:{prevHeaderHash:await fn(this.state.chain.at(-1),e),merkleRoot:null,nonce:e},height:this.state.chain.length,timestamp:new Date().getTime(),transactions:this.state.mempool};this.state.mempool=[],this.state.chain.push(s),this.network.broadcastToType({block:s,command:"submitblock"},"node")}}validate(e){return pt(e.header.prevHeaderHash,te(X({},e),{hash:void 0}))}}function dn(t,e,n,s){switch(n.type){case"client":return new Os(n.id,t,n,s);case"node":return new Is(n.id,t,n,s)}}function Ps(t,...e){switch(t){case"paxos":return cn(...e);case"bitcoin_pow":return dn(...e);default:throw"Algorithm not implemented"}}class Cs{constructor(e,n){this.setupNetwork=(s,i)=>new vs(s,i),this.id=Ae(),this.config=e,this.network=null,this.nodeStates=n,this.nodes=[]}terminate(){this.stopListening&&this.stopListening()}buildMessageEventHandler(){return e=>{const n=e.data;if(console.log(`NodeRunner for "${this.nodeStates?this.nodeStates.map(s=>s.id).join(", "):"?"}" got:`,n),n.isFlow){this.onFlowMessage(n);return}if(n.toId){const s=this.nodes.find(i=>i.id===n.toId);s&&s.running&&s.connected&&s.onmessage(n)}}}setupNodes(e,n,s){this.nodeStates=n,n.forEach(async i=>{const o=this.setupNetwork(i,s),l=Ps(e.algorithm,e,null,i,o);l&&(l.updateState(),this.nodes.push(l),console.log("Starting node with id ",l.id,"and type",l.type))})}onFlowMessage(e){const{nodeId:n}=e;switch(e.type){case"CLIENT_REQUEST":if(n){const s=this.nodes.find(i=>i.id===n);if(s&&s.type==="client"){const{v:i}=e;s.requestRandom(i)}}break;case"SETUP":case"RESET":this.setupNodes(e.config,e.nodes,e.neighbors),this.postMessageToMain({isFlow:!0,type:"STATE_CHANGED",state:"IDLE"});break;case"STEP":this.nodes.forEach(s=>s.step(e.forward));break;case"DISCONNECT":case"RECONNECT":case"STOP":case"RESTART":if(n){const s=this.nodes.find(i=>i.id===n);s&&(e.type==="RECONNECT"?s.reconnect():e.type==="DISCONNECT"?s.disconnect():e.type==="RESTART"?s.restart():e.type==="STOP"&&(this.postMessageToMain({isFlow:!0,type:"COMMANDS",commands:s.executedCommands}),s.stop()))}break;default:console.error("Flow message type not recognized");break}}onmessage(){console.warn("onmessage is not implemented")}onerror(){console.warn("onerror is not implemented")}postMessage(e){this.messageEventHandler||(this.messageEventHandler=this.buildMessageEventHandler());const n={data:e};this.messageEventHandler(n)}postMessageToMain(e){window.dispatchEvent(new CustomEvent("NodeRunnerEvent",{detail:te(X({},e),{nodeRunnerId:this.id})}))}startListening(){const e=i=>i.detail.nodeRunnerId===this.id||this.nodeStates.filter(o=>o.id===i.detail.nodeId||o.id===i.detail.toId).length!==0,s=(i=>o=>e(o)&&i({data:o.detail}))(this.onmessage);window.addEventListener("NodeRunnerEvent",s),window.addEventListener("NetworkEvent",s),this.stopListening=()=>{window.removeEventListener("NodeRunnerEvent",s),window.removeEventListener("NetworkEvent",s)}}}const hn=10;function As(t,e){const n={"0":()=>{}};let s=[];function i(){return()=>{t(l=>{const a=[...s];s=[],Object.keys(n).forEach(u=>{!l.messages.find(f=>f.id===u)&&!a.find(f=>f.id===u)&&(n[u]=void 0)});const r=(u,f,d)=>d.findIndex(_=>_.id===u.id)===f;return te(X({},l),{messages:l.messages.concat(...a).map(Ms(l,e,n)).filter(r)})})}}const o=setInterval(i(),hn);return{stop:()=>clearInterval(o),push:async(l,a,r)=>new Promise(u=>{n[a.id]={resolve:u,onCompleted:r};const f=X({},a);f.progress=0,f.id=a.id,s.push(f),f.pos=l.nodes.filter(d=>d.id===a.fromId)[0].pos})}}function Ms(t,e,n){return s=>{var u,f;if(s.done&&n[s.id]&&!n[s.id].resolved&&(n[s.id].onCompleted(s),n[s.id].resolved=!0,(u=n[s.id])==null||u.resolve(s)),s.done)return s;const i=Ls(t,e,hn,s.progress),o=t.nodes.filter(d=>d.id===s.fromId)[0],l=t.nodes.filter(d=>d.id===s.toId)[0];if(!o||!l)return alert(`got ${s.fromId} ${s.toId}`),s;const a=o.pos,r=l.pos;return s.pos=[a[0]+Math.min(i,1)*(r[0]-a[0]),a[1]+Math.min(i,1)*(r[1]-a[1])],i>=1&&(s.done=!0,n[s.id]?s.progress<1&&(n[s.id].onCompleted(s),n[s.id].resolved=!0,(f=n[s.id])==null||f.resolve(te(X({},s),{done:!0}))):console.warn("onCompletedMap missing key")),s.progress=i,s}}function Ls(t,e,n,s){const i=e<=0?1:n/(e/t.speed);return Math.min(s+(t.paused?0:i),1)}function Rs(t,e,n,s,i){const o=u=>n(f=>{const d=u(f);return X(X({},f),d)}),l={setSpeed:u=>n(f=>te(X({},f),{speed:u})),stepForwards:()=>o(t.useGlobalState?gt(t,e,!0):_t(t,e,!0)),stepBackwards:()=>o(t.useGlobalState?gt(t,e,!1):_t(t,e,!1)),pauseOrPlay:()=>o(js(t,e,void 0)),reset:()=>o(vt(t,e,void 0,s,i)),terminate:Hs(t,e,s)},a=u=>({delete:()=>n(f=>te(X({},f),{selectedElementId:void 0,messages:f.messages.filter(d=>d.id!==f.selectedElementId)})),modify:f=>()=>n(d=>te(X({},d),{messages:d.messages.filter(_=>_.id!==d.selectedElementId).concat(f)}))}),r=u=>({connectOrDisconnect:()=>o(Ds(t,e,u.id)),restart:()=>o(vt(t,e,u.id))});return{simulation:l,element:u=>te(X(X({},r(u)),a()),{createNewAction:f=>()=>{n(d=>{const _=f(t,d,e);return X(X({},d),_)})}})}}function Ds(t,e,n){return s=>{if(!!n&&!!e[n])return e[n].postMessage({isFlow:!0,type:s.nodes.find(i=>i.id===n).connected?"DISCONNECT":"RECONNECT",nodeId:n}),{nodes:s.nodes.map(i=>te(X({},i),{connected:n&&i.id===n?!i.connected:i.connected}))}}}function js(t,e,n=void 0){return s=>{if(Object.values(e).forEach(i=>i.postMessage({isFlow:!0,nodeId:n,type:s.paused?"RESTART":"STOP"})),s.paused){const i=s.messages.filter(o=>o.deleted).sort(pn);if(i.length>0&&i[0]){const o=i[0].fromId;e[o].postMessage({isFlow:!0,nodeId:o,type:"STEP",forward:!0})}}return{paused:typeof s.paused=="undefined"?!0:!s.paused,messages:s.paused?s.messages.filter(i=>!i.deleted):s.messages,nodes:s.nodes.filter(i=>n?i.id===n:!0).map(i=>te(X({},i),{running:!i.running}))}}}function gt(t,e,n=!0){return s=>{if(window.states||(window.stateIdx=-1,window.states=[]),n&&(window.states.length===0||window.stateIdx===window.states.length-1)){const i={messages:Fs([],s.messages),nodes:s.nodes};return window.states.push(i),i}else return n?(window.stateIdx+=1,window.states[window.stateIdx]):(window.stateIdx=Math.max(0,window.stateIdx-1),window.states[window.stateIdx])}}function _t(t,e,n=!0){return s=>{if(n)return{messages:s.messages.map(o=>(o.done||o.deleted||(o.progress=o.progress<.5?.5:1,o.done=o.progress>=1),o))};{const i=[],o=s.messages.sort(pn(!0)),l=o.reduce(bt(o),[]),a=o.filter(u=>l.indexOf(u)===-1).reduce(bt(o),[]),r=s.messages.map(u=>(l.indexOf(u)!==-1?u.progress>.5?(u.progress=.5,u.done=!1,u.deleted=!1):(u.progress=0,u.deleted=!0,u.done=!0,i.push(u)):a.indexOf(u)!==-1&&(u.done=!1,u.progress=.5),u)).filter(u=>!u.deleted);return i.map(u=>u.fromId).filter(Bs).forEach(u=>{e[u].postMessage({isFlow:!0,type:"STEP",forward:!1})}),{messages:r}}}}function bt(t){return(e,n)=>{if(t.length===0)return[];const s=t[0].broadcastKey;return s?(s&&s===n.broadcastKey&&e.push(n),e):[t[0]]}}function pn(t=!1){return(e,n)=>{const s=new Date(e.sent).getTime(),i=new Date(n.sent).getTime();return s>i?t?-1:1:s<i?t?1:-1:0}}function Fs(t,e){return e.map(n=>{const s=t.findIndex(i=>i.id===n.id)==-1;return n.done||n.deleted&&s||(n.deleted=!1,n.progress=n.progress<.5?.5:1,n.done=n.progress>=1),n})}function Hs(t,e,n){return()=>{n(),Object.values(e).forEach(s=>s.terminate())}}function vt(t,e,n,s,i){return o=>{if(n&&e[n]){const l=o.nodes.find(a=>a.id===n);e[n].postMessage({config:t,isFlow:!0,type:"RESET",nodeId:n,nodes:[l],neighbors:o.nodes.filter(a=>a.id!==l.id)})}else if(!n)return s&&s(),i&&i();return{}}}const Bs=(t,e,n)=>n.indexOf(t)===e;function Ws({value:t,update:e},{value:n,update:s},i){const o=As(s,t.networkDelay/n.speed),l={};for(const r of n.nodes){const u=t.useWorkers?new _s({type:"module",name:r.id}):new Cs(t,[r]),f=d=>{const _=d.data;if(_.isFlow)switch(_.type){case"STATE_CHANGED":if(!_.data)break;s(g=>te(X({},g),{commands:(g.commands||[]).concat(..._.data.scheduledCommands||[]),nodes:[...g.nodes.map(m=>m.id===r.id?X(X({},m),_.data):m)]}));break}else o.push(n,_,g=>{g.toId&&l[g.toId].postMessage(g)})};u.onmessage=f,u.onerror=d=>{console.error(d.message,d.error,d),e(_=>te(X({},_),{useWorkers:!1}))},t.useWorkers||u.startListening(),u.postMessage({isFlow:!0,type:"SETUP",config:t,nodes:[r],neighbors:n.nodes.filter(d=>d.id!==r.id)}),l[r.id]=u}const a=Rs(t,l,s,o.stop,i);return[l,a]}function mn(t,e){const n=[];for(let s=0;s<t;s++){const i=2*Math.PI*((s+1)/t);n.push([e*Math.cos(i)+e,e*Math.sin(i)+e])}return n}const qs=1,Gs=1,Us=1,Xs=1,zs=1;function gn(t){const e={selectedElementId:void 0,started:new Date,speed:1,nodes:[],messages:[]};return e.nodes=Ks(t),e}function Ks(t){const e=[];if(t.numberOfClients<qs)throw"IllegalAmountOfClients";for(let n=0;n<t.numberOfClients;n++)e.push({id:"C"+(n+1),type:"client",running:!0,connected:!0,state:"IDLE",pos:[50+n*60,50]});if(t.useSingleNodes){if(t.numberOfNodes<Gs)throw"IllegalAmountOfNodes";const n=130,s=mn(t.numberOfNodes,100);for(let i=0;i<t.numberOfNodes;i++)e.push({id:"N"+(i+1),type:"node",running:!0,connected:!0,state:"IDLE",pos:[s[i][0]+50,s[i][1]+n]});return e}if(t.numberOfProposers<Us)throw"IllegalAmountOfProposers";for(let n=0;n<t.numberOfProposers;n++)e.push({id:"P"+(n+1),type:"proposer",state:"IDLE",running:!0,connected:!0,pos:[100+n*60,150]});if(t.numberOfAcceptors<Xs)throw"IllegalAmountOfAcceptors";for(let n=0;n<t.numberOfAcceptors;n++)e.push({id:"A"+(n+1),type:"acceptor",state:"IDLE",running:!0,connected:!0,pos:[100+n*60,250]});if(t.numberOfLearners<zs)throw"IllegalAmountOfLearners";for(let n=0;n<t.numberOfLearners;n++)e.push({id:"L"+(n+1),type:"learner",state:"IDLE",running:!0,connected:!0,pos:[50+n*60,350]});return e}const _n={algorithm:"paxos",numberOfClients:1,numberOfProposers:1,numberOfAcceptors:3,numberOfLearners:2,numberOfNodes:5,useSingleNodes:!0,learnerImpl:"none",electLeader:!0},Qs=te(X({},Ue),{getText:t=>{let e=t.method;switch(t.method){case"REQUEST":e+=` (${t.v})`;break;case"PROMISE":case"PREPARE":case"IGNORED":e+=` (${t.n})`;break;case"ACCEPT":case"ACCEPTED":e+=` (${t.n+", "+t.v})`;break}return e}}),$s={isLeader:t=>{var e;return(e=t.proposer)==null?void 0:e.isProposer}},Qe={padding:2};function Js(t,e,n,s=Qe){if(!e)return[t.canvas.width,t.canvas.height];let i=0;return s=X(X({},Qe),s),e.nodes.forEach((o,l)=>{var f;const a=30*l;t.beginPath(),t.fillStyle="#000",t.font="20px courier new";let r=[0,a+12];t.fillText(o.id,...r),t.closePath();let u=o.id.length*20+Qe.padding;(f=o.proposer)!=null&&f.log&&o.proposer.log.filter(d=>d).forEach(d=>{t.beginPath(),t.lineWidth=2,t.strokeStyle="#000";const _=d.length*10;t.rect(u-s.padding,a,_+s.padding*2,10),t.stroke(),t.closePath(),t.beginPath(),t.fillStyle="#000",t.font="12px courier new";let g=u+d.length*12+2,m=[g,a+8];u=g,t.fillText(d,...m),t.closePath()})}),[i,30*(e.nodes.length+1)]}function Ys(t){let e,n,s,i,o,l,a,r,u,f,d,_,g,m,v,E;return{c(){e=h("div"),n=h("label"),s=M(`Number of Proposers\r
                `),i=h("input"),o=D(),l=h("div"),a=h("label"),r=M(`Number of Acceptors\r
                `),u=h("input"),f=D(),d=h("div"),_=h("label"),g=M(`Number of Learners\r
                `),m=h("input"),p(i,"type","number"),p(i,"min","1"),p(i,"max","10"),p(e,"class","input-group"),p(u,"type","number"),p(u,"min","1"),p(u,"max","10"),p(l,"class","input-group"),p(m,"type","number"),p(m,"min","1"),p(m,"max","10"),p(d,"class","input-group")},m(b,y){w(b,e,y),c(e,n),c(n,s),c(n,i),ne(i,t[1].numberOfProposers),w(b,o,y),w(b,l,y),c(l,a),c(a,r),c(a,u),ne(u,t[1].numberOfAcceptors),w(b,f,y),w(b,d,y),c(d,_),c(_,g),c(_,m),ne(m,t[1].numberOfLearners),v||(E=[V(i,"input",t[4]),V(u,"input",t[5]),V(m,"input",t[6])],v=!0)},p(b,y){y&2&&le(i.value)!==b[1].numberOfProposers&&ne(i,b[1].numberOfProposers),y&2&&le(u.value)!==b[1].numberOfAcceptors&&ne(u,b[1].numberOfAcceptors),y&2&&le(m.value)!==b[1].numberOfLearners&&ne(m,b[1].numberOfLearners)},d(b){b&&k(e),b&&k(o),b&&k(l),b&&k(f),b&&k(d),v=!1,re(E)}}}function Vs(t){let e,n,s,i,o,l;return{c(){e=h("div"),n=h("label"),s=M(`Number of Nodes\r
                `),i=h("input"),p(i,"type","number"),p(i,"min","1"),p(i,"max",15),p(e,"class","input-group")},m(a,r){w(a,e,r),c(e,n),c(n,s),c(n,i),ne(i,t[1].numberOfNodes),o||(l=V(i,"input",t[3]),o=!0)},p(a,r){r&2&&le(i.value)!==a[1].numberOfNodes&&ne(i,a[1].numberOfNodes)},d(a){a&&k(e),o=!1,l()}}}function Zs(t){let e,n,s,i,o,l,a,r,u,f,d,_,g,m,v;function E(A,H){return A[1].useSingleNodes?Vs:Ys}let b=E(t),y=b(t);return{c(){e=h("div"),n=h("div"),s=h("label"),i=M(`Number of Clients\r
            `),o=h("input"),l=D(),y.c(),a=D(),r=h("div"),u=h("label"),f=M(`Learner Implementation\r
            `),d=h("select"),_=h("option"),_.textContent="none",g=h("option"),g.textContent="contact all acceptors",p(o,"type","number"),p(o,"min","1"),p(o,"max",5),p(n,"class","input-group"),_.__value="none",_.value=_.__value,g.__value="contactAllAcceptors",g.value=g.__value,t[1].learnerImpl===void 0&&Be(()=>t[7].call(d)),p(r,"class","input-group"),p(e,"class","algorithm-specific-options")},m(A,H){w(A,e,H),c(e,n),c(n,s),c(s,i),c(s,o),ne(o,t[1].numberOfClients),c(e,l),y.m(e,null),c(e,a),c(e,r),c(r,u),c(u,f),c(u,d),c(d,_),c(d,g),ot(d,t[1].learnerImpl),m||(v=[V(o,"input",t[2]),V(d,"change",t[7])],m=!0)},p(A,[H]){H&2&&le(o.value)!==A[1].numberOfClients&&ne(o,A[1].numberOfClients),b===(b=E(A))&&y?y.p(A,H):(y.d(1),y=b(A),y&&(y.c(),y.m(e,a))),H&2&&ot(d,A[1].learnerImpl)},i:Q,o:Q,d(A){A&&k(e),y.d(),m=!1,re(v)}}}function xs(t,e,n){let s,i=Q,o=()=>(i(),i=de(l,g=>n(1,s=g)),l);t.$$.on_destroy.push(()=>i());let{config:l}=e;o();function a(){s.numberOfClients=le(this.value),l.set(s)}function r(){s.numberOfNodes=le(this.value),l.set(s)}function u(){s.numberOfProposers=le(this.value),l.set(s)}function f(){s.numberOfAcceptors=le(this.value),l.set(s)}function d(){s.numberOfLearners=le(this.value),l.set(s)}function _(){s.learnerImpl=Hn(this),l.set(s)}return t.$$set=g=>{"config"in g&&o(n(0,l=g.config))},[l,s,a,r,u,f,d,_]}class ei extends fe{constructor(e){super(),ce(this,e,xs,Zs,ae,{config:0})}}const Se={name:"Paxos",description:"Paxos is a consensus algorithm.",original:"http://lamport.azurewebsites.net/pubs/lamport-paxos.pdf",areas:["Distributed Databases"],applications:[{title:"AzureRSL",src:""}],info:{byNodeType:{leader:"A leader primarily has the role of the proposer.",follower:"A follower primarily has the role of the acceptor.",node:"A paxos Node follows all three roles of the paxos protocol.",proposer:"A proposer tries to have the acceptors agree on a value v send by a client.",acceptor:"An acceptor votes on proposals sent from the proposer. Only then a value can be stored",learner:"A learner makes sure an accepted value is stored and distributed.",client:"Clients want to store data or run actions inside the paxos network. The client is most likely another server system."},byNodeState:{},byMessageMethod:{RESPONSE:"Clients may be informed about the outcome of the voting.",REQUEST:"Clients can send requests to the current leader if they want to store an input to the replicated log of the cluster.",PREPARE:"A leader node (or proposer) sends followers its generation n. It prepares to commit a value v.",PROMISE:"Followers (or acceptors) answer to the PREPARE requests with a PROMISE message",ACCEPT:"After getting all promises from the acceptor the proposer wants all acceptors to accept a value v",ACCEPTED:"If an acceptor accepts a value v it sends an ACCEPTED message back to the proposer",IGNORED:"If an acceptor does not accept a value v it sends an IGNORED message back to the proposer. The proposer must try again with a higher generation"}}};function ti(t){let e,n,s=t[0].id+"",i,o,l,a,r=(Se.info.byNodeType[t[0].type]||"No information")+"",u,f,d,_=(Se.info.byNodeState[t[0].state]||"")+"",g,m,v,E,b,y,A=t[0].type+"",H,G,j,I,L,S=t[0].state+"",N,P,T,R,F,W,O,C=t[0].connected?"disconnect":"reconnect",K,J,B,U=t[0].type!=="client"&&yt(t),$=t[0].type==="client"&&kt(t);return{c(){e=h("h1"),n=M("Node "),i=M(s),o=D(),l=h("p"),a=h("span"),u=M(r),f=D(),d=h("span"),g=M(_),m=D(),v=h("ul"),E=h("li"),b=M("type: "),y=h("span"),H=M(A),G=D(),j=h("li"),I=M("state: "),L=h("span"),N=M(S),P=D(),U&&U.c(),T=D(),$&&$.c(),R=D(),F=h("button"),F.textContent="restart",W=D(),O=h("button"),K=M(C),p(y,"class","svelte-1muk73i"),p(E,"class","svelte-1muk73i"),p(L,"class","svelte-1muk73i"),p(j,"class","svelte-1muk73i"),p(v,"class","property-list svelte-1muk73i")},m(z,Y){w(z,e,Y),c(e,n),c(e,i),w(z,o,Y),w(z,l,Y),c(l,a),c(a,u),c(l,f),c(l,d),c(d,g),w(z,m,Y),w(z,v,Y),c(v,E),c(E,b),c(E,y),c(y,H),c(v,G),c(v,j),c(j,I),c(j,L),c(L,N),c(v,P),U&&U.m(v,null),w(z,T,Y),$&&$.m(z,Y),w(z,R,Y),w(z,F,Y),w(z,W,Y),w(z,O,Y),c(O,K),J||(B=[V(F,"click",function(){ue(t[1].restart)&&t[1].restart.apply(this,arguments)}),V(O,"click",function(){ue(t[1].connectOrDisconnect)&&t[1].connectOrDisconnect.apply(this,arguments)})],J=!0)},p(z,Y){t=z,Y&1&&s!==(s=t[0].id+"")&&Z(i,s),Y&1&&r!==(r=(Se.info.byNodeType[t[0].type]||"No information")+"")&&Z(u,r),Y&1&&_!==(_=(Se.info.byNodeState[t[0].state]||"")+"")&&Z(g,_),Y&1&&A!==(A=t[0].type+"")&&Z(H,A),Y&1&&S!==(S=t[0].state+"")&&Z(N,S),t[0].type!=="client"?U?U.p(t,Y):(U=yt(t),U.c(),U.m(v,null)):U&&(U.d(1),U=null),t[0].type==="client"?$?$.p(t,Y):($=kt(t),$.c(),$.m(R.parentNode,R)):$&&($.d(1),$=null),Y&1&&C!==(C=t[0].connected?"disconnect":"reconnect")&&Z(K,C)},d(z){z&&k(e),z&&k(o),z&&k(l),z&&k(m),z&&k(v),U&&U.d(),z&&k(T),$&&$.d(z),z&&k(R),z&&k(F),z&&k(W),z&&k(O),J=!1,re(B)}}}function ni(t){let e,n,s=t[0].id+"",i,o,l,a=t[0].toId+"",r,u,f=t[0].fromId+"",d,_,g,m=Se.info.byMessageMethod[t[0].method]+"",v,E,b,y,A,H,G=t[0].method+"",j,I,L=["REQUEST","ACCEPTED","ACCEPT"].indexOf(t[0].method)!==-1,S,N=["ACCEPT","ACCEPTED","PROMISE","PREPARE","IGNORED"].indexOf(t[0].method)!==-1,P,T,R,F,W,O,C=L&&wt(t),K=N&&Et(t);return{c(){e=h("h1"),n=M("Message "),i=M(s),o=D(),l=h("p"),r=M(a),u=M(" \u2192 "),d=M(f),_=D(),g=h("p"),v=M(m),E=D(),b=h("ul"),y=h("li"),A=M("method: "),H=h("span"),j=M(G),I=D(),C&&C.c(),S=D(),K&&K.c(),P=D(),T=h("button"),T.textContent="delete",R=D(),F=h("button"),F.textContent="modify",p(H,"class","svelte-1muk73i"),p(y,"class","svelte-1muk73i"),p(b,"class","property-list svelte-1muk73i")},m(J,B){w(J,e,B),c(e,n),c(e,i),w(J,o,B),w(J,l,B),c(l,r),c(l,u),c(l,d),w(J,_,B),w(J,g,B),c(g,v),w(J,E,B),w(J,b,B),c(b,y),c(y,A),c(y,H),c(H,j),c(b,I),C&&C.m(b,null),c(b,S),K&&K.m(b,null),w(J,P,B),w(J,T,B),w(J,R,B),w(J,F,B),W||(O=[V(T,"click",function(){ue(t[1].delete)&&t[1].delete.apply(this,arguments)}),V(F,"click",function(){ue(t[1].modify)&&t[1].modify.apply(this,arguments)})],W=!0)},p(J,B){t=J,B&1&&s!==(s=t[0].id+"")&&Z(i,s),B&1&&a!==(a=t[0].toId+"")&&Z(r,a),B&1&&f!==(f=t[0].fromId+"")&&Z(d,f),B&1&&m!==(m=Se.info.byMessageMethod[t[0].method]+"")&&Z(v,m),B&1&&G!==(G=t[0].method+"")&&Z(j,G),B&1&&(L=["REQUEST","ACCEPTED","ACCEPT"].indexOf(t[0].method)!==-1),L?C?C.p(t,B):(C=wt(t),C.c(),C.m(b,S)):C&&(C.d(1),C=null),B&1&&(N=["ACCEPT","ACCEPTED","PROMISE","PREPARE","IGNORED"].indexOf(t[0].method)!==-1),N?K?K.p(t,B):(K=Et(t),K.c(),K.m(b,null)):K&&(K.d(1),K=null)},d(J){J&&k(e),J&&k(o),J&&k(l),J&&k(_),J&&k(g),J&&k(E),J&&k(b),C&&C.d(),K&&K.d(),J&&k(P),J&&k(T),J&&k(R),J&&k(F),W=!1,re(O)}}}function si(t){let e;return{c(){e=h("span"),e.textContent="No valid element select"},m(n,s){w(n,e,s)},p:Q,d(n){n&&k(e)}}}function yt(t){let e,n,s,i=(t[0].greatestN||0)+"",o;return{c(){e=h("li"),n=M("generation: "),s=h("span"),o=M(i),p(s,"class","svelte-1muk73i"),p(e,"class","svelte-1muk73i")},m(l,a){w(l,e,a),c(e,n),c(e,s),c(s,o)},p(l,a){a&1&&i!==(i=(l[0].greatestN||0)+"")&&Z(o,i)},d(l){l&&k(e)}}}function kt(t){let e,n,s,i,o;return{c(){e=h("input"),n=D(),s=h("button"),s.textContent="request",p(e,"type","text")},m(l,a){w(l,e,a),ne(e,t[2]),w(l,n,a),w(l,s,a),i||(o=[V(e,"input",t[7]),V(s,"click",function(){ue(t[4])&&t[4].apply(this,arguments)})],i=!0)},p(l,a){t=l,a&4&&e.value!==t[2]&&ne(e,t[2])},d(l){l&&k(e),l&&k(n),l&&k(s),i=!1,re(o)}}}function wt(t){let e,n,s,i,o;return{c(){e=h("li"),n=M("value: "),s=h("input"),p(s,"type","text"),p(e,"class","svelte-1muk73i")},m(l,a){w(l,e,a),c(e,n),c(e,s),ne(s,t[0].v),i||(o=V(s,"input",t[5]),i=!0)},p(l,a){a&1&&s.value!==l[0].v&&ne(s,l[0].v)},d(l){l&&k(e),i=!1,o()}}}function Et(t){let e,n,s,i,o;return{c(){e=h("li"),n=M("generation: "),s=h("input"),p(s,"type","text"),p(e,"class","svelte-1muk73i")},m(l,a){w(l,e,a),c(e,n),c(e,s),ne(s,t[0].n),i||(o=V(s,"input",t[6]),i=!0)},p(l,a){a&1&&s.value!==l[0].n&&ne(s,l[0].n)},d(l){l&&k(e),i=!1,o()}}}function ii(t){let e;function n(o,l){return o[0]?o[3]?ni:ti:si}let s=n(t),i=s(t);return{c(){e=h("div"),i.c(),p(e,"class","node-actions-panel")},m(o,l){w(o,e,l),i.m(e,null)},p(o,[l]){s===(s=n(o))&&i?i.p(o,l):(i.d(1),i=s(o),i&&(i.c(),i.m(e,null)))},i:Q,o:Q,d(o){o&&k(e),i.d()}}}function li(t,e,n){let{element:s}=e,{actions:i}=e;function o(g,m,v){v[s.id].postMessage({nodeId:s.id,isFlow:!0,type:"CLIENT_REQUEST",v:l})}let l="777",a="",r=!1,u=()=>{};Ze(()=>{i&&!r&&s&&s.type==="client"&&n(4,u=i.createNewAction(o)),s&&a!==s.id&&(n(2,l=s.id),a=s.id,n(3,r=s&&s.fromId))});function f(){s.v=this.value,n(0,s)}function d(){s.n=this.value,n(0,s)}function _(){l=this.value,n(2,l)}return t.$$set=g=>{"element"in g&&n(0,s=g.element),"actions"in g&&n(1,i=g.actions)},[s,i,l,r,u,f,d,_]}class oi extends fe{constructor(e){super(),ce(this,e,li,ii,ae,{element:0,actions:1})}}function St(t,e,n){const s=t.slice();return s[3]=e[n],s}function Ot(t,e,n){const s=t.slice();return s[6]=e[n],s}function Nt(t){let e,n=t[1].nodes.filter(Pt),s=[];for(let i=0;i<n.length;i+=1)s[i]=It(St(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=we()},m(i,o){for(let l=0;l<s.length;l+=1)s[l].m(i,o);w(i,e,o)},p(i,o){if(o&2){n=i[1].nodes.filter(Pt);let l;for(l=0;l<n.length;l+=1){const a=St(i,n,l);s[l]?s[l].p(a,o):(s[l]=It(a),s[l].c(),s[l].m(e.parentNode,e))}for(;l<s.length;l+=1)s[l].d(1);s.length=n.length}},d(i){ve(s,i),i&&k(e)}}}function Tt(t){let e,n=t[6]+"",s;return{c(){e=h("li"),s=M(n),p(e,"class","entry svelte-1o1yvcd")},m(i,o){w(i,e,o),c(e,s)},p(i,o){o&2&&n!==(n=i[6]+"")&&Z(s,n)},d(i){i&&k(e)}}}function It(t){let e,n,s=t[3].id+"",i,o,l,a,r,u=t[3].log,f=[];for(let d=0;d<u.length;d+=1)f[d]=Tt(Ot(t,u,d));return{c(){e=h("li"),n=h("h1"),i=M(s),o=D(),l=h("ul");for(let d=0;d<f.length;d+=1)f[d].c();r=D(),p(n,"class","svelte-1o1yvcd"),p(l,"class",a=be(t[1].selectedElementId===t[3].id?"selected":"")+" svelte-1o1yvcd"),p(e,"class","log svelte-1o1yvcd")},m(d,_){w(d,e,_),c(e,n),c(n,i),c(e,o),c(e,l);for(let g=0;g<f.length;g+=1)f[g].m(l,null);c(e,r)},p(d,_){if(_&2&&s!==(s=d[3].id+"")&&Z(i,s),_&2){u=d[3].log;let g;for(g=0;g<u.length;g+=1){const m=Ot(d,u,g);f[g]?f[g].p(m,_):(f[g]=Tt(m),f[g].c(),f[g].m(l,null))}for(;g<f.length;g+=1)f[g].d(1);f.length=u.length}_&2&&a!==(a=be(d[1].selectedElementId===d[3].id?"selected":"")+" svelte-1o1yvcd")&&p(l,"class",a)},d(d){d&&k(e),ve(f,d)}}}function ri(t){let e,n,s=t[0]&&Nt(t);return{c(){e=h("div"),n=h("ul"),s&&s.c(),p(n,"class","nodes svelte-1o1yvcd"),ln(e,"overflow","auto")},m(i,o){w(i,e,o),c(e,n),s&&s.m(n,null)},p(i,[o]){i[0]?s?s.p(i,o):(s=Nt(i),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:Q,o:Q,d(i){i&&k(e),s&&s.d()}}}const Pt=t=>t.type==="node"&&t.log;function ai(t,e,n){let s,i=Q,o=()=>(i(),i=de(a,r=>n(1,s=r)),a);t.$$.on_destroy.push(()=>i());let{configStore:l}=e,{stateStore:a}=e;return o(),t.$$set=r=>{"configStore"in r&&n(2,l=r.configStore),"stateStore"in r&&o(n(0,a=r.stateStore))},[a,s,l]}class ui extends fe{constructor(e){super(),ce(this,e,ai,ri,ae,{configStore:2,stateStore:0})}}const ci="Paxos",bn="paxos",fi={seqPaintingOptions:Qs,nodePaintingOptions:$s,paintState:Js},di={Configuration:ei,Actions:oi,StateGraph:ui};var hi=Object.freeze(Object.defineProperty({__proto__:null,title:ci,key:bn,drawing:fi,components:di,setupNode:cn,generateState:gn,defaultConfig:_n},Symbol.toStringTag,{value:"Module"}));function pi(t){const e={selectedElementId:void 0,started:new Date,speed:1,nodes:[],messages:[]};for(let s=0;s<t.numberOfClients;s++)e.nodes.push({id:"C"+(s+1),type:"client",running:!0,connected:!0,state:"IDLE",pos:[50+s*60,50]});const n=mn(t.numberOfNodes,80);for(let s=0;s<t.numberOfNodes;s++)e.nodes.push({id:"N"+(s+1),type:"node",running:!0,connected:!0,state:"IDLE",pos:[n[s][0]+80,n[s][1]+80]});return e}const mi={numberOfClients:1,numberOfNodes:5},gi=te(X({},Ue),{getText:t=>t.command==="rawtransaction"?`${t.command} (${t.tx})`:t.command==="submitblock"&&t.block.transactions?`${t.command} (${t.block.transactions.join(", ")})`:`${t.command}`}),_i={isLeader:t=>!1};function bi(t,e,n){return e?[t.canvas.width,t.canvas.height]:[t.canvas.width,t.canvas.height]}function vi(t){let e,n,s,i,o,l,a,r,u,f,d,_;return{c(){e=h("div"),n=h("div"),s=h("label"),i=M(`Number of Clients\r
            `),o=h("input"),l=D(),a=h("div"),r=h("label"),u=M(`Number of Nodes\r
            `),f=h("input"),p(o,"type","number"),p(o,"min","1"),p(o,"max",10),p(n,"class","input-group"),p(f,"type","number"),p(f,"min","1"),p(f,"max",10),p(a,"class","input-group")},m(g,m){w(g,e,m),c(e,n),c(n,s),c(s,i),c(s,o),ne(o,t[1].numberOfClients),c(e,l),c(e,a),c(a,r),c(r,u),c(r,f),ne(f,t[1].numberOfNodes),d||(_=[V(o,"input",t[2]),V(f,"input",t[3])],d=!0)},p(g,[m]){m&2&&le(o.value)!==g[1].numberOfClients&&ne(o,g[1].numberOfClients),m&2&&le(f.value)!==g[1].numberOfNodes&&ne(f,g[1].numberOfNodes)},i:Q,o:Q,d(g){g&&k(e),d=!1,re(_)}}}function yi(t,e,n){let s,i=Q,o=()=>(i(),i=de(l,u=>n(1,s=u)),l);t.$$.on_destroy.push(()=>i());let{config:l}=e;o();function a(){s.numberOfClients=le(this.value),l.set(s)}function r(){s.numberOfNodes=le(this.value),l.set(s)}return t.$$set=u=>{"config"in u&&o(n(0,l=u.config))},[l,s,a,r]}class ki extends fe{constructor(e){super(),ce(this,e,yi,vi,ae,{config:0})}}const Oe={info:{byNodeType:{node:`Nodes accept, save and relay new transactions/blocks.
            A Node can also create Blocks with saved blocks.
            Nodes joins the Network and asks for the current blockchain.`,client:`A client uses a node to request a transaction to be saved on the blockchain.
      Clients can be outside of the P2P network. 
      They may use external providers that actually own nodes to send transactions.`},byNodeSync:{true:"Sync nodes can send their blockchain to new nodes."},byMessageCommand:{REQUEST:"Clients request transactions to be stored on the blockchain.",getblocks:"New nodes bootstrap by asking sync nodes for their blockchain.",blocks:"Sync nodes answer with their blocks to new nodes (getblocks).",submitblock:"Nodes send new mined blocks to their neighbors.",rawtransaction:"Nodes relay transactions to their neighbors."}}};function Ct(t,e,n){const s=t.slice();return s[1]=e[n],s}function At(t){let e,n,s,i=t[0].transactions,o=[];for(let l=0;l<i.length;l+=1)o[l]=Mt(Ct(t,i,l));return{c(){e=h("div"),n=M("transactions: "),s=h("ul");for(let l=0;l<o.length;l+=1)o[l].c();p(s,"class","transactions")},m(l,a){w(l,e,a),c(e,n),c(e,s);for(let r=0;r<o.length;r+=1)o[r].m(s,null)},p(l,a){if(a&1){i=l[0].transactions;let r;for(r=0;r<i.length;r+=1){const u=Ct(l,i,r);o[r]?o[r].p(u,a):(o[r]=Mt(u),o[r].c(),o[r].m(s,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=i.length}},d(l){l&&k(e),ve(o,l)}}}function Mt(t){let e,n=t[1]+"",s;return{c(){e=h("li"),s=M(n)},m(i,o){w(i,e,o),c(e,s)},p(i,o){o&1&&n!==(n=i[1]+"")&&Z(s,n)},d(i){i&&k(e)}}}function wi(t){var R,F,W;let e,n,s,i,o,l=((F=(R=t[0].header)==null?void 0:R.prevHeaderHash)==null?void 0:F.slice(0,8))+"",a,r,u,f,d,_,g=((W=t[0].header)==null?void 0:W.merkleRoot)+"",m,v,E,b,y,A=t[0].height+"",H,G,j,I,L,S=new Date(t[0].timestamp).toLocaleString()+"",N,P,T=t[0].transactions&&t[0].transactions.length!==0&&At(t);return{c(){e=h("ul"),n=h("li"),s=M("prevHeaderHash: "),i=h("span"),o=M("0x"),a=M(l),r=M("..."),u=D(),f=h("li"),d=M("merkleRoot: "),_=h("span"),m=M(g),v=D(),E=h("li"),b=M("height: "),y=h("span"),H=M(A),G=D(),j=h("li"),I=M("timestamp: "),L=h("span"),N=M(S),P=D(),T&&T.c(),p(e,"class","block svelte-cd4rqg")},m(O,C){w(O,e,C),c(e,n),c(n,s),c(n,i),c(i,o),c(i,a),c(i,r),c(e,u),c(e,f),c(f,d),c(f,_),c(_,m),c(e,v),c(e,E),c(E,b),c(E,y),c(y,H),c(e,G),c(e,j),c(j,I),c(j,L),c(L,N),c(e,P),T&&T.m(e,null)},p(O,[C]){var K,J,B;C&1&&l!==(l=((J=(K=O[0].header)==null?void 0:K.prevHeaderHash)==null?void 0:J.slice(0,8))+"")&&Z(a,l),C&1&&g!==(g=((B=O[0].header)==null?void 0:B.merkleRoot)+"")&&Z(m,g),C&1&&A!==(A=O[0].height+"")&&Z(H,A),C&1&&S!==(S=new Date(O[0].timestamp).toLocaleString()+"")&&Z(N,S),O[0].transactions&&O[0].transactions.length!==0?T?T.p(O,C):(T=At(O),T.c(),T.m(e,null)):T&&(T.d(1),T=null)},i:Q,o:Q,d(O){O&&k(e),T&&T.d()}}}function Ei(t,e,n){let{block:s}=e;return t.$$set=i=>{"block"in i&&n(0,s=i.block)},[s]}class vn extends fe{constructor(e){super(),ce(this,e,Ei,wi,ae,{block:0})}}function Lt(t,e,n){const s=t.slice();return s[9]=e[n],s}function Si(t){let e,n,s=t[0].id+"",i,o,l,a,r=(Oe.info.byNodeType[t[0].type]||"No information")+"",u,f,d,_=(Oe.info.byNodeSync[t[0].sync]||"")+"",g,m,v,E,b,y,A=t[0].type+"",H,G,j,I,L,S=t[0].state+"",N,P,T,R,F,W,O,C=t[0].connected?"disconnect":"reconnect",K,J,B,U=t[0].type!=="client"&&Rt(t),$=t[0].type==="client"&&Dt(t);return{c(){e=h("h1"),n=M("Node "),i=M(s),o=D(),l=h("p"),a=h("span"),u=M(r),f=D(),d=h("span"),g=M(_),m=D(),v=h("ul"),E=h("li"),b=M("type: "),y=h("span"),H=M(A),G=D(),j=h("li"),I=M("state: "),L=h("span"),N=M(S),P=D(),U&&U.c(),T=D(),$&&$.c(),R=D(),F=h("button"),F.textContent="restart",W=D(),O=h("button"),K=M(C),p(y,"class","svelte-1gcbars"),p(E,"class","svelte-1gcbars"),p(L,"class","svelte-1gcbars"),p(j,"class","svelte-1gcbars"),p(v,"class","property-list svelte-1gcbars")},m(z,Y){w(z,e,Y),c(e,n),c(e,i),w(z,o,Y),w(z,l,Y),c(l,a),c(a,u),c(l,f),c(l,d),c(d,g),w(z,m,Y),w(z,v,Y),c(v,E),c(E,b),c(E,y),c(y,H),c(v,G),c(v,j),c(j,I),c(j,L),c(L,N),c(v,P),U&&U.m(v,null),w(z,T,Y),$&&$.m(z,Y),w(z,R,Y),w(z,F,Y),w(z,W,Y),w(z,O,Y),c(O,K),J||(B=[V(F,"click",function(){ue(t[1].restart)&&t[1].restart.apply(this,arguments)}),V(O,"click",function(){ue(t[1].connectOrDisconnect)&&t[1].connectOrDisconnect.apply(this,arguments)})],J=!0)},p(z,Y){t=z,Y&1&&s!==(s=t[0].id+"")&&Z(i,s),Y&1&&r!==(r=(Oe.info.byNodeType[t[0].type]||"No information")+"")&&Z(u,r),Y&1&&_!==(_=(Oe.info.byNodeSync[t[0].sync]||"")+"")&&Z(g,_),Y&1&&A!==(A=t[0].type+"")&&Z(H,A),Y&1&&S!==(S=t[0].state+"")&&Z(N,S),t[0].type!=="client"?U?U.p(t,Y):(U=Rt(t),U.c(),U.m(v,null)):U&&(U.d(1),U=null),t[0].type==="client"?$?$.p(t,Y):($=Dt(t),$.c(),$.m(R.parentNode,R)):$&&($.d(1),$=null),Y&1&&C!==(C=t[0].connected?"disconnect":"reconnect")&&Z(K,C)},i:Q,o:Q,d(z){z&&k(e),z&&k(o),z&&k(l),z&&k(m),z&&k(v),U&&U.d(),z&&k(T),$&&$.d(z),z&&k(R),z&&k(F),z&&k(W),z&&k(O),J=!1,re(B)}}}function Oi(t){let e,n,s=t[0].id+"",i,o,l,a=t[0].toId+"",r,u,f=t[0].fromId+"",d,_,g,m=Oe.info.byMessageCommand[t[0].command]+"",v,E,b,y,A,H,G=t[0].command+"",j,I,L,S,N,P,T,R,F,W,O;const C=[Pi,Ii,Ti],K=[];function J(B,U){return B[0].command==="blocks"?0:B[0].command==="rawtransaction"||B[0].command==="REQUEST"?1:B[0].command==="submitblock"?2:-1}return~(L=J(t))&&(S=K[L]=C[L](t)),{c(){e=h("h1"),n=M("Message "),i=M(s),o=D(),l=h("p"),r=M(a),u=M(" \u2192 "),d=M(f),_=D(),g=h("p"),v=M(m),E=D(),b=h("ul"),y=h("li"),A=M("command: "),H=h("span"),j=M(G),I=D(),S&&S.c(),N=D(),P=h("button"),P.textContent="delete",T=D(),R=h("button"),R.textContent="modify",p(H,"class","svelte-1gcbars"),p(y,"class","svelte-1gcbars"),p(b,"class","property-list svelte-1gcbars")},m(B,U){w(B,e,U),c(e,n),c(e,i),w(B,o,U),w(B,l,U),c(l,r),c(l,u),c(l,d),w(B,_,U),w(B,g,U),c(g,v),w(B,E,U),w(B,b,U),c(b,y),c(y,A),c(y,H),c(H,j),c(b,I),~L&&K[L].m(b,null),w(B,N,U),w(B,P,U),w(B,T,U),w(B,R,U),F=!0,W||(O=[V(P,"click",function(){ue(t[1].delete)&&t[1].delete.apply(this,arguments)}),V(R,"click",function(){ue(t[1].modify)&&t[1].modify.apply(this,arguments)})],W=!0)},p(B,U){t=B,(!F||U&1)&&s!==(s=t[0].id+"")&&Z(i,s),(!F||U&1)&&a!==(a=t[0].toId+"")&&Z(r,a),(!F||U&1)&&f!==(f=t[0].fromId+"")&&Z(d,f),(!F||U&1)&&m!==(m=Oe.info.byMessageCommand[t[0].command]+"")&&Z(v,m),(!F||U&1)&&G!==(G=t[0].command+"")&&Z(j,G);let $=L;L=J(t),L===$?~L&&K[L].p(t,U):(S&&(pe(),ee(K[$],1,1,()=>{K[$]=null}),me()),~L?(S=K[L],S?S.p(t,U):(S=K[L]=C[L](t),S.c()),x(S,1),S.m(b,null)):S=null)},i(B){F||(x(S),F=!0)},o(B){ee(S),F=!1},d(B){B&&k(e),B&&k(o),B&&k(l),B&&k(_),B&&k(g),B&&k(E),B&&k(b),~L&&K[L].d(),B&&k(N),B&&k(P),B&&k(T),B&&k(R),W=!1,re(O)}}}function Ni(t){let e;return{c(){e=h("span"),e.textContent="No valid element select"},m(n,s){w(n,e,s)},p:Q,i:Q,o:Q,d(n){n&&k(e)}}}function Rt(t){let e,n,s,i=(t[0].sync===!0)+"",o;return{c(){e=h("li"),n=M("sync: "),s=h("span"),o=M(i),p(s,"class","svelte-1gcbars"),p(e,"class","svelte-1gcbars")},m(l,a){w(l,e,a),c(e,n),c(e,s),c(s,o)},p(l,a){a&1&&i!==(i=(l[0].sync===!0)+"")&&Z(o,i)},d(l){l&&k(e)}}}function Dt(t){let e,n,s,i,o;return{c(){e=h("input"),n=D(),s=h("button"),s.textContent="request",p(e,"type","text")},m(l,a){w(l,e,a),ne(e,t[2]),w(l,n,a),w(l,s,a),i||(o=[V(e,"input",t[5]),V(s,"click",function(){ue(t[4])&&t[4].apply(this,arguments)})],i=!0)},p(l,a){t=l,a&4&&e.value!==t[2]&&ne(e,t[2])},d(l){l&&k(e),l&&k(n),l&&k(s),i=!1,re(o)}}}function Ti(t){let e,n;return e=new vn({props:{block:t[0].block}}),{c(){oe(e.$$.fragment)},m(s,i){se(e,s,i),n=!0},p(s,i){const o={};i&1&&(o.block=s[0].block),e.$set(o)},i(s){n||(x(e.$$.fragment,s),n=!0)},o(s){ee(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function Ii(t){let e,n,s,i=t[0].tx+"",o;return{c(){e=h("li"),n=M("transaction: "),s=h("span"),o=M(i),p(s,"class","svelte-1gcbars"),p(e,"class","svelte-1gcbars")},m(l,a){w(l,e,a),c(e,n),c(e,s),c(s,o)},p(l,a){a&1&&i!==(i=l[0].tx+"")&&Z(o,i)},i:Q,o:Q,d(l){l&&k(e)}}}function Pi(t){let e,n,s,i,o=t[0].entries,l=[];for(let r=0;r<o.length;r+=1)l[r]=jt(Lt(t,o,r));const a=r=>ee(l[r],1,1,()=>{l[r]=null});return{c(){e=h("li"),n=M(`entries:\r
                    `),s=h("ul");for(let r=0;r<l.length;r+=1)l[r].c();p(s,"class","property-list entries svelte-1gcbars"),p(e,"class","svelte-1gcbars")},m(r,u){w(r,e,u),c(e,n),c(e,s);for(let f=0;f<l.length;f+=1)l[f].m(s,null);i=!0},p(r,u){if(u&1){o=r[0].entries;let f;for(f=0;f<o.length;f+=1){const d=Lt(r,o,f);l[f]?(l[f].p(d,u),x(l[f],1)):(l[f]=jt(d),l[f].c(),x(l[f],1),l[f].m(s,null))}for(pe(),f=o.length;f<l.length;f+=1)a(f);me()}},i(r){if(!i){for(let u=0;u<o.length;u+=1)x(l[u]);i=!0}},o(r){l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)ee(l[u]);i=!1},d(r){r&&k(e),ve(l,r)}}}function jt(t){let e,n,s,i;return n=new vn({props:{block:t[9]}}),{c(){e=h("li"),oe(n.$$.fragment),s=D(),p(e,"class","svelte-1gcbars")},m(o,l){w(o,e,l),se(n,e,null),c(e,s),i=!0},p(o,l){const a={};l&1&&(a.block=o[9]),n.$set(a)},i(o){i||(x(n.$$.fragment,o),i=!0)},o(o){ee(n.$$.fragment,o),i=!1},d(o){o&&k(e),ie(n)}}}function Ci(t){let e,n,s,i;const o=[Ni,Oi,Si],l=[];function a(r,u){return r[0]?r[3]?1:2:0}return n=a(t),s=l[n]=o[n](t),{c(){e=h("div"),s.c(),p(e,"class","node-actions-panel")},m(r,u){w(r,e,u),l[n].m(e,null),i=!0},p(r,[u]){let f=n;n=a(r),n===f?l[n].p(r,u):(pe(),ee(l[f],1,1,()=>{l[f]=null}),me(),s=l[n],s?s.p(r,u):(s=l[n]=o[n](r),s.c()),x(s,1),s.m(e,null))},i(r){i||(x(s),i=!0)},o(r){ee(s),i=!1},d(r){r&&k(e),l[n].d()}}}function Ai(t,e,n){let{element:s}=e,{actions:i}=e;function o(d,_,g){g[s.id].postMessage({nodeId:s.id,isFlow:!0,type:"CLIENT_REQUEST",v:l})}let l="777",a="",r=!1,u=()=>{};Ze(()=>{i&&!r&&s&&s.type==="client"&&n(4,u=i.createNewAction(o)),s&&a!==s.id&&(n(2,l=s.id),a=s.id,n(3,r=s&&s.fromId))});function f(){l=this.value,n(2,l)}return t.$$set=d=>{"element"in d&&n(0,s=d.element),"actions"in d&&n(1,i=d.actions)},[s,i,l,r,u,f]}class Mi extends fe{constructor(e){super(),ce(this,e,Ai,Ci,ae,{element:0,actions:1})}}function Ft(t,e,n){const s=t.slice();return s[3]=e[n],s}function Ht(t,e,n){const s=t.slice();return s[6]=e[n],s}function Bt(t,e,n){const s=t.slice();return s[9]=e[n],s}function Wt(t){let e,n=t[1].nodes.filter(Qt),s=[];for(let i=0;i<n.length;i+=1)s[i]=Kt(Ft(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=we()},m(i,o){for(let l=0;l<s.length;l+=1)s[l].m(i,o);w(i,e,o)},p(i,o){if(o&2){n=i[1].nodes.filter(Qt);let l;for(l=0;l<n.length;l+=1){const a=Ft(i,n,l);s[l]?s[l].p(a,o):(s[l]=Kt(a),s[l].c(),s[l].m(e.parentNode,e))}for(;l<s.length;l+=1)s[l].d(1);s.length=n.length}},d(i){ve(s,i),i&&k(e)}}}function qt(t){let e,n=t[3].chain,s=[];for(let i=0;i<n.length;i+=1)s[i]=zt(Ht(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=we()},m(i,o){for(let l=0;l<s.length;l+=1)s[l].m(i,o);w(i,e,o)},p(i,o){if(o&2){n=i[3].chain;let l;for(l=0;l<n.length;l+=1){const a=Ht(i,n,l);s[l]?s[l].p(a,o):(s[l]=zt(a),s[l].c(),s[l].m(e.parentNode,e))}for(;l<s.length;l+=1)s[l].d(1);s.length=n.length}},d(i){ve(s,i),i&&k(e)}}}function Gt(t){var L;let e,n,s,i,o=(t[6].header.prevHeaderHash&&"0x"+((L=t[6].header.prevHeaderHash)==null?void 0:L.slice(0,8))+"...")+"",l,a,r,u,f,d=t[6].header.merkleRoot+"",_,g,m,v,E,b=t[6].height+"",y,A,H,G,j,I=t[6].transactions&&t[6].transactions.length!==0&&Ut(t);return{c(){e=h("li"),n=h("p"),s=M("prevHeaderHash: "),i=h("span"),l=M(o),a=D(),r=h("p"),u=M("merkleRoot: "),f=h("span"),_=M(d),g=D(),m=h("p"),v=M("height: "),E=h("span"),y=M(b),A=D(),I&&I.c(),G=D(),j=h("p"),j.textContent=">",p(n,"class","svelte-ylgkgj"),p(r,"class","svelte-ylgkgj"),p(m,"class","svelte-ylgkgj"),p(e,"class",H="block "+(t[1].selectedElementId===t[3].id?"selected":"")+" svelte-ylgkgj"),p(j,"class","arrow svelte-ylgkgj")},m(S,N){w(S,e,N),c(e,n),c(n,s),c(n,i),c(i,l),c(e,a),c(e,r),c(r,u),c(r,f),c(f,_),c(e,g),c(e,m),c(m,v),c(m,E),c(E,y),c(e,A),I&&I.m(e,null),w(S,G,N),w(S,j,N)},p(S,N){var P;N&2&&o!==(o=(S[6].header.prevHeaderHash&&"0x"+((P=S[6].header.prevHeaderHash)==null?void 0:P.slice(0,8))+"...")+"")&&Z(l,o),N&2&&d!==(d=S[6].header.merkleRoot+"")&&Z(_,d),N&2&&b!==(b=S[6].height+"")&&Z(y,b),S[6].transactions&&S[6].transactions.length!==0?I?I.p(S,N):(I=Ut(S),I.c(),I.m(e,null)):I&&(I.d(1),I=null),N&2&&H!==(H="block "+(S[1].selectedElementId===S[3].id?"selected":"")+" svelte-ylgkgj")&&p(e,"class",H)},d(S){S&&k(e),I&&I.d(),S&&k(G),S&&k(j)}}}function Ut(t){let e,n,s,i=t[6].transactions,o=[];for(let l=0;l<i.length;l+=1)o[l]=Xt(Bt(t,i,l));return{c(){e=h("div"),n=M("transactions: "),s=h("ul");for(let l=0;l<o.length;l+=1)o[l].c();p(s,"class","transactions svelte-ylgkgj")},m(l,a){w(l,e,a),c(e,n),c(e,s);for(let r=0;r<o.length;r+=1)o[r].m(s,null)},p(l,a){if(a&2){i=l[6].transactions;let r;for(r=0;r<i.length;r+=1){const u=Bt(l,i,r);o[r]?o[r].p(u,a):(o[r]=Xt(u),o[r].c(),o[r].m(s,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=i.length}},d(l){l&&k(e),ve(o,l)}}}function Xt(t){let e,n=t[9]+"",s;return{c(){e=h("li"),s=M(n)},m(i,o){w(i,e,o),c(e,s)},p(i,o){o&2&&n!==(n=i[9]+"")&&Z(s,n)},d(i){i&&k(e)}}}function zt(t){let e,n=t[6]&&Gt(t);return{c(){n&&n.c(),e=we()},m(s,i){n&&n.m(s,i),w(s,e,i)},p(s,i){s[6]?n?n.p(s,i):(n=Gt(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(s){n&&n.d(s),s&&k(e)}}}function Kt(t){let e,n,s=t[3].id+"",i,o,l,a,r=t[3].chain&&qt(t);return{c(){e=h("li"),n=h("h1"),i=M(s),o=D(),l=h("ul"),r&&r.c(),a=D(),p(n,"class","svelte-ylgkgj"),p(l,"class","chain-list svelte-ylgkgj"),p(e,"class","chain svelte-ylgkgj")},m(u,f){w(u,e,f),c(e,n),c(n,i),c(e,o),c(e,l),r&&r.m(l,null),c(e,a)},p(u,f){f&2&&s!==(s=u[3].id+"")&&Z(i,s),u[3].chain?r?r.p(u,f):(r=qt(u),r.c(),r.m(l,null)):r&&(r.d(1),r=null)},d(u){u&&k(e),r&&r.d()}}}function Li(t){let e,n,s=t[0]&&Wt(t);return{c(){e=h("div"),n=h("ul"),s&&s.c(),p(n,"class","nodes svelte-ylgkgj"),ln(e,"overflow","auto")},m(i,o){w(i,e,o),c(e,n),s&&s.m(n,null)},p(i,[o]){i[0]?s?s.p(i,o):(s=Wt(i),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:Q,o:Q,d(i){i&&k(e),s&&s.d()}}}const Qt=t=>t.type==="node";function Ri(t,e,n){let s,i=Q,o=()=>(i(),i=de(a,r=>n(1,s=r)),a);t.$$.on_destroy.push(()=>i());let{configStore:l}=e,{stateStore:a}=e;return o(),t.$$set=r=>{"configStore"in r&&n(2,l=r.configStore),"stateStore"in r&&o(n(0,a=r.stateStore))},[a,s,l]}class Di extends fe{constructor(e){super(),ce(this,e,Ri,Li,ae,{configStore:2,stateStore:0})}}const ji="Bitcoin/Proof-of-Work",yn="bitcoin_pow",Fi={seqPaintingOptions:gi,nodePaintingOptions:_i,paintState:bi},Hi={Configuration:ki,Actions:Mi,StateGraph:Di};var Bi=Object.freeze(Object.defineProperty({__proto__:null,title:ji,key:yn,drawing:Fi,components:Hi,setupNode:dn,generateState:pi,defaultConfig:mi},Symbol.toStringTag,{value:"Module"}));const Te={[bn]:hi,[yn]:Bi};function Wi(t=Te.paxos){let e=X({},un);e=X(X({},e),t&&t.defaultConfig?t.defaultConfig:_n);const n=He(e);n.subscribe(a=>{e=a});const s=t&&t.generateState?t.generateState:gn,i=He(s(e));i.subscribe(a=>{});const o=He(null);o.subscribe(a=>{});const l=qi(t,e,i,o,n);return n.subscribe(l),l(e),[n,i,o]}function qi(t,e,n,s,i){let o=null;return l=>{if(o&&o.key===l.algorithm&&o.useWorkers===l.useWorkers)return o=l,l;if(o=l,t.key!==l.algorithm){t=Te[l.algorithm],t||console.error("algorithm not supported");const a={};Object.keys(un).forEach(r=>{a[r]=l[r]}),l=X(X({},a),t.defaultConfig)}return kn(t,l,n,s,i),l}}function kn(t,e,n,s,i){const o=()=>()=>kn(t,e,n,s,i),a=t.generateState(e);n.update(()=>a);const[r,u]=Ws($t(e,i),$t(a,n),o());return s.update(f=>(f&&f.simulation&&f.simulation.terminate(),u)),a}function $t(t,e){let n=t;return e.subscribe(s=>n=s),{value:n,update:e.update}}function Gi(t){let e,n,s,i;return{c(){e=h("span"),n=M("Layout '"),s=M(t[0]),i=M("' not supported")},m(o,l){w(o,e,l),c(e,n),c(e,s),c(e,i)},p(o,l){l&1&&Z(s,o[0])},i:Q,o:Q,d(o){o&&k(e)}}}function Ui(t){let e,n;const s=[t[1]];let i={};for(let o=0;o<s.length;o+=1)i=Me(i,s[o]);return e=new gs({props:i}),{c(){oe(e.$$.fragment)},m(o,l){se(e,o,l),n=!0},p(o,l){const a=l&2?We(s,[qe(o[1])]):{};e.$set(a)},i(o){n||(x(e.$$.fragment,o),n=!0)},o(o){ee(e.$$.fragment,o),n=!1},d(o){ie(e,o)}}}function Xi(t){let e,n,s,i;const o=[Ui,Gi],l=[];function a(r,u){return r[0]==="full"?0:1}return e=a(t),n=l[e]=o[e](t),{c(){n.c(),s=we()},m(r,u){l[e].m(r,u),w(r,s,u),i=!0},p(r,[u]){let f=e;e=a(r),e===f?l[e].p(r,u):(pe(),ee(l[f],1,1,()=>{l[f]=null}),me(),n=l[e],n?n.p(r,u):(n=l[e]=o[e](r),n.c()),x(n,1),n.m(s.parentNode,s))},i(r){i||(x(n),i=!0)},o(r){ee(n),i=!1},d(r){l[e].d(r),r&&k(s)}}}function zi(t,e,n){let{layout:s="full"}=e,{registerAlgorithm:i}=e,{unregisterAlgorithm:o}=e;const[l,a,r]=Wi();let u,f;l.subscribe(_=>{u=Te[_.algorithm],u.labels}),a.subscribe(_=>{window.states||(window.stateIdx=-1,window.states=[]);const{nodes:g,messages:m}=_;window.stateIdx+=1,window.states.push({nodes:g,messages:m})}),r.subscribe(_=>{f=_}),Xe(()=>{i&&i(l,a)}),xe(()=>{o&&o(l,a),f&&f.simulation.terminate()});const d={configStore:l,stateStore:a,controlsStore:r,algorithm:u,algorithms:Te};return t.$$set=_=>{"layout"in _&&n(0,s=_.layout),"registerAlgorithm"in _&&n(2,i=_.registerAlgorithm),"unregisterAlgorithm"in _&&n(3,o=_.unregisterAlgorithm)},[s,d,i,o]}class Ki extends fe{constructor(e){super(),ce(this,e,zi,Xi,ae,{layout:0,registerAlgorithm:2,unregisterAlgorithm:3})}}function Qi(t){let e;return{c(){e=h("footer"),e.innerHTML=`<div class="content svelte-4jochn"><div class="brand svelte-4jochn"><img alt="logo" src="/favicon/android-icon-48x48.png" class="svelte-4jochn"/><span class="svelte-4jochn">Visual Consensus</span></div> 
        <div class="links svelte-4jochn"><p>Links</p> 
            <a href="https://github.com/jojahn/visual-consensus" class="svelte-4jochn">Source Code</a> 
            <a href="https://github.com/jojahn/visual-consensus/blob/main/latex/thesis.pdf" class="svelte-4jochn">Thesis</a> 
            <a href="about.html#ThirdPartyLicenses" class="svelte-4jochn">Third Party Licenses</a></div></div> 
    <div><p class="rights svelte-4jochn">Licensed under <a href="https://github.com/jojahn/visual-consensus/LICENSE" class="svelte-4jochn">MIT</a></p> 
        <p class="rights svelte-4jochn">2022 <a href="https://github.com/jojahn/visual-consensus/graphs/contributors" class="svelte-4jochn">contributers</a></p></div>`,p(e,"class","svelte-4jochn")},m(n,s){w(n,e,s)},p:Q,i:Q,o:Q,d(n){n&&k(e)}}}class $i extends fe{constructor(e){super(),ce(this,e,null,Qi,ae,{})}}function Jt(t,e,n){const s=t.slice();return s[5]=e[n],s}function Yt(t){let e,n,s=t[5].title+"",i,o,l,a;return{c(){e=h("li"),n=h("button"),i=M(s),p(n,"class","svelte-1slpat4"),p(e,"class",o=be(t[0]===t[5].key?"active":"")+" svelte-1slpat4")},m(r,u){w(r,e,u),c(e,n),c(n,i),l||(a=V(n,"click",t[1](t[5].key)),l=!0)},p(r,u){t=r,u&1&&o!==(o=be(t[0]===t[5].key?"active":"")+" svelte-1slpat4")&&p(e,"class",o)},d(r){r&&k(e),l=!1,a()}}}function Ji(t){let e,n,s,i,o,l=Object.values(Te),a=[];for(let r=0;r<l.length;r+=1)a[r]=Yt(Jt(t,l,r));return{c(){e=h("header"),n=h("nav"),s=h("ul");for(let r=0;r<a.length;r+=1)a[r].c();i=D(),o=h("li"),o.innerHTML='<a href="/about.html" class="svelte-1slpat4">About</a>',p(o,"class","svelte-1slpat4"),p(s,"class","svelte-1slpat4"),p(n,"class","svelte-1slpat4"),p(e,"class","svelte-1slpat4")},m(r,u){w(r,e,u),c(e,n),c(n,s);for(let f=0;f<a.length;f+=1)a[f].m(s,null);c(s,i),c(s,o)},p(r,[u]){if(u&3){l=Object.values(Te);let f;for(f=0;f<l.length;f+=1){const d=Jt(r,l,f);a[f]?a[f].p(d,u):(a[f]=Yt(d),a[f].c(),a[f].m(s,i))}for(;f<a.length;f+=1)a[f].d(1);a.length=l.length}},i:Q,o:Q,d(r){r&&k(e),ve(a,r)}}}function Yi(t,e,n){let{selectedAlgorithm:s}=e,{changeAlgorithm:i}=e,{share:o}=e;const l=a=>()=>i(a);return t.$$set=a=>{"selectedAlgorithm"in a&&n(0,s=a.selectedAlgorithm),"changeAlgorithm"in a&&n(2,i=a.changeAlgorithm),"share"in a&&n(3,o=a.share)},[s,l,i,o]}class Vi extends fe{constructor(e){super(),ce(this,e,Yi,Ji,ae,{selectedAlgorithm:0,changeAlgorithm:2,share:3})}}var wn={};(function(t){(function(e){e([],function(){var n=-1,s=-2,i=-3,o=-4,l=-5,a=function(m,v){v=v||{};var E=v.verbose||!1;E&&console.log("Normalize the JSON Object"),m=typeof m=="string"?this.JSON.parse(m):m,E&&console.log("Creating a empty dictionary");var b={strings:[],integers:[],floats:[]};E&&console.log("Creating the AST");var y=function j(I){E&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(I));var L=typeof I;if(I===null)return{type:"null",index:i};if(typeof I=="undefined")return{type:"undefined",index:l};if(I instanceof Array){var S=["@"];for(var N in I)!I.hasOwnProperty(N)||S.push(j(I[N]));return S}if(L==="object"){var S=["$"];for(var P in I)!I.hasOwnProperty(P)||(S.push(j(P)),S.push(j(I[P])));return S}if(I==="")return{type:"empty",index:o};if(L==="string"){var T=g.call(b.strings,I);return T==-1&&(b.strings.push(u(I)),T=b.strings.length-1),{type:"strings",index:T}}if(L==="number"&&I%1===0){var T=g.call(b.integers,I);return T==-1&&(b.integers.push(d(I)),T=b.integers.length-1),{type:"integers",index:T}}if(L==="number"){var T=g.call(b.floats,I);return T==-1&&(b.floats.push(I),T=b.floats.length-1),{type:"floats",index:T}}if(L==="boolean")return{type:"boolean",index:I?n:s};throw new Error("Unexpected argument of type "+typeof I)}(m),A=b.strings.length,H=b.integers.length;b.floats.length,E&&console.log("Parsing the dictionary");var G=b.strings.join("|");return G+="^"+b.integers.join("|"),G+="^"+b.floats.join("|"),E&&console.log("Parsing the structure"),G+="^"+function j(I){if(E&&console.log("Calling a recursiveParser with "+this.JSON.stringify(I)),I instanceof Array){var L=I.shift();for(var S in I)!I.hasOwnProperty(S)||(L+=j(I[S])+"|");return(L[L.length-1]==="|"?L.slice(0,-1):L)+"]"}var N=I.type,P=I.index;if(N==="strings")return d(P);if(N==="integers")return d(A+P);if(N==="floats")return d(A+H+P);if(N==="boolean")return I.index;if(N==="null")return i;if(N==="undefined")return l;if(N==="empty")return o;throw new TypeError("The item is alien!")}(y),E&&console.log("Ending parser"),v.debug?{dictionary:b,ast:y,packed:G}:G},r=function(m,v){v=v||{};var E=m.split("^");v.verbose&&console.log("Building dictionary");var b=[],y=E[0];if(y!==""){y=y.split("|"),v.verbose&&console.log("Parse the strings dictionary");for(var A=0,H=y.length;A<H;A++)b.push(f(y[A]))}if(y=E[1],y!==""){y=y.split("|"),v.verbose&&console.log("Parse the integers dictionary");for(var A=0,H=y.length;A<H;A++)b.push(_(y[A]))}if(y=E[2],y!==""){y=y.split("|"),v.verbose&&console.log("Parse the floats dictionary");for(var A=0,H=y.length;A<H;A++)b.push(parseFloat(y[A]))}y=null,v.verbose&&console.log("Tokenizing the structure");for(var G="",j=[],I=E[3].length,A=0;A<I;A++){var L=E[3].charAt(A);L==="|"||L==="$"||L==="@"||L==="]"?(G&&(j.push(_(G)),G=""),L!=="|"&&j.push(L)):G+=L}var S=j.length,N=0;return v.verbose&&console.log("Starting recursive parser"),function P(){var T=j[N++];if(v.verbose&&console.log("Reading collection type "+(T==="$"?"object":"Array")),T==="@"){for(var R=[];N<S;N++){var F=j[N];if(v.verbose&&console.log("Read "+F+" symbol"),F==="]")return R;if(F==="@"||F==="$")R.push(P());else switch(F){case n:R.push(!0);break;case s:R.push(!1);break;case i:R.push(null);break;case l:R.push(void 0);break;case o:R.push("");break;default:R.push(b[F])}}return v.verbose&&console.log("Parsed "+this.JSON.stringify(R)),R}if(T==="$"){for(var R={};N<S;N++){var W=j[N];if(W==="]")return R;W===o?W="":W=b[W];var F=j[++N];if(F==="@"||F==="$")R[W]=P();else switch(F){case n:R[W]=!0;break;case s:R[W]=!1;break;case i:R[W]=null;break;case l:R[W]=void 0;break;case o:R[W]="";break;default:R[W]=b[F]}}return v.verbose&&console.log("Parsed "+this.JSON.stringify(R)),R}throw new TypeError("Bad token "+T+" isn't a type")}()},u=function(m){return typeof m!="string"?m:m.replace(/[\+ \|\^\%]/g,function(v){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[v]})},f=function(m){return typeof m!="string"?m:m.replace(/\+|%2B|%7C|%5E|%25/g,function(v){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[v]})},d=function(m){return Number.prototype.toString.call(m,36).toUpperCase()},_=function(m){return parseInt(m,36)},g=Array.prototype.indexOf||function(m,v){for(var E=v||0,b=this.length;E<b;E++)if(this[E]===m)return E;return-1};return{JSON,pack:a,unpack:r}})})(function(e,n){var s=n();for(var i in s)t[i]=s[i]})})(wn);function Vt(t){let e=t;return e=wn.pack(t),e=window.btoa?btoa(e):e,e}function Zi(t,e){const n=Vt(t),s=Vt(e),i="/?config="+n+"&state="+s;xi(),navigator.clipboard.writeText(location.origin+i)}function xi(t){const e="Visual Consensus",n={additionalInformation:"URL"};window.history.pushState(n,e,t)}function el(t){let e;return{c(){e=h("span"),e.textContent="Layout not supported!"},m(n,s){w(n,e,s)},p:Q,i:Q,o:Q,d(n){n&&k(e)}}}function tl(t){let e,n;return e=new Ki({props:{registerAlgorithm:t[4],unregisterAlgorithm:t[5],layout:En}}),{c(){oe(e.$$.fragment)},m(s,i){se(e,s,i),n=!0},p:Q,i(s){n||(x(e.$$.fragment,s),n=!0)},o(s){ee(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function nl(t){let e,n,s,i,o,l,a,r,u,f=!1;s=new Vi({props:{layout:En,changeAlgorithm:t[3],selectedAlgorithm:t[1],share:t[2]}});const d=[tl,el],_=[];function g(m,v){return 0}return o=g(),l=_[o]=d[o](t),r=new $i({}),{c(){e=h("main"),n=D(),oe(s.$$.fragment),i=D(),l.c(),a=D(),oe(r.$$.fragment)},m(m,v){w(m,e,v),c(e,n),se(s,e,null),c(e,i),_[o].m(e,null),c(e,a),se(r,e,null),u=!0},p(m,[v]){const E={};v&2&&(E.selectedAlgorithm=m[1]),s.$set(E),l.p(m,v)},i(m){u||(x(f),x(s.$$.fragment,m),x(l),x(r.$$.fragment,m),u=!0)},o(m){ee(f),ee(s.$$.fragment,m),ee(l),ee(r.$$.fragment,m),u=!1},d(m){m&&k(e),ie(s),_[o].d(),ie(r)}}}let En="full";function sl(t,e,n){let s=[],i="paxos";function o(){s&&s[0]&&Zi(s[0])}function l(u){n(1,i=u),s&&s[0]&&s[0].config.update(f=>te(X({},f),{algorithm:u}))}function a(u,f){s.push({config:u,state:f})}function r(u,f){n(0,s=s.filter(d=>d.config!==u&&d.state&&f))}return[s,i,o,l,a,r]}class il extends fe{constructor(e){super(),ce(this,e,sl,nl,ae,{})}}new il({target:document.getElementById("app")});export{ol as __vite_legacy_guard};
