var Tn=Object.defineProperty,In=Object.defineProperties;var Nn=Object.getOwnPropertyDescriptors;var st=Object.getOwnPropertySymbols;var Pn=Object.prototype.hasOwnProperty,Cn=Object.prototype.propertyIsEnumerable;var it=(t,e,n)=>e in t?Tn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,X=(t,e)=>{for(var n in e||(e={}))Pn.call(e,n)&&it(t,n,e[n]);if(st)for(var n of st(e))Cn.call(e,n)&&it(t,n,e[n]);return t},x=(t,e)=>In(t,Nn(e));function tl(){import("data:text/javascript,")}const An=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};An();function K(){}function Ae(t,e){for(const n in e)t[n]=e[n];return t}function Qt(t){return t()}function lt(){return Object.create(null)}function re(t){t.forEach(Qt)}function ue(t){return typeof t=="function"}function ae(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Mn(t){return Object.keys(t).length===0}function de(t,...e){if(t==null)return K;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Yt(t,e,n,s){if(t){const i=$t(t,e,n,s);return t[0](i)}}function $t(t,e,n,s){return t[1]&&s?Ae(n.ctx.slice(),t[1](s(e))):n.ctx}function Vt(t,e,n,s){if(t[2]&&s){const i=t[2](s(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],l=Math.max(e.dirty.length,i.length);for(let a=0;a<l;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function Zt(t,e,n,s,i,o){if(i){const l=$t(e,n,s,o);t.p(l,i)}}function xt(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let s=0;s<n;s++)e[s]=-1;return e}return-1}function be(t){return t==null?"":t}function c(t,e){t.appendChild(e)}function E(t,e,n){t.insertBefore(e,n||null)}function S(t){t.parentNode.removeChild(t)}function ve(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function h(t){return document.createElement(t)}function L(t){return document.createTextNode(t)}function F(){return L(" ")}function we(){return L("")}function Q(t,e,n,s){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n,s)}function m(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function le(t){return t===""?null:+t}function Ln(t){return Array.from(t.childNodes)}function Y(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function ee(t,e){t.value=e==null?"":e}function en(t,e,n,s){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,s?"important":"")}let Me;function Pe(t){Me=t}function Ve(){if(!Me)throw new Error("Function called outside component initialization");return Me}function Ue(t){Ve().$$.on_mount.push(t)}function Ze(t){Ve().$$.after_update.push(t)}function xe(t){Ve().$$.on_destroy.push(t)}const Ne=[],Je=[],Fe=[],ot=[],Rn=Promise.resolve();let Qe=!1;function Dn(){Qe||(Qe=!0,Rn.then(tn))}function Ye(t){Fe.push(t)}const Xe=new Set;let Re=0;function tn(){const t=Me;do{for(;Re<Ne.length;){const e=Ne[Re];Re++,Pe(e),Fn(e.$$)}for(Pe(null),Ne.length=0,Re=0;Je.length;)Je.pop()();for(let e=0;e<Fe.length;e+=1){const n=Fe[e];Xe.has(n)||(Xe.add(n),n())}Fe.length=0}while(Ne.length);for(;ot.length;)ot.pop()();Qe=!1,Xe.clear(),Pe(t)}function Fn(t){if(t.fragment!==null){t.update(),re(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Ye)}}const He=new Set;let ke;function pe(){ke={r:0,c:[],p:ke}}function me(){ke.r||re(ke.c),ke=ke.p}function $(t,e){t&&t.i&&(He.delete(t),t.i(e))}function V(t,e,n,s){if(t&&t.o){if(He.has(t))return;He.add(t),ke.c.push(()=>{He.delete(t),s&&(n&&t.d(1),s())}),t.o(e)}else s&&s()}function Be(t,e){const n={},s={},i={$$scope:1};let o=t.length;for(;o--;){const l=t[o],a=e[o];if(a){for(const r in l)r in a||(s[r]=1);for(const r in a)i[r]||(n[r]=a[r],i[r]=1);t[o]=a}else for(const r in l)i[r]=1}for(const l in s)l in n||(n[l]=void 0);return n}function We(t){return typeof t=="object"&&t!==null?t:{}}function oe(t){t&&t.c()}function se(t,e,n,s){const{fragment:i,on_mount:o,on_destroy:l,after_update:a}=t.$$;i&&i.m(e,n),s||Ye(()=>{const r=o.map(Qt).filter(ue);l?l.push(...r):re(r),t.$$.on_mount=[]}),a.forEach(Ye)}function ie(t,e){const n=t.$$;n.fragment!==null&&(re(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Hn(t,e){t.$$.dirty[0]===-1&&(Ne.push(t),Dn(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ce(t,e,n,s,i,o,l,a=[-1]){const r=Me;Pe(t);const u=t.$$={fragment:null,ctx:null,props:o,update:K,not_equal:i,bound:lt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(r?r.$$.context:[])),callbacks:lt(),dirty:a,skip_bound:!1,root:e.target||r.$$.root};l&&l(u.root);let f=!1;if(u.ctx=n?n(t,e.props||{},(d,p,..._)=>{const g=_.length?_[0]:p;return u.ctx&&i(u.ctx[d],u.ctx[d]=g)&&(!u.skip_bound&&u.bound[d]&&u.bound[d](g),f&&Hn(t,d)),p}):[],u.update(),f=!0,re(u.before_update),u.fragment=s?s(u.ctx):!1,e.target){if(e.hydrate){const d=Ln(e.target);u.fragment&&u.fragment.l(d),d.forEach(S)}else u.fragment&&u.fragment.c();e.intro&&$(t.$$.fragment),se(t,e.target,e.anchor,e.customElement),tn()}Pe(r)}class fe{$destroy(){ie(this,1),this.$destroy=K}$on(e,n){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const i=s.indexOf(n);i!==-1&&s.splice(i,1)}}$set(e){this.$$set&&!Mn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const jn=t=>({config:t&1}),rt=t=>({config:t[0]});function Bn(t){let e,n,s,i,o,l,a,r,u,f,d,p,_,g,v,O,b,T,j,W,z,R,P,M,y,D,k;const I=t[5]["algorithm-config"],A=Yt(I,t,t[4],rt);return{c(){e=h("form"),n=h("div"),s=h("div"),i=h("label"),i.textContent="Network Delay",o=F(),l=h("div"),a=h("input"),r=F(),u=h("span"),u.textContent="ms",f=F(),d=h("div"),p=h("label"),p.textContent="Command Delay",_=F(),g=h("div"),v=h("input"),O=F(),b=h("span"),b.textContent="ms",T=F(),j=h("div"),W=h("label"),W.textContent="Use WebWorkers",z=F(),R=h("input"),P=F(),A&&A.c(),m(i,"for","NetworkDelayInput"),m(i,"class","svelte-1yd6c5a"),m(a,"id","NetworkDelayInput"),m(a,"type","number"),m(a,"min","0"),m(a,"max","60000"),m(l,"class","svelte-1yd6c5a"),m(s,"class","input-group svelte-1yd6c5a"),m(p,"for","CommandDelayInput"),m(p,"class","svelte-1yd6c5a"),m(v,"id","CommandDelayInput"),m(v,"type","number"),m(v,"min","0"),m(v,"max","60000"),m(g,"class","svelte-1yd6c5a"),m(d,"class","input-group svelte-1yd6c5a"),m(W,"for","UseWebWorkersInput"),m(W,"class","svelte-1yd6c5a"),m(R,"id","UseWebWorkersInput"),R.disabled=!0,m(R,"type","checkbox"),m(R,"class","svelte-1yd6c5a"),m(j,"class","input-group svelte-1yd6c5a"),m(n,"class","options svelte-1yd6c5a"),m(e,"class",M=be("config-form"+t[1]?" full-layout":"")+" svelte-1yd6c5a")},m(C,B){E(C,e,B),c(e,n),c(n,s),c(s,i),c(s,o),c(s,l),c(l,a),ee(a,t[2].networkDelay),c(l,r),c(l,u),c(n,f),c(n,d),c(d,p),c(d,_),c(d,g),c(g,v),ee(v,t[2].commandDelay),c(g,O),c(g,b),c(n,T),c(n,j),c(j,W),c(j,z),c(j,R),R.checked=t[2].useWorkers,c(e,P),A&&A.m(e,null),y=!0,D||(k=[Q(a,"input",t[6]),Q(v,"input",t[7]),Q(R,"change",t[8]),Q(e,"submit",t[3])],D=!0)},p(C,[B]){B&4&&le(a.value)!==C[2].networkDelay&&ee(a,C[2].networkDelay),B&4&&le(v.value)!==C[2].commandDelay&&ee(v,C[2].commandDelay),B&4&&(R.checked=C[2].useWorkers),A&&A.p&&(!y||B&17)&&Zt(A,I,C,C[4],y?Vt(I,C[4],B,jn):xt(C[4]),rt),(!y||B&2&&M!==(M=be("config-form"+C[1]?" full-layout":"")+" svelte-1yd6c5a"))&&m(e,"class",M)},i(C){y||($(A,C),y=!0)},o(C){V(A,C),y=!1},d(C){C&&S(e),A&&A.d(C),D=!1,re(k)}}}function Wn(t,e,n){let s,i=K,o=()=>(i(),i=de(r,g=>n(2,s=g)),r);t.$$.on_destroy.push(()=>i());let{$$slots:l={},$$scope:a}=e,{configStore:r}=e;o();let{fullLayout:u=!1}=e;const f=g=>{g.preventDefault()};function d(){s.networkDelay=le(this.value),r.set(s)}function p(){s.commandDelay=le(this.value),r.set(s)}function _(){s.useWorkers=this.checked,r.set(s)}return t.$$set=g=>{"configStore"in g&&o(n(0,r=g.configStore)),"fullLayout"in g&&n(1,u=g.fullLayout),"$$scope"in g&&n(4,a=g.$$scope)},[r,u,s,f,a,l,d,p,_]}class qn extends fe{constructor(e){super(),ce(this,e,Wn,Bn,ae,{configStore:0,fullLayout:1})}}const Se=[];function je(t,e=K){let n;const s=new Set;function i(a){if(ae(t,a)&&(t=a,n)){const r=!Se.length;for(const u of s)u[1](),Se.push(u,t);if(r){for(let u=0;u<Se.length;u+=2)Se[u][0](Se[u+1]);Se.length=0}}}function o(a){i(a(t))}function l(a,r=K){const u=[a,r];return s.add(u),s.size===1&&(n=e(i)||K),a(t),()=>{s.delete(u),s.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:l}}function nn(t,e){const n=new Date(t.sent).getTime(),s=new Date(e.sent).getTime();return n<s?-1:n>s?1:Gn(t,e)}function Gn(t,e){return t.id>e.id?-1:t.id<e.id?1:0}function Un(t,e){return(n,s)=>{const i=r=>e(s,r)&&Math.abs(new Date(r.sent).getTime()-new Date(s.sent).getTime())<t,o=r=>r.findIndex(u=>i(u)),a=(()=>n.findIndex(r=>Array.isArray(r)?o(r)!==-1:i(r)))();return a!==-1&&n[a]&&Array.isArray(n[a])?n[a].push(s):a!==-1&&a?n[a]=[n[a],s]:n.push(s),n}}const _e={disabledNode:"",messageFill:"#FA3",messageOutline:"#000",highlight:"#F497A4",messageLine:"#DDD"},at={nodeRadius:24,messageRadius:8,paintNodeText:t=>t.id,isLeader:()=>{},paintMessageText:()=>{},arrowLength:6};function qe(t,e,n,s=at){if(t.save(),s=X(X({},at),s),!e)return[t.canvas.width,t.canvas.height];let i=0,o=0;return e.messages.filter(l=>!l.done&&l.pos).forEach(l=>{t.beginPath();let a=e.nodes.filter(u=>u.id===l.fromId)[0].pos,r=e.nodes.filter(u=>u.id===l.toId)[0].pos;l.id===e.selectedElementId&&(t.lineWidth=4,t.strokeStyle=_e.highlight,t.moveTo(...a),t.lineTo(...r),t.stroke()),t.lineWidth=1,t.strokeStyle="#DDD",t.moveTo(...a),t.lineTo(...r),t.stroke(),t.closePath()}),e.messages.filter(l=>!l.done&&l.pos).sort(nn).forEach(l=>{l.id===e.selectedElementId&&(t.beginPath(),t.fillStyle=_e.highlight,t.arc(l.pos[0],l.pos[1],s.messageRadius+5,0,2*Math.PI),t.fill(),t.closePath()),t.beginPath();const a=e.nodes.filter(b=>b.id===l.fromId)[0].pos,r=e.nodes.filter(b=>b.id===l.toId)[0].pos,u=Math.sqrt(Math.pow(a[0]-r[0],2)+Math.pow(a[1]-r[1],2)),f=s.messageRadius+s.arrowLength,d=[l.pos[0]+f/u*(r[0]-a[0]),l.pos[1]+f/u*(r[1]-a[1])],p=[l.pos[0]+s.messageRadius/u*(a[0]-r[0]),l.pos[1]+s.messageRadius/u*(a[1]-r[1])],_=(b,T)=>[Math.cos(T)*b[0]-Math.sin(T)*b[1],Math.sin(T)*b[0]+Math.cos(T)*b[1]],g=(b,T)=>{let j=[b[0]-l.pos[0],b[1]-l.pos[1]];return j=_(j,T),[j[0]+l.pos[0],j[1]+l.pos[1]]},v=g(p,Math.PI/2+.5),O=g(p,-Math.PI/2-.5);t.fillStyle=_e.messageOutline,t.strokeStyle=_e.messageOutline,t.moveTo(...v),t.lineTo(...d),t.lineTo(...O),t.stroke(),t.fill(),t.closePath(),t.beginPath(),t.lineWidth=2,t.strokeStyle=_e.messageOutline,t.fillStyle=_e.messageFill,t.arc(l.pos[0],l.pos[1],s.messageRadius,0,2*Math.PI),t.stroke(),t.fill(),t.isPointInPath(n.position[0],n.position[1])&&(t.canvas.style.setProperty("cursor","pointer","important"),n.hits.map(b=>b.id).indexOf(l.id)===-1&&n.hits.push(l)),t.closePath()}),e.nodes.filter(l=>l&&l.pos&&l.id).forEach(l=>{t.beginPath(),t.lineWidth=5,t.fillStyle="#ADD495",t.strokeStyle="#80B7A2",l.connected?s.isLeader(l)&&(t.fillStyle="#EE2",t.strokeStyle="#DD0"):(t.fillStyle="#DDD",t.strokeStyle="#AAA"),t.arc(l.pos[0],l.pos[1],s.nodeRadius,0,2*Math.PI),t.stroke(),i=Math.max(i,l.pos[0]),o=Math.max(o,l.pos[1]),t.fill(),t.isPointInPath(n.position[0],n.position[1])&&(t.canvas.style.setProperty("cursor","pointer","important"),n.hits.map(a=>a.id).indexOf(l.id)===-1&&n.hits.push(l)),t.closePath(),s.paintNodeText(t,l),t.beginPath(),t.fillStyle="#FFF",l.connected?s.isLeader(l)&&(t.fillStyle="#000"):t.fillStyle="#000",t.font="bold 20px courier new",t.fillText(l.id,l.pos[0]-12,l.pos[1]+5),t.closePath()}),e.selectedElementId&&e.nodes.filter(l=>l.id===e.selectedElementId).forEach(l=>{t.beginPath(),t.strokeStyle="#F497A4",t.lineWidth=5,t.arc(l.pos[0],l.pos[1],s.nodeRadius+5,0,2*Math.PI),t.stroke(),t.closePath()}),t.restore(),[i,o]}function zn(t,e,{subscribe:n},s=qe,i={autoAlign:"CENTER"},{onHover:o,onHoverEnd:l,onClick:a,updateState:r}={}){let u=1,f=[0,0],d=!1,p=null;n(k=>{p=k});const _=t.getContext("2d",{alpha:!1});var g=1,v=t.getBoundingClientRect();t.width=v.width*g,t.height=v.height*g,_.scale(g,g);const O={hits:[],position:[0,0]},b=k=>{if(t.style.cursor="default",O.hits.length>0){const C=O.hits[0];o&&o(C)}else l&&l();let I=k.clientX+document.body.scrollLeft-t.offsetLeft,A=k.clientY+document.body.scrollTop-t.offsetTop;O.position=[I+window.scrollX,A+window.scrollY],O.hits=[]};t.addEventListener("mousemove",b);const T=()=>{if(O.hits[0]){let k=O.hits[0];p.selectedElementId=k.id,r&&r(I=>x(X({},I),{selectedElementId:k.id})),a&&a(k)}};t.addEventListener("mousedown",T);let j={fps:0},W=[0,0],z=t.width,R=t.height,P=!1,M=!1;var y=[];t.width!==t.parentElement.clientWidth&&(t.width=t.parentElement.clientWidth);function D(){switch(i.autoAlign){case"TOP_TO_BOTTOM":t.height<t.parentElement.clientHeight&&(t.height=Math.max(R,t.parentElement.clientHeight)),P&&(P=!1,t.height=R,t.parentElement.style.overflowY="scroll",d||t.parentElement.scrollTo(0,t.parentElement.scrollHeight));break}_.fillStyle="#FFF",_.fillRect(0,0,t.width,t.height),_.scale(u/g,u/g);let k=f[0],I=f[1];switch(i.autoAlign){case"TOP_TO_BOTTOM":k=f[0]+W[0]/2-z/2,I=10;break;case"CENTER":k=f[0]+W[0]/2-z/2,I=f[1]+W[1]/2-R/2;break}_.translate(k,I);const[A,C]=s(_,p,O,i);W=[t.width/2,t.height/2];const B=performance.now();for(;y.length>0&&y[0]<=B-1e3;)y.shift();y.push(B),j.fps=y.length,_.translate(-k,-I),_.scale(g*1/u,g*1/u),A!==z&&(z=A,P=!0),C!==R&&(R=C,P=!0),M||requestAnimationFrame(D)}return D(),{context:_,debugInfo:j,zoom:k=>{u=k||1,_.canvas.height*=u},pan:k=>{f=k},setLock:k=>{d=k},remove:()=>{M=!0,_.fillStyle="#FFF",_.fillRect(0,0,640,480),t.removeEventListener("mousedown",T),t.removeEventListener("mousemove",b)}}}const Xn=t=>({offsetX:t[0]&16,offsetY:t[0]&32}),ut=t=>({hoveredElement:t[12],offsetX:t[4],offsetY:t[5]});function Kn(t){let e;return{c(){e=h("p"),m(e,"class","svelte-h6pvzl")},m(n,s){E(n,e,s)},p:K,d(n){n&&S(e)}}}function Jn(t){let e;return{c(){e=h("span"),e.textContent="unlock"},m(n,s){E(n,e,s)},d(n){n&&S(e)}}}function Qn(t){let e;return{c(){e=h("span"),e.textContent="lock"},m(n,s){E(n,e,s)},d(n){n&&S(e)}}}function Yn(t){let e,n,s,i,o,l,a,r,u,f,d,p,_,g,v,O,b,T,j,W,z,R,P,M;function y(H,J){return Kn}let k=y()(t);function I(H,J){return H[7]?Qn:Jn}let A=I(t),C=A(t);const B=t[28].hover,w=Yt(B,t,t[27],ut);return{c(){e=h("div"),n=h("div"),k.c(),s=F(),i=h("button"),C.c(),o=F(),l=h("button"),l.textContent="Reset",a=F(),r=h("div"),u=h("button"),u.textContent="-",f=F(),d=h("p"),p=L(t[10]),_=L("x"),g=F(),v=h("button"),v.textContent="+",O=F(),b=h("canvas"),j=F(),w&&w.c(),W=F(),z=h("div"),z.innerHTML=`<span>Pan: <kbd>LeftCtrl</kbd> + Hold <kbd>MouseLeft</kbd></span> 
    <span>Zoom: <kbd>LeftCtrl</kbd> + <kbd>MouseWheel</kbd></span>`,m(d,"class","svelte-h6pvzl"),m(n,"class","controls-section svelte-h6pvzl"),m(b,"class",T=be(t[11].hoveredElement?"clickable":t[9]?"moving":t[7]&&t[8]?"movable":"")+" svelte-h6pvzl"),m(b,"id",t[0]),m(b,"width","640"),m(b,"height","480"),m(e,"class","canvas-wrapper svelte-h6pvzl"),m(z,"class","help svelte-h6pvzl")},m(H,J){E(H,e,J),c(e,n),k.m(n,null),c(n,s),c(n,i),C.m(i,null),c(n,o),c(n,l),c(n,a),c(n,r),c(r,u),c(r,f),c(r,d),c(d,p),c(d,_),c(r,g),c(r,v),c(e,O),c(e,b),t[31](b),c(e,j),w&&w.m(e,null),E(H,W,J),E(H,z,J),R=!0,P||(M=[Q(i,"click",t[13]),Q(l,"click",t[18]),Q(u,"click",t[29]),Q(v,"click",t[30]),Q(b,"mousemove",t[16]),Q(b,"mousedown",t[14]),Q(b,"mouseup",t[15]),Q(b,"mouseleave",t[17]),Q(e,"drop",Zn),Q(e,"dragover",xn)],P=!0)},p(H,J){k.p(H,J),A!==(A=I(H))&&(C.d(1),C=A(H),C&&(C.c(),C.m(i,null))),(!R||J[0]&1024)&&Y(p,H[10]),(!R||J[0]&2944&&T!==(T=be(H[11].hoveredElement?"clickable":H[9]?"moving":H[7]&&H[8]?"movable":"")+" svelte-h6pvzl"))&&m(b,"class",T),(!R||J[0]&1)&&m(b,"id",H[0]),w&&w.p&&(!R||J[0]&134217776)&&Zt(w,B,H,H[27],R?Vt(B,H[27],J,Xn):xt(H[27]),ut)},i(H){R||($(w,H),R=!0)},o(H){V(w,H),R=!1},d(H){H&&S(e),k.d(),C.d(),t[31](null),w&&w.d(H),H&&S(W),H&&S(z),P=!1,re(M)}}}const $n=.5,Vn=2;function ct(t){return t.preventDefault(),t.stopPropagation(),!1}function Zn(t){}function xn(t){}function es(t,e,n){let s,i=K,o=()=>(i(),i=de(p,U=>n(35,s=U)),p),l,a=K,r=()=>(a(),a=de(_,U=>n(11,l=U)),_);t.$$.on_destroy.push(()=>i()),t.$$.on_destroy.push(()=>a());let{$$slots:u={},$$scope:f}=e,{id:d}=e,{configStore:p}=e;o();let{stateStore:_}=e;r();let{paintFn:g=qe}=e,{minWidth:v=100}=e,{minHeight:O=100}=e,{paintOptions:b=void 0}=e,{onElementSelected:T=U=>{}}=e,{onElementHovered:j=U=>{}}=e,{onElementHoverEnd:W=()=>{}}=e,z=je(void 0);const R=U=>{z.update(he=>U),j(U)},P=()=>{z.set(void 0),W()};function M(U){_.update(he=>x(X({},he),{selectedElementId:U.id})),T(U),z.set(void 0)}let y=null,D=null,k,I=50,A=0,C=!0;function B(){n(7,C=!C),y&&y.setLock(!C)}let w=!1;function H(U){U.keyCode===17&&n(8,w=!0)}function J(U){U.keyCode===17&&n(8,w=!1)}const ne=U=>_.update(U),G=()=>{y&&y.remove(),y=zn(D,s,{subscribe:U=>_.subscribe(U)},g,b,{onHover:R,onHoverEnd:P,onClick:M,updateState:ne}),ge=[D.width/5,D.height/5],y.pan(ge)};function N(){const U=document.getElementById(d),he=U.parentElement;U&&he&&(U.height=Math.max(O,he.clientHeight),U.width=Math.max(v,he.clientWidth))}let q=!1;function Z(){!C||!w||n(9,q=!0)}function te(){n(9,q=!1)}let ge=[0,0];function yn(U){if(q&&C&&w){const he=1/ye;ge=[ge[0]+he*U.movementX,b.autoAlign==="TOP_TO_BOTTOM"?0:ge[1]+he*U.movementY],y.pan(ge)}}function kn(){n(9,q=!1)}function wn(){n(10,ye=1),y.zoom(ye),ge=[0,0],y.pan(ge)}let ye=1;function et(U){!C||!w||(U.preventDefault(),U.stopPropagation(),n(10,ye=Le(U.deltaY*-.001)),y.zoom(ye))}function Le(U){return Math.round(Math.min(Math.max($n,ye+U),Vn)*10)/10}Ue(()=>{const U=document.getElementById(d);n(4,k=U.offsetLeft),n(5,I=U.offsetTop),U.addEventListener("wheel",et,{passive:!1}),window.addEventListener("scroll",ct,!1),window.addEventListener("resize",N,!0),document.addEventListener("keydown",H),document.addEventListener("keyup",J),p.subscribe(G),N()});let tt=b;Ze(()=>{tt!==b&&(G(),tt=b)});let nt=setInterval(()=>{n(6,A=y.debugInfo.fps)},500);xe(()=>{window.removeEventListener("resize",N),D.removeEventListener("wheel",et),window.removeEventListener("scroll",ct),document.removeEventListener("keydown",H),document.removeEventListener("keyup",J),y&&y.remove(),nt&&clearInterval(nt)});const Sn=()=>Le(-.1),En=()=>Le(.1);function On(U){Je[U?"unshift":"push"](()=>{D=U,n(3,D)})}return t.$$set=U=>{"id"in U&&n(0,d=U.id),"configStore"in U&&o(n(1,p=U.configStore)),"stateStore"in U&&r(n(2,_=U.stateStore)),"paintFn"in U&&n(20,g=U.paintFn),"minWidth"in U&&n(21,v=U.minWidth),"minHeight"in U&&n(22,O=U.minHeight),"paintOptions"in U&&n(23,b=U.paintOptions),"onElementSelected"in U&&n(24,T=U.onElementSelected),"onElementHovered"in U&&n(25,j=U.onElementHovered),"onElementHoverEnd"in U&&n(26,W=U.onElementHoverEnd),"$$scope"in U&&n(27,f=U.$$scope)},[d,p,_,D,k,I,A,C,w,q,ye,l,z,B,Z,te,yn,kn,wn,Le,g,v,O,b,T,j,W,f,u,Sn,En,On]}class $e extends fe{constructor(e){super(),ce(this,e,es,Yn,ae,{id:0,configStore:1,stateStore:2,paintFn:20,minWidth:21,minHeight:22,paintOptions:23,onElementSelected:24,onElementHovered:25,onElementHoverEnd:26},null,[-1,-1])}}function ts(t){let e;return{c(){e=L("pause")},m(n,s){E(n,e,s)},d(n){n&&S(e)}}}function ns(t){let e;return{c(){e=L("resume")},m(n,s){E(n,e,s)},d(n){n&&S(e)}}}function ss(t){let e,n,s,i,o,l,a,r,u,f,d,p,_,g,v,O,b,T,j,W=t[2]*Te+"",z,R,P,M;function y(I,A){return I[1]?ns:ts}let D=y(t),k=D(t);return{c(){e=h("div"),n=h("button"),n.textContent="reset",s=F(),i=h("button"),o=L("step backwards"),a=F(),r=h("button"),k.c(),u=F(),f=h("button"),d=L("step forward"),_=F(),g=h("div"),v=h("label"),v.textContent="Speed",O=F(),b=h("input"),T=F(),j=h("span"),z=L(W),R=L("x"),m(n,"type","button"),m(n,"class","svelte-air56o"),m(i,"type","button"),i.disabled=l=!t[1],m(i,"class","svelte-air56o"),m(r,"type","button"),m(r,"class","svelte-air56o"),m(f,"type","button"),f.disabled=p=!t[1],m(f,"class","svelte-air56o"),m(v,"for","SpeedInput"),m(b,"id","SpeedInput"),m(b,"type","range"),m(b,"min","0"),m(b,"max",5/Te),b.value=t[2],m(g,"class","svelte-air56o"),m(e,"class","anim-controls svelte-air56o")},m(I,A){E(I,e,A),c(e,n),c(e,s),c(e,i),c(i,o),c(e,a),c(e,r),k.m(r,null),c(e,u),c(e,f),c(f,d),c(e,_),c(e,g),c(g,v),c(g,O),c(g,b),c(g,T),c(g,j),c(j,z),c(j,R),P||(M=[Q(n,"click",function(){ue(t[0].reset)&&t[0].reset.apply(this,arguments)}),Q(i,"click",function(){ue(t[0].stepBackwards)&&t[0].stepBackwards.apply(this,arguments)}),Q(r,"click",function(){ue(t[0].pauseOrPlay)&&t[0].pauseOrPlay.apply(this,arguments)}),Q(f,"click",function(){ue(t[0].stepForwards)&&t[0].stepForwards.apply(this,arguments)}),Q(b,"change",t[3])],P=!0)},p(I,[A]){t=I,A&2&&l!==(l=!t[1])&&(i.disabled=l),D!==(D=y(t))&&(k.d(1),k=D(t),k&&(k.c(),k.m(r,null))),A&2&&p!==(p=!t[1])&&(f.disabled=p),A&4&&(b.value=t[2]),A&4&&W!==(W=t[2]*Te+"")&&Y(z,W)},i:K,o:K,d(I){I&&S(e),k.d(),P=!1,re(M)}}}const Te=.25;function is(t,e,n){let{stateStore:s}=e,{controls:i}=e,o=!1,l=1/Te;const a=u=>{try{n(2,l=parseInt(u.target.value))}catch{console.error("Failed to parse speed")}i.setSpeed(l*Te)};let r;return Ue(()=>{r=s.subscribe(u=>{if(!u){n(1,o=!0);return}n(1,o=u.paused),n(2,l=u.speed/Te)})}),xe(()=>{r&&r()}),t.$$set=u=>{"stateStore"in u&&n(4,s=u.stateStore),"controls"in u&&n(0,i=u.controls)},[i,o,l,a,s]}class ls extends fe{constructor(e){super(),ce(this,e,is,ss,ae,{stateStore:4,controls:0})}}const Ge={linePadding:50,initialLineLength:200,lengthPerTimeStep:10,groupOffset:30,messageOffset:8,maxMessageLength:30,maxMessageOffset:100,vertical:!1,autoAlign:"TOP_TO_BOTTOM",spaceBetweenBroadcasts:!1,getText:t=>t.type};function ft(t,e,n,s=Ge){if(s=X(X({},Ge),s),!e)return[t.canvas.width,t.canvas.height];s.internal={},s.internal.nodeToXMap={},e.nodes.forEach((o,l)=>{s.internal.nodeToXMap[o.id]=10+l*s.linePadding,s.internal.furthestLineX=s.internal.nodeToXMap[o.id]});const i=(o,l)=>s.getText(o)===s.getText(l)?!0:o.broadcastKey!==void 0&&l.broadcastKey!==void 0?o.broadcastKey===l.broadcastKey:!1;return t.save(),s.internal.lastLineOffset=25,s.internal.maxWidth=s.internal.furthestLineX,e.messages.sort(nn).reduce(Un(1e3,i),[]).forEach(sn(t,e,s)),t.restore(),t.save(),e.nodes.forEach((o,l)=>{let a=10+l*s.linePadding;if(s.internal.nodeToXMap[o.id]=a,e.selectedElementId===o.id){t.beginPath(),t.lineWidth=10,t.strokeStyle=_e.highlight;let d=[s.internal.nodeToXMap[e.selectedElementId],25],p=[s.internal.nodeToXMap[e.selectedElementId],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(d=d.reverse(),p=p.reverse()),t.moveTo(...d),t.lineTo(...p),t.stroke(),t.closePath()}t.beginPath(),t.lineWidth=1,t.setLineDash(o.connected?[0]:[5,5]),t.strokeStyle=o.connected?"#000":"#AAA";let r=[s.internal.nodeToXMap[o.id],25],u=[s.internal.nodeToXMap[o.id],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(r=r.reverse(),u=u.reverse()),t.moveTo(...r),t.lineTo(...u),t.stroke(),t.closePath(),t.setLineDash([0]),t.beginPath(),t.fillStyle="#000",t.font="bold 20px courier new",t.fontWeight="bold";let f=[a-7.5,20];s.vertical&&(f=f.reverse()),t.fillText(o.id,...f),t.closePath()}),t.restore(),[s.internal.maxWidth,s.internal.lastLineOffset+s.messageOffset]}function sn(t,e,n,s=0,i=!0){return(o,l)=>{if(Array.isArray(o)){o.forEach((p,_)=>sn(t,e,n,_,_===o.length-1)(p,l));return}const{nodeToXMap:a,furthestLineX:r}=n.internal;t.beginPath();let u=n.internal.lastLineOffset;l===0&&(u+=n.messageOffset),n.spaceBetweenBroadcasts&&s!==0&&(u+=n.messageOffset);let f=[a[o.fromId],u],d=[a[o.toId],f[1]+(n.spaceBetweenBroadcasts?0:n.maxMessageLength)];if((i||n.spaceBetweenBroadcasts)&&(n.internal.lastLineOffset=d[1],i&&n.spaceBetweenBroadcasts?n.internal.lastLineOffset+=n.groupOffset:n.internal.lastLineOffset+=n.messageOffset),n.vertical&&(f=f.reverse(),d=d.reverse()),o.id===e.selectedElementId&&(t.lineWidth=8,t.strokeStyle=_e.highlight,t.moveTo(...f),t.lineTo(...d),t.stroke()),t.lineWidth=1,t.strokeStyle="#000",t.moveTo(...f),t.lineTo(...d),t.stroke(),t.closePath(),s===0){t.beginPath(),t.fillStyle="#000",t.font="15px arial";let p=[r+20,f[1]+(d[1]-f[1])/2];n.spaceBetweenBroadcasts&&(p[1]=f[1]+(n.internal.lastLineOffset-f[1])/2),n.vertical&&(p=p.reverse());const _=n.getText(o);n.internal.maxWidth=Math.max(n.internal.maxWidth,p[0]+_.length*15),t.fillText(_,...p),t.closePath()}}}function dt(t){let e,n,s,i,o,l;const a=[rs,os],r=[];function u(f,d){return f[11]?0:f[8]?1:-1}return~(i=u(t))&&(o=r[i]=a[i](t)),{c(){e=h("section"),n=h("h1"),n.textContent="State",s=F(),o&&o.c(),m(n,"class","svelte-1y74lh9"),m(e,"class","state-section svelte-1y74lh9")},m(f,d){E(f,e,d),c(e,n),c(e,s),~i&&r[i].m(e,null),l=!0},p(f,d){let p=i;i=u(f),i===p?~i&&r[i].p(f,d):(o&&(pe(),V(r[p],1,1,()=>{r[p]=null}),me()),~i?(o=r[i],o?o.p(f,d):(o=r[i]=a[i](f),o.c()),$(o,1),o.m(e,null)):o=null)},i(f){l||($(o),l=!0)},o(f){V(o),l=!1},d(f){f&&S(e),~i&&r[i].d()}}}function os(t){let e,n;const s=[t[5],{id:"Canvas_"+t[14].algorithm+"_State"},{paintFn:t[8]},{paintOptions:{autoAlign:"CENTER"}}];let i={};for(let o=0;o<s.length;o+=1)i=Ae(i,s[o]);return e=new $e({props:i}),{c(){oe(e.$$.fragment)},m(o,l){se(e,o,l),n=!0},p(o,l){const a=l&16672?Be(s,[l&32&&We(o[5]),l&16384&&{id:"Canvas_"+o[14].algorithm+"_State"},l&256&&{paintFn:o[8]},s[3]]):{};e.$set(a)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){V(e.$$.fragment,o),n=!1},d(o){ie(e,o)}}}function rs(t){let e,n,s;var i=t[11];function o(l){return{props:{stateStore:l[0],configStore:l[1]}}}return i&&(e=new i(o(t))),{c(){e&&oe(e.$$.fragment),n=we()},m(l,a){e&&se(e,l,a),E(l,n,a),s=!0},p(l,a){const r={};if(a&1&&(r.stateStore=l[0]),a&2&&(r.configStore=l[1]),i!==(i=l[11])){if(e){pe();const u=e;V(u.$$.fragment,1,0,()=>{ie(u,1)}),me()}i?(e=new i(o(l)),oe(e.$$.fragment),$(e.$$.fragment,1),se(e,n.parentNode,n)):e=null}else i&&e.$set(r)},i(l){s||(e&&$(e.$$.fragment,l),s=!0)},o(l){e&&V(e.$$.fragment,l),s=!1},d(l){l&&S(n),e&&ie(e,l)}}}function as(t){let e,n,s;var i=t[6];function o(l){return{props:{slot:"algorithm-config",config:l[18]}}}return i&&(e=new i(o(t))),{c(){e&&oe(e.$$.fragment),n=we()},m(l,a){e&&se(e,l,a),E(l,n,a),s=!0},p(l,a){const r={};if(a&262144&&(r.config=l[18]),i!==(i=l[6])){if(e){pe();const u=e;V(u.$$.fragment,1,0,()=>{ie(u,1)}),me()}i?(e=new i(o(l)),oe(e.$$.fragment),$(e.$$.fragment,1),se(e,n.parentNode,n)):e=null}else i&&e.$set(r)},i(l){s||(e&&$(e.$$.fragment,l),s=!0)},o(l){e&&V(e.$$.fragment,l),s=!1},d(l){l&&S(n),e&&ie(e,l)}}}function us(t){let e,n,s,i,o,l,a,r,u,f,d,p,_,g,v,O,b,T,j,W,z,R,P,M;const y=[t[5],{id:"Canvas_"+t[14].algorithm+"_Nodes"},{paintFn:qe},{paintOptions:t[10]}];let D={};for(let w=0;w<y.length;w+=1)D=Ae(D,y[w]);l=new $e({props:D});const k=[t[5],{id:"Canvas_"+t[14].algorithm+"_Sequence"},{paintFn:ft},{paintOptions:t[9]}];let I={};for(let w=0;w<k.length;w+=1)I=Ae(I,k[w]);d=new $e({props:I});var A=t[7];function C(w){return{props:{element:w[12],actions:w[4]}}}A&&(O=new A(C(t)));let B=(t[8]||t[11])&&dt(t);return W=new ls({props:{stateStore:t[0],controls:t[13]&&t[13].simulation}}),P=new qn({props:{configStore:t[1],fullLayout:!0,updateOnChange:!0,algorithm:t[3],$$slots:{"algorithm-config":[as,({config:w})=>({18:w}),({config:w})=>w?262144:0]},$$scope:{ctx:t}}}),{c(){e=h("article"),n=h("section"),s=h("section"),i=h("h1"),i.textContent="Node Graph",o=F(),oe(l.$$.fragment),a=F(),r=h("section"),u=h("h1"),u.textContent="Sequence Diagram",f=F(),oe(d.$$.fragment),p=F(),_=h("section"),g=h("h1"),g.textContent="Actions",v=F(),O&&oe(O.$$.fragment),b=F(),B&&B.c(),T=F(),j=h("section"),oe(W.$$.fragment),z=F(),R=h("section"),oe(P.$$.fragment),m(i,"class","svelte-1y74lh9"),m(s,"class","raised graph-panel svelte-1y74lh9"),m(u,"class","svelte-1y74lh9"),m(r,"class","raised graph-panel svelte-1y74lh9"),m(g,"class","svelte-1y74lh9"),m(_,"class","raised actions-panel svelte-1y74lh9"),m(n,"class","canvas-section svelte-1y74lh9"),m(j,"class","controls-section svelte-1y74lh9"),m(R,"class","config-section svelte-1y74lh9"),m(e,"class","full-algorithm svelte-1y74lh9")},m(w,H){E(w,e,H),c(e,n),c(n,s),c(s,i),c(s,o),se(l,s,null),c(n,a),c(n,r),c(r,u),c(r,f),se(d,r,null),c(n,p),c(n,_),c(_,g),c(_,v),O&&se(O,_,null),c(e,b),B&&B.m(e,null),c(e,T),c(e,j),se(W,j,null),c(e,z),c(e,R),se(P,R,null),M=!0},p(w,[H]){const J=H&17440?Be(y,[H&32&&We(w[5]),H&16384&&{id:"Canvas_"+w[14].algorithm+"_Nodes"},H&0&&{paintFn:qe},H&1024&&{paintOptions:w[10]}]):{};l.$set(J);const ne=H&16928?Be(k,[H&32&&We(w[5]),H&16384&&{id:"Canvas_"+w[14].algorithm+"_Sequence"},H&0&&{paintFn:ft},H&512&&{paintOptions:w[9]}]):{};d.$set(ne);const G={};if(H&4096&&(G.element=w[12]),H&16&&(G.actions=w[4]),A!==(A=w[7])){if(O){pe();const Z=O;V(Z.$$.fragment,1,0,()=>{ie(Z,1)}),me()}A?(O=new A(C(w)),oe(O.$$.fragment),$(O.$$.fragment,1),se(O,_,null)):O=null}else A&&O.$set(G);w[8]||w[11]?B?(B.p(w,H),H&2304&&$(B,1)):(B=dt(w),B.c(),$(B,1),B.m(e,T)):B&&(pe(),V(B,1,1,()=>{B=null}),me());const N={};H&1&&(N.stateStore=w[0]),H&8192&&(N.controls=w[13]&&w[13].simulation),W.$set(N);const q={};H&2&&(q.configStore=w[1]),H&8&&(q.algorithm=w[3]),H&4456512&&(q.$$scope={dirty:H,ctx:w}),P.$set(q)},i(w){M||($(l.$$.fragment,w),$(d.$$.fragment,w),O&&$(O.$$.fragment,w),$(B),$(W.$$.fragment,w),$(P.$$.fragment,w),M=!0)},o(w){V(l.$$.fragment,w),V(d.$$.fragment,w),O&&V(O.$$.fragment,w),V(B),V(W.$$.fragment,w),V(P.$$.fragment,w),M=!1},d(w){w&&S(e),ie(l),ie(d),O&&ie(O),B&&B.d(),ie(W),ie(P)}}}function cs(t,e,n){let s,i=K,o=()=>(i(),i=de(g,k=>n(13,s=k)),g),l,a=K,r=()=>(a(),a=de(p,k=>n(17,l=k)),p),u,f=K,d=()=>(f(),f=de(_,k=>n(14,u=k)),_);t.$$.on_destroy.push(()=>i()),t.$$.on_destroy.push(()=>a()),t.$$.on_destroy.push(()=>f());let{stateStore:p}=e;r();let{configStore:_}=e;d();let{controlsStore:g}=e;o();let{algorithm:v}=e,{algorithms:O}=e,b={},T,j={stateStore:p,configStore:_},W=v.components.Configuration,z=v.components.Actions,R=v.drawing.paintState,P=v.drawing.seqPaintingOptions||{},M=v.drawing.nodePaintingOptions||{},y=v.components.StateGraph,D=null;return Ue(()=>{_.subscribe(k=>{let I=O[k.algorithm];n(6,W=I.components.Configuration),n(11,y=I.components.StateGraph),n(7,z=I.components.Actions),n(8,R=I.drawing.paintState),n(9,P=I.drawing.seqPaintingOptions?X({},I.drawing.seqPaintingOptions):{}),n(9,P.autoAlign="TOP_TO_BOTTOM",P),n(10,M=I.drawing.nodePaintingOptions?X({},I.drawing.nodePaintingOptions):{}),n(10,M.autoAlign="CENTER",M)}),p.subscribe(k=>{!s||!k||(T!==k.selectedElementId&&(T=k.selectedElementId),T&&T.indexOf&&T.indexOf("M_")===0?n(12,D=l.messages.find(I=>I.id===T)):n(12,D=l.nodes.find(I=>I.id===T)),D&&n(4,b=s.element(k.nodes.find(I=>I.id===T))))}),p.update(k=>x(X({},k),{selectedElementId:k.nodes.filter(I=>I.type==="client")[0]})),n(5,j={stateStore:p,configStore:_})}),t.$$set=k=>{"stateStore"in k&&r(n(0,p=k.stateStore)),"configStore"in k&&d(n(1,_=k.configStore)),"controlsStore"in k&&o(n(2,g=k.controlsStore)),"algorithm"in k&&n(3,v=k.algorithm),"algorithms"in k&&n(15,O=k.algorithms)},[p,_,g,v,b,j,W,z,R,P,M,y,D,s,u,O]}class fs extends fe{constructor(e){super(),ce(this,e,cs,us,ae,{stateStore:0,configStore:1,controlsStore:2,algorithm:3,algorithms:15})}}const ln={algorithm:"paxos",commandDelay:0,networkDelay:5e3,speed:1,useWorkers:!0,useGlobalState:!1};function ds(){return new Worker("/assets/NodeRunnerWorker.2e79288f.js",{type:"module"})}function Ce(){return typeof crypto!="undefined"&&crypto.randomUUID?crypto.randomUUID():hs()}function hs(t=6,e=36){return Math.random().toString(e).substring(2,t)}class ps{constructor(e,n){this.neighbors=[],this.node=e,this.neighbors=n&&this.neighbors.concat(n)}getAllNeighbors(){return this.neighbors}getNeighborsOfType(e){return this.neighbors.filter(n=>n.type===e)}getRandomNeighborOfType(e){const n=this.getNeighborsOfType(e),s=Math.floor(Math.random()*n.length);return n[s]}broadcast(e,n){const s=Ce(),i=this.node.id;for(const o of n)o!==i&&this.emit(x(X({},e),{sent:new Date().toISOString(),id:this.getRandomId(),broadcastKey:s,fromId:i,toId:o}))}broadcastToAll(e){const n=this.neighbors.map(s=>s.id);this.broadcast(e,n)}broadcastToType(e,n){const s=this.neighbors.filter(i=>i.type===n).map(i=>i.id);this.broadcast(e,s)}sendTo(e,n){const s=this.node.id;this.emit(x(X({},n),{sent:new Date().toISOString(),fromId:s,toId:e,id:this.getRandomId()}))}sendToSync(e,n){const s=this.node.id;return this.emitSync(x(X({},n),{sent:new Date().toISOString(),fromId:s,toId:e,id:this.getRandomId()}))}emit(e){window.dispatchEvent(new CustomEvent("NetworkEvent",{detail:x(X({},e),{nodeId:this.node.id})}))}emitSync(e){const n=Ce();return new Promise(s=>{this.emit(x(X({},e),{resKey:n}));const i=this.listen(o=>{o.resKey===n&&(i(),s(o))})})}listen(e){const s=(i=>o=>o.detail.toId===this.node.id&&i(o.detail))(e);return window.addEventListener("NetworkEvent",s),()=>{window.removeEventListener("NetworkEvent",s)}}async receive(){return new Promise(e=>{this.listen(n=>{e(n)})})}getRandomId(){return"M_"+Ce()}}class ze{constructor(e,n,s,i){this.id=e,this.config=n,this.state=s,this.network=i,this.running=!0,this.connected=!0,this.executedCommands=[],this.scheduledCommands=[]}stop(){this.running=!1}restart(){this.running=!0,this.scheduledCommands.forEach(e=>{e.do(),this.executedCommands.push(e)})}reconnect(){this.connected=!0}disconnect(){this.connected=!1}invoke(e){const n=Ce();let s=e;typeof s=="function"?s={id:n,do:e,undo:()=>console.warn("Undo not implemented")}:s.id=n,this.running?(s.do(),this.executedCommands.push(s)):this.scheduledCommands.push(s),this.updateState()}step(e=!0){if(e&&this.scheduledCommands.length>0){let n=this.scheduledCommands.shift();n.do(),this.executedCommands.push(n)}else if(this.executedCommands.length>0){let n=this.executedCommands.pop();n.undo(),this.scheduledCommands.push(n)}this.updateState()}invokeDo(e){const n=X({},this.state),s={do:()=>{e()},undo:()=>{this.state=n}};this.invoke(s)}updateState(){this.network.sendTo(void 0,{type:"STATE_CHANGED",isFlow:!0,data:x(X({},this.state),{scheduledCommands:this.scheduledCommands.map(({id:e})=>({id:e})),executedCommands:this.executedCommands.map(({id:e})=>({id:e}))})})}}class ms extends ze{constructor(e,n,s,i){super(e,n,s,i),this.type="client"}request(e,n){const s=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{method:"REQUEST",v:n}),this.updateState()},undo:()=>{this.state.text=s}}}onmessage(e){e.method==="RESPONSE"&&this.invoke(this.onAck())}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}requestRandom(e){const n=this.network.getRandomNeighborOfType("proposer")||this.network.getRandomNeighborOfType("node");this.invoke(this.request(n.id,e))}}class gs{constructor(e,n){this.id=e,this.network=n,this.state={greatestN:-1,text:"IDLE"}}onPrepare(e){let n=X({},this.state);return{do:()=>{if(e.n<=this.state.greatestN){this.state.text="IDLE",this.network.sendTo(e.fromId,{clientId:e.clientId,n:this.state.greatestN,v:e.v,method:"IGNORED"});return}this.state.greatestN=e.n,this.state.text="PROMISED",this.network.sendTo(e.fromId,{method:"PROMISE",clientId:e.clientId,n:e.n,v:e.v})},undo:()=>{this.state=n}}}onAccept(e){let n=X({},this.state);return{do:()=>{if(e.n>this.state.greatestN){this.state.text="IDLE",e.clientId,this.state.greatestN,e.v;return}this.state.text="ACCEPTED",this.network.broadcastToType({clientId:e.clientId,n:e.n,v:e.v,method:"ACCEPTED"},"node"),this.state.greatestN=e.n},undo:()=>{this.state=n}}}}class _s{constructor(e,n){this.network=n,this.id=e,this.state={v:null,n:null,log:[]}}onAccepted(e){const n=this.state.v;return{do:()=>{e.v===this.state.v&&e.n===this.state.n||(this.state.v=e.v,this.state.n=e.n,this.state.log[e.n-1]=e.v,this.network.sendTo(e.clientId,{clientId:e.clientId,n:e.n,v:e.v,method:"RESPONSE"}))},undo:()=>{this.state.v=n}}}}class bs{constructor(e,n){this.id=e,this.network=n,this.type="proposer",this.state={proposals:[],text:"IDLE",n:1}}hasMajority(e,n=!0){const s=this.state.proposals.find(o=>o.n===e);if(!s){console.log("----> no proposal",this.state.proposals);return}const i=this.network.getNeighborsOfType("acceptors").length||this.network.getNeighborsOfType("node").length-1;return(n?s.promises:s.acceptances).length>Math.round(.5*i)}onRequest(e){const n=X({},this.state);return{do:()=>{this.state.isProposer=!0,this.state.text="PREPARING",this.state.proposals.push({clientId:e.fromId,v:e.v,n:this.state.n,promises:[],acceptances:[]});let s=this.network.getNeighborsOfType("acceptor");(!s||s.length===0)&&(s=this.network.getNeighborsOfType("node")),this.network.broadcast({clientId:e.fromId,v:e.v,method:"PREPARE",n:this.state.n},s.map(i=>i.id))},undo:()=>{this.state=n}}}onPromise(e){const n=X({},this.state);return{do:()=>{if(this.state.text==="PROMISED")return;const s=this.state.proposals.find(i=>i.n===e.n);!s||(s.promises.push(e.fromId),this.hasMajority(e.n)&&(this.network.broadcast({clientId:e.clientId,v:e.v,method:"ACCEPT",n:s.n},s.promises),this.state.text="PROMISED"))},undo:()=>{this.state=n}}}onAccepted(e){const n=X({},this.state);return{do:()=>{if(this.state.text==="IDLE")return;const s=this.state.proposals.find(i=>i.n===e.n);!s||(s.acceptances.push(e.fromId),this.hasMajority(e.n,!1)&&(this.state.n=this.state.n+1,this.state.proposals.forEach(i=>{}),this.state.text="IDLE"),this.state.isProposer=!1)},undo:()=>{this.state=n}}}onIgnored(e){const n=X({},this.state);return{do:()=>{const s=this.state.proposals.findIndex(o=>o.n===e.n);if(s<0||!this.state.proposals[s])return;this.state.proposals=this.state.proposals.map(o=>o.n===e.n?x(X({},o),{acceptances:o.acceptances.filter(l=>l.acceptorId!==e.fromId),promises:o.promises.filter(l=>l.acceptorId!==e.fromId)}):o),this.state.n=e.n+1,this.state.proposals[s].n=this.state.n;let i=this.network.getNeighborsOfType("acceptor");(!i||i.length===0)&&(i=this.network.getNeighborsOfType("node"));for(let o of i)console.log("---> ",this.state.proposals[s],this.state.proposals[s].clientId),this.network.sendTo(o.id,{clientId:this.state.proposals[s].clientId,v:this.state.proposals[s].v,method:"PREPARE",n:this.state.n})},undo:()=>{this.state=n}}}}class vs extends ze{constructor(e,n,s,i,o="node"){super(e,n,s,i),this.type=o,this.state.log=[],(o==="node"||o==="acceptor")&&(this.acceptor=new gs(e,i),this.state.acceptor=this.acceptor.state),(o==="node"||o==="learner")&&(this.learner=new _s(e,i),this.state.learner=this.learner.state),(o==="node"||o==="proposer")&&(this.proposer=new bs(e,i),this.state.proposer=this.proposer.state)}onmessage(e){this.proposer&&this.handleProposerMessage(e),this.acceptor&&this.handleAcceptorMessage(e),this.learner&&this.handleLearnerMessage(e)}handleProposerMessage(e){switch(e.method){case"REQUEST":this.invoke(this.proposer.onRequest(e));break;case"PROMISE":this.invoke(this.proposer.onPromise(e));break;case"ACCEPTED":this.invoke(this.proposer.onAccepted(e));break;case"IGNORED":this.invoke(this.proposer.onIgnored(e));break}}handleAcceptorMessage(e){switch(e.method){case"PREPARE":this.invoke(this.acceptor.onPrepare(e));break;case"ACCEPT":this.invoke(this.acceptor.onAccept(e));break}}handleLearnerMessage(e){switch(e.method){case"ACCEPTED":this.invoke(this.learner.onAccepted(e));break}}}function on(t,e,n,s){return n.type==="client"?new ms(n.id,t,n,s):new vs(n.id,t,n,s,n.type||"all")}class ys extends ze{constructor(e,n,s,i){super(e,n,s,i),this.type="client"}request(e,n){const s=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{command:"REQUEST",tx:n,timestamp:new Date().getTime()}),this.updateState()},undo:()=>{this.state.text=s}}}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}onmessage(e){e.method==="RESPONSE"&&this.invoke(this.onAck())}requestRandom(e){const n=this.network.getRandomNeighborOfType("node");this.invoke(this.request(n.id,e))}}const ks={header:{prevHeaderHash:null,merkleRoot:null},height:0,timestamp:new Date("2009-01-03T19:15:00.000Z").getTime(),transactions:[]};async function rn(t,e="",n="sha-256"){if(typeof crypto=="undefined"||!crypto||!crypto.subtle)return JSON.stringify(t)+e;const s=ws(JSON.stringify(t)+e),i=await crypto.subtle.digest(n,s);return Array.from(new Uint8Array(i)).map(l=>l.toString(16).padStart(2,"0")).join("")}async function ht(t,e,n="",s="sha-256"){return typeof crypto=="undefined"||!crypto||!crypto.subtle?JSON.stringify(e)+n===t:await rn(e,n,s)===t}function ws(t){return new TextEncoder().encode(t)}const pt=5e3,De=1e3;class Ss extends ze{constructor(e,n,s,i){super(e,n,s,i),this.type="node",this.state.text="IDLE",this.state.chain=[ks],this.state.mempool=[],this.getBlocks()}onmessage(e){switch(e.command){case"getblocks":super.invoke(this.onGetBlocks(e));break;case"REQUEST":super.invokeDo(this.sendRawTransaction(e));break;case"blocks":super.invoke(this.onBlocks(e));break;case"rawtransaction":super.invokeDo(this.onRawTransaction(e));break;case"submitblock":super.invokeDo(this.onSubmitBlock(e));break}}onBlocks(e){return{do:async()=>{for(let n of e.entries){if(!await ht(n.header.prevHeaderHash,this.state.chain.at(-1).header))return;this.state.chain.push(n)}},undo:()=>{}}}onGetBlocks(e){return{do:()=>{this.network.sendTo(e.fromId,{command:"blocks",entries:this.state.chain})},undo:()=>{}}}getBlocks(){if(this.network.neighbors.length===0)return;const e=this.network.getNeighborsOfType("node");if(e.length===0)return;const n=Math.floor(Math.random()*e.length),s=e[n];this.network.sendTo(s.id,{command:"getblocks",headerHashes:[this.state.chain.at(-1).hash]})}sendRawTransaction(e){return()=>{const n=this.state.mempool.find(i=>e.tx===i),s=this.state.chain.find(i=>i.transactions.find(o=>o===e.tx));if(!n&&!s){this.timeout&&clearTimeout(this.timeout);const i=Math.random()*(pt-De)+De;this.timeout=setTimeout(this.tryMining(),i),this.state.mempool.push(e.tx),this.network.broadcastToType({timestamp:e.timestamp,tx:e.tx,command:"rawtransaction"},"node")}}}onRawTransaction(e){return()=>{this.sendRawTransaction(e)()}}onSubmitBlock(e){return()=>{const n=(i,o)=>()=>i.transactions.filter((l,a)=>l!==o.transactions[a]).length===0;this.state.chain.find(i=>i===e.block||n(e.block,i))||(console.log("--> NO DUPLICATE: chain = ",this.state.chain,", new block = ",e.block),this.state.mempool=this.state.mempool.filter(i=>!e.block.transactions.find(o=>o!==i)),this.state.chain.push(e.block))}}stop(){super.stop(),this.timeout&&clearTimeout(this.timeout)}restart(){super.restart();const e=Math.random()*(pt-De)+De;this.timeout=setTimeout(this.tryMining(),e)}tryMining(){return async()=>{if(this.state.mempool.length===0)return;const e=Math.random().toFixed(8),s={header:{prevHeaderHash:await rn(this.state.chain.at(-1),e),merkleRoot:null,nonce:e},height:this.state.chain.length,timestamp:new Date().getTime(),transactions:this.state.mempool};this.state.mempool=[],this.state.chain.push(s),this.network.broadcastToType({block:s,command:"submitblock"},"node")}}validate(e){return ht(e.header.prevHeaderHash,x(X({},e),{hash:void 0}))}}function an(t,e,n,s){switch(n.type){case"client":return new ys(n.id,t,n,s);case"node":return new Ss(n.id,t,n,s)}}function Es(t,...e){switch(t){case"paxos":return on(...e);case"bitcoin_pow":return an(...e);default:throw"Algorithm not implemented"}}class Os{constructor(e,n){this.setupNetwork=(s,i)=>new ps(s,i),this.id=Ce(),this.config=e,this.network=null,this.nodeStates=n,this.nodes=[]}terminate(){this.stopListening&&this.stopListening()}buildMessageEventHandler(){return e=>{let n=e.data;if(console.log(`NodeRunner for "${this.nodeStates?this.nodeStates.map(s=>s.id).join(", "):"?"}" got:`,n),n.isFlow){this.onFlowMessage(n);return}if(n.toId){const s=this.nodes.find(i=>i.id===n.toId);s&&s.running&&s.connected&&s.onmessage(n)}}}setupNodes(e,n,s){this.nodeStates=n,n.forEach(async i=>{const o=this.setupNetwork(i,s),l=Es(e.algorithm,e,null,i,o);l&&(l.updateState(),this.nodes.push(l),console.log("Starting node with id ",l.id,"and type",l.type))})}onFlowMessage(e){const{nodeId:n}=e;switch(e.type){case"CLIENT_REQUEST":if(n){const s=this.nodes.find(i=>i.id===n);if(s&&s.type==="client"){const{v:i}=e;s.requestRandom(i)}}break;case"SETUP":case"RESET":this.setupNodes(e.config,e.nodes,e.neighbors),this.postMessageToMain({isFlow:!0,type:"STATE_CHANGED",state:"IDLE"});break;case"STEP":this.nodes.forEach(s=>s.step(e.forward));break;case"DISCONNECT":case"RECONNECT":case"STOP":case"RESTART":if(n){const s=this.nodes.find(i=>i.id===n);s&&(e.type==="RECONNECT"?s.reconnect():e.type==="DISCONNECT"?s.disconnect():e.type==="RESTART"?s.restart():e.type==="STOP"&&(this.postMessageToMain({isFlow:!0,type:"COMMANDS",commands:s.executedCommands}),s.stop()))}break;default:console.error("Flow message type not recognized");break}}onmessage(){console.warn("onmessage is not implemented")}onerror(){console.warn("onerror is not implemented")}postMessage(e){this.messageEventHandler||(this.messageEventHandler=this.buildMessageEventHandler());const n={data:e};this.messageEventHandler(n)}postMessageToMain(e){window.dispatchEvent(new CustomEvent("NodeRunnerEvent",{detail:x(X({},e),{nodeRunnerId:this.id})}))}startListening(){const e=i=>i.detail.nodeRunnerId===this.id||this.nodeStates.filter(o=>o.id===i.detail.nodeId||o.id===i.detail.toId).length!==0,s=(i=>o=>e(o)&&i({data:o.detail}))(this.onmessage);window.addEventListener("NodeRunnerEvent",s),window.addEventListener("NetworkEvent",s),this.stopListening=()=>{window.removeEventListener("NodeRunnerEvent",s),window.removeEventListener("NetworkEvent",s)}}}const un=10;function Ts(t,e){const n={"0":()=>{}};let s=[];function i(){return()=>{t(l=>{const a=[...s];return s=[],Object.keys(n).forEach(r=>{!l.messages.find(u=>u.id===r)&&!a.find(u=>u.id===r)&&(n[r]=void 0)}),x(X({},l),{messages:l.messages.concat(...a).map(Is(l,e,n))})})}}const o=setInterval(i(),un);return{stop:()=>clearInterval(o),push:async(l,a,r)=>new Promise(u=>{n[a.id]={resolve:u,onCompleted:r};const f=X({},a);f.progress=0,f.id=a.id,s.push(f),f.pos=l.nodes.filter(d=>d.id===a.fromId)[0].pos})}}function Is(t,e,n){return s=>{var a,r;if(s.done&&n[s.id]&&!n[s.id].resolved&&(n[s.id].onCompleted(),n[s.id].resolved=!0,(a=n[s.id])==null||a.resolve(s)),s.done)return s;const i=Ns(t,e,un,s.progress),o=t.nodes.filter(u=>u.id===s.fromId)[0].pos,l=t.nodes.filter(u=>u.id===s.toId)[0].pos;return s.pos=[o[0]+Math.min(i,1)*(l[0]-o[0]),o[1]+Math.min(i,1)*(l[1]-o[1])],i>=1&&(s.done=!0,n[s.id]?s.progress<1&&(n[s.id].onCompleted(),n[s.id].resolved=!0,(r=n[s.id])==null||r.resolve(x(X({},s),{done:!0}))):console.warn("onCompletedMap missing key")),s.progress=i,s}}function Ns(t,e,n,s){const i=e<=0?1:n/(e/t.speed);return Math.min(s+(t.paused?0:i),1)}function Ps(t,e,n,s,i){const o=u=>n(f=>{const d=u(f);return X(X({},f),d)}),l={setSpeed:u=>n(f=>x(X({},f),{speed:u})),stepForwards:()=>o(t.useGlobalState?mt(t,e,!0):gt(t,e,!0)),stepBackwards:()=>o(t.useGlobalState?mt(t,e,!1):gt(t,e,!1)),pauseOrPlay:()=>o(As(t,e,void 0)),reset:()=>o(bt(t,e,void 0,s,i)),terminate:Ls(t,e,s)},a=u=>({delete:()=>n(f=>x(X({},f),{selectedElementId:void 0,messages:f.messages.filter(d=>d.id!==f.selectedElementId)})),modify:f=>()=>n(d=>x(X({},d),{messages:d.messages.filter(p=>p.id!==d.selectedElementId).concat(f)}))}),r=u=>({connectOrDisconnect:()=>o(Cs(t,e,u.id)),restart:()=>o(bt(t,e,u.id))});return{simulation:l,element:u=>x(X(X({},r(u)),a()),{createNewAction:f=>()=>{n(d=>{const p=f(t,d,e);return X(X({},d),p)})}})}}function Cs(t,e,n){return s=>{if(!!n&&!!e[n])return e[n].postMessage({isFlow:!0,type:s.nodes.find(i=>i.id===n).connected?"DISCONNECT":"RECONNECT",nodeId:n}),{nodes:s.nodes.map(i=>x(X({},i),{connected:n&&i.id===n?!i.connected:i.connected}))}}}function As(t,e,n=void 0){return s=>{if(Object.values(e).forEach(i=>i.postMessage({isFlow:!0,nodeId:n,type:s.paused?"RESTART":"STOP"})),s.paused){const i=s.messages.filter(o=>o.deleted).sort(cn);if(i.length>0&&i[0]){const o=i[0].fromId;e[o].postMessage({isFlow:!0,nodeId:o,type:"STEP",forward:!0})}}return{paused:typeof s.paused=="undefined"?!0:!s.paused,messages:s.paused?s.messages.filter(i=>!i.deleted):s.messages,nodes:s.nodes.filter(i=>n?i.id===n:!0).map(i=>x(X({},i),{running:!i.running}))}}}function mt(t,e,n=!0){return s=>{if(window.states||(window.stateIdx=-1,window.states=[]),n&&(window.states.length===0||window.stateIdx===window.states.length-1)){const i={messages:Ms([],s.messages),nodes:s.nodes};return window.states.push(i),i}else return n?(window.stateIdx+=1,window.states[window.stateIdx]):(window.stateIdx=Math.max(0,window.stateIdx-1),window.states[window.stateIdx])}}function gt(t,e,n=!0){return s=>{if(n)return{messages:s.messages.map(o=>(o.done||o.deleted||(o.progress=o.progress<.5?.5:1,o.done=o.progress>=1),o))};{const i=[],o=s.messages.sort(cn(!0)),l=o.reduce(_t(o),[]),a=o.filter(u=>l.indexOf(u)===-1).reduce(_t(o),[]),r=s.messages.map(u=>(l.indexOf(u)!==-1?u.progress>.5?(u.progress=.5,u.done=!1,u.deleted=!1):(u.progress=0,u.deleted=!0,u.done=!0,i.push(u)):a.indexOf(u)!==-1&&(u.done=!1,u.progress=.5),u)).filter(u=>!u.deleted);return i.map(u=>u.fromId).filter(Rs).forEach(u=>{e[u].postMessage({isFlow:!0,type:"STEP",forward:!1})}),{messages:r}}}}function _t(t){return(e,n)=>{if(t.length===0)return[];const s=t[0].broadcastKey;return s?(s&&s===n.broadcastKey&&e.push(n),e):[t[0]]}}function cn(t=!1){return(e,n)=>{const s=new Date(e.sent).getTime(),i=new Date(n.sent).getTime();return s>i?t?-1:1:s<i?t?1:-1:0}}function Ms(t,e){return e.map(n=>{const s=t.findIndex(i=>i.id===n.id)==-1;return n.done||n.deleted&&s||(n.deleted=!1,n.progress=n.progress<.5?.5:1,n.done=n.progress>=1),n})}function Ls(t,e,n){return()=>{n(),Object.values(e).forEach(s=>s.terminate())}}function bt(t,e,n,s,i){return o=>{if(n&&e[n]){const l=o.nodes.find(a=>a.id===n);e[n].postMessage({config:t,isFlow:!0,type:"RESET",nodeId:n,nodes:[l],neighbors:o.nodes.filter(a=>a.id!==l.id)})}else if(!n)return s&&s(),i&&i();return{}}}const Rs=(t,e,n)=>n.indexOf(t)===e;function Ds({value:t,update:e},{value:n,update:s},i){const o=Ts(s,t.networkDelay/n.speed),l={};for(const r of n.nodes){const u=t.useWorkers?new ds({type:"module",name:r.id}):new Os(t,[r]),f=d=>{const p=d.data;if(p.isFlow)switch(p.type){case"STATE_CHANGED":if(!p.data)break;s(_=>x(X({},_),{commands:(_.commands||[]).concat(...p.data.scheduledCommands||[]),nodes:[..._.nodes.map(g=>g.id===r.id?X(X({},g),p.data):g)]}));break}else o.push(n,p,()=>{p.toId&&l[p.toId].postMessage(p)})};u.onmessage=f,u.onerror=d=>{console.error(d.message,d.error,d),e(p=>x(X({},p),{useWorkers:!1}))},t.useWorkers||u.startListening(),u.postMessage({isFlow:!0,type:"SETUP",config:t,nodes:[r],neighbors:n.nodes.filter(d=>d.id!==r.id)}),l[r.id]=u}const a=Ps(t,l,s,o.stop,i);return[l,a]}function fn(t,e){const n=[];for(let s=0;s<t;s++){const i=2*Math.PI*((s+1)/t);n.push([e*Math.cos(i)+e,e*Math.sin(i)+e])}return n}const Fs=1,Hs=1,js=1,Bs=1,Ws=1;function dn(t){const e={selectedElementId:void 0,started:new Date,speed:1,nodes:[],messages:[]};return e.nodes=qs(t),e}function qs(t){const e=[];if(t.numberOfClients<Fs)throw"IllegalAmountOfClients";for(let n=0;n<t.numberOfClients;n++)e.push({id:"C"+(n+1),type:"client",running:!0,connected:!0,state:"IDLE",pos:[50+n*60,50]});if(t.useSingleNodes){if(t.numberOfNodes<Hs)throw"IllegalAmountOfNodes";const n=130,s=fn(t.numberOfNodes,100);for(let i=0;i<t.numberOfNodes;i++)e.push({id:"N"+(i+1),type:"node",running:!0,connected:!0,state:"IDLE",pos:[s[i][0]+50,s[i][1]+n]});return e}if(t.numberOfProposers<js)throw"IllegalAmountOfProposers";for(let n=0;n<t.numberOfProposers;n++)e.push({id:"P"+(n+1),type:"proposer",state:"IDLE",running:!0,connected:!0,pos:[100+n*60,150]});if(t.numberOfAcceptors<Bs)throw"IllegalAmountOfAcceptors";for(let n=0;n<t.numberOfAcceptors;n++)e.push({id:"A"+(n+1),type:"acceptor",state:"IDLE",running:!0,connected:!0,pos:[100+n*60,250]});if(t.numberOfLearners<Ws)throw"IllegalAmountOfLearners";for(let n=0;n<t.numberOfLearners;n++)e.push({id:"L"+(n+1),type:"learner",state:"IDLE",running:!0,connected:!0,pos:[50+n*60,350]});return e}const hn={algorithm:"paxos",numberOfClients:1,numberOfProposers:1,numberOfAcceptors:3,numberOfLearners:2,numberOfNodes:5,useSingleNodes:!0},Gs=x(X({},Ge),{getText:t=>`${t.method} (${t.method!=="REQUEST"?t.n+", ":""}${t.v})`}),Us={isLeader:t=>{var e;return(e=t.proposer)==null?void 0:e.isProposer}},Ke={padding:2};function zs(t,e,n,s=Ke){if(!e)return[t.canvas.width,t.canvas.height];let i=0;return s=X(X({},Ke),s),e.nodes.forEach((o,l)=>{var f;const a=30*l;t.beginPath(),t.fillStyle="#000",t.font="20px courier new";let r=[0,a+12];t.fillText(o.id,...r),t.closePath();let u=o.id.length*20+Ke.padding;(f=o.proposer)!=null&&f.log&&o.proposer.log.filter(d=>d).forEach(d=>{t.beginPath(),t.lineWidth=2,t.strokeStyle="#000";const p=d.length*10;t.rect(u-s.padding,a,p+s.padding*2,10),t.stroke(),t.closePath(),t.beginPath(),t.fillStyle="#000",t.font="12px courier new";let _=u+d.length*12+2,g=[_,a+8];u=_,t.fillText(d,...g),t.closePath()})}),[i,30*(e.nodes.length+1)]}function Xs(t){let e,n,s,i,o,l,a,r,u,f,d,p,_,g,v,O;return{c(){e=h("div"),n=h("label"),s=L(`Number of Proposers\r
                `),i=h("input"),o=F(),l=h("div"),a=h("label"),r=L(`Number of Acceptors\r
                `),u=h("input"),f=F(),d=h("div"),p=h("label"),_=L(`Number of Learners\r
                `),g=h("input"),m(i,"type","number"),m(i,"min","1"),m(i,"max","10"),m(e,"class","input-group"),m(u,"type","number"),m(u,"min","1"),m(u,"max","10"),m(l,"class","input-group"),m(g,"type","number"),m(g,"min","1"),m(g,"max","10"),m(d,"class","input-group")},m(b,T){E(b,e,T),c(e,n),c(n,s),c(n,i),ee(i,t[1].numberOfProposers),E(b,o,T),E(b,l,T),c(l,a),c(a,r),c(a,u),ee(u,t[1].numberOfAcceptors),E(b,f,T),E(b,d,T),c(d,p),c(p,_),c(p,g),ee(g,t[1].numberOfLearners),v||(O=[Q(i,"input",t[4]),Q(u,"input",t[5]),Q(g,"input",t[6])],v=!0)},p(b,T){T&2&&le(i.value)!==b[1].numberOfProposers&&ee(i,b[1].numberOfProposers),T&2&&le(u.value)!==b[1].numberOfAcceptors&&ee(u,b[1].numberOfAcceptors),T&2&&le(g.value)!==b[1].numberOfLearners&&ee(g,b[1].numberOfLearners)},d(b){b&&S(e),b&&S(o),b&&S(l),b&&S(f),b&&S(d),v=!1,re(O)}}}function Ks(t){let e,n,s,i,o,l;return{c(){e=h("div"),n=h("label"),s=L(`Number of Nodes\r
                `),i=h("input"),m(i,"type","number"),m(i,"min","1"),m(i,"max",15),m(e,"class","input-group")},m(a,r){E(a,e,r),c(e,n),c(n,s),c(n,i),ee(i,t[1].numberOfNodes),o||(l=Q(i,"input",t[3]),o=!0)},p(a,r){r&2&&le(i.value)!==a[1].numberOfNodes&&ee(i,a[1].numberOfNodes)},d(a){a&&S(e),o=!1,l()}}}function Js(t){let e,n,s,i,o,l,a,r;function u(p,_){return p[1].useSingleNodes?Ks:Xs}let f=u(t),d=f(t);return{c(){e=h("div"),n=h("div"),s=h("label"),i=L(`Number of Clients\r
            `),o=h("input"),l=F(),d.c(),m(o,"type","number"),m(o,"min","1"),m(o,"max",5),m(n,"class","input-group"),m(e,"class","algorithm-specific-options")},m(p,_){E(p,e,_),c(e,n),c(n,s),c(s,i),c(s,o),ee(o,t[1].numberOfClients),c(e,l),d.m(e,null),a||(r=Q(o,"input",t[2]),a=!0)},p(p,[_]){_&2&&le(o.value)!==p[1].numberOfClients&&ee(o,p[1].numberOfClients),f===(f=u(p))&&d?d.p(p,_):(d.d(1),d=f(p),d&&(d.c(),d.m(e,null)))},i:K,o:K,d(p){p&&S(e),d.d(),a=!1,r()}}}function Qs(t,e,n){let s,i=K,o=()=>(i(),i=de(l,p=>n(1,s=p)),l);t.$$.on_destroy.push(()=>i());let{config:l}=e;o();function a(){s.numberOfClients=le(this.value),l.set(s)}function r(){s.numberOfNodes=le(this.value),l.set(s)}function u(){s.numberOfProposers=le(this.value),l.set(s)}function f(){s.numberOfAcceptors=le(this.value),l.set(s)}function d(){s.numberOfLearners=le(this.value),l.set(s)}return t.$$set=p=>{"config"in p&&o(n(0,l=p.config))},[l,s,a,r,u,f,d]}class Ys extends fe{constructor(e){super(),ce(this,e,Qs,Js,ae,{config:0})}}const Ee={name:"Paxos",description:"Paxos is a consensus algorithm.",original:"http://lamport.azurewebsites.net/pubs/lamport-paxos.pdf",areas:["Distributed Databases"],applications:[{title:"AzureRSL",src:""}],info:{byNodeType:{leader:"A leader primarily has the role of the proposer.",follower:"A follower primarily has the role of the acceptor.",node:"A paxos Node follows all three roles of the paxos protocol.",proposer:"A proposer tries to have the acceptors agree on a value v send by a client.",acceptor:"An acceptor votes on proposals sent from the proposer. Only then a value can be stored",learner:"A learner makes sure an accepted value is stored and distributed.",client:"Clients want to store data or run actions inside the paxos network. The client is most likely another server system."},byNodeState:{},byMessageMethod:{REQUEST:"Clients can send requests to the current leader if they want to store an input to the replicated log of the cluster.",PREPARE:"A leader node (or proposer) sends followers its generation n. It prepares to commit a value v.",PROMISE:"Followers (or acceptors) answer to the PREPARE requests with a PROMISE message",ACCEPT:"After getting all promises from the acceptor the proposer wants all acceptors to accept a value v",ACCEPTED:"If an acceptor accepts a value v it sends an ACCEPTED message back to the proposer",IGNORED:"If an acceptor does not accept a value v it sends an IGNORED message back to the proposer. The proposer must try again with a higher generation"}}};function $s(t){let e,n,s=t[0].id+"",i,o,l,a,r=(Ee.info.byNodeType[t[0].type]||"No information")+"",u,f,d,p=(Ee.info.byNodeState[t[0].state]||"")+"",_,g,v,O,b,T,j=t[0].type+"",W,z,R,P,M,y=t[0].state+"",D,k,I,A,C,B,w=t[0].connected?"disconnect":"reconnect",H,J,ne,G=t[0].type==="client"&&vt(t);return{c(){e=h("h1"),n=L("Node "),i=L(s),o=F(),l=h("p"),a=h("span"),u=L(r),f=F(),d=h("span"),_=L(p),g=F(),v=h("ul"),O=h("li"),b=L("type: "),T=h("span"),W=L(j),z=F(),R=h("li"),P=L("state: "),M=h("span"),D=L(y),k=F(),G&&G.c(),I=F(),A=h("button"),A.textContent="restart",C=F(),B=h("button"),H=L(w),m(T,"class","svelte-1muk73i"),m(O,"class","svelte-1muk73i"),m(M,"class","svelte-1muk73i"),m(R,"class","svelte-1muk73i"),m(v,"class","property-list svelte-1muk73i")},m(N,q){E(N,e,q),c(e,n),c(e,i),E(N,o,q),E(N,l,q),c(l,a),c(a,u),c(l,f),c(l,d),c(d,_),E(N,g,q),E(N,v,q),c(v,O),c(O,b),c(O,T),c(T,W),c(v,z),c(v,R),c(R,P),c(R,M),c(M,D),E(N,k,q),G&&G.m(N,q),E(N,I,q),E(N,A,q),E(N,C,q),E(N,B,q),c(B,H),J||(ne=[Q(A,"click",function(){ue(t[1].restart)&&t[1].restart.apply(this,arguments)}),Q(B,"click",function(){ue(t[1].connectOrDisconnect)&&t[1].connectOrDisconnect.apply(this,arguments)})],J=!0)},p(N,q){t=N,q&1&&s!==(s=t[0].id+"")&&Y(i,s),q&1&&r!==(r=(Ee.info.byNodeType[t[0].type]||"No information")+"")&&Y(u,r),q&1&&p!==(p=(Ee.info.byNodeState[t[0].state]||"")+"")&&Y(_,p),q&1&&j!==(j=t[0].type+"")&&Y(W,j),q&1&&y!==(y=t[0].state+"")&&Y(D,y),t[0].type==="client"?G?G.p(t,q):(G=vt(t),G.c(),G.m(I.parentNode,I)):G&&(G.d(1),G=null),q&1&&w!==(w=t[0].connected?"disconnect":"reconnect")&&Y(H,w)},d(N){N&&S(e),N&&S(o),N&&S(l),N&&S(g),N&&S(v),N&&S(k),G&&G.d(N),N&&S(I),N&&S(A),N&&S(C),N&&S(B),J=!1,re(ne)}}}function Vs(t){let e,n,s=t[0].id+"",i,o,l,a=t[0].toId+"",r,u,f=t[0].fromId+"",d,p,_,g=Ee.info.byMessageMethod[t[0].method]+"",v,O,b,T,j,W,z=t[0].method+"",R,P,M,y,D,k,I,A,C,B,w,H,J,ne,G;return{c(){e=h("h1"),n=L("Message "),i=L(s),o=F(),l=h("p"),r=L(a),u=L(" \u2192 "),d=L(f),p=F(),_=h("p"),v=L(g),O=F(),b=h("ul"),T=h("li"),j=L("method: "),W=h("span"),R=L(z),P=F(),M=h("li"),y=L("value: "),D=h("input"),k=F(),I=h("li"),A=L("generation: "),C=h("input"),B=F(),w=h("button"),w.textContent="delete",H=F(),J=h("button"),J.textContent="modify",m(W,"class","svelte-1muk73i"),m(T,"class","svelte-1muk73i"),m(D,"type","text"),m(M,"class","svelte-1muk73i"),m(C,"type","text"),m(I,"class","svelte-1muk73i"),m(b,"class","property-list svelte-1muk73i")},m(N,q){E(N,e,q),c(e,n),c(e,i),E(N,o,q),E(N,l,q),c(l,r),c(l,u),c(l,d),E(N,p,q),E(N,_,q),c(_,v),E(N,O,q),E(N,b,q),c(b,T),c(T,j),c(T,W),c(W,R),c(b,P),c(b,M),c(M,y),c(M,D),ee(D,t[0].v),c(b,k),c(b,I),c(I,A),c(I,C),ee(C,t[0].n),E(N,B,q),E(N,w,q),E(N,H,q),E(N,J,q),ne||(G=[Q(D,"input",t[5]),Q(C,"input",t[6]),Q(w,"click",function(){ue(t[1].delete)&&t[1].delete.apply(this,arguments)}),Q(J,"click",function(){ue(t[1].modify)&&t[1].modify.apply(this,arguments)})],ne=!0)},p(N,q){t=N,q&1&&s!==(s=t[0].id+"")&&Y(i,s),q&1&&a!==(a=t[0].toId+"")&&Y(r,a),q&1&&f!==(f=t[0].fromId+"")&&Y(d,f),q&1&&g!==(g=Ee.info.byMessageMethod[t[0].method]+"")&&Y(v,g),q&1&&z!==(z=t[0].method+"")&&Y(R,z),q&1&&D.value!==t[0].v&&ee(D,t[0].v),q&1&&C.value!==t[0].n&&ee(C,t[0].n)},d(N){N&&S(e),N&&S(o),N&&S(l),N&&S(p),N&&S(_),N&&S(O),N&&S(b),N&&S(B),N&&S(w),N&&S(H),N&&S(J),ne=!1,re(G)}}}function Zs(t){let e;return{c(){e=h("span"),e.textContent="No valid element select"},m(n,s){E(n,e,s)},p:K,d(n){n&&S(e)}}}function vt(t){let e,n,s,i,o;return{c(){e=h("input"),n=F(),s=h("button"),s.textContent="request",m(e,"type","text")},m(l,a){E(l,e,a),ee(e,t[2]),E(l,n,a),E(l,s,a),i||(o=[Q(e,"input",t[7]),Q(s,"click",function(){ue(t[4])&&t[4].apply(this,arguments)})],i=!0)},p(l,a){t=l,a&4&&e.value!==t[2]&&ee(e,t[2])},d(l){l&&S(e),l&&S(n),l&&S(s),i=!1,re(o)}}}function xs(t){let e;function n(o,l){return o[0]?o[3]?Vs:$s:Zs}let s=n(t),i=s(t);return{c(){e=h("div"),i.c(),m(e,"class","node-actions-panel")},m(o,l){E(o,e,l),i.m(e,null)},p(o,[l]){s===(s=n(o))&&i?i.p(o,l):(i.d(1),i=s(o),i&&(i.c(),i.m(e,null)))},i:K,o:K,d(o){o&&S(e),i.d()}}}function ei(t,e,n){let{element:s}=e,{actions:i}=e;function o(_,g,v){v[s.id].postMessage({nodeId:s.id,isFlow:!0,type:"CLIENT_REQUEST",v:l})}let l="777",a="",r=!1,u=()=>{};Ze(()=>{i&&!r&&s&&s.type==="client"&&n(4,u=i.createNewAction(o)),s&&a!==s.id&&(n(2,l=s.id),a=s.id,n(3,r=s&&s.fromId))});function f(){s.v=this.value,n(0,s)}function d(){s.n=this.value,n(0,s)}function p(){l=this.value,n(2,l)}return t.$$set=_=>{"element"in _&&n(0,s=_.element),"actions"in _&&n(1,i=_.actions)},[s,i,l,r,u,f,d,p]}class ti extends fe{constructor(e){super(),ce(this,e,ei,xs,ae,{element:0,actions:1})}}function yt(t,e,n){const s=t.slice();return s[3]=e[n],s}function kt(t,e,n){const s=t.slice();return s[6]=e[n],s}function wt(t){let e,n=t[1].nodes.filter(Ot),s=[];for(let i=0;i<n.length;i+=1)s[i]=Et(yt(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=we()},m(i,o){for(let l=0;l<s.length;l+=1)s[l].m(i,o);E(i,e,o)},p(i,o){if(o&2){n=i[1].nodes.filter(Ot);let l;for(l=0;l<n.length;l+=1){const a=yt(i,n,l);s[l]?s[l].p(a,o):(s[l]=Et(a),s[l].c(),s[l].m(e.parentNode,e))}for(;l<s.length;l+=1)s[l].d(1);s.length=n.length}},d(i){ve(s,i),i&&S(e)}}}function St(t){let e,n=t[6]+"",s;return{c(){e=h("li"),s=L(n),m(e,"class","entry svelte-1o1yvcd")},m(i,o){E(i,e,o),c(e,s)},p(i,o){o&2&&n!==(n=i[6]+"")&&Y(s,n)},d(i){i&&S(e)}}}function Et(t){let e,n,s=t[3].id+"",i,o,l,a,r,u=t[3].learner.log,f=[];for(let d=0;d<u.length;d+=1)f[d]=St(kt(t,u,d));return{c(){e=h("li"),n=h("h1"),i=L(s),o=F(),l=h("ul");for(let d=0;d<f.length;d+=1)f[d].c();r=F(),m(n,"class","svelte-1o1yvcd"),m(l,"class",a=be(t[1].selectedElementId===t[3].id?"selected":"")+" svelte-1o1yvcd"),m(e,"class","log svelte-1o1yvcd")},m(d,p){E(d,e,p),c(e,n),c(n,i),c(e,o),c(e,l);for(let _=0;_<f.length;_+=1)f[_].m(l,null);c(e,r)},p(d,p){if(p&2&&s!==(s=d[3].id+"")&&Y(i,s),p&2){u=d[3].learner.log;let _;for(_=0;_<u.length;_+=1){const g=kt(d,u,_);f[_]?f[_].p(g,p):(f[_]=St(g),f[_].c(),f[_].m(l,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=u.length}p&2&&a!==(a=be(d[1].selectedElementId===d[3].id?"selected":"")+" svelte-1o1yvcd")&&m(l,"class",a)},d(d){d&&S(e),ve(f,d)}}}function ni(t){let e,n,s=t[0]&&wt(t);return{c(){e=h("div"),n=h("ul"),s&&s.c(),m(n,"class","nodes svelte-1o1yvcd"),en(e,"overflow","auto")},m(i,o){E(i,e,o),c(e,n),s&&s.m(n,null)},p(i,[o]){i[0]?s?s.p(i,o):(s=wt(i),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:K,o:K,d(i){i&&S(e),s&&s.d()}}}const Ot=t=>t.type==="node"&&t.learner;function si(t,e,n){let s,i=K,o=()=>(i(),i=de(a,r=>n(1,s=r)),a);t.$$.on_destroy.push(()=>i());let{configStore:l}=e,{stateStore:a}=e;return o(),t.$$set=r=>{"configStore"in r&&n(2,l=r.configStore),"stateStore"in r&&o(n(0,a=r.stateStore))},[a,s,l]}class ii extends fe{constructor(e){super(),ce(this,e,si,ni,ae,{configStore:2,stateStore:0})}}const li="Paxos",pn="paxos",oi={seqPaintingOptions:Gs,nodePaintingOptions:Us,paintState:zs},ri={Configuration:Ys,Actions:ti,StateGraph:ii};var ai=Object.freeze(Object.defineProperty({__proto__:null,title:li,key:pn,drawing:oi,components:ri,setupNode:on,generateState:dn,defaultConfig:hn},Symbol.toStringTag,{value:"Module"}));function ui(t){const e={selectedElementId:void 0,started:new Date,speed:1,nodes:[],messages:[]};for(let s=0;s<t.numberOfClients;s++)e.nodes.push({id:"C"+(s+1),type:"client",running:!0,connected:!0,state:"IDLE",pos:[50+s*60,50]});const n=fn(t.numberOfNodes,80);for(let s=0;s<t.numberOfNodes;s++)e.nodes.push({id:"N"+(s+1),type:"node",running:!0,connected:!0,state:"IDLE",pos:[n[s][0]+80,n[s][1]+80]});return e}const ci={numberOfClients:1,numberOfNodes:5},fi=x(X({},Ge),{getText:t=>t.command==="rawtransaction"?`${t.command} (${t.tx})`:t.command==="submitblock"&&t.block.transactions?`${t.command} (${t.block.transactions.join(", ")})`:`${t.command}`}),di={isLeader:t=>!1};function hi(t,e,n){return e?[t.canvas.width,t.canvas.height]:[t.canvas.width,t.canvas.height]}function pi(t){let e,n,s,i,o,l,a,r,u,f,d,p;return{c(){e=h("div"),n=h("div"),s=h("label"),i=L(`Number of Clients\r
            `),o=h("input"),l=F(),a=h("div"),r=h("label"),u=L(`Number of Nodes\r
            `),f=h("input"),m(o,"type","number"),m(o,"min","1"),m(o,"max",10),m(n,"class","input-group"),m(f,"type","number"),m(f,"min","1"),m(f,"max",10),m(a,"class","input-group")},m(_,g){E(_,e,g),c(e,n),c(n,s),c(s,i),c(s,o),ee(o,t[1].numberOfClients),c(e,l),c(e,a),c(a,r),c(r,u),c(r,f),ee(f,t[1].numberOfNodes),d||(p=[Q(o,"input",t[2]),Q(f,"input",t[3])],d=!0)},p(_,[g]){g&2&&le(o.value)!==_[1].numberOfClients&&ee(o,_[1].numberOfClients),g&2&&le(f.value)!==_[1].numberOfNodes&&ee(f,_[1].numberOfNodes)},i:K,o:K,d(_){_&&S(e),d=!1,re(p)}}}function mi(t,e,n){let s,i=K,o=()=>(i(),i=de(l,u=>n(1,s=u)),l);t.$$.on_destroy.push(()=>i());let{config:l}=e;o();function a(){s.numberOfClients=le(this.value),l.set(s)}function r(){s.numberOfNodes=le(this.value),l.set(s)}return t.$$set=u=>{"config"in u&&o(n(0,l=u.config))},[l,s,a,r]}class gi extends fe{constructor(e){super(),ce(this,e,mi,pi,ae,{config:0})}}const Oe={info:{byNodeType:{node:`Nodes accept, save and relay new transactions/blocks.
            A Node can also create Blocks with saved blocks.
            Nodes joins the Network and asks for the current blockchain.`,client:`A client uses a node to request a transaction to be saved on the blockchain.
      Clients can be outside of the P2P network. 
      They may use external providers that actually own nodes to send transactions.`},byNodeSync:{true:"Sync nodes can send their blockchain to new nodes."},byMessageCommand:{REQUEST:"Clients request transactions to be stored on the blockchain.",getblocks:"New nodes bootstrap by asking sync nodes for their blockchain.",blocks:"Sync nodes answer with their blocks to new nodes (getblocks).",submitblock:"Nodes send new mined blocks to their neighbors.",rawtransaction:"Nodes relay transactions to their neighbors."}}};function Tt(t,e,n){const s=t.slice();return s[1]=e[n],s}function It(t){let e,n,s,i=t[0].transactions,o=[];for(let l=0;l<i.length;l+=1)o[l]=Nt(Tt(t,i,l));return{c(){e=h("div"),n=L("transactions: "),s=h("ul");for(let l=0;l<o.length;l+=1)o[l].c();m(s,"class","transactions")},m(l,a){E(l,e,a),c(e,n),c(e,s);for(let r=0;r<o.length;r+=1)o[r].m(s,null)},p(l,a){if(a&1){i=l[0].transactions;let r;for(r=0;r<i.length;r+=1){const u=Tt(l,i,r);o[r]?o[r].p(u,a):(o[r]=Nt(u),o[r].c(),o[r].m(s,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=i.length}},d(l){l&&S(e),ve(o,l)}}}function Nt(t){let e,n=t[1]+"",s;return{c(){e=h("li"),s=L(n)},m(i,o){E(i,e,o),c(e,s)},p(i,o){o&1&&n!==(n=i[1]+"")&&Y(s,n)},d(i){i&&S(e)}}}function _i(t){var A,C,B;let e,n,s,i,o,l=((C=(A=t[0].header)==null?void 0:A.prevHeaderHash)==null?void 0:C.slice(0,8))+"",a,r,u,f,d,p,_=((B=t[0].header)==null?void 0:B.merkleRoot)+"",g,v,O,b,T,j=t[0].height+"",W,z,R,P,M,y=new Date(t[0].timestamp).toLocaleString()+"",D,k,I=t[0].transactions&&t[0].transactions.length!==0&&It(t);return{c(){e=h("ul"),n=h("li"),s=L("prevHeaderHash: "),i=h("span"),o=L("0x"),a=L(l),r=L("..."),u=F(),f=h("li"),d=L("merkleRoot: "),p=h("span"),g=L(_),v=F(),O=h("li"),b=L("height: "),T=h("span"),W=L(j),z=F(),R=h("li"),P=L("timestamp: "),M=h("span"),D=L(y),k=F(),I&&I.c(),m(e,"class","block svelte-cd4rqg")},m(w,H){E(w,e,H),c(e,n),c(n,s),c(n,i),c(i,o),c(i,a),c(i,r),c(e,u),c(e,f),c(f,d),c(f,p),c(p,g),c(e,v),c(e,O),c(O,b),c(O,T),c(T,W),c(e,z),c(e,R),c(R,P),c(R,M),c(M,D),c(e,k),I&&I.m(e,null)},p(w,[H]){var J,ne,G;H&1&&l!==(l=((ne=(J=w[0].header)==null?void 0:J.prevHeaderHash)==null?void 0:ne.slice(0,8))+"")&&Y(a,l),H&1&&_!==(_=((G=w[0].header)==null?void 0:G.merkleRoot)+"")&&Y(g,_),H&1&&j!==(j=w[0].height+"")&&Y(W,j),H&1&&y!==(y=new Date(w[0].timestamp).toLocaleString()+"")&&Y(D,y),w[0].transactions&&w[0].transactions.length!==0?I?I.p(w,H):(I=It(w),I.c(),I.m(e,null)):I&&(I.d(1),I=null)},i:K,o:K,d(w){w&&S(e),I&&I.d()}}}function bi(t,e,n){let{block:s}=e;return t.$$set=i=>{"block"in i&&n(0,s=i.block)},[s]}class mn extends fe{constructor(e){super(),ce(this,e,bi,_i,ae,{block:0})}}function Pt(t,e,n){const s=t.slice();return s[9]=e[n],s}function vi(t){let e,n,s=t[0].id+"",i,o,l,a,r=(Oe.info.byNodeType[t[0].type]||"No information")+"",u,f,d,p=(Oe.info.byNodeSync[t[0].sync]||"")+"",_,g,v,O,b,T,j=t[0].type+"",W,z,R,P,M,y=t[0].state+"",D,k,I,A,C,B,w,H=t[0].connected?"disconnect":"reconnect",J,ne,G,N=t[0].type!=="client"&&Ct(t),q=t[0].type==="client"&&At(t);return{c(){e=h("h1"),n=L("Node "),i=L(s),o=F(),l=h("p"),a=h("span"),u=L(r),f=F(),d=h("span"),_=L(p),g=F(),v=h("ul"),O=h("li"),b=L("type: "),T=h("span"),W=L(j),z=F(),R=h("li"),P=L("state: "),M=h("span"),D=L(y),k=F(),N&&N.c(),I=F(),q&&q.c(),A=F(),C=h("button"),C.textContent="restart",B=F(),w=h("button"),J=L(H),m(T,"class","svelte-1gcbars"),m(O,"class","svelte-1gcbars"),m(M,"class","svelte-1gcbars"),m(R,"class","svelte-1gcbars"),m(v,"class","property-list svelte-1gcbars")},m(Z,te){E(Z,e,te),c(e,n),c(e,i),E(Z,o,te),E(Z,l,te),c(l,a),c(a,u),c(l,f),c(l,d),c(d,_),E(Z,g,te),E(Z,v,te),c(v,O),c(O,b),c(O,T),c(T,W),c(v,z),c(v,R),c(R,P),c(R,M),c(M,D),c(v,k),N&&N.m(v,null),E(Z,I,te),q&&q.m(Z,te),E(Z,A,te),E(Z,C,te),E(Z,B,te),E(Z,w,te),c(w,J),ne||(G=[Q(C,"click",function(){ue(t[1].restart)&&t[1].restart.apply(this,arguments)}),Q(w,"click",function(){ue(t[1].connectOrDisconnect)&&t[1].connectOrDisconnect.apply(this,arguments)})],ne=!0)},p(Z,te){t=Z,te&1&&s!==(s=t[0].id+"")&&Y(i,s),te&1&&r!==(r=(Oe.info.byNodeType[t[0].type]||"No information")+"")&&Y(u,r),te&1&&p!==(p=(Oe.info.byNodeSync[t[0].sync]||"")+"")&&Y(_,p),te&1&&j!==(j=t[0].type+"")&&Y(W,j),te&1&&y!==(y=t[0].state+"")&&Y(D,y),t[0].type!=="client"?N?N.p(t,te):(N=Ct(t),N.c(),N.m(v,null)):N&&(N.d(1),N=null),t[0].type==="client"?q?q.p(t,te):(q=At(t),q.c(),q.m(A.parentNode,A)):q&&(q.d(1),q=null),te&1&&H!==(H=t[0].connected?"disconnect":"reconnect")&&Y(J,H)},i:K,o:K,d(Z){Z&&S(e),Z&&S(o),Z&&S(l),Z&&S(g),Z&&S(v),N&&N.d(),Z&&S(I),q&&q.d(Z),Z&&S(A),Z&&S(C),Z&&S(B),Z&&S(w),ne=!1,re(G)}}}function yi(t){let e,n,s=t[0].id+"",i,o,l,a=t[0].toId+"",r,u,f=t[0].fromId+"",d,p,_,g=Oe.info.byMessageCommand[t[0].command]+"",v,O,b,T,j,W,z=t[0].command+"",R,P,M,y,D,k,I,A,C,B,w;const H=[Ei,Si,wi],J=[];function ne(G,N){return G[0].command==="blocks"?0:G[0].command==="rawtransaction"||G[0].command==="REQUEST"?1:G[0].command==="submitblock"?2:-1}return~(M=ne(t))&&(y=J[M]=H[M](t)),{c(){e=h("h1"),n=L("Message "),i=L(s),o=F(),l=h("p"),r=L(a),u=L(" \u2192 "),d=L(f),p=F(),_=h("p"),v=L(g),O=F(),b=h("ul"),T=h("li"),j=L("command: "),W=h("span"),R=L(z),P=F(),y&&y.c(),D=F(),k=h("button"),k.textContent="delete",I=F(),A=h("button"),A.textContent="modify",m(W,"class","svelte-1gcbars"),m(T,"class","svelte-1gcbars"),m(b,"class","property-list svelte-1gcbars")},m(G,N){E(G,e,N),c(e,n),c(e,i),E(G,o,N),E(G,l,N),c(l,r),c(l,u),c(l,d),E(G,p,N),E(G,_,N),c(_,v),E(G,O,N),E(G,b,N),c(b,T),c(T,j),c(T,W),c(W,R),c(b,P),~M&&J[M].m(b,null),E(G,D,N),E(G,k,N),E(G,I,N),E(G,A,N),C=!0,B||(w=[Q(k,"click",function(){ue(t[1].delete)&&t[1].delete.apply(this,arguments)}),Q(A,"click",function(){ue(t[1].modify)&&t[1].modify.apply(this,arguments)})],B=!0)},p(G,N){t=G,(!C||N&1)&&s!==(s=t[0].id+"")&&Y(i,s),(!C||N&1)&&a!==(a=t[0].toId+"")&&Y(r,a),(!C||N&1)&&f!==(f=t[0].fromId+"")&&Y(d,f),(!C||N&1)&&g!==(g=Oe.info.byMessageCommand[t[0].command]+"")&&Y(v,g),(!C||N&1)&&z!==(z=t[0].command+"")&&Y(R,z);let q=M;M=ne(t),M===q?~M&&J[M].p(t,N):(y&&(pe(),V(J[q],1,1,()=>{J[q]=null}),me()),~M?(y=J[M],y?y.p(t,N):(y=J[M]=H[M](t),y.c()),$(y,1),y.m(b,null)):y=null)},i(G){C||($(y),C=!0)},o(G){V(y),C=!1},d(G){G&&S(e),G&&S(o),G&&S(l),G&&S(p),G&&S(_),G&&S(O),G&&S(b),~M&&J[M].d(),G&&S(D),G&&S(k),G&&S(I),G&&S(A),B=!1,re(w)}}}function ki(t){let e;return{c(){e=h("span"),e.textContent="No valid element select"},m(n,s){E(n,e,s)},p:K,i:K,o:K,d(n){n&&S(e)}}}function Ct(t){let e,n,s,i=(t[0].sync===!0)+"",o;return{c(){e=h("li"),n=L("sync: "),s=h("span"),o=L(i),m(s,"class","svelte-1gcbars"),m(e,"class","svelte-1gcbars")},m(l,a){E(l,e,a),c(e,n),c(e,s),c(s,o)},p(l,a){a&1&&i!==(i=(l[0].sync===!0)+"")&&Y(o,i)},d(l){l&&S(e)}}}function At(t){let e,n,s,i,o;return{c(){e=h("input"),n=F(),s=h("button"),s.textContent="request",m(e,"type","text")},m(l,a){E(l,e,a),ee(e,t[2]),E(l,n,a),E(l,s,a),i||(o=[Q(e,"input",t[5]),Q(s,"click",function(){ue(t[4])&&t[4].apply(this,arguments)})],i=!0)},p(l,a){t=l,a&4&&e.value!==t[2]&&ee(e,t[2])},d(l){l&&S(e),l&&S(n),l&&S(s),i=!1,re(o)}}}function wi(t){let e,n;return e=new mn({props:{block:t[0].block}}),{c(){oe(e.$$.fragment)},m(s,i){se(e,s,i),n=!0},p(s,i){const o={};i&1&&(o.block=s[0].block),e.$set(o)},i(s){n||($(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function Si(t){let e,n,s,i=t[0].tx+"",o;return{c(){e=h("li"),n=L("transaction: "),s=h("span"),o=L(i),m(s,"class","svelte-1gcbars"),m(e,"class","svelte-1gcbars")},m(l,a){E(l,e,a),c(e,n),c(e,s),c(s,o)},p(l,a){a&1&&i!==(i=l[0].tx+"")&&Y(o,i)},i:K,o:K,d(l){l&&S(e)}}}function Ei(t){let e,n,s,i,o=t[0].entries,l=[];for(let r=0;r<o.length;r+=1)l[r]=Mt(Pt(t,o,r));const a=r=>V(l[r],1,1,()=>{l[r]=null});return{c(){e=h("li"),n=L(`entries:\r
                    `),s=h("ul");for(let r=0;r<l.length;r+=1)l[r].c();m(s,"class","property-list entries svelte-1gcbars"),m(e,"class","svelte-1gcbars")},m(r,u){E(r,e,u),c(e,n),c(e,s);for(let f=0;f<l.length;f+=1)l[f].m(s,null);i=!0},p(r,u){if(u&1){o=r[0].entries;let f;for(f=0;f<o.length;f+=1){const d=Pt(r,o,f);l[f]?(l[f].p(d,u),$(l[f],1)):(l[f]=Mt(d),l[f].c(),$(l[f],1),l[f].m(s,null))}for(pe(),f=o.length;f<l.length;f+=1)a(f);me()}},i(r){if(!i){for(let u=0;u<o.length;u+=1)$(l[u]);i=!0}},o(r){l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)V(l[u]);i=!1},d(r){r&&S(e),ve(l,r)}}}function Mt(t){let e,n,s,i;return n=new mn({props:{block:t[9]}}),{c(){e=h("li"),oe(n.$$.fragment),s=F(),m(e,"class","svelte-1gcbars")},m(o,l){E(o,e,l),se(n,e,null),c(e,s),i=!0},p(o,l){const a={};l&1&&(a.block=o[9]),n.$set(a)},i(o){i||($(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&S(e),ie(n)}}}function Oi(t){let e,n,s,i;const o=[ki,yi,vi],l=[];function a(r,u){return r[0]?r[3]?1:2:0}return n=a(t),s=l[n]=o[n](t),{c(){e=h("div"),s.c(),m(e,"class","node-actions-panel")},m(r,u){E(r,e,u),l[n].m(e,null),i=!0},p(r,[u]){let f=n;n=a(r),n===f?l[n].p(r,u):(pe(),V(l[f],1,1,()=>{l[f]=null}),me(),s=l[n],s?s.p(r,u):(s=l[n]=o[n](r),s.c()),$(s,1),s.m(e,null))},i(r){i||($(s),i=!0)},o(r){V(s),i=!1},d(r){r&&S(e),l[n].d()}}}function Ti(t,e,n){let{element:s}=e,{actions:i}=e;function o(d,p,_){_[s.id].postMessage({nodeId:s.id,isFlow:!0,type:"CLIENT_REQUEST",v:l})}let l="777",a="",r=!1,u=()=>{};Ze(()=>{i&&!r&&s&&s.type==="client"&&n(4,u=i.createNewAction(o)),s&&a!==s.id&&(n(2,l=s.id),a=s.id,n(3,r=s&&s.fromId))});function f(){l=this.value,n(2,l)}return t.$$set=d=>{"element"in d&&n(0,s=d.element),"actions"in d&&n(1,i=d.actions)},[s,i,l,r,u,f]}class Ii extends fe{constructor(e){super(),ce(this,e,Ti,Oi,ae,{element:0,actions:1})}}function Lt(t,e,n){const s=t.slice();return s[3]=e[n],s}function Rt(t,e,n){const s=t.slice();return s[6]=e[n],s}function Dt(t,e,n){const s=t.slice();return s[9]=e[n],s}function Ft(t){let e,n=t[1].nodes.filter(Ut),s=[];for(let i=0;i<n.length;i+=1)s[i]=Gt(Lt(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=we()},m(i,o){for(let l=0;l<s.length;l+=1)s[l].m(i,o);E(i,e,o)},p(i,o){if(o&2){n=i[1].nodes.filter(Ut);let l;for(l=0;l<n.length;l+=1){const a=Lt(i,n,l);s[l]?s[l].p(a,o):(s[l]=Gt(a),s[l].c(),s[l].m(e.parentNode,e))}for(;l<s.length;l+=1)s[l].d(1);s.length=n.length}},d(i){ve(s,i),i&&S(e)}}}function Ht(t){let e,n=t[3].chain,s=[];for(let i=0;i<n.length;i+=1)s[i]=qt(Rt(t,n,i));return{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=we()},m(i,o){for(let l=0;l<s.length;l+=1)s[l].m(i,o);E(i,e,o)},p(i,o){if(o&2){n=i[3].chain;let l;for(l=0;l<n.length;l+=1){const a=Rt(i,n,l);s[l]?s[l].p(a,o):(s[l]=qt(a),s[l].c(),s[l].m(e.parentNode,e))}for(;l<s.length;l+=1)s[l].d(1);s.length=n.length}},d(i){ve(s,i),i&&S(e)}}}function jt(t){var M;let e,n,s,i,o=(t[6].header.prevHeaderHash&&"0x"+((M=t[6].header.prevHeaderHash)==null?void 0:M.slice(0,8))+"...")+"",l,a,r,u,f,d=t[6].header.merkleRoot+"",p,_,g,v,O,b=t[6].height+"",T,j,W,z,R,P=t[6].transactions&&t[6].transactions.length!==0&&Bt(t);return{c(){e=h("li"),n=h("p"),s=L("prevHeaderHash: "),i=h("span"),l=L(o),a=F(),r=h("p"),u=L("merkleRoot: "),f=h("span"),p=L(d),_=F(),g=h("p"),v=L("height: "),O=h("span"),T=L(b),j=F(),P&&P.c(),z=F(),R=h("p"),R.textContent=">",m(n,"class","svelte-ylgkgj"),m(r,"class","svelte-ylgkgj"),m(g,"class","svelte-ylgkgj"),m(e,"class",W="block "+(t[1].selectedElementId===t[3].id?"selected":"")+" svelte-ylgkgj"),m(R,"class","arrow svelte-ylgkgj")},m(y,D){E(y,e,D),c(e,n),c(n,s),c(n,i),c(i,l),c(e,a),c(e,r),c(r,u),c(r,f),c(f,p),c(e,_),c(e,g),c(g,v),c(g,O),c(O,T),c(e,j),P&&P.m(e,null),E(y,z,D),E(y,R,D)},p(y,D){var k;D&2&&o!==(o=(y[6].header.prevHeaderHash&&"0x"+((k=y[6].header.prevHeaderHash)==null?void 0:k.slice(0,8))+"...")+"")&&Y(l,o),D&2&&d!==(d=y[6].header.merkleRoot+"")&&Y(p,d),D&2&&b!==(b=y[6].height+"")&&Y(T,b),y[6].transactions&&y[6].transactions.length!==0?P?P.p(y,D):(P=Bt(y),P.c(),P.m(e,null)):P&&(P.d(1),P=null),D&2&&W!==(W="block "+(y[1].selectedElementId===y[3].id?"selected":"")+" svelte-ylgkgj")&&m(e,"class",W)},d(y){y&&S(e),P&&P.d(),y&&S(z),y&&S(R)}}}function Bt(t){let e,n,s,i=t[6].transactions,o=[];for(let l=0;l<i.length;l+=1)o[l]=Wt(Dt(t,i,l));return{c(){e=h("div"),n=L("transactions: "),s=h("ul");for(let l=0;l<o.length;l+=1)o[l].c();m(s,"class","transactions svelte-ylgkgj")},m(l,a){E(l,e,a),c(e,n),c(e,s);for(let r=0;r<o.length;r+=1)o[r].m(s,null)},p(l,a){if(a&2){i=l[6].transactions;let r;for(r=0;r<i.length;r+=1){const u=Dt(l,i,r);o[r]?o[r].p(u,a):(o[r]=Wt(u),o[r].c(),o[r].m(s,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=i.length}},d(l){l&&S(e),ve(o,l)}}}function Wt(t){let e,n=t[9]+"",s;return{c(){e=h("li"),s=L(n)},m(i,o){E(i,e,o),c(e,s)},p(i,o){o&2&&n!==(n=i[9]+"")&&Y(s,n)},d(i){i&&S(e)}}}function qt(t){let e,n=t[6]&&jt(t);return{c(){n&&n.c(),e=we()},m(s,i){n&&n.m(s,i),E(s,e,i)},p(s,i){s[6]?n?n.p(s,i):(n=jt(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(s){n&&n.d(s),s&&S(e)}}}function Gt(t){let e,n,s=t[3].id+"",i,o,l,a,r=t[3].chain&&Ht(t);return{c(){e=h("li"),n=h("h1"),i=L(s),o=F(),l=h("ul"),r&&r.c(),a=F(),m(n,"class","svelte-ylgkgj"),m(l,"class","chain-list svelte-ylgkgj"),m(e,"class","chain svelte-ylgkgj")},m(u,f){E(u,e,f),c(e,n),c(n,i),c(e,o),c(e,l),r&&r.m(l,null),c(e,a)},p(u,f){f&2&&s!==(s=u[3].id+"")&&Y(i,s),u[3].chain?r?r.p(u,f):(r=Ht(u),r.c(),r.m(l,null)):r&&(r.d(1),r=null)},d(u){u&&S(e),r&&r.d()}}}function Ni(t){let e,n,s=t[0]&&Ft(t);return{c(){e=h("div"),n=h("ul"),s&&s.c(),m(n,"class","nodes svelte-ylgkgj"),en(e,"overflow","auto")},m(i,o){E(i,e,o),c(e,n),s&&s.m(n,null)},p(i,[o]){i[0]?s?s.p(i,o):(s=Ft(i),s.c(),s.m(n,null)):s&&(s.d(1),s=null)},i:K,o:K,d(i){i&&S(e),s&&s.d()}}}const Ut=t=>t.type==="node";function Pi(t,e,n){let s,i=K,o=()=>(i(),i=de(a,r=>n(1,s=r)),a);t.$$.on_destroy.push(()=>i());let{configStore:l}=e,{stateStore:a}=e;return o(),t.$$set=r=>{"configStore"in r&&n(2,l=r.configStore),"stateStore"in r&&o(n(0,a=r.stateStore))},[a,s,l]}class Ci extends fe{constructor(e){super(),ce(this,e,Pi,Ni,ae,{configStore:2,stateStore:0})}}const Ai="Bitcoin/Proof-of-Work",gn="bitcoin_pow",Mi={seqPaintingOptions:fi,nodePaintingOptions:di,paintState:hi},Li={Configuration:gi,Actions:Ii,StateGraph:Ci};var Ri=Object.freeze(Object.defineProperty({__proto__:null,title:Ai,key:gn,drawing:Mi,components:Li,setupNode:an,generateState:ui,defaultConfig:ci},Symbol.toStringTag,{value:"Module"}));const Ie={[pn]:ai,[gn]:Ri};function Di(t=Ie.paxos){let e=X({},ln);e=X(X({},e),t&&t.defaultConfig?t.defaultConfig:hn);const n=je(e);n.subscribe(a=>{e=a});const s=t&&t.generateState?t.generateState:dn,i=je(s(e));i.subscribe(a=>{});const o=je(null);o.subscribe(a=>{});const l=Fi(t,e,i,o,n);return n.subscribe(l),l(e),[n,i,o]}function Fi(t,e,n,s,i){let o=null;return l=>{if(o&&o.key===l.algorithm&&o.useWorkers===l.useWorkers)return o=l,l;if(o=l,t.key!==l.algorithm){t=Ie[l.algorithm],t||console.error("algorithm not supported");const a={};Object.keys(ln).forEach(r=>{a[r]=l[r]}),l=X(X({},a),t.defaultConfig)}return _n(t,l,n,s,i),l}}function _n(t,e,n,s,i){const o=()=>()=>_n(t,e,n,s,i),a=t.generateState(e);n.update(()=>a);const[r,u]=Ds(zt(e,i),zt(a,n),o());return s.update(f=>(f&&f.simulation&&f.simulation.terminate(),u)),a}function zt(t,e){let n=t;return e.subscribe(s=>n=s),{value:n,update:e.update}}function Hi(t){let e,n,s,i;return{c(){e=h("span"),n=L("Layout '"),s=L(t[0]),i=L("' not supported")},m(o,l){E(o,e,l),c(e,n),c(e,s),c(e,i)},p(o,l){l&1&&Y(s,o[0])},i:K,o:K,d(o){o&&S(e)}}}function ji(t){let e,n;const s=[t[1]];let i={};for(let o=0;o<s.length;o+=1)i=Ae(i,s[o]);return e=new fs({props:i}),{c(){oe(e.$$.fragment)},m(o,l){se(e,o,l),n=!0},p(o,l){const a=l&2?Be(s,[We(o[1])]):{};e.$set(a)},i(o){n||($(e.$$.fragment,o),n=!0)},o(o){V(e.$$.fragment,o),n=!1},d(o){ie(e,o)}}}function Bi(t){let e,n,s,i;const o=[ji,Hi],l=[];function a(r,u){return r[0]==="full"?0:1}return e=a(t),n=l[e]=o[e](t),{c(){n.c(),s=we()},m(r,u){l[e].m(r,u),E(r,s,u),i=!0},p(r,[u]){let f=e;e=a(r),e===f?l[e].p(r,u):(pe(),V(l[f],1,1,()=>{l[f]=null}),me(),n=l[e],n?n.p(r,u):(n=l[e]=o[e](r),n.c()),$(n,1),n.m(s.parentNode,s))},i(r){i||($(n),i=!0)},o(r){V(n),i=!1},d(r){l[e].d(r),r&&S(s)}}}function Wi(t,e,n){let{layout:s="full"}=e,{registerAlgorithm:i}=e,{unregisterAlgorithm:o}=e;const[l,a,r]=Di();let u,f;l.subscribe(p=>{u=Ie[p.algorithm],u.labels}),a.subscribe(p=>{window.states||(window.stateIdx=-1,window.states=[]);const{nodes:_,messages:g}=p;window.stateIdx+=1,window.states.push({nodes:_,messages:g})}),r.subscribe(p=>{f=p}),Ue(()=>{i&&i(l,a)}),xe(()=>{o&&o(l,a),f&&f.simulation.terminate()});const d={configStore:l,stateStore:a,controlsStore:r,algorithm:u,algorithms:Ie};return t.$$set=p=>{"layout"in p&&n(0,s=p.layout),"registerAlgorithm"in p&&n(2,i=p.registerAlgorithm),"unregisterAlgorithm"in p&&n(3,o=p.unregisterAlgorithm)},[s,d,i,o]}class qi extends fe{constructor(e){super(),ce(this,e,Wi,Bi,ae,{layout:0,registerAlgorithm:2,unregisterAlgorithm:3})}}function Gi(t){let e;return{c(){e=h("footer"),e.innerHTML=`<div class="content svelte-4jochn"><div class="brand svelte-4jochn"><img alt="logo" src="/favicon/android-icon-48x48.png" class="svelte-4jochn"/><span class="svelte-4jochn">Visual Consensus</span></div> 
        <div class="links svelte-4jochn"><p>Links</p> 
            <a href="https://github.com/jojahn/visual-consensus" class="svelte-4jochn">Source Code</a> 
            <a href="https://github.com/jojahn/visual-consensus/blob/main/latex/thesis.pdf" class="svelte-4jochn">Thesis</a> 
            <a href="about.html#ThirdPartyLicenses" class="svelte-4jochn">Third Party Licenses</a></div></div> 
    <div><p class="rights svelte-4jochn">Licensed under <a href="https://github.com/jojahn/visual-consensus/LICENSE" class="svelte-4jochn">MIT</a></p> 
        <p class="rights svelte-4jochn">2022 <a href="https://github.com/jojahn/visual-consensus/graphs/contributors" class="svelte-4jochn">contributers</a></p></div>`,m(e,"class","svelte-4jochn")},m(n,s){E(n,e,s)},p:K,i:K,o:K,d(n){n&&S(e)}}}class Ui extends fe{constructor(e){super(),ce(this,e,null,Gi,ae,{})}}function Xt(t,e,n){const s=t.slice();return s[5]=e[n],s}function Kt(t){let e,n,s=t[5].title+"",i,o,l,a;return{c(){e=h("li"),n=h("button"),i=L(s),m(n,"class","svelte-1slpat4"),m(e,"class",o=be(t[0]===t[5].key?"active":"")+" svelte-1slpat4")},m(r,u){E(r,e,u),c(e,n),c(n,i),l||(a=Q(n,"click",t[1](t[5].key)),l=!0)},p(r,u){t=r,u&1&&o!==(o=be(t[0]===t[5].key?"active":"")+" svelte-1slpat4")&&m(e,"class",o)},d(r){r&&S(e),l=!1,a()}}}function zi(t){let e,n,s,i,o,l=Object.values(Ie),a=[];for(let r=0;r<l.length;r+=1)a[r]=Kt(Xt(t,l,r));return{c(){e=h("header"),n=h("nav"),s=h("ul");for(let r=0;r<a.length;r+=1)a[r].c();i=F(),o=h("li"),o.innerHTML='<a href="/about.html" class="svelte-1slpat4">About</a>',m(o,"class","svelte-1slpat4"),m(s,"class","svelte-1slpat4"),m(n,"class","svelte-1slpat4"),m(e,"class","svelte-1slpat4")},m(r,u){E(r,e,u),c(e,n),c(n,s);for(let f=0;f<a.length;f+=1)a[f].m(s,null);c(s,i),c(s,o)},p(r,[u]){if(u&3){l=Object.values(Ie);let f;for(f=0;f<l.length;f+=1){const d=Xt(r,l,f);a[f]?a[f].p(d,u):(a[f]=Kt(d),a[f].c(),a[f].m(s,i))}for(;f<a.length;f+=1)a[f].d(1);a.length=l.length}},i:K,o:K,d(r){r&&S(e),ve(a,r)}}}function Xi(t,e,n){let{selectedAlgorithm:s}=e,{changeAlgorithm:i}=e,{share:o}=e;const l=a=>()=>i(a);return t.$$set=a=>{"selectedAlgorithm"in a&&n(0,s=a.selectedAlgorithm),"changeAlgorithm"in a&&n(2,i=a.changeAlgorithm),"share"in a&&n(3,o=a.share)},[s,l,i,o]}class Ki extends fe{constructor(e){super(),ce(this,e,Xi,zi,ae,{selectedAlgorithm:0,changeAlgorithm:2,share:3})}}var bn={};(function(t){(function(e){e([],function(){var n=-1,s=-2,i=-3,o=-4,l=-5,a=function(g,v){v=v||{};var O=v.verbose||!1;O&&console.log("Normalize the JSON Object"),g=typeof g=="string"?this.JSON.parse(g):g,O&&console.log("Creating a empty dictionary");var b={strings:[],integers:[],floats:[]};O&&console.log("Creating the AST");var T=function R(P){O&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(P));var M=typeof P;if(P===null)return{type:"null",index:i};if(typeof P=="undefined")return{type:"undefined",index:l};if(P instanceof Array){var y=["@"];for(var D in P)!P.hasOwnProperty(D)||y.push(R(P[D]));return y}if(M==="object"){var y=["$"];for(var k in P)!P.hasOwnProperty(k)||(y.push(R(k)),y.push(R(P[k])));return y}if(P==="")return{type:"empty",index:o};if(M==="string"){var I=_.call(b.strings,P);return I==-1&&(b.strings.push(u(P)),I=b.strings.length-1),{type:"strings",index:I}}if(M==="number"&&P%1===0){var I=_.call(b.integers,P);return I==-1&&(b.integers.push(d(P)),I=b.integers.length-1),{type:"integers",index:I}}if(M==="number"){var I=_.call(b.floats,P);return I==-1&&(b.floats.push(P),I=b.floats.length-1),{type:"floats",index:I}}if(M==="boolean")return{type:"boolean",index:P?n:s};throw new Error("Unexpected argument of type "+typeof P)}(g),j=b.strings.length,W=b.integers.length;b.floats.length,O&&console.log("Parsing the dictionary");var z=b.strings.join("|");return z+="^"+b.integers.join("|"),z+="^"+b.floats.join("|"),O&&console.log("Parsing the structure"),z+="^"+function R(P){if(O&&console.log("Calling a recursiveParser with "+this.JSON.stringify(P)),P instanceof Array){var M=P.shift();for(var y in P)!P.hasOwnProperty(y)||(M+=R(P[y])+"|");return(M[M.length-1]==="|"?M.slice(0,-1):M)+"]"}var D=P.type,k=P.index;if(D==="strings")return d(k);if(D==="integers")return d(j+k);if(D==="floats")return d(j+W+k);if(D==="boolean")return P.index;if(D==="null")return i;if(D==="undefined")return l;if(D==="empty")return o;throw new TypeError("The item is alien!")}(T),O&&console.log("Ending parser"),v.debug?{dictionary:b,ast:T,packed:z}:z},r=function(g,v){v=v||{};var O=g.split("^");v.verbose&&console.log("Building dictionary");var b=[],T=O[0];if(T!==""){T=T.split("|"),v.verbose&&console.log("Parse the strings dictionary");for(var j=0,W=T.length;j<W;j++)b.push(f(T[j]))}if(T=O[1],T!==""){T=T.split("|"),v.verbose&&console.log("Parse the integers dictionary");for(var j=0,W=T.length;j<W;j++)b.push(p(T[j]))}if(T=O[2],T!==""){T=T.split("|"),v.verbose&&console.log("Parse the floats dictionary");for(var j=0,W=T.length;j<W;j++)b.push(parseFloat(T[j]))}T=null,v.verbose&&console.log("Tokenizing the structure");for(var z="",R=[],P=O[3].length,j=0;j<P;j++){var M=O[3].charAt(j);M==="|"||M==="$"||M==="@"||M==="]"?(z&&(R.push(p(z)),z=""),M!=="|"&&R.push(M)):z+=M}var y=R.length,D=0;return v.verbose&&console.log("Starting recursive parser"),function k(){var I=R[D++];if(v.verbose&&console.log("Reading collection type "+(I==="$"?"object":"Array")),I==="@"){for(var A=[];D<y;D++){var C=R[D];if(v.verbose&&console.log("Read "+C+" symbol"),C==="]")return A;if(C==="@"||C==="$")A.push(k());else switch(C){case n:A.push(!0);break;case s:A.push(!1);break;case i:A.push(null);break;case l:A.push(void 0);break;case o:A.push("");break;default:A.push(b[C])}}return v.verbose&&console.log("Parsed "+this.JSON.stringify(A)),A}if(I==="$"){for(var A={};D<y;D++){var B=R[D];if(B==="]")return A;B===o?B="":B=b[B];var C=R[++D];if(C==="@"||C==="$")A[B]=k();else switch(C){case n:A[B]=!0;break;case s:A[B]=!1;break;case i:A[B]=null;break;case l:A[B]=void 0;break;case o:A[B]="";break;default:A[B]=b[C]}}return v.verbose&&console.log("Parsed "+this.JSON.stringify(A)),A}throw new TypeError("Bad token "+I+" isn't a type")}()},u=function(g){return typeof g!="string"?g:g.replace(/[\+ \|\^\%]/g,function(v){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[v]})},f=function(g){return typeof g!="string"?g:g.replace(/\+|%2B|%7C|%5E|%25/g,function(v){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[v]})},d=function(g){return Number.prototype.toString.call(g,36).toUpperCase()},p=function(g){return parseInt(g,36)},_=Array.prototype.indexOf||function(g,v){for(var O=v||0,b=this.length;O<b;O++)if(this[O]===g)return O;return-1};return{JSON,pack:a,unpack:r}})})(function(e,n){var s=n();for(var i in s)t[i]=s[i]})})(bn);function Jt(t){let e=t;return e=bn.pack(t),e=window.btoa?btoa(e):e,e}function Ji(t,e){const n=Jt(t),s=Jt(e),i="/?config="+n+"&state="+s;Qi(),navigator.clipboard.writeText(location.origin+i)}function Qi(t){const e="Visual Consensus",n={additionalInformation:"URL"};window.history.pushState(n,e,t)}function Yi(t){let e;return{c(){e=h("span"),e.textContent="Layout not supported!"},m(n,s){E(n,e,s)},p:K,i:K,o:K,d(n){n&&S(e)}}}function $i(t){let e,n;return e=new qi({props:{registerAlgorithm:t[4],unregisterAlgorithm:t[5],layout:vn}}),{c(){oe(e.$$.fragment)},m(s,i){se(e,s,i),n=!0},p:K,i(s){n||($(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){ie(e,s)}}}function Vi(t){let e,n,s,i,o,l,a,r,u,f=!1;s=new Ki({props:{layout:vn,changeAlgorithm:t[3],selectedAlgorithm:t[1],share:t[2]}});const d=[$i,Yi],p=[];function _(g,v){return 0}return o=_(),l=p[o]=d[o](t),r=new Ui({}),{c(){e=h("main"),n=F(),oe(s.$$.fragment),i=F(),l.c(),a=F(),oe(r.$$.fragment)},m(g,v){E(g,e,v),c(e,n),se(s,e,null),c(e,i),p[o].m(e,null),c(e,a),se(r,e,null),u=!0},p(g,[v]){const O={};v&2&&(O.selectedAlgorithm=g[1]),s.$set(O),l.p(g,v)},i(g){u||($(f),$(s.$$.fragment,g),$(l),$(r.$$.fragment,g),u=!0)},o(g){V(f),V(s.$$.fragment,g),V(l),V(r.$$.fragment,g),u=!1},d(g){g&&S(e),ie(s),p[o].d(),ie(r)}}}let vn="full";function Zi(t,e,n){let s=[],i="paxos";function o(){s&&s[0]&&Ji(s[0])}function l(u){n(1,i=u),s&&s[0]&&s[0].config.update(f=>x(X({},f),{algorithm:u}))}function a(u,f){s.push({config:u,state:f})}function r(u,f){n(0,s=s.filter(d=>d.config!==u&&d.state&&f))}return[s,i,o,l,a,r]}class xi extends fe{constructor(e){super(),ce(this,e,Zi,Vi,ae,{})}}new xi({target:document.getElementById("app")});export{tl as __vite_legacy_guard};
