!function(){var e=document.createElement("style");e.innerHTML=".input-group.svelte-1yd6c5a>.svelte-1yd6c5a{display:block}.full-layout.svelte-1yd6c5a.svelte-1yd6c5a{width:100%;padding:10px;display:flex;justify-content:center}.full-layout.svelte-1yd6c5a>.svelte-1yd6c5a{margin-right:10px}.canvas-wrapper.svelte-h6pvzl .controls-section.svelte-h6pvzl{margin:10px;position:absolute;padding:2px 8px;display:flex}.help.svelte-h6pvzl.svelte-h6pvzl{padding:2px 8px;margin-top:-30px;font-size:.6rem;display:flex;flex-direction:column;user-select:none;width:max-content}.canvas-wrapper.svelte-h6pvzl .controls-section p.svelte-h6pvzl:not(.fps-counter-badge){margin:0;padding:0}.fps-counter-badge.svelte-h6pvzl.svelte-h6pvzl{width:max-content;background-color:#0072ff;padding:2px 8px;border-radius:5rem;color:#fff;margin:0}.canvas-wrapper.svelte-h6pvzl.svelte-h6pvzl{border:1px solid #eee;border-radius:.3rem;padding:0;overflow:hidden;max-height:100vh;min-height:200px;height:calc(100% - 30px)}.canvas-wrapper.svelte-h6pvzl canvas.svelte-h6pvzl{min-width:100px;min-height:100px;margin-top:20px;cursor:default!important}canvas.movable.svelte-h6pvzl.svelte-h6pvzl{cursor:grab!important}canvas.moving.svelte-h6pvzl.svelte-h6pvzl{cursor:grabbing!important}canvas.clickable.svelte-h6pvzl.svelte-h6pvzl{cursor:pointer!important}.anim-controls.svelte-air56o.svelte-air56o{margin:10px 0;display:flex;justify-content:center;user-select:none}.anim-controls.svelte-air56o>.svelte-air56o{margin:0 3px}button.svelte-air56o.svelte-air56o{cursor:pointer}.property-list.svelte-1ctl6hp.svelte-1ctl6hp.svelte-1ctl6hp{list-style-type:none;margin:0;padding:0}.property-list.svelte-1ctl6hp>li.svelte-1ctl6hp.svelte-1ctl6hp{color:#ff4500}.property-list.svelte-1ctl6hp>li.svelte-1ctl6hp>span.svelte-1ctl6hp{color:#5f9ea0}.node-info.svelte-1yqfw3u.svelte-1yqfw3u{display:flex;padding:4px;flex-direction:column;background-color:wheat;position:absolute;top:0;left:0;font-size:1rem}.node-info.svelte-1yqfw3u>.svelte-1yqfw3u:last-child{font-size:.75rem}.actions-panel.svelte-1y74lh9.svelte-1y74lh9{width:calc(25% - 10px);margin:10px;background-color:rgba(244,151,164,.22);padding:10px;overflow-x:auto;overflow-y:scroll}h1.svelte-1y74lh9.svelte-1y74lh9{margin-top:0;margin-bottom:10px;font-size:1rem}.graph-panel.svelte-1y74lh9.svelte-1y74lh9{display:flex;flex-direction:column;overflow:hidden;width:37.5%;margin:0 10px}.full-algorithm.svelte-1y74lh9.svelte-1y74lh9{display:flex;flex-direction:column;max-width:100vw;overflow-y:hidden;overflow-x:hidden}.canvas-section.svelte-1y74lh9.svelte-1y74lh9{z-index:9999;display:flex;justify-content:space-between;overflow:hidden;padding:10px;min-height:40vh;height:40vh}.config-section.svelte-1y74lh9.svelte-1y74lh9{color:#222;background-color:#fff;display:flex;justify-content:space-around}.controls-section.svelte-1y74lh9.svelte-1y74lh9{background-color:#ddd}.state-section.svelte-1y74lh9.svelte-1y74lh9{display:flex;flex-direction:column;overflow:hidden;margin-bottom:10px;height:32vh;padding:0 20px}@media screen and (max-width: 680px){.canvas-section.svelte-1y74lh9.svelte-1y74lh9{flex-direction:column;height:max-content}.canvas-section.svelte-1y74lh9>.svelte-1y74lh9{width:100%;height:100vh}}.property-list.svelte-1muk73i.svelte-1muk73i.svelte-1muk73i{list-style-type:none;margin:0;padding:0}.property-list.svelte-1muk73i>li.svelte-1muk73i.svelte-1muk73i{color:#ff4500}.property-list.svelte-1muk73i>li.svelte-1muk73i>span.svelte-1muk73i{color:#5f9ea0}ul.svelte-1o1yvcd.svelte-1o1yvcd{list-style-type:none;margin:0;padding:0;display:flex;overflow:auto}.nodes.svelte-1o1yvcd.svelte-1o1yvcd{flex-direction:column}.log.svelte-1o1yvcd.svelte-1o1yvcd{display:flex;margin:10px}.log.svelte-1o1yvcd>h1.svelte-1o1yvcd{margin:0 10px 0 0;line-height:30px}.entry.svelte-1o1yvcd.svelte-1o1yvcd{border:1px solid black;padding:5px}.entry.svelte-1o1yvcd.svelte-1o1yvcd:not(:first-child){border-left:none}.selected.svelte-1o1yvcd.svelte-1o1yvcd{box-shadow:0 0 0 5px #f497a4}ul.block.svelte-cd4rqg,.property-list.svelte-1gcbars.svelte-1gcbars.svelte-1gcbars{list-style-type:none;margin:0;padding:0}.property-list.svelte-1gcbars li.svelte-1gcbars.svelte-1gcbars{color:#ff4500}.property-list.svelte-1gcbars li.svelte-1gcbars>span.svelte-1gcbars{color:#5f9ea0}.property-list.entries.svelte-1gcbars.svelte-1gcbars.svelte-1gcbars{list-style-type:disc}ul.svelte-ylgkgj.svelte-ylgkgj{list-style-type:none;margin:0;padding:0;display:flex;overflow:auto}ul.chain-list.svelte-ylgkgj.svelte-ylgkgj{overflow:visible}.nodes.svelte-ylgkgj.svelte-ylgkgj{flex-direction:column}.chain.svelte-ylgkgj.svelte-ylgkgj{display:flex;margin:10px}.chain.svelte-ylgkgj>h1.svelte-ylgkgj{margin:0 10px 0 0;line-height:30px}.block.svelte-ylgkgj.svelte-ylgkgj{border:1px solid black;padding:5px}.block.svelte-ylgkgj>p.svelte-ylgkgj{padding:0;margin:0}.selected.svelte-ylgkgj.svelte-ylgkgj{box-shadow:0 0 0 5px #f497a4}.transactions.svelte-ylgkgj.svelte-ylgkgj{list-style-type:disc!important;padding-left:20px}.arrow.svelte-ylgkgj.svelte-ylgkgj{font-size:2rem;padding:0;font-weight:lighter;font-family:courier,serif;margin:auto 10px}footer.svelte-4jochn.svelte-4jochn{padding:10px 0;top:100vh;background-color:#ddd;width:100%;overflow:hidden;display:flex;flex-direction:column}.content.svelte-4jochn.svelte-4jochn{max-width:60vw;min-width:300px;width:100%;display:flex;justify-content:space-evenly;flex-direction:row;margin:auto auto 20px}.links.svelte-4jochn.svelte-4jochn{display:flex;flex-direction:column}a.svelte-4jochn.svelte-4jochn{text-decoration:none;border-bottom:.1rem dotted blue;width:max-content}.rights.svelte-4jochn.svelte-4jochn{margin:0;padding:0;color:#888;text-align:center}.brand.svelte-4jochn.svelte-4jochn{display:flex}.brand.svelte-4jochn>span.svelte-4jochn{display:block;line-height:48px;padding-left:10px}.brand.svelte-4jochn>img.svelte-4jochn{width:48px;height:48px}header.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4{padding-left:20px;height:50px;background-color:#222;border-bottom:1px solid #ddd}header.svelte-1slpat4 .svelte-1slpat4.svelte-1slpat4{color:#ddd!important}nav.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4{height:100%}nav.svelte-1slpat4>ul.svelte-1slpat4.svelte-1slpat4{list-style-type:none;margin:0;padding:0;display:flex;height:100%}nav.svelte-1slpat4>ul.svelte-1slpat4>li.svelte-1slpat4{margin:auto 0}a.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4{text-decoration:none}button.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4,a.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4{font-size:1rem;padding:0 10px;border:none;height:35px;cursor:pointer;background-color:transparent;opacity:.5}.active.svelte-1slpat4 button.svelte-1slpat4.svelte-1slpat4{opacity:1}.performance-graph.svelte-14wi5xo{position:fixed;top:5px;right:5px;background-color:#fff;padding:5px;z-index:999999;border:1px solid}p.svelte-14wi5xo{margin:0}span.svelte-14wi5xo{font-weight:700}span.hide-btn.svelte-14wi5xo{padding:0 8px;margin-left:10px;background-color:#000;color:#fff;cursor:pointer;font-weight:400;user-select:none;display:block;float:right}:root{font-family:Helvetica Neue,Helvetica,Arial,sans-serif}body{margin:0;padding:0}\n",document.head.appendChild(e),System.register([],(function(){"use strict";return{execute:function(){function e(){}function t(e,t){for(const n in t)e[n]=t[n];return e}function n(e){return e()}function s(){return Object.create(null)}function o(e){e.forEach(n)}function i(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(t,...n){if(null==t)return e;const s=t.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}function a(e,t,n,s){if(e){const o=c(e,t,n,s);return e[0](o)}}function c(e,n,s,o){return e[1]&&o?t(s.ctx.slice(),e[1](o(n))):s.ctx}function d(e,t,n,s){if(e[2]&&s){const o=e[2](s(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|o[s];return e}return t.dirty|o}return t.dirty}function u(e,t,n,s,o,i){if(o){const r=c(t,n,s,i);e.p(r,o)}}function p(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function h(e){return null==e?"":e}function f(e,t){e.appendChild(t)}function m(e,t,n){e.insertBefore(t,n||null)}function g(e){e.parentNode.removeChild(e)}function v(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function y(e){return document.createElement(e)}function b(e){return document.createTextNode(e)}function w(){return b(" ")}function k(){return b("")}function x(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function E(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function $(e){return""===e?null:+e}function S(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function T(e,t){e.value=null==t?"":t}function O(e,t,n,s){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,s?"important":"")}let I;function N(e){I=e}function C(){if(!I)throw new Error("Function called outside component initialization");return I}function P(e){C().$$.on_mount.push(e)}function A(e){C().$$.after_update.push(e)}function M(e){C().$$.on_destroy.push(e)}const L=[],j=[],R=[],D=[],_=Promise.resolve();let H=!1;function F(e){R.push(e)}const z=new Set;let B=0;function W(){const e=I;do{for(;B<L.length;){const e=L[B];B++,N(e),q(e.$$)}for(N(null),L.length=0,B=0;j.length;)j.pop()();for(let e=0;e<R.length;e+=1){const t=R[e];z.has(t)||(z.add(t),t())}R.length=0}while(L.length);for(;D.length;)D.pop()();H=!1,z.clear(),N(e)}function q(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(F)}}const U=new Set;let G;function X(){G={r:0,c:[],p:G}}function J(){G.r||o(G.c),G=G.p}function Q(e,t){e&&e.i&&(U.delete(e),e.i(t))}function K(e,t,n,s){if(e&&e.o){if(U.has(e))return;U.add(e),G.c.push((()=>{U.delete(e),s&&(n&&e.d(1),s())})),e.o(t)}else s&&s()}function Y(e,t){const n={},s={},o={$$scope:1};let i=e.length;for(;i--;){const r=e[i],l=t[i];if(l){for(const e in r)e in l||(s[e]=1);for(const e in l)o[e]||(n[e]=l[e],o[e]=1);e[i]=l}else for(const e in r)o[e]=1}for(const r in s)r in n||(n[r]=void 0);return n}function V(e){return"object"==typeof e&&null!==e?e:{}}function Z(e){e&&e.c()}function ee(e,t,s,r){const{fragment:l,on_mount:a,on_destroy:c,after_update:d}=e.$$;l&&l.m(t,s),r||F((()=>{const t=a.map(n).filter(i);c?c.push(...t):o(t),e.$$.on_mount=[]})),d.forEach(F)}function te(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ne(e,t){-1===e.$$.dirty[0]&&(L.push(e),H||(H=!0,_.then(W)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function se(t,n,i,r,l,a,c,d=[-1]){const u=I;N(t);const p=t.$$={fragment:null,ctx:null,props:a,update:e,not_equal:l,bound:s(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(u?u.$$.context:[])),callbacks:s(),dirty:d,skip_bound:!1,root:n.target||u.$$.root};c&&c(p.root);let h=!1;if(p.ctx=i?i(t,n.props||{},((e,n,...s)=>{const o=s.length?s[0]:n;return p.ctx&&l(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),h&&ne(t,e)),n})):[],p.update(),h=!0,o(p.before_update),p.fragment=!!r&&r(p.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);p.fragment&&p.fragment.l(e),e.forEach(g)}else p.fragment&&p.fragment.c();n.intro&&Q(t.$$.fragment),ee(t,n.target,n.anchor,n.customElement),W()}N(u)}class oe{$destroy(){te(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ie=e=>({config:1&e}),re=e=>({config:e[0]});function le(e){let t,n,s,i,r,l,c,v,b,k,S,O,I,N,C,P,A,M,L,j,R,D,_,H,F,z,B;const W=e[5]["algorithm-config"],q=a(W,e,e[4],re);return{c(){t=y("form"),n=y("div"),s=y("div"),i=y("label"),i.textContent="Network Delay",r=w(),l=y("div"),c=y("input"),v=w(),b=y("span"),b.textContent="ms",k=w(),S=y("div"),O=y("label"),O.textContent="Command Delay",I=w(),N=y("div"),C=y("input"),P=w(),A=y("span"),A.textContent="ms",M=w(),L=y("div"),j=y("label"),j.textContent="Use WebWorkers",R=w(),D=y("input"),_=w(),q&&q.c(),E(i,"for","NetworkDelayInput"),E(i,"class","svelte-1yd6c5a"),E(c,"id","NetworkDelayInput"),E(c,"type","number"),E(c,"min","0"),E(c,"max","60000"),E(l,"class","svelte-1yd6c5a"),E(s,"class","input-group svelte-1yd6c5a"),E(O,"for","CommandDelayInput"),E(O,"class","svelte-1yd6c5a"),E(C,"id","CommandDelayInput"),E(C,"type","number"),E(C,"min","0"),E(C,"max","60000"),E(N,"class","svelte-1yd6c5a"),E(S,"class","input-group svelte-1yd6c5a"),E(j,"for","UseWebWorkersInput"),E(j,"class","svelte-1yd6c5a"),E(D,"id","UseWebWorkersInput"),D.disabled=!0,E(D,"type","checkbox"),E(D,"class","svelte-1yd6c5a"),E(L,"class","input-group svelte-1yd6c5a"),E(n,"class","options svelte-1yd6c5a"),E(t,"class",H=h((e[1]," full-layout"))+" svelte-1yd6c5a")},m(o,a){m(o,t,a),f(t,n),f(n,s),f(s,i),f(s,r),f(s,l),f(l,c),T(c,e[2].networkDelay),f(l,v),f(l,b),f(n,k),f(n,S),f(S,O),f(S,I),f(S,N),f(N,C),T(C,e[2].commandDelay),f(N,P),f(N,A),f(n,M),f(n,L),f(L,j),f(L,R),f(L,D),D.checked=e[2].useWorkers,f(t,_),q&&q.m(t,null),F=!0,z||(B=[x(c,"input",e[6]),x(C,"input",e[7]),x(D,"change",e[8]),x(t,"submit",e[3])],z=!0)},p(e,[n]){4&n&&$(c.value)!==e[2].networkDelay&&T(c,e[2].networkDelay),4&n&&$(C.value)!==e[2].commandDelay&&T(C,e[2].commandDelay),4&n&&(D.checked=e[2].useWorkers),q&&q.p&&(!F||17&n)&&u(q,W,e,e[4],F?d(W,e[4],n,ie):p(e[4]),re),(!F||2&n&&H!==(H=h((e[1]," full-layout"))+" svelte-1yd6c5a"))&&E(t,"class",H)},i(e){F||(Q(q,e),F=!0)},o(e){K(q,e),F=!1},d(e){e&&g(t),q&&q.d(e),z=!1,o(B)}}}function ae(t,n,s){let o,i=e,r=()=>(i(),i=l(d,(e=>s(2,o=e))),d);t.$$.on_destroy.push((()=>i()));let{$$slots:a={},$$scope:c}=n,{configStore:d}=n;r();let{fullLayout:u=!1}=n;return t.$$set=e=>{"configStore"in e&&r(s(0,d=e.configStore)),"fullLayout"in e&&s(1,u=e.fullLayout),"$$scope"in e&&s(4,c=e.$$scope)},[d,u,o,e=>{e.preventDefault()},c,a,function(){o.networkDelay=$(this.value),d.set(o)},function(){o.commandDelay=$(this.value),d.set(o)},function(){o.useWorkers=this.checked,d.set(o)}]}class ce extends oe{constructor(e){super(),se(this,e,ae,le,r,{configStore:0,fullLayout:1})}}const de=[];function ue(t,n=e){let s;const o=new Set;function i(e){if(r(t,e)&&(t=e,s)){const e=!de.length;for(const n of o)n[1](),de.push(n,t);if(e){for(let e=0;e<de.length;e+=2)de[e][0](de[e+1]);de.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(r,l=e){const a=[r,l];return o.add(a),1===o.size&&(s=n(i)||e),r(t),()=>{o.delete(a),0===o.size&&(s(),s=null)}}}}function pe(e,t){const n=new Date(e.sent).getTime(),s=new Date(t.sent).getTime();return n<s?-1:n>s?1:function(e,t){return e.id>t.id?-1:e.id<t.id?1:0}(e,t)}function he(e,t){return(n,s)=>{const o=n=>t(s,n)&&Math.abs(new Date(n.sent).getTime()-new Date(s.sent).getTime())<e,i=n.findIndex((e=>Array.isArray(e)?-1!==e.findIndex((e=>o(e))):o(e)));return-1!==i&&n[i]&&Array.isArray(n[i])?n[i].push(s):-1!==i&&i?n[i]=[n[i],s]:n.push(s),n}}const fe="#FA3",me="#000",ge="#F497A4",ve={nodeRadius:24,messageRadius:8,paintNodeText:e=>e.id,isLeader:()=>{},paintMessageText:()=>{},arrowLength:6};function ye(e,t,n,s=ve){if(e.save(),s={...ve,...s},!t)return[e.canvas.width,e.canvas.height];let o=0,i=0;return t.messages.filter((e=>!e.done&&e.pos)).forEach((n=>{e.beginPath();let s=t.nodes.filter((e=>e.id===n.fromId))[0].pos,o=t.nodes.filter((e=>e.id===n.toId))[0].pos;n.id===t.selectedElementId&&(e.lineWidth=4,e.strokeStyle=ge,e.moveTo(...s),e.lineTo(...o),e.stroke()),e.lineWidth=1,e.strokeStyle="#DDD",e.moveTo(...s),e.lineTo(...o),e.stroke(),e.closePath()})),t.messages.filter((e=>!e.done&&e.pos)).sort(pe).forEach((o=>{o.id===t.selectedElementId&&(e.beginPath(),e.fillStyle=ge,e.arc(o.pos[0],o.pos[1],s.messageRadius+5,0,2*Math.PI),e.fill(),e.closePath()),e.beginPath();const i=t.nodes.filter((e=>e.id===o.fromId))[0].pos,r=t.nodes.filter((e=>e.id===o.toId))[0].pos,l=Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2)),a=s.messageRadius+s.arrowLength,c=[o.pos[0]+a/l*(r[0]-i[0]),o.pos[1]+a/l*(r[1]-i[1])],d=[o.pos[0]+s.messageRadius/l*(i[0]-r[0]),o.pos[1]+s.messageRadius/l*(i[1]-r[1])],u=(e,t)=>{let n=[e[0]-o.pos[0],e[1]-o.pos[1]];return n=((e,t)=>[Math.cos(t)*e[0]-Math.sin(t)*e[1],Math.sin(t)*e[0]+Math.cos(t)*e[1]])(n,t),[n[0]+o.pos[0],n[1]+o.pos[1]]},p=u(d,Math.PI/2+.5),h=u(d,-Math.PI/2-.5);e.fillStyle=me,e.strokeStyle=me,e.moveTo(...p),e.lineTo(...c),e.lineTo(...h),e.stroke(),e.fill(),e.closePath(),e.beginPath(),e.lineWidth=2,e.strokeStyle=me,e.fillStyle=fe,e.arc(o.pos[0],o.pos[1],s.messageRadius,0,2*Math.PI),e.stroke(),e.fill(),e.isPointInPath(n.position[0],n.position[1])&&(e.canvas.style.setProperty("cursor","pointer","important"),-1===n.hits.map((e=>e.id)).indexOf(o.id)&&n.hits.push(o)),e.closePath()})),t.nodes.filter((e=>e&&e.pos&&e.id)).forEach((t=>{e.beginPath(),e.lineWidth=5,e.fillStyle="#ADD495",e.strokeStyle="#80B7A2",t.connected?s.isLeader(t)&&(e.fillStyle="#EE2",e.strokeStyle="#DD0"):(e.fillStyle="#DDD",e.strokeStyle="#AAA"),e.arc(t.pos[0],t.pos[1],s.nodeRadius,0,2*Math.PI),e.stroke(),o=Math.max(o,t.pos[0]),i=Math.max(i,t.pos[1]),e.fill(),e.isPointInPath(n.position[0],n.position[1])&&(e.canvas.style.setProperty("cursor","pointer","important"),-1===n.hits.map((e=>e.id)).indexOf(t.id)&&n.hits.push(t)),e.closePath(),s.paintNodeText(e,t),e.beginPath(),e.fillStyle="#FFF",t.connected?s.isLeader(t)&&(e.fillStyle="#000"):e.fillStyle="#000",e.font="bold 20px courier new",e.fillText(t.id,t.pos[0]-12,t.pos[1]+5),e.closePath()})),t.selectedElementId&&t.nodes.filter((e=>e.id===t.selectedElementId)).forEach((t=>{e.beginPath(),e.strokeStyle="#F497A4",e.lineWidth=5,e.arc(t.pos[0],t.pos[1],s.nodeRadius+5,0,2*Math.PI),e.stroke(),e.closePath()})),e.restore(),[o,i]}const be=e=>({offsetX:16&e[0],offsetY:32&e[0]}),we=e=>({hoveredElement:e[12],offsetX:e[4],offsetY:e[5]});function ke(t){let n;return{c(){n=y("p"),E(n,"class","svelte-h6pvzl")},m(e,t){m(e,n,t)},p:e,d(e){e&&g(n)}}}function xe(e){let t;return{c(){t=y("span"),t.textContent="unlock"},m(e,n){m(e,t,n)},d(e){e&&g(t)}}}function Ee(e){let t;return{c(){t=y("span"),t.textContent="lock"},m(e,n){m(e,t,n)},d(e){e&&g(t)}}}function $e(e){let t,n,s,i,r,l,c,v,k,$,T,O,I,N,C,P,A,M,L,j,R,D,_,H;let F=ke(e);function z(e,t){return e[7]?Ee:xe}let B=z(e),W=B(e);const q=e[28].hover,U=a(q,e,e[27],we);return{c(){t=y("div"),n=y("div"),F.c(),s=w(),i=y("button"),W.c(),r=w(),l=y("button"),l.textContent="Reset",c=w(),v=y("div"),k=y("button"),k.textContent="-",$=w(),T=y("p"),O=b(e[10]),I=b("x"),N=w(),C=y("button"),C.textContent="+",P=w(),A=y("canvas"),L=w(),U&&U.c(),j=w(),R=y("div"),R.innerHTML="<span>Pan: <kbd>LeftCtrl</kbd> + Hold <kbd>MouseLeft</kbd></span> \n    <span>Zoom: <kbd>LeftCtrl</kbd> + <kbd>MouseWheel</kbd></span>",E(T,"class","svelte-h6pvzl"),E(n,"class","controls-section svelte-h6pvzl"),E(A,"class",M=h(e[11].hoveredElement?"clickable":e[9]?"moving":e[7]&&e[8]?"movable":"")+" svelte-h6pvzl"),E(A,"id",e[0]),E(A,"width","640"),E(A,"height","480"),E(t,"class","canvas-wrapper svelte-h6pvzl"),E(R,"class","help svelte-h6pvzl")},m(o,a){m(o,t,a),f(t,n),F.m(n,null),f(n,s),f(n,i),W.m(i,null),f(n,r),f(n,l),f(n,c),f(n,v),f(v,k),f(v,$),f(v,T),f(T,O),f(T,I),f(v,N),f(v,C),f(t,P),f(t,A),e[31](A),f(t,L),U&&U.m(t,null),m(o,j,a),m(o,R,a),D=!0,_||(H=[x(i,"click",e[13]),x(l,"click",e[18]),x(k,"click",e[29]),x(C,"click",e[30]),x(A,"mousemove",e[16]),x(A,"mousedown",e[14]),x(A,"mouseup",e[15]),x(A,"mouseleave",e[17]),x(t,"drop",Te),x(t,"dragover",Oe)],_=!0)},p(e,t){F.p(e,t),B!==(B=z(e))&&(W.d(1),W=B(e),W&&(W.c(),W.m(i,null))),(!D||1024&t[0])&&S(O,e[10]),(!D||2944&t[0]&&M!==(M=h(e[11].hoveredElement?"clickable":e[9]?"moving":e[7]&&e[8]?"movable":"")+" svelte-h6pvzl"))&&E(A,"class",M),(!D||1&t[0])&&E(A,"id",e[0]),U&&U.p&&(!D||134217776&t[0])&&u(U,q,e,e[27],D?d(q,e[27],t,be):p(e[27]),we)},i(e){D||(Q(U,e),D=!0)},o(e){K(U,e),D=!1},d(n){n&&g(t),F.d(),W.d(),e[31](null),U&&U.d(n),n&&g(j),n&&g(R),_=!1,o(H)}}}function Se(e){return e.preventDefault(),e.stopPropagation(),!1}function Te(e){}function Oe(e){}function Ie(t,n,s){let o,i,r=e,a=()=>(r(),r=l(f,(e=>s(35,o=e))),f),c=e,d=()=>(c(),c=l(m,(e=>s(11,i=e))),m);t.$$.on_destroy.push((()=>r())),t.$$.on_destroy.push((()=>c()));let{$$slots:u={},$$scope:p}=n,{id:h}=n,{configStore:f}=n;a();let{stateStore:m}=n;d();let{paintFn:g=ye}=n,{minWidth:v=100}=n,{minHeight:y=100}=n,{paintOptions:b}=n,{onElementSelected:w=(e=>{})}=n,{onElementHovered:k=(e=>{})}=n,{onElementHoverEnd:x=(()=>{})}=n,E=ue(void 0);const $=e=>{E.update((t=>e)),k(e)},S=()=>{E.set(void 0),x()};function T(e){m.update((t=>({...t,selectedElementId:e.id}))),w(e),E.set(void 0)}let O,I=null,N=null,C=50,L=0,R=!0;let D=!1;function _(e){17===e.keyCode&&s(8,D=!0)}function H(e){17===e.keyCode&&s(8,D=!1)}const F=e=>m.update(e),z=()=>{I&&I.remove(),I=function(e,t,{subscribe:n},s=ye,o={autoAlign:"CENTER"},{onHover:i,onHoverEnd:r,onClick:l,updateState:a}={}){let c=1,d=[0,0],u=!1,p=null;n((e=>{p=e}));const h=e.getContext("2d",{alpha:!1});var f=e.getBoundingClientRect();e.width=1*f.width,e.height=1*f.height,h.scale(1,1);const m={hits:[],position:[0,0]},g=t=>{if(e.style.cursor="default",m.hits.length>0){const e=m.hits[0];i&&i(e)}else r&&r();let n=t.clientX+document.body.scrollLeft-e.offsetLeft,s=t.clientY+document.body.scrollTop-e.offsetTop;m.position=[n+window.scrollX,s+window.scrollY],m.hits=[]};e.addEventListener("mousemove",g);const v=()=>{if(m.hits[0]){let e=m.hits[0];p.selectedElementId=e.id,a&&a((t=>({...t,selectedElementId:e.id}))),l&&l(e)}};e.addEventListener("mousedown",v);let y={fps:0},b=[0,0],w=e.width,k=e.height,x=!1,E=!1;var $=[];return e.width!==e.parentElement.clientWidth&&(e.width=e.parentElement.clientWidth),function t(){"TOP_TO_BOTTOM"===o.autoAlign&&(e.height<e.parentElement.clientHeight&&(e.height=Math.max(k,e.parentElement.clientHeight)),x&&(x=!1,e.height=k,e.parentElement.style.overflowY="scroll",u||e.parentElement.scrollTo(0,e.parentElement.scrollHeight))),h.fillStyle="#FFF",h.fillRect(0,0,e.width,e.height),h.scale(c/1,c/1);let n=d[0],i=d[1];switch(o.autoAlign){case"TOP_TO_BOTTOM":n=d[0]+b[0]/2-w/2,i=10;break;case"CENTER":n=d[0]+b[0]/2-w/2,i=d[1]+b[1]/2-k/2}h.translate(n,i);const[r,l]=s(h,p,m,o);b=[e.width/2,e.height/2];const a=performance.now();for(;$.length>0&&$[0]<=a-1e3;)$.shift();$.push(a),y.fps=$.length,h.translate(-n,-i),h.scale(1/c,1/c),r!==w&&(w=r,x=!0),l!==k&&(k=l,x=!0),E||requestAnimationFrame(t)}(),{context:h,debugInfo:y,zoom:e=>{c=e||1,h.canvas.height*=c},pan:e=>{d=e},setLock:e=>{u=e},remove:()=>{E=!0,h.fillStyle="#FFF",h.fillRect(0,0,640,480),e.removeEventListener("mousedown",v),e.removeEventListener("mousemove",g)}}}(N,0,{subscribe:e=>m.subscribe(e)},g,b,{onHover:$,onHoverEnd:S,onClick:T,updateState:F}),q=[N.width/5,N.height/5],I.pan(q)};function B(){const e=document.getElementById(h),t=e.parentElement;e&&t&&(e.height=Math.max(y,t.clientHeight),e.width=Math.max(v,t.clientWidth))}let W=!1;let q=[0,0];let U=1;function G(e){R&&D&&(e.preventDefault(),e.stopPropagation(),s(10,U=X(-.001*e.deltaY)),I.zoom(U))}function X(e){return Math.round(10*Math.min(Math.max(.5,U+e),2))/10}P((()=>{const e=document.getElementById(h);s(4,O=e.offsetLeft),s(5,C=e.offsetTop),e.addEventListener("wheel",G,{passive:!1}),window.addEventListener("scroll",Se,!1),window.addEventListener("resize",B,!0),document.addEventListener("keydown",_),document.addEventListener("keyup",H),f.subscribe(z),B()}));let J=b;A((()=>{J!==b&&(z(),J=b)}));let Q=setInterval((()=>{s(6,L=I.debugInfo.fps)}),500);M((()=>{window.removeEventListener("resize",B),N.removeEventListener("wheel",G),window.removeEventListener("scroll",Se),document.removeEventListener("keydown",_),document.removeEventListener("keyup",H),I&&I.remove(),Q&&clearInterval(Q)}));return t.$$set=e=>{"id"in e&&s(0,h=e.id),"configStore"in e&&a(s(1,f=e.configStore)),"stateStore"in e&&d(s(2,m=e.stateStore)),"paintFn"in e&&s(20,g=e.paintFn),"minWidth"in e&&s(21,v=e.minWidth),"minHeight"in e&&s(22,y=e.minHeight),"paintOptions"in e&&s(23,b=e.paintOptions),"onElementSelected"in e&&s(24,w=e.onElementSelected),"onElementHovered"in e&&s(25,k=e.onElementHovered),"onElementHoverEnd"in e&&s(26,x=e.onElementHoverEnd),"$$scope"in e&&s(27,p=e.$$scope)},[h,f,m,N,O,C,L,R,D,W,U,i,E,function(){s(7,R=!R),I&&I.setLock(!R)},function(){R&&D&&s(9,W=!0)},function(){s(9,W=!1)},function(e){if(W&&R&&D){const t=1/U;q=[q[0]+t*e.movementX,"TOP_TO_BOTTOM"===b.autoAlign?0:q[1]+t*e.movementY],I.pan(q)}},function(){s(9,W=!1)},function(){s(10,U=1),I.zoom(U),q=[0,0],I.pan(q)},X,g,v,y,b,w,k,x,p,u,()=>X(-.1),()=>X(.1),function(e){j[e?"unshift":"push"]((()=>{N=e,s(3,N)}))}]}class Ne extends oe{constructor(e){super(),se(this,e,Ie,$e,r,{id:0,configStore:1,stateStore:2,paintFn:20,minWidth:21,minHeight:22,paintOptions:23,onElementSelected:24,onElementHovered:25,onElementHoverEnd:26},null,[-1,-1])}}function Ce(e){let t;return{c(){t=b("pause")},m(e,n){m(e,t,n)},d(e){e&&g(t)}}}function Pe(e){let t;return{c(){t=b("resume")},m(e,n){m(e,t,n)},d(e){e&&g(t)}}}function Ae(t){let n,s,r,l,a,c,d,u,p,h,v,k,$,T,O,I,N,C,P,A,M,L,j,R=t[2]*Me+"";function D(e,t){return e[1]?Pe:Ce}let _=D(t),H=_(t);return{c(){n=y("div"),s=y("button"),s.textContent="reset",r=w(),l=y("button"),a=b("step backwards"),d=w(),u=y("button"),H.c(),p=w(),h=y("button"),v=b("step forward"),$=w(),T=y("div"),O=y("label"),O.textContent="Speed",I=w(),N=y("input"),C=w(),P=y("span"),A=b(R),M=b("x"),E(s,"type","button"),E(s,"class","svelte-air56o"),E(l,"type","button"),l.disabled=c=!t[1],E(l,"class","svelte-air56o"),E(u,"type","button"),E(u,"class","svelte-air56o"),E(h,"type","button"),h.disabled=k=!t[1],E(h,"class","svelte-air56o"),E(O,"for","SpeedInput"),E(N,"id","SpeedInput"),E(N,"type","range"),E(N,"min","0"),E(N,"max",5/Me),N.value=t[2],E(T,"class","svelte-air56o"),E(n,"class","anim-controls svelte-air56o")},m(e,o){m(e,n,o),f(n,s),f(n,r),f(n,l),f(l,a),f(n,d),f(n,u),H.m(u,null),f(n,p),f(n,h),f(h,v),f(n,$),f(n,T),f(T,O),f(T,I),f(T,N),f(T,C),f(T,P),f(P,A),f(P,M),L||(j=[x(s,"click",(function(){i(t[0].reset)&&t[0].reset.apply(this,arguments)})),x(l,"click",(function(){i(t[0].stepBackwards)&&t[0].stepBackwards.apply(this,arguments)})),x(u,"click",(function(){i(t[0].pauseOrPlay)&&t[0].pauseOrPlay.apply(this,arguments)})),x(h,"click",(function(){i(t[0].stepForwards)&&t[0].stepForwards.apply(this,arguments)})),x(N,"change",t[3])],L=!0)},p(e,[n]){t=e,2&n&&c!==(c=!t[1])&&(l.disabled=c),_!==(_=D(t))&&(H.d(1),H=_(t),H&&(H.c(),H.m(u,null))),2&n&&k!==(k=!t[1])&&(h.disabled=k),4&n&&(N.value=t[2]),4&n&&R!==(R=t[2]*Me+"")&&S(A,R)},i:e,o:e,d(e){e&&g(n),H.d(),L=!1,o(j)}}}const Me=.25;function Le(e,t,n){let{stateStore:s}=t,{controls:o}=t,i=!1,r=1/Me;let l;return P((()=>{l=s.subscribe((e=>{e?(n(1,i=e.paused),n(2,r=e.speed/Me)):n(1,i=!0)}))})),M((()=>{l&&l()})),e.$$set=e=>{"stateStore"in e&&n(4,s=e.stateStore),"controls"in e&&n(0,o=e.controls)},[o,i,r,e=>{try{n(2,r=parseInt(e.target.value))}catch(t){console.error("Failed to parse speed")}o.setSpeed(r*Me)},s]}class je extends oe{constructor(e){super(),se(this,e,Le,Ae,r,{stateStore:4,controls:0})}}const Re={linePadding:50,initialLineLength:200,lengthPerTimeStep:10,groupOffset:30,messageOffset:8,maxMessageLength:30,maxMessageOffset:100,vertical:!1,autoAlign:"TOP_TO_BOTTOM",spaceBetweenBroadcasts:!1,getText:e=>e.type};function De(e,t,n,s=Re){if(s={...Re,...s},!t)return[e.canvas.width,e.canvas.height];s.internal={},s.internal.nodeToXMap={},t.nodes.forEach(((e,t)=>{s.internal.nodeToXMap[e.id]=10+t*s.linePadding,s.internal.furthestLineX=s.internal.nodeToXMap[e.id]}));return e.save(),s.internal.lastLineOffset=25,s.internal.maxWidth=s.internal.furthestLineX,t.messages.sort(pe).reduce(he(1e3,((e,t)=>s.getText(e)===s.getText(t)||void 0!==e.broadcastKey&&void 0!==t.broadcastKey&&e.broadcastKey===t.broadcastKey)),[]).forEach(_e(e,t,s)),e.restore(),e.save(),t.nodes.forEach(((n,o)=>{let i=10+o*s.linePadding;if(s.internal.nodeToXMap[n.id]=i,t.selectedElementId===n.id){e.beginPath(),e.lineWidth=10,e.strokeStyle=ge;let n=[s.internal.nodeToXMap[t.selectedElementId],25],o=[s.internal.nodeToXMap[t.selectedElementId],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(n=n.reverse(),o=o.reverse()),e.moveTo(...n),e.lineTo(...o),e.stroke(),e.closePath()}e.beginPath(),e.lineWidth=1,e.setLineDash(n.connected?[0]:[5,5]),e.strokeStyle=n.connected?"#000":"#AAA";let r=[s.internal.nodeToXMap[n.id],25],l=[s.internal.nodeToXMap[n.id],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(r=r.reverse(),l=l.reverse()),e.moveTo(...r),e.lineTo(...l),e.stroke(),e.closePath(),e.setLineDash([0]),e.beginPath(),e.fillStyle="#000",e.font="bold 20px courier new",e.fontWeight="bold";let a=[i-7.5,20];s.vertical&&(a=a.reverse()),e.fillText(n.id,...a),e.closePath()})),e.restore(),[s.internal.maxWidth,s.internal.lastLineOffset+s.messageOffset]}function _e(e,t,n,s=0,o=!0){return(i,r)=>{if(Array.isArray(i))return void i.forEach(((s,o)=>_e(e,t,n,o,o===i.length-1)(s,r)));const{nodeToXMap:l,furthestLineX:a}=n.internal;e.beginPath();let c=n.internal.lastLineOffset;0===r&&(c+=n.messageOffset),n.spaceBetweenBroadcasts&&0!==s&&(c+=n.messageOffset);let d=[l[i.fromId],c],u=[l[i.toId],d[1]+(n.spaceBetweenBroadcasts?0:n.maxMessageLength)];if((o||n.spaceBetweenBroadcasts)&&(n.internal.lastLineOffset=u[1],o&&n.spaceBetweenBroadcasts?n.internal.lastLineOffset+=n.groupOffset:n.internal.lastLineOffset+=n.messageOffset),n.vertical&&(d=d.reverse(),u=u.reverse()),i.id===t.selectedElementId&&(e.lineWidth=8,e.strokeStyle=ge,e.moveTo(...d),e.lineTo(...u),e.stroke()),e.lineWidth=1,e.strokeStyle="#000",e.moveTo(...d),e.lineTo(...u),e.stroke(),e.closePath(),0===s){e.beginPath(),e.fillStyle="#000",e.font="15px arial";let t=[a+20,d[1]+(u[1]-d[1])/2];n.spaceBetweenBroadcasts&&(t[1]=d[1]+(n.internal.lastLineOffset-d[1])/2),n.vertical&&(t=t.reverse());const s=n.getText(i);n.internal.maxWidth=Math.max(n.internal.maxWidth,t[0]+15*s.length),e.fillText(s,...t),e.closePath()}}}function He(e){let t,n,s,o,i,r;const l=[ze,Fe],a=[];function c(e,t){return e[11]?0:e[8]?1:-1}return~(o=c(e))&&(i=a[o]=l[o](e)),{c(){t=y("section"),n=y("h1"),n.textContent="State",s=w(),i&&i.c(),E(n,"class","svelte-1y74lh9"),E(t,"class","state-section svelte-1y74lh9")},m(e,i){m(e,t,i),f(t,n),f(t,s),~o&&a[o].m(t,null),r=!0},p(e,n){let s=o;o=c(e),o===s?~o&&a[o].p(e,n):(i&&(X(),K(a[s],1,1,(()=>{a[s]=null})),J()),~o?(i=a[o],i?i.p(e,n):(i=a[o]=l[o](e),i.c()),Q(i,1),i.m(t,null)):i=null)},i(e){r||(Q(i),r=!0)},o(e){K(i),r=!1},d(e){e&&g(t),~o&&a[o].d()}}}function Fe(e){let n,s;const o=[e[5],{id:"Canvas_"+e[14].algorithm+"_State"},{paintFn:e[8]},{paintOptions:{autoAlign:"CENTER"}}];let i={};for(let r=0;r<o.length;r+=1)i=t(i,o[r]);return n=new Ne({props:i}),{c(){Z(n.$$.fragment)},m(e,t){ee(n,e,t),s=!0},p(e,t){const s=16672&t?Y(o,[32&t&&V(e[5]),16384&t&&{id:"Canvas_"+e[14].algorithm+"_State"},256&t&&{paintFn:e[8]},o[3]]):{};n.$set(s)},i(e){s||(Q(n.$$.fragment,e),s=!0)},o(e){K(n.$$.fragment,e),s=!1},d(e){te(n,e)}}}function ze(e){let t,n,s;var o=e[11];function i(e){return{props:{stateStore:e[0],configStore:e[1]}}}return o&&(t=new o(i(e))),{c(){t&&Z(t.$$.fragment),n=k()},m(e,o){t&&ee(t,e,o),m(e,n,o),s=!0},p(e,s){const r={};if(1&s&&(r.stateStore=e[0]),2&s&&(r.configStore=e[1]),o!==(o=e[11])){if(t){X();const e=t;K(e.$$.fragment,1,0,(()=>{te(e,1)})),J()}o?(t=new o(i(e)),Z(t.$$.fragment),Q(t.$$.fragment,1),ee(t,n.parentNode,n)):t=null}else o&&t.$set(r)},i(e){s||(t&&Q(t.$$.fragment,e),s=!0)},o(e){t&&K(t.$$.fragment,e),s=!1},d(e){e&&g(n),t&&te(t,e)}}}function Be(e){let t,n,s;var o=e[6];function i(e){return{props:{slot:"algorithm-config",config:e[18]}}}return o&&(t=new o(i(e))),{c(){t&&Z(t.$$.fragment),n=k()},m(e,o){t&&ee(t,e,o),m(e,n,o),s=!0},p(e,s){const r={};if(262144&s&&(r.config=e[18]),o!==(o=e[6])){if(t){X();const e=t;K(e.$$.fragment,1,0,(()=>{te(e,1)})),J()}o?(t=new o(i(e)),Z(t.$$.fragment),Q(t.$$.fragment,1),ee(t,n.parentNode,n)):t=null}else o&&t.$set(r)},i(e){s||(t&&Q(t.$$.fragment,e),s=!0)},o(e){t&&K(t.$$.fragment,e),s=!1},d(e){e&&g(n),t&&te(t,e)}}}function We(e){let n,s,o,i,r,l,a,c,d,u,p,h,v,b,k,x,$,S,T,O,I,N,C,P;const A=[e[5],{id:"Canvas_"+e[14].algorithm+"_Nodes"},{paintFn:ye},{paintOptions:e[10]}];let M={};for(let f=0;f<A.length;f+=1)M=t(M,A[f]);l=new Ne({props:M});const L=[e[5],{id:"Canvas_"+e[14].algorithm+"_Sequence"},{paintFn:De},{paintOptions:e[9]}];let j={};for(let f=0;f<L.length;f+=1)j=t(j,L[f]);p=new Ne({props:j});var R=e[7];function D(e){return{props:{element:e[12],actions:e[4]}}}R&&(x=new R(D(e)));let _=(e[8]||e[11])&&He(e);return O=new je({props:{stateStore:e[0],controls:e[13]&&e[13].simulation}}),C=new ce({props:{configStore:e[1],fullLayout:!0,updateOnChange:!0,algorithm:e[3],$$slots:{"algorithm-config":[Be,({config:e})=>({18:e}),({config:e})=>e?262144:0]},$$scope:{ctx:e}}}),{c(){n=y("article"),s=y("section"),o=y("section"),i=y("h1"),i.textContent="Node Graph",r=w(),Z(l.$$.fragment),a=w(),c=y("section"),d=y("h1"),d.textContent="Sequence Diagram",u=w(),Z(p.$$.fragment),h=w(),v=y("section"),b=y("h1"),b.textContent="Actions",k=w(),x&&Z(x.$$.fragment),$=w(),_&&_.c(),S=w(),T=y("section"),Z(O.$$.fragment),I=w(),N=y("section"),Z(C.$$.fragment),E(i,"class","svelte-1y74lh9"),E(o,"class","raised graph-panel svelte-1y74lh9"),E(d,"class","svelte-1y74lh9"),E(c,"class","raised graph-panel svelte-1y74lh9"),E(b,"class","svelte-1y74lh9"),E(v,"class","raised actions-panel svelte-1y74lh9"),E(s,"class","canvas-section svelte-1y74lh9"),E(T,"class","controls-section svelte-1y74lh9"),E(N,"class","config-section svelte-1y74lh9"),E(n,"class","full-algorithm svelte-1y74lh9")},m(e,t){m(e,n,t),f(n,s),f(s,o),f(o,i),f(o,r),ee(l,o,null),f(s,a),f(s,c),f(c,d),f(c,u),ee(p,c,null),f(s,h),f(s,v),f(v,b),f(v,k),x&&ee(x,v,null),f(n,$),_&&_.m(n,null),f(n,S),f(n,T),ee(O,T,null),f(n,I),f(n,N),ee(C,N,null),P=!0},p(e,[t]){const s=17440&t?Y(A,[32&t&&V(e[5]),16384&t&&{id:"Canvas_"+e[14].algorithm+"_Nodes"},0&t&&{paintFn:ye},1024&t&&{paintOptions:e[10]}]):{};l.$set(s);const o=16928&t?Y(L,[32&t&&V(e[5]),16384&t&&{id:"Canvas_"+e[14].algorithm+"_Sequence"},0&t&&{paintFn:De},512&t&&{paintOptions:e[9]}]):{};p.$set(o);const i={};if(4096&t&&(i.element=e[12]),16&t&&(i.actions=e[4]),R!==(R=e[7])){if(x){X();const e=x;K(e.$$.fragment,1,0,(()=>{te(e,1)})),J()}R?(x=new R(D(e)),Z(x.$$.fragment),Q(x.$$.fragment,1),ee(x,v,null)):x=null}else R&&x.$set(i);e[8]||e[11]?_?(_.p(e,t),2304&t&&Q(_,1)):(_=He(e),_.c(),Q(_,1),_.m(n,S)):_&&(X(),K(_,1,1,(()=>{_=null})),J());const r={};1&t&&(r.stateStore=e[0]),8192&t&&(r.controls=e[13]&&e[13].simulation),O.$set(r);const a={};2&t&&(a.configStore=e[1]),8&t&&(a.algorithm=e[3]),4456512&t&&(a.$$scope={dirty:t,ctx:e}),C.$set(a)},i(e){P||(Q(l.$$.fragment,e),Q(p.$$.fragment,e),x&&Q(x.$$.fragment,e),Q(_),Q(O.$$.fragment,e),Q(C.$$.fragment,e),P=!0)},o(e){K(l.$$.fragment,e),K(p.$$.fragment,e),x&&K(x.$$.fragment,e),K(_),K(O.$$.fragment,e),K(C.$$.fragment,e),P=!1},d(e){e&&g(n),te(l),te(p),x&&te(x),_&&_.d(),te(O),te(C)}}}function qe(t,n,s){let o,i,r,a=e,c=()=>(a(),a=l(g,(e=>s(13,o=e))),g),d=e,u=()=>(d(),d=l(f,(e=>s(17,i=e))),f),p=e,h=()=>(p(),p=l(m,(e=>s(14,r=e))),m);t.$$.on_destroy.push((()=>a())),t.$$.on_destroy.push((()=>d())),t.$$.on_destroy.push((()=>p()));let{stateStore:f}=n;u();let{configStore:m}=n;h();let{controlsStore:g}=n;c();let v,{algorithm:y}=n,{algorithms:b}=n,w={},k={stateStore:f,configStore:m},x=y.components.Configuration,E=y.components.Actions,$=y.drawing.paintState,S=y.drawing.seqPaintingOptions||{},T=y.drawing.nodePaintingOptions||{},O=y.components.StateGraph,I=null;return P((()=>{m.subscribe((e=>{let t=b[e.algorithm];s(6,x=t.components.Configuration),s(11,O=t.components.StateGraph),s(7,E=t.components.Actions),s(8,$=t.drawing.paintState),s(9,S=t.drawing.seqPaintingOptions?{...t.drawing.seqPaintingOptions}:{}),s(9,S.autoAlign="TOP_TO_BOTTOM",S),s(10,T=t.drawing.nodePaintingOptions?{...t.drawing.nodePaintingOptions}:{}),s(10,T.autoAlign="CENTER",T)})),f.subscribe((e=>{o&&e&&(v!==e.selectedElementId&&(v=e.selectedElementId),v&&v.indexOf&&0===v.indexOf("M_")?s(12,I=i.messages.find((e=>e.id===v))):s(12,I=i.nodes.find((e=>e.id===v))),I&&s(4,w=o.element(e.nodes.find((e=>e.id===v)))))})),f.update((e=>({...e,selectedElementId:e.nodes.filter((e=>"client"===e.type))[0]}))),s(5,k={stateStore:f,configStore:m})})),t.$$set=e=>{"stateStore"in e&&u(s(0,f=e.stateStore)),"configStore"in e&&h(s(1,m=e.configStore)),"controlsStore"in e&&c(s(2,g=e.controlsStore)),"algorithm"in e&&s(3,y=e.algorithm),"algorithms"in e&&s(15,b=e.algorithms)},[f,m,g,y,w,k,x,E,$,S,T,O,I,o,r,b]}class Ue extends oe{constructor(e){super(),se(this,e,qe,We,r,{stateStore:0,configStore:1,controlsStore:2,algorithm:3,algorithms:15})}}const Ge={algorithm:"paxos",commandDelay:0,networkDelay:5e3,speed:1,useWorkers:!0,useGlobalState:!1};function Xe(){return new Worker("/assets/NodeRunnerWorker.2e79288f.js",{type:"module"})}function Je(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():function(e=6,t=36){return Math.random().toString(t).substring(2,e)}()}class Qe{constructor(e,t){this.neighbors=[],this.node=e,this.neighbors=t&&this.neighbors.concat(t)}getAllNeighbors(){return this.neighbors}getNeighborsOfType(e){return this.neighbors.filter((t=>t.type===e))}getRandomNeighborOfType(e){const t=this.getNeighborsOfType(e);return t[Math.floor(Math.random()*t.length)]}broadcast(e,t){const n=Je(),s=this.node.id;for(const o of t)o!==s&&this.emit({...e,sent:(new Date).toISOString(),id:this.getRandomId(),broadcastKey:n,fromId:s,toId:o})}broadcastToAll(e){const t=this.neighbors.map((e=>e.id));this.broadcast(e,t)}broadcastToType(e,t){const n=this.neighbors.filter((e=>e.type===t)).map((e=>e.id));this.broadcast(e,n)}sendTo(e,t){const n=this.node.id;this.emit({...t,sent:(new Date).toISOString(),fromId:n,toId:e,id:this.getRandomId()})}sendToSync(e,t){const n=this.node.id;return this.emitSync({...t,sent:(new Date).toISOString(),fromId:n,toId:e,id:this.getRandomId()})}emit(e){window.dispatchEvent(new CustomEvent("NetworkEvent",{detail:{...e,nodeId:this.node.id}}))}emitSync(e){const t=Je();return new Promise((n=>{this.emit({...e,resKey:t});const s=this.listen((e=>{e.resKey===t&&(s(),n(e))}))}))}listen(e){const t=(e=>t=>t.detail.toId===this.node.id&&e(t.detail))(e);return window.addEventListener("NetworkEvent",t),()=>{window.removeEventListener("NetworkEvent",t)}}async receive(){return new Promise((e=>{this.listen((t=>{e(t)}))}))}getRandomId(){return"M_"+Je()}}class Ke{constructor(e,t,n,s){this.id=e,this.config=t,this.state=n,this.network=s,this.running=!0,this.connected=!0,this.executedCommands=[],this.scheduledCommands=[]}stop(){this.running=!1}restart(){this.running=!0,this.scheduledCommands.forEach((e=>{e.do(),this.executedCommands.push(e)}))}reconnect(){this.connected=!0}disconnect(){this.connected=!1}invoke(e){const t=Je();let n=e;"function"==typeof n?n={id:t,do:e,undo:()=>console.warn("Undo not implemented")}:n.id=t,this.running?(n.do(),this.executedCommands.push(n)):this.scheduledCommands.push(n),this.updateState()}step(e=!0){if(e&&this.scheduledCommands.length>0){let e=this.scheduledCommands.shift();e.do(),this.executedCommands.push(e)}else if(this.executedCommands.length>0){let e=this.executedCommands.pop();e.undo(),this.scheduledCommands.push(e)}this.updateState()}invokeDo(e){const t={...this.state},n={do:()=>{e()},undo:()=>{this.state=t}};this.invoke(n)}updateState(){this.network.sendTo(void 0,{type:"STATE_CHANGED",isFlow:!0,data:{...this.state,scheduledCommands:this.scheduledCommands.map((({id:e})=>({id:e}))),executedCommands:this.executedCommands.map((({id:e})=>({id:e})))}})}}class Ye extends Ke{constructor(e,t,n,s){super(e,t,n,s),this.type="client"}request(e,t){const n=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{method:"REQUEST",v:t}),this.updateState()},undo:()=>{this.state.text=n}}}onmessage(e){"RESPONSE"===e.method&&this.invoke(this.onAck())}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}requestRandom(e){const t=this.network.getRandomNeighborOfType("proposer")||this.network.getRandomNeighborOfType("node");this.invoke(this.request(t.id,e))}}class Ve{constructor(e,t){this.id=e,this.network=t,this.state={greatestN:-1,text:"IDLE"}}onPrepare(e){let t={...this.state};return{do:()=>{if(e.n<=this.state.greatestN)return this.state.text="IDLE",void this.network.sendTo(e.fromId,{clientId:e.clientId,n:this.state.greatestN,v:e.v,method:"IGNORED"});this.state.greatestN=e.n,this.state.text="PROMISED",this.network.sendTo(e.fromId,{method:"PROMISE",clientId:e.clientId,n:e.n,v:e.v})},undo:()=>{this.state=t}}}onAccept(e){let t={...this.state};return{do:()=>{if(e.n>this.state.greatestN)return this.state.text="IDLE",e.clientId,this.state.greatestN,void e.v;this.state.text="ACCEPTED",this.network.broadcastToType({clientId:e.clientId,n:e.n,v:e.v,method:"ACCEPTED"},"node"),this.state.greatestN=e.n},undo:()=>{this.state=t}}}}class Ze{constructor(e,t){this.network=t,this.id=e,this.state={v:null,n:null,log:[]}}onAccepted(e){const t=this.state.v;return{do:()=>{e.v===this.state.v&&e.n===this.state.n||(this.state.v=e.v,this.state.n=e.n,this.state.log[e.n-1]=e.v,this.network.sendTo(e.clientId,{clientId:e.clientId,n:e.n,v:e.v,method:"RESPONSE"}))},undo:()=>{this.state.v=t}}}}class et{constructor(e,t){this.id=e,this.network=t,this.type="proposer",this.state={proposals:[],text:"IDLE",n:1}}hasMajority(e,t=!0){const n=this.state.proposals.find((t=>t.n===e));if(!n)return void console.log("----\x3e no proposal",this.state.proposals);const s=this.network.getNeighborsOfType("acceptors").length||this.network.getNeighborsOfType("node").length-1;return(t?n.promises:n.acceptances).length>Math.round(.5*s)}onRequest(e){const t={...this.state};return{do:()=>{this.state.isProposer=!0,this.state.text="PREPARING",this.state.proposals.push({clientId:e.fromId,v:e.v,n:this.state.n,promises:[],acceptances:[]});let t=this.network.getNeighborsOfType("acceptor");t&&0!==t.length||(t=this.network.getNeighborsOfType("node")),this.network.broadcast({clientId:e.fromId,v:e.v,method:"PREPARE",n:this.state.n},t.map((e=>e.id)))},undo:()=>{this.state=t}}}onPromise(e){const t={...this.state};return{do:()=>{if("PROMISED"===this.state.text)return;const t=this.state.proposals.find((t=>t.n===e.n));t&&(t.promises.push(e.fromId),this.hasMajority(e.n)&&(this.network.broadcast({clientId:e.clientId,v:e.v,method:"ACCEPT",n:t.n},t.promises),this.state.text="PROMISED"))},undo:()=>{this.state=t}}}onAccepted(e){const t={...this.state};return{do:()=>{if("IDLE"===this.state.text)return;const t=this.state.proposals.find((t=>t.n===e.n));t&&(t.acceptances.push(e.fromId),this.hasMajority(e.n,!1)&&(this.state.n=this.state.n+1,this.state.proposals.forEach((e=>{})),this.state.text="IDLE"),this.state.isProposer=!1)},undo:()=>{this.state=t}}}onIgnored(e){const t={...this.state};return{do:()=>{const t=this.state.proposals.findIndex((t=>t.n===e.n));if(t<0||!this.state.proposals[t])return;this.state.proposals=this.state.proposals.map((t=>t.n===e.n?{...t,acceptances:t.acceptances.filter((t=>t.acceptorId!==e.fromId)),promises:t.promises.filter((t=>t.acceptorId!==e.fromId))}:t)),this.state.n=e.n+1,this.state.proposals[t].n=this.state.n;let n=this.network.getNeighborsOfType("acceptor");n&&0!==n.length||(n=this.network.getNeighborsOfType("node"));for(let e of n)console.log("---\x3e ",this.state.proposals[t],this.state.proposals[t].clientId),this.network.sendTo(e.id,{clientId:this.state.proposals[t].clientId,v:this.state.proposals[t].v,method:"PREPARE",n:this.state.n})},undo:()=>{this.state=t}}}}class tt extends Ke{constructor(e,t,n,s,o="node"){super(e,t,n,s),this.type=o,this.state.log=[],"node"!==o&&"acceptor"!==o||(this.acceptor=new Ve(e,s),this.state.acceptor=this.acceptor.state),"node"!==o&&"learner"!==o||(this.learner=new Ze(e,s),this.state.learner=this.learner.state),"node"!==o&&"proposer"!==o||(this.proposer=new et(e,s),this.state.proposer=this.proposer.state)}onmessage(e){this.proposer&&this.handleProposerMessage(e),this.acceptor&&this.handleAcceptorMessage(e),this.learner&&this.handleLearnerMessage(e)}handleProposerMessage(e){switch(e.method){case"REQUEST":this.invoke(this.proposer.onRequest(e));break;case"PROMISE":this.invoke(this.proposer.onPromise(e));break;case"ACCEPTED":this.invoke(this.proposer.onAccepted(e));break;case"IGNORED":this.invoke(this.proposer.onIgnored(e))}}handleAcceptorMessage(e){switch(e.method){case"PREPARE":this.invoke(this.acceptor.onPrepare(e));break;case"ACCEPT":this.invoke(this.acceptor.onAccept(e))}}handleLearnerMessage(e){if("ACCEPTED"===e.method)this.invoke(this.learner.onAccepted(e))}}function nt(e,t,n,s){return"client"===n.type?new Ye(n.id,e,n,s):new tt(n.id,e,n,s,n.type||"all")}class st extends Ke{constructor(e,t,n,s){super(e,t,n,s),this.type="client"}request(e,t){const n=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{command:"REQUEST",tx:t,timestamp:(new Date).getTime()}),this.updateState()},undo:()=>{this.state.text=n}}}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}onmessage(e){"RESPONSE"===e.method&&this.invoke(this.onAck())}requestRandom(e){const t=this.network.getRandomNeighborOfType("node");this.invoke(this.request(t.id,e))}}const ot={header:{prevHeaderHash:null,merkleRoot:null},height:0,timestamp:new Date("2009-01-03T19:15:00.000Z").getTime(),transactions:[]};async function it(e,t="",n="sha-256"){if("undefined"==typeof crypto||!crypto||!crypto.subtle)return JSON.stringify(e)+t;const s=(o=JSON.stringify(e)+t,(new TextEncoder).encode(o));var o;const i=await crypto.subtle.digest(n,s);return Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("")}async function rt(e,t,n="",s="sha-256"){if("undefined"==typeof crypto||!crypto||!crypto.subtle){return JSON.stringify(t)+n===e}return await it(t,n,s)===e}const lt=1e3;class at extends Ke{constructor(e,t,n,s){super(e,t,n,s),this.type="node",this.state.text="IDLE",this.state.chain=[ot],this.state.mempool=[],this.getBlocks()}onmessage(e){switch(e.command){case"getblocks":super.invoke(this.onGetBlocks(e));break;case"REQUEST":super.invokeDo(this.sendRawTransaction(e));break;case"blocks":super.invoke(this.onBlocks(e));break;case"rawtransaction":super.invokeDo(this.onRawTransaction(e));break;case"submitblock":super.invokeDo(this.onSubmitBlock(e))}}onBlocks(e){return{do:async()=>{for(let t of e.entries){if(!(await rt(t.header.prevHeaderHash,this.state.chain.at(-1).header)))return;this.state.chain.push(t)}},undo:()=>{}}}onGetBlocks(e){return{do:()=>{this.network.sendTo(e.fromId,{command:"blocks",entries:this.state.chain})},undo:()=>{}}}getBlocks(){if(0===this.network.neighbors.length)return;const e=this.network.getNeighborsOfType("node");if(0===e.length)return;const t=e[Math.floor(Math.random()*e.length)];this.network.sendTo(t.id,{command:"getblocks",headerHashes:[this.state.chain.at(-1).hash]})}sendRawTransaction(e){return()=>{const t=this.state.mempool.find((t=>e.tx===t)),n=this.state.chain.find((t=>t.transactions.find((t=>t===e.tx))));if(!t&&!n){this.timeout&&clearTimeout(this.timeout);const t=4e3*Math.random()+lt;this.timeout=setTimeout(this.tryMining(),t),this.state.mempool.push(e.tx),this.network.broadcastToType({timestamp:e.timestamp,tx:e.tx,command:"rawtransaction"},"node")}}}onRawTransaction(e){return()=>{this.sendRawTransaction(e)()}}onSubmitBlock(e){return()=>{this.state.chain.find((t=>t===e.block||((e,t)=>()=>0===e.transactions.filter(((e,n)=>e!==t.transactions[n])).length)(e.block,t)))||(console.log("--\x3e NO DUPLICATE: chain = ",this.state.chain,", new block = ",e.block),this.state.mempool=this.state.mempool.filter((t=>!e.block.transactions.find((e=>e!==t)))),this.state.chain.push(e.block))}}stop(){super.stop(),this.timeout&&clearTimeout(this.timeout)}restart(){super.restart();const e=4e3*Math.random()+lt;this.timeout=setTimeout(this.tryMining(),e)}tryMining(){return async()=>{if(0===this.state.mempool.length)return;const e=Math.random().toFixed(8),t={header:{prevHeaderHash:await it(this.state.chain.at(-1),e),merkleRoot:null,nonce:e},height:this.state.chain.length,timestamp:(new Date).getTime(),transactions:this.state.mempool};this.state.mempool=[],this.state.chain.push(t),this.network.broadcastToType({block:t,command:"submitblock"},"node")}}validate(e){return rt(e.header.prevHeaderHash,{...e,hash:void 0})}}function ct(e,t,n,s){switch(n.type){case"client":return new st(n.id,e,n,s);case"node":return new at(n.id,e,n,s)}}class dt{constructor(e,t){this.setupNetwork=(e,t)=>new Qe(e,t),this.id=Je(),this.config=e,this.network=null,this.nodeStates=t,this.nodes=[]}terminate(){this.stopListening&&this.stopListening()}buildMessageEventHandler(){return e=>{let t=e.data;if(console.log(`NodeRunner for "${this.nodeStates?this.nodeStates.map((e=>e.id)).join(", "):"?"}" got:`,t),t.isFlow)this.onFlowMessage(t);else if(t.toId){const e=this.nodes.find((e=>e.id===t.toId));e&&e.running&&e.connected&&e.onmessage(t)}}}setupNodes(e,t,n){this.nodeStates=t,t.forEach((async t=>{const s=this.setupNetwork(t,n),o=function(e,...t){switch(e){case"paxos":return nt(...t);case"bitcoin_pow":return ct(...t);default:throw"Algorithm not implemented"}}(e.algorithm,e,null,t,s);o&&(o.updateState(),this.nodes.push(o),console.log("Starting node with id ",o.id,"and type",o.type))}))}onFlowMessage(e){const{nodeId:t}=e;switch(e.type){case"CLIENT_REQUEST":if(t){const n=this.nodes.find((e=>e.id===t));if(n&&"client"===n.type){const{v:t}=e;n.requestRandom(t)}}break;case"SETUP":case"RESET":this.setupNodes(e.config,e.nodes,e.neighbors),this.postMessageToMain({isFlow:!0,type:"STATE_CHANGED",state:"IDLE"});break;case"STEP":this.nodes.forEach((t=>t.step(e.forward)));break;case"DISCONNECT":case"RECONNECT":case"STOP":case"RESTART":if(t){const n=this.nodes.find((e=>e.id===t));n&&("RECONNECT"===e.type?n.reconnect():"DISCONNECT"===e.type?n.disconnect():"RESTART"===e.type?n.restart():"STOP"===e.type&&(this.postMessageToMain({isFlow:!0,type:"COMMANDS",commands:n.executedCommands}),n.stop()))}break;default:console.error("Flow message type not recognized")}}onmessage(){console.warn("onmessage is not implemented")}onerror(){console.warn("onerror is not implemented")}postMessage(e){this.messageEventHandler||(this.messageEventHandler=this.buildMessageEventHandler());const t={data:e};this.messageEventHandler(t)}postMessageToMain(e){window.dispatchEvent(new CustomEvent("NodeRunnerEvent",{detail:{...e,nodeRunnerId:this.id}}))}startListening(){const e=e=>e.detail.nodeRunnerId===this.id||0!==this.nodeStates.filter((t=>t.id===e.detail.nodeId||t.id===e.detail.toId)).length,t=(n=this.onmessage,t=>e(t)&&n({data:t.detail}));var n;window.addEventListener("NodeRunnerEvent",t),window.addEventListener("NetworkEvent",t),this.stopListening=()=>{window.removeEventListener("NodeRunnerEvent",t),window.removeEventListener("NetworkEvent",t)}}}function ut(e,t,n){return s=>{var o;s.done&&n[s.id]&&!n[s.id].resolved&&(n[s.id].onCompleted(),n[s.id].resolved=!0,null===(o=n[s.id])||void 0===o||o.resolve(s));if(s.done)return s;const i=function(e,t,n,s){const o=t<=0?1:n/(t/e.speed);return Math.min(s+(e.paused?0:o),1)}(e,t,10,s.progress),r=e.nodes.filter((e=>e.id===s.fromId))[0].pos,l=e.nodes.filter((e=>e.id===s.toId))[0].pos;if(s.pos=[r[0]+Math.min(i,1)*(l[0]-r[0]),r[1]+Math.min(i,1)*(l[1]-r[1])],i>=1)if(s.done=!0,n[s.id]){if(s.progress<1){var a;n[s.id].onCompleted(),n[s.id].resolved=!0,null===(a=n[s.id])||void 0===a||a.resolve({...s,done:!0})}}else console.warn("onCompletedMap missing key");return s.progress=i,s}}function pt(e,t,n,s,o){const i=e=>n((t=>{const n=e(t);return{...t,...n}})),r={setSpeed:e=>n((t=>({...t,speed:e}))),stepForwards:()=>i(e.useGlobalState?ht(e,t,!0):ft(e,t,!0)),stepBackwards:()=>i(e.useGlobalState?ht(e,t,!1):ft(e,t,!1)),pauseOrPlay:()=>i(function(e,t,n){return e=>{if(Object.values(t).forEach((t=>t.postMessage({isFlow:!0,nodeId:n,type:e.paused?"RESTART":"STOP"}))),e.paused){const n=e.messages.filter((e=>e.deleted)).sort(gt);if(n.length>0&&n[0]){const e=n[0].fromId;t[e].postMessage({isFlow:!0,nodeId:e,type:"STEP",forward:!0})}}return{paused:void 0===e.paused||!e.paused,messages:e.paused?e.messages.filter((e=>!e.deleted)):e.messages,nodes:e.nodes.filter((e=>!n||e.id===n)).map((e=>({...e,running:!e.running})))}}}(0,t,void 0)),reset:()=>i(yt(e,t,void 0,s,o)),terminate:vt(e,t,s)},l=n=>({connectOrDisconnect:()=>i(function(e,t,n){return e=>{if(n&&t[n])return t[n].postMessage({isFlow:!0,type:e.nodes.find((e=>e.id===n)).connected?"DISCONNECT":"RECONNECT",nodeId:n}),{nodes:e.nodes.map((e=>({...e,connected:n&&e.id===n?!e.connected:e.connected})))}}}(0,t,n.id)),restart:()=>i(yt(e,t,n.id))});return{simulation:r,element:s=>({...l(s),delete:()=>n((e=>({...e,selectedElementId:void 0,messages:e.messages.filter((t=>t.id!==e.selectedElementId))}))),modify:e=>()=>n((t=>({...t,messages:t.messages.filter((e=>e.id!==t.selectedElementId)).concat(e)}))),createNewAction:s=>()=>{n((n=>{const o=s(e,n,t);return{...n,...o}}))}})}}function ht(e,t,n=!0){return e=>{if(window.states||(window.stateIdx=-1,window.states=[]),!n||0!==window.states.length&&window.stateIdx!==window.states.length-1)return n?(window.stateIdx+=1,window.states[window.stateIdx]):(window.stateIdx=Math.max(0,window.stateIdx-1),window.states[window.stateIdx]);{const n={messages:(t=[],s=e.messages,s.map((e=>{const n=-1==t.findIndex((t=>t.id===e.id));return e.done||e.deleted&&n||(e.deleted=!1,e.progress=e.progress<.5?.5:1,e.done=e.progress>=1),e}))),nodes:e.nodes};return window.states.push(n),n}var t,s}}function ft(e,t,n=!0){return e=>{if(n){return{messages:e.messages.map((e=>(e.done||e.deleted||(e.progress=e.progress<.5?.5:1,e.done=e.progress>=1),e)))}}{const n=[],s=e.messages.sort(gt(!0)),o=s.reduce(mt(s),[]),i=s.filter((e=>-1===o.indexOf(e))).reduce(mt(s),[]),r=e.messages.map((e=>(-1!==o.indexOf(e)?e.progress>.5?(e.progress=.5,e.done=!1,e.deleted=!1):(e.progress=0,e.deleted=!0,e.done=!0,n.push(e)):-1!==i.indexOf(e)&&(e.done=!1,e.progress=.5),e))).filter((e=>!e.deleted));return n.map((e=>e.fromId)).filter(bt).forEach((e=>{t[e].postMessage({isFlow:!0,type:"STEP",forward:!1})})),{messages:r}}}}function mt(e){return(t,n)=>{if(0===e.length)return[];const s=e[0].broadcastKey;return s?(s&&s===n.broadcastKey&&t.push(n),t):[e[0]]}}function gt(e=!1){return(t,n)=>{const s=new Date(t.sent).getTime(),o=new Date(n.sent).getTime();return s>o?e?-1:1:s<o?e?1:-1:0}}function vt(e,t,n){return()=>{n(),Object.values(t).forEach((e=>e.terminate()))}}function yt(e,t,n,s,o){return i=>{if(n&&t[n]){const s=i.nodes.find((e=>e.id===n));t[n].postMessage({config:e,isFlow:!0,type:"RESET",nodeId:n,nodes:[s],neighbors:i.nodes.filter((e=>e.id!==s.id))})}else if(!n)return s&&s(),o&&o();return{}}}const bt=(e,t,n)=>n.indexOf(e)===t;function wt({value:e,update:t},{value:n,update:s},o){const i=function(e,t){const n={0:()=>{}};let s=[];const o=setInterval((()=>{e((e=>{const o=[...s];return s=[],Object.keys(n).forEach((t=>{e.messages.find((e=>e.id===t))||o.find((e=>e.id===t))||(n[t]=void 0)})),{...e,messages:e.messages.concat(...o).map(ut(e,t,n))}}))}),10);return{stop:()=>clearInterval(o),push:async(e,t,o)=>new Promise((i=>{n[t.id]={resolve:i,onCompleted:o};const r={...t};r.progress=0,r.id=t.id,s.push(r),r.pos=e.nodes.filter((e=>e.id===t.fromId))[0].pos}))}}(s,e.networkDelay/n.speed),r={};for(const a of n.nodes){const o=e.useWorkers?new Xe({type:"module",name:a.id}):new dt(e,[a]),l=e=>{const t=e.data;if(t.isFlow)switch(t.type){case"STATE_CHANGED":if(!t.data)break;s((e=>({...e,commands:(e.commands||[]).concat(...t.data.scheduledCommands||[]),nodes:[...e.nodes.map((e=>e.id===a.id?{...e,...t.data}:e))]})))}else i.push(n,t,(()=>{t.toId&&r[t.toId].postMessage(t)}))};o.onmessage=l,o.onerror=e=>{console.error(e.message,e.error,e),t((e=>({...e,useWorkers:!1})))},e.useWorkers||o.startListening(),o.postMessage({isFlow:!0,type:"SETUP",config:e,nodes:[a],neighbors:n.nodes.filter((e=>e.id!==a.id))}),r[a.id]=o}const l=pt(e,r,s,i.stop,o);return[r,l]}function kt(e,t){const n=[];for(let s=0;s<e;s++){const o=2*Math.PI*((s+1)/e);n.push([t*Math.cos(o)+t,t*Math.sin(o)+t])}return n}function xt(e){const t={selectedElementId:void 0,started:new Date,speed:1,nodes:[],messages:[]};return t.nodes=function(e){const t=[];if(e.numberOfClients<1)throw"IllegalAmountOfClients";for(let n=0;n<e.numberOfClients;n++)t.push({id:"C"+(n+1),type:"client",running:!0,connected:!0,state:"IDLE",pos:[50+60*n,50]});if(e.useSingleNodes){if(e.numberOfNodes<1)throw"IllegalAmountOfNodes";const n=130,s=kt(e.numberOfNodes,100);for(let o=0;o<e.numberOfNodes;o++)t.push({id:"N"+(o+1),type:"node",running:!0,connected:!0,state:"IDLE",pos:[s[o][0]+50,s[o][1]+n]});return t}if(e.numberOfProposers<1)throw"IllegalAmountOfProposers";for(let n=0;n<e.numberOfProposers;n++)t.push({id:"P"+(n+1),type:"proposer",state:"IDLE",running:!0,connected:!0,pos:[100+60*n,150]});if(e.numberOfAcceptors<1)throw"IllegalAmountOfAcceptors";for(let n=0;n<e.numberOfAcceptors;n++)t.push({id:"A"+(n+1),type:"acceptor",state:"IDLE",running:!0,connected:!0,pos:[100+60*n,250]});if(e.numberOfLearners<1)throw"IllegalAmountOfLearners";for(let n=0;n<e.numberOfLearners;n++)t.push({id:"L"+(n+1),type:"learner",state:"IDLE",running:!0,connected:!0,pos:[50+60*n,350]});return t}(e),t}const Et={algorithm:"paxos",numberOfClients:1,numberOfProposers:1,numberOfAcceptors:3,numberOfLearners:2,numberOfNodes:5,useSingleNodes:!0},$t={...Re,getText:e=>`${e.method} (${"REQUEST"!==e.method?e.n+", ":""}${e.v})`},St={padding:2};function Tt(e){let t,n,s,i,r,l,a,c,d,u,p,h,v,k,S,O;return{c(){t=y("div"),n=y("label"),s=b("Number of Proposers\r\n                "),i=y("input"),r=w(),l=y("div"),a=y("label"),c=b("Number of Acceptors\r\n                "),d=y("input"),u=w(),p=y("div"),h=y("label"),v=b("Number of Learners\r\n                "),k=y("input"),E(i,"type","number"),E(i,"min","1"),E(i,"max","10"),E(t,"class","input-group"),E(d,"type","number"),E(d,"min","1"),E(d,"max","10"),E(l,"class","input-group"),E(k,"type","number"),E(k,"min","1"),E(k,"max","10"),E(p,"class","input-group")},m(o,g){m(o,t,g),f(t,n),f(n,s),f(n,i),T(i,e[1].numberOfProposers),m(o,r,g),m(o,l,g),f(l,a),f(a,c),f(a,d),T(d,e[1].numberOfAcceptors),m(o,u,g),m(o,p,g),f(p,h),f(h,v),f(h,k),T(k,e[1].numberOfLearners),S||(O=[x(i,"input",e[4]),x(d,"input",e[5]),x(k,"input",e[6])],S=!0)},p(e,t){2&t&&$(i.value)!==e[1].numberOfProposers&&T(i,e[1].numberOfProposers),2&t&&$(d.value)!==e[1].numberOfAcceptors&&T(d,e[1].numberOfAcceptors),2&t&&$(k.value)!==e[1].numberOfLearners&&T(k,e[1].numberOfLearners)},d(e){e&&g(t),e&&g(r),e&&g(l),e&&g(u),e&&g(p),S=!1,o(O)}}}function Ot(e){let t,n,s,o,i,r;return{c(){t=y("div"),n=y("label"),s=b("Number of Nodes\r\n                "),o=y("input"),E(o,"type","number"),E(o,"min","1"),E(o,"max",15),E(t,"class","input-group")},m(l,a){m(l,t,a),f(t,n),f(n,s),f(n,o),T(o,e[1].numberOfNodes),i||(r=x(o,"input",e[3]),i=!0)},p(e,t){2&t&&$(o.value)!==e[1].numberOfNodes&&T(o,e[1].numberOfNodes)},d(e){e&&g(t),i=!1,r()}}}function It(t){let n,s,o,i,r,l,a,c;function d(e,t){return e[1].useSingleNodes?Ot:Tt}let u=d(t),p=u(t);return{c(){n=y("div"),s=y("div"),o=y("label"),i=b("Number of Clients\r\n            "),r=y("input"),l=w(),p.c(),E(r,"type","number"),E(r,"min","1"),E(r,"max",5),E(s,"class","input-group"),E(n,"class","algorithm-specific-options")},m(e,d){m(e,n,d),f(n,s),f(s,o),f(o,i),f(o,r),T(r,t[1].numberOfClients),f(n,l),p.m(n,null),a||(c=x(r,"input",t[2]),a=!0)},p(e,[t]){2&t&&$(r.value)!==e[1].numberOfClients&&T(r,e[1].numberOfClients),u===(u=d(e))&&p?p.p(e,t):(p.d(1),p=u(e),p&&(p.c(),p.m(n,null)))},i:e,o:e,d(e){e&&g(n),p.d(),a=!1,c()}}}function Nt(t,n,s){let o,i=e,r=()=>(i(),i=l(a,(e=>s(1,o=e))),a);t.$$.on_destroy.push((()=>i()));let{config:a}=n;return r(),t.$$set=e=>{"config"in e&&r(s(0,a=e.config))},[a,o,function(){o.numberOfClients=$(this.value),a.set(o)},function(){o.numberOfNodes=$(this.value),a.set(o)},function(){o.numberOfProposers=$(this.value),a.set(o)},function(){o.numberOfAcceptors=$(this.value),a.set(o)},function(){o.numberOfLearners=$(this.value),a.set(o)}]}const Ct={byNodeType:{leader:"A leader primarily has the role of the proposer.",follower:"A follower primarily has the role of the acceptor.",node:"A paxos Node follows all three roles of the paxos protocol.",proposer:"A proposer tries to have the acceptors agree on a value v send by a client.",acceptor:"An acceptor votes on proposals sent from the proposer. Only then a value can be stored",learner:"A learner makes sure an accepted value is stored and distributed.",client:"Clients want to store data or run actions inside the paxos network. The client is most likely another server system."},byNodeState:{},byMessageMethod:{REQUEST:"Clients can send requests to the current leader if they want to store an input to the replicated log of the cluster.",PREPARE:"A leader node (or proposer) sends followers its generation n. It prepares to commit a value v.",PROMISE:"Followers (or acceptors) answer to the PREPARE requests with a PROMISE message",ACCEPT:"After getting all promises from the acceptor the proposer wants all acceptors to accept a value v",ACCEPTED:"If an acceptor accepts a value v it sends an ACCEPTED message back to the proposer",IGNORED:"If an acceptor does not accept a value v it sends an IGNORED message back to the proposer. The proposer must try again with a higher generation"}};function Pt(e){let t,n,s,r,l,a,c,d,u,p,h,v,k,$,T,O,I,N,C,P,A,M,L,j,R,D,_,H,F,z=e[0].id+"",B=(Ct.byNodeType[e[0].type]||"No information")+"",W=(Ct.byNodeState[e[0].state]||"")+"",q=e[0].type+"",U=e[0].state+"",G=e[0].connected?"disconnect":"reconnect",X="client"===e[0].type&&Lt(e);return{c(){t=y("h1"),n=b("Node "),s=b(z),r=w(),l=y("p"),a=y("span"),c=b(B),d=w(),u=y("span"),p=b(W),h=w(),v=y("ul"),k=y("li"),$=b("type: "),T=y("span"),O=b(q),I=w(),N=y("li"),C=b("state: "),P=y("span"),A=b(U),M=w(),X&&X.c(),L=w(),j=y("button"),j.textContent="restart",R=w(),D=y("button"),_=b(G),E(T,"class","svelte-1muk73i"),E(k,"class","svelte-1muk73i"),E(P,"class","svelte-1muk73i"),E(N,"class","svelte-1muk73i"),E(v,"class","property-list svelte-1muk73i")},m(o,g){m(o,t,g),f(t,n),f(t,s),m(o,r,g),m(o,l,g),f(l,a),f(a,c),f(l,d),f(l,u),f(u,p),m(o,h,g),m(o,v,g),f(v,k),f(k,$),f(k,T),f(T,O),f(v,I),f(v,N),f(N,C),f(N,P),f(P,A),m(o,M,g),X&&X.m(o,g),m(o,L,g),m(o,j,g),m(o,R,g),m(o,D,g),f(D,_),H||(F=[x(j,"click",(function(){i(e[1].restart)&&e[1].restart.apply(this,arguments)})),x(D,"click",(function(){i(e[1].connectOrDisconnect)&&e[1].connectOrDisconnect.apply(this,arguments)}))],H=!0)},p(t,n){e=t,1&n&&z!==(z=e[0].id+"")&&S(s,z),1&n&&B!==(B=(Ct.byNodeType[e[0].type]||"No information")+"")&&S(c,B),1&n&&W!==(W=(Ct.byNodeState[e[0].state]||"")+"")&&S(p,W),1&n&&q!==(q=e[0].type+"")&&S(O,q),1&n&&U!==(U=e[0].state+"")&&S(A,U),"client"===e[0].type?X?X.p(e,n):(X=Lt(e),X.c(),X.m(L.parentNode,L)):X&&(X.d(1),X=null),1&n&&G!==(G=e[0].connected?"disconnect":"reconnect")&&S(_,G)},d(e){e&&g(t),e&&g(r),e&&g(l),e&&g(h),e&&g(v),e&&g(M),X&&X.d(e),e&&g(L),e&&g(j),e&&g(R),e&&g(D),H=!1,o(F)}}}function At(e){let t,n,s,r,l,a,c,d,u,p,h,v,k,$,O,I,N,C,P,A,M,L,j,R,D,_,H,F,z,B,W,q=e[0].id+"",U=e[0].toId+"",G=e[0].fromId+"",X=Ct.byMessageMethod[e[0].method]+"",J=e[0].method+"";return{c(){t=y("h1"),n=b("Message "),s=b(q),r=w(),l=y("p"),a=b(U),c=b(" → "),d=b(G),u=w(),p=y("p"),h=b(X),v=w(),k=y("ul"),$=y("li"),O=b("method: "),I=y("span"),N=b(J),C=w(),P=y("li"),A=b("value: "),M=y("input"),L=w(),j=y("li"),R=b("generation: "),D=y("input"),_=w(),H=y("button"),H.textContent="delete",F=w(),z=y("button"),z.textContent="modify",E(I,"class","svelte-1muk73i"),E($,"class","svelte-1muk73i"),E(M,"type","text"),E(P,"class","svelte-1muk73i"),E(D,"type","text"),E(j,"class","svelte-1muk73i"),E(k,"class","property-list svelte-1muk73i")},m(o,g){m(o,t,g),f(t,n),f(t,s),m(o,r,g),m(o,l,g),f(l,a),f(l,c),f(l,d),m(o,u,g),m(o,p,g),f(p,h),m(o,v,g),m(o,k,g),f(k,$),f($,O),f($,I),f(I,N),f(k,C),f(k,P),f(P,A),f(P,M),T(M,e[0].v),f(k,L),f(k,j),f(j,R),f(j,D),T(D,e[0].n),m(o,_,g),m(o,H,g),m(o,F,g),m(o,z,g),B||(W=[x(M,"input",e[5]),x(D,"input",e[6]),x(H,"click",(function(){i(e[1].delete)&&e[1].delete.apply(this,arguments)})),x(z,"click",(function(){i(e[1].modify)&&e[1].modify.apply(this,arguments)}))],B=!0)},p(t,n){e=t,1&n&&q!==(q=e[0].id+"")&&S(s,q),1&n&&U!==(U=e[0].toId+"")&&S(a,U),1&n&&G!==(G=e[0].fromId+"")&&S(d,G),1&n&&X!==(X=Ct.byMessageMethod[e[0].method]+"")&&S(h,X),1&n&&J!==(J=e[0].method+"")&&S(N,J),1&n&&M.value!==e[0].v&&T(M,e[0].v),1&n&&D.value!==e[0].n&&T(D,e[0].n)},d(e){e&&g(t),e&&g(r),e&&g(l),e&&g(u),e&&g(p),e&&g(v),e&&g(k),e&&g(_),e&&g(H),e&&g(F),e&&g(z),B=!1,o(W)}}}function Mt(t){let n;return{c(){n=y("span"),n.textContent="No valid element select"},m(e,t){m(e,n,t)},p:e,d(e){e&&g(n)}}}function Lt(e){let t,n,s,r,l;return{c(){t=y("input"),n=w(),s=y("button"),s.textContent="request",E(t,"type","text")},m(o,a){m(o,t,a),T(t,e[2]),m(o,n,a),m(o,s,a),r||(l=[x(t,"input",e[7]),x(s,"click",(function(){i(e[4])&&e[4].apply(this,arguments)}))],r=!0)},p(n,s){e=n,4&s&&t.value!==e[2]&&T(t,e[2])},d(e){e&&g(t),e&&g(n),e&&g(s),r=!1,o(l)}}}function jt(t){let n;function s(e,t){return e[0]?e[3]?At:Pt:Mt}let o=s(t),i=o(t);return{c(){n=y("div"),i.c(),E(n,"class","node-actions-panel")},m(e,t){m(e,n,t),i.m(n,null)},p(e,[t]){o===(o=s(e))&&i?i.p(e,t):(i.d(1),i=o(e),i&&(i.c(),i.m(n,null)))},i:e,o:e,d(e){e&&g(n),i.d()}}}function Rt(e,t,n){let{element:s}=t,{actions:o}=t;function i(e,t,n){n[s.id].postMessage({nodeId:s.id,isFlow:!0,type:"CLIENT_REQUEST",v:r})}let r="777",l="",a=!1,c=()=>{};return A((()=>{o&&!a&&s&&"client"===s.type&&n(4,c=o.createNewAction(i)),s&&l!==s.id&&(n(2,r=s.id),l=s.id,n(3,a=s&&s.fromId))})),e.$$set=e=>{"element"in e&&n(0,s=e.element),"actions"in e&&n(1,o=e.actions)},[s,o,r,a,c,function(){s.v=this.value,n(0,s)},function(){s.n=this.value,n(0,s)},function(){r=this.value,n(2,r)}]}function Dt(e,t,n){const s=e.slice();return s[3]=t[n],s}function _t(e,t,n){const s=e.slice();return s[6]=t[n],s}function Ht(e){let t,n=e[1].nodes.filter(Wt),s=[];for(let o=0;o<n.length;o+=1)s[o]=zt(Dt(e,n,o));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=k()},m(e,n){for(let t=0;t<s.length;t+=1)s[t].m(e,n);m(e,t,n)},p(e,o){if(2&o){let i;for(n=e[1].nodes.filter(Wt),i=0;i<n.length;i+=1){const r=Dt(e,n,i);s[i]?s[i].p(r,o):(s[i]=zt(r),s[i].c(),s[i].m(t.parentNode,t))}for(;i<s.length;i+=1)s[i].d(1);s.length=n.length}},d(e){v(s,e),e&&g(t)}}}function Ft(e){let t,n,s=e[6]+"";return{c(){t=y("li"),n=b(s),E(t,"class","entry svelte-1o1yvcd")},m(e,s){m(e,t,s),f(t,n)},p(e,t){2&t&&s!==(s=e[6]+"")&&S(n,s)},d(e){e&&g(t)}}}function zt(e){let t,n,s,o,i,r,l,a=e[3].id+"",c=e[3].learner.log,d=[];for(let u=0;u<c.length;u+=1)d[u]=Ft(_t(e,c,u));return{c(){t=y("li"),n=y("h1"),s=b(a),o=w(),i=y("ul");for(let e=0;e<d.length;e+=1)d[e].c();l=w(),E(n,"class","svelte-1o1yvcd"),E(i,"class",r=h(e[1].selectedElementId===e[3].id?"selected":"")+" svelte-1o1yvcd"),E(t,"class","log svelte-1o1yvcd")},m(e,r){m(e,t,r),f(t,n),f(n,s),f(t,o),f(t,i);for(let t=0;t<d.length;t+=1)d[t].m(i,null);f(t,l)},p(e,t){if(2&t&&a!==(a=e[3].id+"")&&S(s,a),2&t){let n;for(c=e[3].learner.log,n=0;n<c.length;n+=1){const s=_t(e,c,n);d[n]?d[n].p(s,t):(d[n]=Ft(s),d[n].c(),d[n].m(i,null))}for(;n<d.length;n+=1)d[n].d(1);d.length=c.length}2&t&&r!==(r=h(e[1].selectedElementId===e[3].id?"selected":"")+" svelte-1o1yvcd")&&E(i,"class",r)},d(e){e&&g(t),v(d,e)}}}function Bt(t){let n,s,o=t[0]&&Ht(t);return{c(){n=y("div"),s=y("ul"),o&&o.c(),E(s,"class","nodes svelte-1o1yvcd"),O(n,"overflow","auto")},m(e,t){m(e,n,t),f(n,s),o&&o.m(s,null)},p(e,[t]){e[0]?o?o.p(e,t):(o=Ht(e),o.c(),o.m(s,null)):o&&(o.d(1),o=null)},i:e,o:e,d(e){e&&g(n),o&&o.d()}}}const Wt=e=>"node"===e.type&&e.learner;function qt(t,n,s){let o,i=e,r=()=>(i(),i=l(c,(e=>s(1,o=e))),c);t.$$.on_destroy.push((()=>i()));let{configStore:a}=n,{stateStore:c}=n;return r(),t.$$set=e=>{"configStore"in e&&s(2,a=e.configStore),"stateStore"in e&&r(s(0,c=e.stateStore))},[c,o,a]}const Ut="paxos",Gt={seqPaintingOptions:$t,nodePaintingOptions:{isLeader:e=>{var t;return null===(t=e.proposer)||void 0===t?void 0:t.isProposer}},paintState:function(e,t,n,s=St){return t?(s={...St,...s},t.nodes.forEach(((t,n)=>{var o;const i=30*n;e.beginPath(),e.fillStyle="#000",e.font="20px courier new";let r=[0,i+12];e.fillText(t.id,...r),e.closePath();let l=20*t.id.length+St.padding;(null===(o=t.proposer)||void 0===o?void 0:o.log)&&t.proposer.log.filter((e=>e)).forEach((t=>{e.beginPath(),e.lineWidth=2,e.strokeStyle="#000";const n=10*t.length;e.rect(l-s.padding,i,n+2*s.padding,10),e.stroke(),e.closePath(),e.beginPath(),e.fillStyle="#000",e.font="12px courier new";let o=l+12*t.length+2,r=[o,i+8];l=o,e.fillText(t,...r),e.closePath()}))})),[0,30*(t.nodes.length+1)]):[e.canvas.width,e.canvas.height]}},Xt={Configuration:class extends oe{constructor(e){super(),se(this,e,Nt,It,r,{config:0})}},Actions:class extends oe{constructor(e){super(),se(this,e,Rt,jt,r,{element:0,actions:1})}},StateGraph:class extends oe{constructor(e){super(),se(this,e,qt,Bt,r,{configStore:2,stateStore:0})}}};var Jt=Object.freeze(Object.defineProperty({__proto__:null,title:"Paxos",key:Ut,drawing:Gt,components:Xt,setupNode:nt,generateState:xt,defaultConfig:Et},Symbol.toStringTag,{value:"Module"}));const Qt={...Re,getText:e=>"rawtransaction"===e.command?`${e.command} (${e.tx})`:"submitblock"===e.command&&e.block.transactions?`${e.command} (${e.block.transactions.join(", ")})`:`${e.command}`};function Kt(t){let n,s,i,r,l,a,c,d,u,p,h,v;return{c(){n=y("div"),s=y("div"),i=y("label"),r=b("Number of Clients\r\n            "),l=y("input"),a=w(),c=y("div"),d=y("label"),u=b("Number of Nodes\r\n            "),p=y("input"),E(l,"type","number"),E(l,"min","1"),E(l,"max",10),E(s,"class","input-group"),E(p,"type","number"),E(p,"min","1"),E(p,"max",10),E(c,"class","input-group")},m(e,o){m(e,n,o),f(n,s),f(s,i),f(i,r),f(i,l),T(l,t[1].numberOfClients),f(n,a),f(n,c),f(c,d),f(d,u),f(d,p),T(p,t[1].numberOfNodes),h||(v=[x(l,"input",t[2]),x(p,"input",t[3])],h=!0)},p(e,[t]){2&t&&$(l.value)!==e[1].numberOfClients&&T(l,e[1].numberOfClients),2&t&&$(p.value)!==e[1].numberOfNodes&&T(p,e[1].numberOfNodes)},i:e,o:e,d(e){e&&g(n),h=!1,o(v)}}}function Yt(t,n,s){let o,i=e,r=()=>(i(),i=l(a,(e=>s(1,o=e))),a);t.$$.on_destroy.push((()=>i()));let{config:a}=n;return r(),t.$$set=e=>{"config"in e&&r(s(0,a=e.config))},[a,o,function(){o.numberOfClients=$(this.value),a.set(o)},function(){o.numberOfNodes=$(this.value),a.set(o)}]}const Vt={byNodeType:{node:"Nodes accept, save and relay new transactions/blocks.\n            A Node can also create Blocks with saved blocks.\n            Nodes joins the Network and asks for the current blockchain.",client:"A client uses a node to request a transaction to be saved on the blockchain.\n      Clients can be outside of the P2P network. \n      They may use external providers that actually own nodes to send transactions."},byNodeSync:{true:"Sync nodes can send their blockchain to new nodes."},byMessageCommand:{REQUEST:"Clients request transactions to be stored on the blockchain.",getblocks:"New nodes bootstrap by asking sync nodes for their blockchain.",blocks:"Sync nodes answer with their blocks to new nodes (getblocks).",submitblock:"Nodes send new mined blocks to their neighbors.",rawtransaction:"Nodes relay transactions to their neighbors."}};function Zt(e,t,n){const s=e.slice();return s[1]=t[n],s}function en(e){let t,n,s,o=e[0].transactions,i=[];for(let r=0;r<o.length;r+=1)i[r]=tn(Zt(e,o,r));return{c(){t=y("div"),n=b("transactions: "),s=y("ul");for(let e=0;e<i.length;e+=1)i[e].c();E(s,"class","transactions")},m(e,o){m(e,t,o),f(t,n),f(t,s);for(let t=0;t<i.length;t+=1)i[t].m(s,null)},p(e,t){if(1&t){let n;for(o=e[0].transactions,n=0;n<o.length;n+=1){const r=Zt(e,o,n);i[n]?i[n].p(r,t):(i[n]=tn(r),i[n].c(),i[n].m(s,null))}for(;n<i.length;n+=1)i[n].d(1);i.length=o.length}},d(e){e&&g(t),v(i,e)}}}function tn(e){let t,n,s=e[1]+"";return{c(){t=y("li"),n=b(s)},m(e,s){m(e,t,s),f(t,n)},p(e,t){1&t&&s!==(s=e[1]+"")&&S(n,s)},d(e){e&&g(t)}}}function nn(t){var n,s,o;let i,r,l,a,c,d,u,p,h,v,k,x,$,T,O,I,N,C,P,A,M,L,j,R=(null===(n=t[0].header)||void 0===n||null===(s=n.prevHeaderHash)||void 0===s?void 0:s.slice(0,8))+"",D=(null===(o=t[0].header)||void 0===o?void 0:o.merkleRoot)+"",_=t[0].height+"",H=new Date(t[0].timestamp).toLocaleString()+"",F=t[0].transactions&&0!==t[0].transactions.length&&en(t);return{c(){i=y("ul"),r=y("li"),l=b("prevHeaderHash: "),a=y("span"),c=b("0x"),d=b(R),u=b("..."),p=w(),h=y("li"),v=b("merkleRoot: "),k=y("span"),x=b(D),$=w(),T=y("li"),O=b("height: "),I=y("span"),N=b(_),C=w(),P=y("li"),A=b("timestamp: "),M=y("span"),L=b(H),j=w(),F&&F.c(),E(i,"class","block svelte-cd4rqg")},m(e,t){m(e,i,t),f(i,r),f(r,l),f(r,a),f(a,c),f(a,d),f(a,u),f(i,p),f(i,h),f(h,v),f(h,k),f(k,x),f(i,$),f(i,T),f(T,O),f(T,I),f(I,N),f(i,C),f(i,P),f(P,A),f(P,M),f(M,L),f(i,j),F&&F.m(i,null)},p(e,[t]){var n,s,o;1&t&&R!==(R=(null===(n=e[0].header)||void 0===n||null===(s=n.prevHeaderHash)||void 0===s?void 0:s.slice(0,8))+"")&&S(d,R),1&t&&D!==(D=(null===(o=e[0].header)||void 0===o?void 0:o.merkleRoot)+"")&&S(x,D),1&t&&_!==(_=e[0].height+"")&&S(N,_),1&t&&H!==(H=new Date(e[0].timestamp).toLocaleString()+"")&&S(L,H),e[0].transactions&&0!==e[0].transactions.length?F?F.p(e,t):(F=en(e),F.c(),F.m(i,null)):F&&(F.d(1),F=null)},i:e,o:e,d(e){e&&g(i),F&&F.d()}}}function sn(e,t,n){let{block:s}=t;return e.$$set=e=>{"block"in e&&n(0,s=e.block)},[s]}class on extends oe{constructor(e){super(),se(this,e,sn,nn,r,{block:0})}}function rn(e,t,n){const s=e.slice();return s[9]=t[n],s}function ln(t){let n,s,r,l,a,c,d,u,p,h,v,k,$,T,O,I,N,C,P,A,M,L,j,R,D,_,H,F,z,B,W=t[0].id+"",q=(Vt.byNodeType[t[0].type]||"No information")+"",U=(Vt.byNodeSync[t[0].sync]||"")+"",G=t[0].type+"",X=t[0].state+"",J=t[0].connected?"disconnect":"reconnect",Q="client"!==t[0].type&&dn(t),K="client"===t[0].type&&un(t);return{c(){n=y("h1"),s=b("Node "),r=b(W),l=w(),a=y("p"),c=y("span"),d=b(q),u=w(),p=y("span"),h=b(U),v=w(),k=y("ul"),$=y("li"),T=b("type: "),O=y("span"),I=b(G),N=w(),C=y("li"),P=b("state: "),A=y("span"),M=b(X),L=w(),Q&&Q.c(),j=w(),K&&K.c(),R=w(),D=y("button"),D.textContent="restart",_=w(),H=y("button"),F=b(J),E(O,"class","svelte-1gcbars"),E($,"class","svelte-1gcbars"),E(A,"class","svelte-1gcbars"),E(C,"class","svelte-1gcbars"),E(k,"class","property-list svelte-1gcbars")},m(e,o){m(e,n,o),f(n,s),f(n,r),m(e,l,o),m(e,a,o),f(a,c),f(c,d),f(a,u),f(a,p),f(p,h),m(e,v,o),m(e,k,o),f(k,$),f($,T),f($,O),f(O,I),f(k,N),f(k,C),f(C,P),f(C,A),f(A,M),f(k,L),Q&&Q.m(k,null),m(e,j,o),K&&K.m(e,o),m(e,R,o),m(e,D,o),m(e,_,o),m(e,H,o),f(H,F),z||(B=[x(D,"click",(function(){i(t[1].restart)&&t[1].restart.apply(this,arguments)})),x(H,"click",(function(){i(t[1].connectOrDisconnect)&&t[1].connectOrDisconnect.apply(this,arguments)}))],z=!0)},p(e,n){t=e,1&n&&W!==(W=t[0].id+"")&&S(r,W),1&n&&q!==(q=(Vt.byNodeType[t[0].type]||"No information")+"")&&S(d,q),1&n&&U!==(U=(Vt.byNodeSync[t[0].sync]||"")+"")&&S(h,U),1&n&&G!==(G=t[0].type+"")&&S(I,G),1&n&&X!==(X=t[0].state+"")&&S(M,X),"client"!==t[0].type?Q?Q.p(t,n):(Q=dn(t),Q.c(),Q.m(k,null)):Q&&(Q.d(1),Q=null),"client"===t[0].type?K?K.p(t,n):(K=un(t),K.c(),K.m(R.parentNode,R)):K&&(K.d(1),K=null),1&n&&J!==(J=t[0].connected?"disconnect":"reconnect")&&S(F,J)},i:e,o:e,d(e){e&&g(n),e&&g(l),e&&g(a),e&&g(v),e&&g(k),Q&&Q.d(),e&&g(j),K&&K.d(e),e&&g(R),e&&g(D),e&&g(_),e&&g(H),z=!1,o(B)}}}function an(e){let t,n,s,r,l,a,c,d,u,p,h,v,k,$,T,O,I,N,C,P,A,M,L,j,R,D,_,H=e[0].id+"",F=e[0].toId+"",z=e[0].fromId+"",B=Vt.byMessageCommand[e[0].command]+"",W=e[0].command+"";const q=[fn,hn,pn],U=[];function G(e,t){return"blocks"===e[0].command?0:"rawtransaction"===e[0].command||"REQUEST"===e[0].command?1:"submitblock"===e[0].command?2:-1}return~(C=G(e))&&(P=U[C]=q[C](e)),{c(){t=y("h1"),n=b("Message "),s=b(H),r=w(),l=y("p"),a=b(F),c=b(" → "),d=b(z),u=w(),p=y("p"),h=b(B),v=w(),k=y("ul"),$=y("li"),T=b("command: "),O=y("span"),I=b(W),N=w(),P&&P.c(),A=w(),M=y("button"),M.textContent="delete",L=w(),j=y("button"),j.textContent="modify",E(O,"class","svelte-1gcbars"),E($,"class","svelte-1gcbars"),E(k,"class","property-list svelte-1gcbars")},m(o,g){m(o,t,g),f(t,n),f(t,s),m(o,r,g),m(o,l,g),f(l,a),f(l,c),f(l,d),m(o,u,g),m(o,p,g),f(p,h),m(o,v,g),m(o,k,g),f(k,$),f($,T),f($,O),f(O,I),f(k,N),~C&&U[C].m(k,null),m(o,A,g),m(o,M,g),m(o,L,g),m(o,j,g),R=!0,D||(_=[x(M,"click",(function(){i(e[1].delete)&&e[1].delete.apply(this,arguments)})),x(j,"click",(function(){i(e[1].modify)&&e[1].modify.apply(this,arguments)}))],D=!0)},p(t,n){e=t,(!R||1&n)&&H!==(H=e[0].id+"")&&S(s,H),(!R||1&n)&&F!==(F=e[0].toId+"")&&S(a,F),(!R||1&n)&&z!==(z=e[0].fromId+"")&&S(d,z),(!R||1&n)&&B!==(B=Vt.byMessageCommand[e[0].command]+"")&&S(h,B),(!R||1&n)&&W!==(W=e[0].command+"")&&S(I,W);let o=C;C=G(e),C===o?~C&&U[C].p(e,n):(P&&(X(),K(U[o],1,1,(()=>{U[o]=null})),J()),~C?(P=U[C],P?P.p(e,n):(P=U[C]=q[C](e),P.c()),Q(P,1),P.m(k,null)):P=null)},i(e){R||(Q(P),R=!0)},o(e){K(P),R=!1},d(e){e&&g(t),e&&g(r),e&&g(l),e&&g(u),e&&g(p),e&&g(v),e&&g(k),~C&&U[C].d(),e&&g(A),e&&g(M),e&&g(L),e&&g(j),D=!1,o(_)}}}function cn(t){let n;return{c(){n=y("span"),n.textContent="No valid element select"},m(e,t){m(e,n,t)},p:e,i:e,o:e,d(e){e&&g(n)}}}function dn(e){let t,n,s,o,i=(!0===e[0].sync)+"";return{c(){t=y("li"),n=b("sync: "),s=y("span"),o=b(i),E(s,"class","svelte-1gcbars"),E(t,"class","svelte-1gcbars")},m(e,i){m(e,t,i),f(t,n),f(t,s),f(s,o)},p(e,t){1&t&&i!==(i=(!0===e[0].sync)+"")&&S(o,i)},d(e){e&&g(t)}}}function un(e){let t,n,s,r,l;return{c(){t=y("input"),n=w(),s=y("button"),s.textContent="request",E(t,"type","text")},m(o,a){m(o,t,a),T(t,e[2]),m(o,n,a),m(o,s,a),r||(l=[x(t,"input",e[5]),x(s,"click",(function(){i(e[4])&&e[4].apply(this,arguments)}))],r=!0)},p(n,s){e=n,4&s&&t.value!==e[2]&&T(t,e[2])},d(e){e&&g(t),e&&g(n),e&&g(s),r=!1,o(l)}}}function pn(e){let t,n;return t=new on({props:{block:e[0].block}}),{c(){Z(t.$$.fragment)},m(e,s){ee(t,e,s),n=!0},p(e,n){const s={};1&n&&(s.block=e[0].block),t.$set(s)},i(e){n||(Q(t.$$.fragment,e),n=!0)},o(e){K(t.$$.fragment,e),n=!1},d(e){te(t,e)}}}function hn(t){let n,s,o,i,r=t[0].tx+"";return{c(){n=y("li"),s=b("transaction: "),o=y("span"),i=b(r),E(o,"class","svelte-1gcbars"),E(n,"class","svelte-1gcbars")},m(e,t){m(e,n,t),f(n,s),f(n,o),f(o,i)},p(e,t){1&t&&r!==(r=e[0].tx+"")&&S(i,r)},i:e,o:e,d(e){e&&g(n)}}}function fn(e){let t,n,s,o,i=e[0].entries,r=[];for(let a=0;a<i.length;a+=1)r[a]=mn(rn(e,i,a));const l=e=>K(r[e],1,1,(()=>{r[e]=null}));return{c(){t=y("li"),n=b("entries:\r\n                    "),s=y("ul");for(let e=0;e<r.length;e+=1)r[e].c();E(s,"class","property-list entries svelte-1gcbars"),E(t,"class","svelte-1gcbars")},m(e,i){m(e,t,i),f(t,n),f(t,s);for(let t=0;t<r.length;t+=1)r[t].m(s,null);o=!0},p(e,t){if(1&t){let n;for(i=e[0].entries,n=0;n<i.length;n+=1){const o=rn(e,i,n);r[n]?(r[n].p(o,t),Q(r[n],1)):(r[n]=mn(o),r[n].c(),Q(r[n],1),r[n].m(s,null))}for(X(),n=i.length;n<r.length;n+=1)l(n);J()}},i(e){if(!o){for(let e=0;e<i.length;e+=1)Q(r[e]);o=!0}},o(e){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)K(r[t]);o=!1},d(e){e&&g(t),v(r,e)}}}function mn(e){let t,n,s,o;return n=new on({props:{block:e[9]}}),{c(){t=y("li"),Z(n.$$.fragment),s=w(),E(t,"class","svelte-1gcbars")},m(e,i){m(e,t,i),ee(n,t,null),f(t,s),o=!0},p(e,t){const s={};1&t&&(s.block=e[9]),n.$set(s)},i(e){o||(Q(n.$$.fragment,e),o=!0)},o(e){K(n.$$.fragment,e),o=!1},d(e){e&&g(t),te(n)}}}function gn(e){let t,n,s,o;const i=[cn,an,ln],r=[];function l(e,t){return e[0]?e[3]?1:2:0}return n=l(e),s=r[n]=i[n](e),{c(){t=y("div"),s.c(),E(t,"class","node-actions-panel")},m(e,s){m(e,t,s),r[n].m(t,null),o=!0},p(e,[o]){let a=n;n=l(e),n===a?r[n].p(e,o):(X(),K(r[a],1,1,(()=>{r[a]=null})),J(),s=r[n],s?s.p(e,o):(s=r[n]=i[n](e),s.c()),Q(s,1),s.m(t,null))},i(e){o||(Q(s),o=!0)},o(e){K(s),o=!1},d(e){e&&g(t),r[n].d()}}}function vn(e,t,n){let{element:s}=t,{actions:o}=t;function i(e,t,n){n[s.id].postMessage({nodeId:s.id,isFlow:!0,type:"CLIENT_REQUEST",v:r})}let r="777",l="",a=!1,c=()=>{};return A((()=>{o&&!a&&s&&"client"===s.type&&n(4,c=o.createNewAction(i)),s&&l!==s.id&&(n(2,r=s.id),l=s.id,n(3,a=s&&s.fromId))})),e.$$set=e=>{"element"in e&&n(0,s=e.element),"actions"in e&&n(1,o=e.actions)},[s,o,r,a,c,function(){r=this.value,n(2,r)}]}function yn(e,t,n){const s=e.slice();return s[3]=t[n],s}function bn(e,t,n){const s=e.slice();return s[6]=t[n],s}function wn(e,t,n){const s=e.slice();return s[9]=t[n],s}function kn(e){let t,n=e[1].nodes.filter(Nn),s=[];for(let o=0;o<n.length;o+=1)s[o]=On(yn(e,n,o));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=k()},m(e,n){for(let t=0;t<s.length;t+=1)s[t].m(e,n);m(e,t,n)},p(e,o){if(2&o){let i;for(n=e[1].nodes.filter(Nn),i=0;i<n.length;i+=1){const r=yn(e,n,i);s[i]?s[i].p(r,o):(s[i]=On(r),s[i].c(),s[i].m(t.parentNode,t))}for(;i<s.length;i+=1)s[i].d(1);s.length=n.length}},d(e){v(s,e),e&&g(t)}}}function xn(e){let t,n=e[3].chain,s=[];for(let o=0;o<n.length;o+=1)s[o]=Tn(bn(e,n,o));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=k()},m(e,n){for(let t=0;t<s.length;t+=1)s[t].m(e,n);m(e,t,n)},p(e,o){if(2&o){let i;for(n=e[3].chain,i=0;i<n.length;i+=1){const r=bn(e,n,i);s[i]?s[i].p(r,o):(s[i]=Tn(r),s[i].c(),s[i].m(t.parentNode,t))}for(;i<s.length;i+=1)s[i].d(1);s.length=n.length}},d(e){v(s,e),e&&g(t)}}}function En(e){var t;let n,s,o,i,r,l,a,c,d,u,p,h,v,k,x,$,T,O,I,N=(e[6].header.prevHeaderHash&&"0x"+(null===(t=e[6].header.prevHeaderHash)||void 0===t?void 0:t.slice(0,8))+"...")+"",C=e[6].header.merkleRoot+"",P=e[6].height+"",A=e[6].transactions&&0!==e[6].transactions.length&&$n(e);return{c(){n=y("li"),s=y("p"),o=b("prevHeaderHash: "),i=y("span"),r=b(N),l=w(),a=y("p"),c=b("merkleRoot: "),d=y("span"),u=b(C),p=w(),h=y("p"),v=b("height: "),k=y("span"),x=b(P),$=w(),A&&A.c(),O=w(),I=y("p"),I.textContent=">",E(s,"class","svelte-ylgkgj"),E(a,"class","svelte-ylgkgj"),E(h,"class","svelte-ylgkgj"),E(n,"class",T="block "+(e[1].selectedElementId===e[3].id?"selected":"")+" svelte-ylgkgj"),E(I,"class","arrow svelte-ylgkgj")},m(e,t){m(e,n,t),f(n,s),f(s,o),f(s,i),f(i,r),f(n,l),f(n,a),f(a,c),f(a,d),f(d,u),f(n,p),f(n,h),f(h,v),f(h,k),f(k,x),f(n,$),A&&A.m(n,null),m(e,O,t),m(e,I,t)},p(e,t){var s;2&t&&N!==(N=(e[6].header.prevHeaderHash&&"0x"+(null===(s=e[6].header.prevHeaderHash)||void 0===s?void 0:s.slice(0,8))+"...")+"")&&S(r,N),2&t&&C!==(C=e[6].header.merkleRoot+"")&&S(u,C),2&t&&P!==(P=e[6].height+"")&&S(x,P),e[6].transactions&&0!==e[6].transactions.length?A?A.p(e,t):(A=$n(e),A.c(),A.m(n,null)):A&&(A.d(1),A=null),2&t&&T!==(T="block "+(e[1].selectedElementId===e[3].id?"selected":"")+" svelte-ylgkgj")&&E(n,"class",T)},d(e){e&&g(n),A&&A.d(),e&&g(O),e&&g(I)}}}function $n(e){let t,n,s,o=e[6].transactions,i=[];for(let r=0;r<o.length;r+=1)i[r]=Sn(wn(e,o,r));return{c(){t=y("div"),n=b("transactions: "),s=y("ul");for(let e=0;e<i.length;e+=1)i[e].c();E(s,"class","transactions svelte-ylgkgj")},m(e,o){m(e,t,o),f(t,n),f(t,s);for(let t=0;t<i.length;t+=1)i[t].m(s,null)},p(e,t){if(2&t){let n;for(o=e[6].transactions,n=0;n<o.length;n+=1){const r=wn(e,o,n);i[n]?i[n].p(r,t):(i[n]=Sn(r),i[n].c(),i[n].m(s,null))}for(;n<i.length;n+=1)i[n].d(1);i.length=o.length}},d(e){e&&g(t),v(i,e)}}}function Sn(e){let t,n,s=e[9]+"";return{c(){t=y("li"),n=b(s)},m(e,s){m(e,t,s),f(t,n)},p(e,t){2&t&&s!==(s=e[9]+"")&&S(n,s)},d(e){e&&g(t)}}}function Tn(e){let t,n=e[6]&&En(e);return{c(){n&&n.c(),t=k()},m(e,s){n&&n.m(e,s),m(e,t,s)},p(e,s){e[6]?n?n.p(e,s):(n=En(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&g(t)}}}function On(e){let t,n,s,o,i,r,l=e[3].id+"",a=e[3].chain&&xn(e);return{c(){t=y("li"),n=y("h1"),s=b(l),o=w(),i=y("ul"),a&&a.c(),r=w(),E(n,"class","svelte-ylgkgj"),E(i,"class","chain-list svelte-ylgkgj"),E(t,"class","chain svelte-ylgkgj")},m(e,l){m(e,t,l),f(t,n),f(n,s),f(t,o),f(t,i),a&&a.m(i,null),f(t,r)},p(e,t){2&t&&l!==(l=e[3].id+"")&&S(s,l),e[3].chain?a?a.p(e,t):(a=xn(e),a.c(),a.m(i,null)):a&&(a.d(1),a=null)},d(e){e&&g(t),a&&a.d()}}}function In(t){let n,s,o=t[0]&&kn(t);return{c(){n=y("div"),s=y("ul"),o&&o.c(),E(s,"class","nodes svelte-ylgkgj"),O(n,"overflow","auto")},m(e,t){m(e,n,t),f(n,s),o&&o.m(s,null)},p(e,[t]){e[0]?o?o.p(e,t):(o=kn(e),o.c(),o.m(s,null)):o&&(o.d(1),o=null)},i:e,o:e,d(e){e&&g(n),o&&o.d()}}}const Nn=e=>"node"===e.type;function Cn(t,n,s){let o,i=e,r=()=>(i(),i=l(c,(e=>s(1,o=e))),c);t.$$.on_destroy.push((()=>i()));let{configStore:a}=n,{stateStore:c}=n;return r(),t.$$set=e=>{"configStore"in e&&s(2,a=e.configStore),"stateStore"in e&&r(s(0,c=e.stateStore))},[c,o,a]}const Pn="bitcoin_pow",An={seqPaintingOptions:Qt,nodePaintingOptions:{isLeader:e=>!1},paintState:function(e,t,n){return[e.canvas.width,e.canvas.height]}},Mn={Configuration:class extends oe{constructor(e){super(),se(this,e,Yt,Kt,r,{config:0})}},Actions:class extends oe{constructor(e){super(),se(this,e,vn,gn,r,{element:0,actions:1})}},StateGraph:class extends oe{constructor(e){super(),se(this,e,Cn,In,r,{configStore:2,stateStore:0})}}};const Ln={[Ut]:Jt,[Pn]:Object.freeze(Object.defineProperty({__proto__:null,title:"Bitcoin/Proof-of-Work",key:Pn,drawing:An,components:Mn,setupNode:ct,generateState:function(e){const t={selectedElementId:void 0,started:new Date,speed:1,nodes:[],messages:[]};for(let s=0;s<e.numberOfClients;s++)t.nodes.push({id:"C"+(s+1),type:"client",running:!0,connected:!0,state:"IDLE",pos:[50+60*s,50]});const n=kt(e.numberOfNodes,80);for(let s=0;s<e.numberOfNodes;s++)t.nodes.push({id:"N"+(s+1),type:"node",running:!0,connected:!0,state:"IDLE",pos:[n[s][0]+80,n[s][1]+80]});return t},defaultConfig:{numberOfClients:1,numberOfNodes:5}},Symbol.toStringTag,{value:"Module"}))};function jn(e=Ln.paxos){let t={...Ge};t={...t,...e&&e.defaultConfig?e.defaultConfig:Et};const n=ue(t);n.subscribe((e=>{t=e}));const s=ue((e&&e.generateState?e.generateState:xt)(t));s.subscribe((e=>{}));const o=ue(null);o.subscribe((e=>{}));const i=function(e,t,n,s,o){let i=null;return t=>{if(i&&i.key===t.algorithm&&i.useWorkers===t.useWorkers)return i=t,t;if(i=t,e.key!==t.algorithm){(e=Ln[t.algorithm])||console.error("algorithm not supported");const n={};Object.keys(Ge).forEach((e=>{n[e]=t[e]})),t={...n,...e.defaultConfig}}return Rn(e,t,n,s,o),t}}(e,0,s,o,n);return n.subscribe(i),i(t),[n,s,o]}function Rn(e,t,n,s,o){const i=(0,e.generateState)(t);n.update((()=>i));const[r,l]=wt(Dn(t,o),Dn(i,n),(()=>Rn(e,t,n,s,o)));return s.update((e=>(e&&e.simulation&&e.simulation.terminate(),l))),i}function Dn(e,t){let n=e;return t.subscribe((e=>n=e)),{value:n,update:t.update}}function _n(t){let n,s,o,i;return{c(){n=y("span"),s=b("Layout '"),o=b(t[0]),i=b("' not supported")},m(e,t){m(e,n,t),f(n,s),f(n,o),f(n,i)},p(e,t){1&t&&S(o,e[0])},i:e,o:e,d(e){e&&g(n)}}}function Hn(e){let n,s;const o=[e[1]];let i={};for(let r=0;r<o.length;r+=1)i=t(i,o[r]);return n=new Ue({props:i}),{c(){Z(n.$$.fragment)},m(e,t){ee(n,e,t),s=!0},p(e,t){const s=2&t?Y(o,[V(e[1])]):{};n.$set(s)},i(e){s||(Q(n.$$.fragment,e),s=!0)},o(e){K(n.$$.fragment,e),s=!1},d(e){te(n,e)}}}function Fn(e){let t,n,s,o;const i=[Hn,_n],r=[];function l(e,t){return"full"===e[0]?0:1}return t=l(e),n=r[t]=i[t](e),{c(){n.c(),s=k()},m(e,n){r[t].m(e,n),m(e,s,n),o=!0},p(e,[o]){let a=t;t=l(e),t===a?r[t].p(e,o):(X(),K(r[a],1,1,(()=>{r[a]=null})),J(),n=r[t],n?n.p(e,o):(n=r[t]=i[t](e),n.c()),Q(n,1),n.m(s.parentNode,s))},i(e){o||(Q(n),o=!0)},o(e){K(n),o=!1},d(e){r[t].d(e),e&&g(s)}}}function zn(e,t,n){let{layout:s="full"}=t,{registerAlgorithm:o}=t,{unregisterAlgorithm:i}=t;const[r,l,a]=jn();let c,d;r.subscribe((e=>{c=Ln[e.algorithm],c.labels})),l.subscribe((e=>{window.states||(window.stateIdx=-1,window.states=[]);const{nodes:t,messages:n}=e;window.stateIdx+=1,window.states.push({nodes:t,messages:n})})),a.subscribe((e=>{d=e})),P((()=>{o&&o(r,l)})),M((()=>{i&&i(r,l),d&&d.simulation.terminate()}));const u={configStore:r,stateStore:l,controlsStore:a,algorithm:c,algorithms:Ln};return e.$$set=e=>{"layout"in e&&n(0,s=e.layout),"registerAlgorithm"in e&&n(2,o=e.registerAlgorithm),"unregisterAlgorithm"in e&&n(3,i=e.unregisterAlgorithm)},[s,u,o,i]}class Bn extends oe{constructor(e){super(),se(this,e,zn,Fn,r,{layout:0,registerAlgorithm:2,unregisterAlgorithm:3})}}function Wn(t){let n;return{c(){n=y("footer"),n.innerHTML='<div class="content svelte-4jochn"><div class="brand svelte-4jochn"><img alt="logo" src="/favicon/android-icon-48x48.png" class="svelte-4jochn"/><span class="svelte-4jochn">Visual Consensus</span></div> \n        <div class="links svelte-4jochn"><p>Links</p> \n            <a href="https://github.com/jojahn/visual-consensus" class="svelte-4jochn">Source Code</a> \n            <a href="https://github.com/jojahn/visual-consensus/blob/main/latex/thesis.pdf" class="svelte-4jochn">Thesis</a> \n            <a href="about.html#ThirdPartyLicenses" class="svelte-4jochn">Third Party Licenses</a></div></div> \n    <div><p class="rights svelte-4jochn">Licensed under <a href="https://github.com/jojahn/visual-consensus/LICENSE" class="svelte-4jochn">MIT</a></p> \n        <p class="rights svelte-4jochn">2022 <a href="https://github.com/jojahn/visual-consensus/graphs/contributors" class="svelte-4jochn">contributers</a></p></div>',E(n,"class","svelte-4jochn")},m(e,t){m(e,n,t)},p:e,i:e,o:e,d(e){e&&g(n)}}}class qn extends oe{constructor(e){super(),se(this,e,null,Wn,r,{})}}function Un(e,t,n){const s=e.slice();return s[5]=t[n],s}function Gn(e){let t,n,s,o,i,r,l=e[5].title+"";return{c(){t=y("li"),n=y("button"),s=b(l),E(n,"class","svelte-1slpat4"),E(t,"class",o=h(e[0]===e[5].key?"active":"")+" svelte-1slpat4")},m(o,l){m(o,t,l),f(t,n),f(n,s),i||(r=x(n,"click",e[1](e[5].key)),i=!0)},p(n,s){e=n,1&s&&o!==(o=h(e[0]===e[5].key?"active":"")+" svelte-1slpat4")&&E(t,"class",o)},d(e){e&&g(t),i=!1,r()}}}function Xn(t){let n,s,o,i,r,l=Object.values(Ln),a=[];for(let e=0;e<l.length;e+=1)a[e]=Gn(Un(t,l,e));return{c(){n=y("header"),s=y("nav"),o=y("ul");for(let e=0;e<a.length;e+=1)a[e].c();i=w(),r=y("li"),r.innerHTML='<a href="/about.html" class="svelte-1slpat4">About</a>',E(r,"class","svelte-1slpat4"),E(o,"class","svelte-1slpat4"),E(s,"class","svelte-1slpat4"),E(n,"class","svelte-1slpat4")},m(e,t){m(e,n,t),f(n,s),f(s,o);for(let n=0;n<a.length;n+=1)a[n].m(o,null);f(o,i),f(o,r)},p(e,[t]){if(3&t){let n;for(l=Object.values(Ln),n=0;n<l.length;n+=1){const s=Un(e,l,n);a[n]?a[n].p(s,t):(a[n]=Gn(s),a[n].c(),a[n].m(o,i))}for(;n<a.length;n+=1)a[n].d(1);a.length=l.length}},i:e,o:e,d(e){e&&g(n),v(a,e)}}}function Jn(e,t,n){let{selectedAlgorithm:s}=t,{changeAlgorithm:o}=t,{share:i}=t;return e.$$set=e=>{"selectedAlgorithm"in e&&n(0,s=e.selectedAlgorithm),"changeAlgorithm"in e&&n(2,o=e.changeAlgorithm),"share"in e&&n(3,i=e.share)},[s,e=>()=>o(e),o,i]}class Qn extends oe{constructor(e){super(),se(this,e,Jn,Xn,r,{selectedAlgorithm:0,changeAlgorithm:2,share:3})}}var Kn,Yn={};function Vn(e){let t=e;return t=Yn.pack(e),t=window.btoa?btoa(t):t,t}function Zn(e,t){const n="/?config="+Vn(e)+"&state="+Vn(t);!function(e){const t="Visual Consensus",n={additionalInformation:"URL"};window.history.pushState(n,t,e)}(),navigator.clipboard.writeText(location.origin+n)}Kn=Yn,function(e,t){var n=t();for(var s in n)Kn[s]=n[s]}(0,(function(){var e=function(e){return"string"!=typeof e?e:e.replace(/[\+ \|\^\%]/g,(function(e){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[e]}))},t=function(e){return"string"!=typeof e?e:e.replace(/\+|%2B|%7C|%5E|%25/g,(function(e){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[e]}))},n=function(e){return Number.prototype.toString.call(e,36).toUpperCase()},s=function(e){return parseInt(e,36)},o=Array.prototype.indexOf||function(e,t){for(var n=t||0,s=this.length;n<s;n++)if(this[n]===e)return n;return-1};return{JSON:JSON,pack:function(t,s){var i=(s=s||{}).verbose||!1;i&&console.log("Normalize the JSON Object"),t="string"==typeof t?this.JSON.parse(t):t,i&&console.log("Creating a empty dictionary");var r={strings:[],integers:[],floats:[]};i&&console.log("Creating the AST");var l=function t(s){i&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(s));var l,a=typeof s;if(null===s)return{type:"null",index:-3};if(void 0===s)return{type:"undefined",index:-5};if(s instanceof Array){var c=["@"];for(var d in s)s.hasOwnProperty(d)&&c.push(t(s[d]));return c}if("object"===a){for(var u in c=["$"],s)s.hasOwnProperty(u)&&(c.push(t(u)),c.push(t(s[u])));return c}if(""===s)return{type:"empty",index:-4};if("string"===a)return-1==(l=o.call(r.strings,s))&&(r.strings.push(e(s)),l=r.strings.length-1),{type:"strings",index:l};if("number"===a&&s%1==0)return-1==(l=o.call(r.integers,s))&&(r.integers.push(n(s)),l=r.integers.length-1),{type:"integers",index:l};if("number"===a)return-1==(l=o.call(r.floats,s))&&(r.floats.push(s),l=r.floats.length-1),{type:"floats",index:l};if("boolean"===a)return{type:"boolean",index:s?-1:-2};throw new Error("Unexpected argument of type "+typeof s)}(t),a=r.strings.length,c=r.integers.length;r.floats.length,i&&console.log("Parsing the dictionary");var d=r.strings.join("|");return d+="^"+r.integers.join("|"),d+="^"+r.floats.join("|"),i&&console.log("Parsing the structure"),d+="^"+function e(t){if(i&&console.log("Calling a recursiveParser with "+this.JSON.stringify(t)),t instanceof Array){var s=t.shift();for(var o in t)t.hasOwnProperty(o)&&(s+=e(t[o])+"|");return("|"===s[s.length-1]?s.slice(0,-1):s)+"]"}var r=t.type,l=t.index;if("strings"===r)return n(l);if("integers"===r)return n(a+l);if("floats"===r)return n(a+c+l);if("boolean"===r)return t.index;if("null"===r)return-3;if("undefined"===r)return-5;if("empty"===r)return-4;throw new TypeError("The item is alien!")}(l),i&&console.log("Ending parser"),s.debug?{dictionary:r,ast:l,packed:d}:d},unpack:function(e,n){n=n||{};var o=e.split("^");n.verbose&&console.log("Building dictionary");var i=[],r=o[0];if(""!==r){r=r.split("|"),n.verbose&&console.log("Parse the strings dictionary");for(var l=0,a=r.length;l<a;l++)i.push(t(r[l]))}if(""!==(r=o[1]))for(r=r.split("|"),n.verbose&&console.log("Parse the integers dictionary"),l=0,a=r.length;l<a;l++)i.push(s(r[l]));if(""!==(r=o[2]))for(r=r.split("|"),n.verbose&&console.log("Parse the floats dictionary"),l=0,a=r.length;l<a;l++)i.push(parseFloat(r[l]));r=null,n.verbose&&console.log("Tokenizing the structure");var c="",d=[],u=o[3].length;for(l=0;l<u;l++){var p=o[3].charAt(l);"|"===p||"$"===p||"@"===p||"]"===p?(c&&(d.push(s(c)),c=""),"|"!==p&&d.push(p)):c+=p}var h=d.length,f=0;return n.verbose&&console.log("Starting recursive parser"),function e(){var t=d[f++];if(n.verbose&&console.log("Reading collection type "+("$"===t?"object":"Array")),"@"===t){for(var s=[];f<h;f++){var o=d[f];if(n.verbose&&console.log("Read "+o+" symbol"),"]"===o)return s;if("@"===o||"$"===o)s.push(e());else switch(o){case-1:s.push(!0);break;case-2:s.push(!1);break;case-3:s.push(null);break;case-5:s.push(void 0);break;case-4:s.push("");break;default:s.push(i[o])}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(s)),s}if("$"===t){for(s={};f<h;f++){var r=d[f];if("]"===r)return s;if(r=-4===r?"":i[r],"@"===(o=d[++f])||"$"===o)s[r]=e();else switch(o){case-1:s[r]=!0;break;case-2:s[r]=!1;break;case-3:s[r]=null;break;case-5:s[r]=void 0;break;case-4:s[r]="";break;default:s[r]=i[o]}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(s)),s}throw new TypeError("Bad token "+t+" isn't a type")}()}}}));function es(t){let n;return{c(){n=y("span"),n.textContent="Layout not supported!"},m(e,t){m(e,n,t)},p:e,i:e,o:e,d(e){e&&g(n)}}}function ts(t){let n,s;return n=new Bn({props:{registerAlgorithm:t[4],unregisterAlgorithm:t[5],layout:ss}}),{c(){Z(n.$$.fragment)},m(e,t){ee(n,e,t),s=!0},p:e,i(e){s||(Q(n.$$.fragment,e),s=!0)},o(e){K(n.$$.fragment,e),s=!1},d(e){te(n,e)}}}function ns(e){let t,n,s,o,i,r,l,a,c;s=new Qn({props:{layout:ss,changeAlgorithm:e[3],selectedAlgorithm:e[1],share:e[2]}});const d=[ts,es],u=[];return i=0,r=u[0]=d[0](e),a=new qn({}),{c(){t=y("main"),n=w(),Z(s.$$.fragment),o=w(),r.c(),l=w(),Z(a.$$.fragment)},m(e,i){m(e,t,i),f(t,n),ee(s,t,null),f(t,o),u[0].m(t,null),f(t,l),ee(a,t,null),c=!0},p(e,[t]){const n={};2&t&&(n.selectedAlgorithm=e[1]),s.$set(n),r.p(e,t)},i(e){c||(Q(false),Q(s.$$.fragment,e),Q(r),Q(a.$$.fragment,e),c=!0)},o(e){K(false),K(s.$$.fragment,e),K(r),K(a.$$.fragment,e),c=!1},d(e){e&&g(t),te(s),u[0].d(),te(a)}}}let ss="full";function os(e,t,n){let s=[],o="paxos";return[s,o,function(){s&&s[0]&&Zn(s[0])},function(e){n(1,o=e),s&&s[0]&&s[0].config.update((t=>({...t,algorithm:e})))},function(e,t){s.push({config:e,state:t})},function(e,t){n(0,s=s.filter((n=>n.config!==e&&n.state&&t)))}]}new class extends oe{constructor(e){super(),se(this,e,os,ns,r,{})}}({target:document.getElementById("app")})}}}))}();
