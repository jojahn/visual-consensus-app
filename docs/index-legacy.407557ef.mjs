!function(){var e=document.createElement("style");e.innerHTML=".input-group.svelte-1yd6c5a>.svelte-1yd6c5a{display:block}.full-layout.svelte-1yd6c5a.svelte-1yd6c5a{width:100%;padding:10px;display:flex;justify-content:center}.full-layout.svelte-1yd6c5a>.svelte-1yd6c5a{margin-right:10px}.canvas-wrapper.svelte-1jb7q7x .controls-section.svelte-1jb7q7x{margin:10px;position:absolute;padding:2px 8px;display:flex}.controls-section.svelte-1jb7q7x .zoom.svelte-1jb7q7x{display:flex;user-select:none}.help.svelte-1jb7q7x.svelte-1jb7q7x{padding:2px 8px;margin-top:-30px;font-size:.6rem;display:flex;flex-direction:column;user-select:none;width:max-content}.canvas-wrapper.svelte-1jb7q7x .controls-section p.svelte-1jb7q7x:not(.fps-counter-badge){margin:0;padding:0}.fps-counter-badge.svelte-1jb7q7x.svelte-1jb7q7x{width:max-content;background-color:#0072ff;padding:2px 8px;border-radius:5rem;color:#fff;margin:0}.canvas-wrapper.svelte-1jb7q7x.svelte-1jb7q7x{border:1px solid #eee;border-radius:.3rem;padding:0;overflow:hidden;max-height:100vh;min-height:200px;height:calc(100% - 30px)}.canvas-wrapper.svelte-1jb7q7x canvas.svelte-1jb7q7x{min-width:100px;min-height:100px;margin-top:20px;cursor:default!important}canvas.movable.svelte-1jb7q7x.svelte-1jb7q7x{cursor:grab!important}canvas.moving.svelte-1jb7q7x.svelte-1jb7q7x{cursor:grabbing!important}canvas.clickable.svelte-1jb7q7x.svelte-1jb7q7x{cursor:pointer!important}.anim-controls.svelte-air56o.svelte-air56o{margin:10px 0;display:flex;justify-content:center;user-select:none}.anim-controls.svelte-air56o>.svelte-air56o{margin:0 3px}button.svelte-air56o.svelte-air56o{cursor:pointer}.node-info.svelte-1yqfw3u.svelte-1yqfw3u{display:flex;padding:4px;flex-direction:column;background-color:wheat;position:absolute;top:0;left:0;font-size:1rem}.node-info.svelte-1yqfw3u>.svelte-1yqfw3u:last-child{font-size:.75rem}.actions-panel.svelte-1y74lh9.svelte-1y74lh9{width:calc(25% - 10px);margin:10px;background-color:rgba(244,151,164,.22);padding:10px;overflow-x:auto;overflow-y:scroll}h1.svelte-1y74lh9.svelte-1y74lh9{margin-top:0;margin-bottom:10px;font-size:1rem}.graph-panel.svelte-1y74lh9.svelte-1y74lh9{display:flex;flex-direction:column;overflow:hidden;width:37.5%;margin:0 10px}.full-algorithm.svelte-1y74lh9.svelte-1y74lh9{display:flex;flex-direction:column;max-width:100vw;overflow-y:hidden;overflow-x:hidden}.canvas-section.svelte-1y74lh9.svelte-1y74lh9{z-index:9999;display:flex;justify-content:space-between;overflow:hidden;padding:10px;min-height:40vh;height:40vh}.config-section.svelte-1y74lh9.svelte-1y74lh9{color:#222;background-color:#fff;display:flex;justify-content:space-around}.controls-section.svelte-1y74lh9.svelte-1y74lh9{background-color:#ddd}.state-section.svelte-1y74lh9.svelte-1y74lh9{display:flex;flex-direction:column;overflow:hidden;margin-bottom:10px;height:32vh;padding:0 20px}@media screen and (max-width: 680px){.canvas-section.svelte-1y74lh9.svelte-1y74lh9{flex-direction:column;height:max-content}.canvas-section.svelte-1y74lh9>.svelte-1y74lh9{width:100%;height:100vh}}.property-list.svelte-1muk73i.svelte-1muk73i.svelte-1muk73i{list-style-type:none;margin:0;padding:0}.property-list.svelte-1muk73i>li.svelte-1muk73i.svelte-1muk73i{color:#ff4500}.property-list.svelte-1muk73i>li.svelte-1muk73i>span.svelte-1muk73i{color:#5f9ea0}ul.svelte-1o1yvcd.svelte-1o1yvcd{list-style-type:none;margin:0;padding:0;display:flex;overflow:auto}.nodes.svelte-1o1yvcd.svelte-1o1yvcd{flex-direction:column}.log.svelte-1o1yvcd.svelte-1o1yvcd{display:flex;margin:10px}.log.svelte-1o1yvcd>h1.svelte-1o1yvcd{margin:0 10px 0 0;line-height:30px}.entry.svelte-1o1yvcd.svelte-1o1yvcd{border:1px solid black;padding:5px}.entry.svelte-1o1yvcd.svelte-1o1yvcd:not(:first-child){border-left:none}.selected.svelte-1o1yvcd.svelte-1o1yvcd{box-shadow:0 0 0 5px #f497a4}ul.block.svelte-cd4rqg,.property-list.svelte-nvij4z.svelte-nvij4z.svelte-nvij4z{list-style-type:none;margin:0;padding:0}.property-list.svelte-nvij4z li.svelte-nvij4z.svelte-nvij4z{color:#ff4500}.property-list.svelte-nvij4z li.svelte-nvij4z>span.svelte-nvij4z{color:#5f9ea0}.property-list.entries.svelte-nvij4z.svelte-nvij4z.svelte-nvij4z{list-style-type:disc}ul.svelte-ylgkgj.svelte-ylgkgj{list-style-type:none;margin:0;padding:0;display:flex;overflow:auto}ul.chain-list.svelte-ylgkgj.svelte-ylgkgj{overflow:visible}.nodes.svelte-ylgkgj.svelte-ylgkgj{flex-direction:column}.chain.svelte-ylgkgj.svelte-ylgkgj{display:flex;margin:10px}.chain.svelte-ylgkgj>h1.svelte-ylgkgj{margin:0 10px 0 0;line-height:30px}.block.svelte-ylgkgj.svelte-ylgkgj{border:1px solid black;padding:5px}.block.svelte-ylgkgj>p.svelte-ylgkgj{padding:0;margin:0}.selected.svelte-ylgkgj.svelte-ylgkgj{box-shadow:0 0 0 5px #f497a4}.transactions.svelte-ylgkgj.svelte-ylgkgj{list-style-type:disc!important;padding-left:20px}.arrow.svelte-ylgkgj.svelte-ylgkgj{font-size:2rem;padding:0;font-weight:lighter;font-family:courier,serif;margin:auto 10px}footer.svelte-4jochn.svelte-4jochn{padding:10px 0;top:100vh;background-color:#ddd;width:100%;overflow:hidden;display:flex;flex-direction:column}.content.svelte-4jochn.svelte-4jochn{max-width:60vw;min-width:300px;width:100%;display:flex;justify-content:space-evenly;flex-direction:row;margin:auto auto 20px}.links.svelte-4jochn.svelte-4jochn{display:flex;flex-direction:column}a.svelte-4jochn.svelte-4jochn{text-decoration:none;border-bottom:.1rem dotted blue;width:max-content}.rights.svelte-4jochn.svelte-4jochn{margin:0;padding:0;color:#888;text-align:center}.brand.svelte-4jochn.svelte-4jochn{display:flex}.brand.svelte-4jochn>span.svelte-4jochn{display:block;line-height:48px;padding-left:10px}.brand.svelte-4jochn>img.svelte-4jochn{width:48px;height:48px}header.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4{padding-left:20px;height:50px;background-color:#222;border-bottom:1px solid #ddd}header.svelte-1slpat4 .svelte-1slpat4.svelte-1slpat4{color:#ddd!important}nav.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4{height:100%}nav.svelte-1slpat4>ul.svelte-1slpat4.svelte-1slpat4{list-style-type:none;margin:0;padding:0;display:flex;height:100%}nav.svelte-1slpat4>ul.svelte-1slpat4>li.svelte-1slpat4{margin:auto 0}a.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4{text-decoration:none}button.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4,a.svelte-1slpat4.svelte-1slpat4.svelte-1slpat4{font-size:1rem;padding:0 10px;border:none;height:35px;cursor:pointer;background-color:transparent;opacity:.5}.active.svelte-1slpat4 button.svelte-1slpat4.svelte-1slpat4{opacity:1}.performance-graph.svelte-14wi5xo{position:fixed;top:5px;right:5px;background-color:#fff;padding:5px;z-index:999999;border:1px solid}p.svelte-14wi5xo{margin:0}span.svelte-14wi5xo{font-weight:700}span.hide-btn.svelte-14wi5xo{padding:0 8px;margin-left:10px;background-color:#000;color:#fff;cursor:pointer;font-weight:400;user-select:none;display:block;float:right}:root{font-family:Helvetica Neue,Helvetica,Arial,sans-serif}body{margin:0;padding:0}\n",document.head.appendChild(e),System.register([],(function(){"use strict";return{execute:function(){function e(){}function t(e,t){for(const n in t)e[n]=t[n];return e}function n(e){return e()}function s(){return Object.create(null)}function o(e){e.forEach(n)}function i(e){return"function"==typeof e}function r(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(t,...n){if(null==t)return e;const s=t.subscribe(...n);return s.unsubscribe?()=>s.unsubscribe():s}function l(e,t,n,s){if(e){const o=c(e,t,n,s);return e[0](o)}}function c(e,n,s,o){return e[1]&&o?t(s.ctx.slice(),e[1](o(n))):s.ctx}function d(e,t,n,s){if(e[2]&&s){const o=e[2](s(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|o[s];return e}return t.dirty|o}return t.dirty}function u(e,t,n,s,o,i){if(o){const r=c(t,n,s,i);e.p(r,o)}}function p(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function h(e){return null==e?"":e}function f(e,t){e.appendChild(t)}function m(e,t,n){e.insertBefore(t,n||null)}function g(e){e.parentNode.removeChild(e)}function v(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function y(e){return document.createElement(e)}function b(e){return document.createTextNode(e)}function w(){return b(" ")}function x(){return b("")}function k(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function E(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function S(e){return""===e?null:+e}function $(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function T(e,t){e.value=null==t?"":t}function I(e,t){for(let n=0;n<e.options.length;n+=1){const s=e.options[n];if(s.__value===t)return void(s.selected=!0)}e.selectedIndex=-1}let O;function N(e){O=e}function P(){if(!O)throw new Error("Function called outside component initialization");return O}function C(e){P().$$.on_mount.push(e)}function A(e){P().$$.after_update.push(e)}function j(e){P().$$.on_destroy.push(e)}const M=[],L=[],R=[],D=[],_=Promise.resolve();let q=!1;function F(e){R.push(e)}const H=new Set;let W=0;function B(){const e=O;do{for(;W<M.length;){const e=M[W];W++,N(e),z(e.$$)}for(N(null),M.length=0,W=0;L.length;)L.pop()();for(let e=0;e<R.length;e+=1){const t=R[e];H.has(t)||(H.add(t),t())}R.length=0}while(M.length);for(;D.length;)D.pop()();q=!1,H.clear(),N(e)}function z(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(F)}}const U=new Set;let G;function X(){G={r:0,c:[],p:G}}function J(){G.r||o(G.c),G=G.p}function Q(e,t){e&&e.i&&(U.delete(e),e.i(t))}function Y(e,t,n,s){if(e&&e.o){if(U.has(e))return;U.add(e),G.c.push((()=>{U.delete(e),s&&(n&&e.d(1),s())})),e.o(t)}else s&&s()}function K(e,t){const n={},s={},o={$$scope:1};let i=e.length;for(;i--;){const r=e[i],a=t[i];if(a){for(const e in r)e in a||(s[e]=1);for(const e in a)o[e]||(n[e]=a[e],o[e]=1);e[i]=a}else for(const e in r)o[e]=1}for(const r in s)r in n||(n[r]=void 0);return n}function V(e){return"object"==typeof e&&null!==e?e:{}}function Z(e){e&&e.c()}function ee(e,t,s,r){const{fragment:a,on_mount:l,on_destroy:c,after_update:d}=e.$$;a&&a.m(t,s),r||F((()=>{const t=l.map(n).filter(i);c?c.push(...t):o(t),e.$$.on_mount=[]})),d.forEach(F)}function te(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ne(e,t){-1===e.$$.dirty[0]&&(M.push(e),q||(q=!0,_.then(B)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function se(t,n,i,r,a,l,c,d=[-1]){const u=O;N(t);const p=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:a,bound:s(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(u?u.$$.context:[])),callbacks:s(),dirty:d,skip_bound:!1,root:n.target||u.$$.root};c&&c(p.root);let h=!1;if(p.ctx=i?i(t,n.props||{},((e,n,...s)=>{const o=s.length?s[0]:n;return p.ctx&&a(p.ctx[e],p.ctx[e]=o)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](o),h&&ne(t,e)),n})):[],p.update(),h=!0,o(p.before_update),p.fragment=!!r&&r(p.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);p.fragment&&p.fragment.l(e),e.forEach(g)}else p.fragment&&p.fragment.c();n.intro&&Q(t.$$.fragment),ee(t,n.target,n.anchor,n.customElement),B()}N(u)}class oe{$destroy(){te(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ie=e=>({config:1&e}),re=e=>({config:e[0]});function ae(e){let t,n,s,i,r,a,c,v,b,x,$,I,O,N,P,C,A,j,M,L,R,D,_,q,F,H,W;const B=e[5]["algorithm-config"],z=l(B,e,e[4],re);return{c(){t=y("form"),n=y("div"),s=y("div"),i=y("label"),i.textContent="Network Delay",r=w(),a=y("div"),c=y("input"),v=w(),b=y("span"),b.textContent="ms",x=w(),$=y("div"),I=y("label"),I.textContent="Command Delay",O=w(),N=y("div"),P=y("input"),C=w(),A=y("span"),A.textContent="ms",j=w(),M=y("div"),L=y("label"),L.textContent="Use WebWorkers",R=w(),D=y("input"),_=w(),z&&z.c(),E(i,"for","NetworkDelayInput"),E(i,"class","svelte-1yd6c5a"),E(c,"id","NetworkDelayInput"),E(c,"type","number"),E(c,"min","0"),E(c,"max","60000"),E(a,"class","svelte-1yd6c5a"),E(s,"class","input-group svelte-1yd6c5a"),E(I,"for","CommandDelayInput"),E(I,"class","svelte-1yd6c5a"),E(P,"id","CommandDelayInput"),E(P,"type","number"),E(P,"min","0"),E(P,"max","60000"),E(N,"class","svelte-1yd6c5a"),E($,"class","input-group svelte-1yd6c5a"),E(L,"for","UseWebWorkersInput"),E(L,"class","svelte-1yd6c5a"),E(D,"id","UseWebWorkersInput"),D.disabled=!0,E(D,"type","checkbox"),E(D,"class","svelte-1yd6c5a"),E(M,"class","input-group svelte-1yd6c5a"),E(n,"class","options svelte-1yd6c5a"),E(t,"class",q=h((e[1]," full-layout"))+" svelte-1yd6c5a")},m(o,l){m(o,t,l),f(t,n),f(n,s),f(s,i),f(s,r),f(s,a),f(a,c),T(c,e[2].networkDelay),f(a,v),f(a,b),f(n,x),f(n,$),f($,I),f($,O),f($,N),f(N,P),T(P,e[2].commandDelay),f(N,C),f(N,A),f(n,j),f(n,M),f(M,L),f(M,R),f(M,D),D.checked=e[2].useWorkers,f(t,_),z&&z.m(t,null),F=!0,H||(W=[k(c,"input",e[6]),k(P,"input",e[7]),k(D,"change",e[8]),k(t,"submit",e[3])],H=!0)},p(e,[n]){4&n&&S(c.value)!==e[2].networkDelay&&T(c,e[2].networkDelay),4&n&&S(P.value)!==e[2].commandDelay&&T(P,e[2].commandDelay),4&n&&(D.checked=e[2].useWorkers),z&&z.p&&(!F||17&n)&&u(z,B,e,e[4],F?d(B,e[4],n,ie):p(e[4]),re),(!F||2&n&&q!==(q=h((e[1]," full-layout"))+" svelte-1yd6c5a"))&&E(t,"class",q)},i(e){F||(Q(z,e),F=!0)},o(e){Y(z,e),F=!1},d(e){e&&g(t),z&&z.d(e),H=!1,o(W)}}}function le(t,n,s){let o,i=e,r=()=>(i(),i=a(d,(e=>s(2,o=e))),d);t.$$.on_destroy.push((()=>i()));let{$$slots:l={},$$scope:c}=n,{configStore:d}=n;r();let{fullLayout:u=!1}=n;return t.$$set=e=>{"configStore"in e&&r(s(0,d=e.configStore)),"fullLayout"in e&&s(1,u=e.fullLayout),"$$scope"in e&&s(4,c=e.$$scope)},[d,u,o,e=>{e.preventDefault()},c,l,function(){o.networkDelay=S(this.value),d.set(o)},function(){o.commandDelay=S(this.value),d.set(o)},function(){o.useWorkers=this.checked,d.set(o)}]}class ce extends oe{constructor(e){super(),se(this,e,le,ae,r,{configStore:0,fullLayout:1})}}const de=[];function ue(t,n=e){let s;const o=new Set;function i(e){if(r(t,e)&&(t=e,s)){const e=!de.length;for(const n of o)n[1](),de.push(n,t);if(e){for(let e=0;e<de.length;e+=2)de[e][0](de[e+1]);de.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(r,a=e){const l=[r,a];return o.add(l),1===o.size&&(s=n(i)||e),r(t),()=>{o.delete(l),0===o.size&&(s(),s=null)}}}}function pe(e,t){const n=new Date(e.sent).getTime(),s=new Date(t.sent).getTime();return n<s?-1:n>s?1:function(e,t){return e.id>t.id?-1:e.id<t.id?1:0}(e,t)}function he(e,t){return(n,s)=>{const o=n=>t(s,n)&&Math.abs(new Date(n.sent).getTime()-new Date(s.sent).getTime())<e,i=n.findIndex((e=>Array.isArray(e)?-1!==e.findIndex((e=>o(e))):o(e)));return-1!==i&&n[i]&&Array.isArray(n[i])?n[i].push(s):-1!==i&&i?n[i]=[n[i],s]:n.push(s),n}}const fe="#FA3",me="#000",ge="#F497A4",ve={nodeRadius:24,messageRadius:8,paintNodeText:e=>e.id,isLeader:()=>{},paintMessageText:()=>{},arrowLength:6};function ye(e,t,n,s=ve){if(e.save(),s={...ve,...s},!t)return[e.canvas.width,e.canvas.height];let o=0,i=0;return t.messages.filter((e=>!e.done&&e.pos)).forEach((n=>{e.beginPath();let s=t.nodes.filter((e=>e.id===n.fromId))[0].pos,o=t.nodes.filter((e=>e.id===n.toId))[0].pos;n.id===t.selectedElementId&&(e.lineWidth=4,e.strokeStyle=ge,e.moveTo(...s),e.lineTo(...o),e.stroke()),e.lineWidth=1,e.strokeStyle="#DDD",e.moveTo(...s),e.lineTo(...o),e.stroke(),e.closePath()})),t.messages.filter((e=>!e.done&&e.pos)).sort(pe).forEach((o=>{o.id===t.selectedElementId&&(e.beginPath(),e.fillStyle=ge,e.arc(o.pos[0],o.pos[1],s.messageRadius+5,0,2*Math.PI),e.fill(),e.closePath()),e.beginPath();const i=t.nodes.filter((e=>e.id===o.fromId))[0].pos,r=t.nodes.filter((e=>e.id===o.toId))[0].pos,a=Math.sqrt(Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2)),l=s.messageRadius+s.arrowLength,c=[o.pos[0]+l/a*(r[0]-i[0]),o.pos[1]+l/a*(r[1]-i[1])],d=[o.pos[0]+s.messageRadius/a*(i[0]-r[0]),o.pos[1]+s.messageRadius/a*(i[1]-r[1])],u=(e,t)=>{let n=[e[0]-o.pos[0],e[1]-o.pos[1]];return n=((e,t)=>[Math.cos(t)*e[0]-Math.sin(t)*e[1],Math.sin(t)*e[0]+Math.cos(t)*e[1]])(n,t),[n[0]+o.pos[0],n[1]+o.pos[1]]},p=u(d,Math.PI/2+.5),h=u(d,-Math.PI/2-.5);e.fillStyle=me,e.strokeStyle=me,e.moveTo(...p),e.lineTo(...c),e.lineTo(...h),e.stroke(),e.fill(),e.closePath(),e.beginPath(),e.lineWidth=2,e.strokeStyle=me,e.fillStyle=fe,e.arc(o.pos[0],o.pos[1],s.messageRadius,0,2*Math.PI),e.stroke(),e.fill(),e.isPointInPath(n.position[0],n.position[1])&&(e.canvas.style.setProperty("cursor","pointer","important"),-1===n.hits.map((e=>e.id)).indexOf(o.id)&&n.hits.push(o)),e.closePath()})),t.nodes.filter((e=>e&&e.pos&&e.id)).forEach((t=>{e.beginPath(),e.lineWidth=5,e.fillStyle="#ADD495",e.strokeStyle="#80B7A2",t.connected?s.isLeader(t)&&(e.fillStyle="#EE2",e.strokeStyle="#DD0"):(e.fillStyle="#DDD",e.strokeStyle="#AAA"),e.arc(t.pos[0],t.pos[1],s.nodeRadius,0,2*Math.PI),e.stroke(),o=Math.max(o,t.pos[0]),i=Math.max(i,t.pos[1]),e.fill(),e.isPointInPath(n.position[0],n.position[1])&&(e.canvas.style.setProperty("cursor","pointer","important"),-1===n.hits.map((e=>e.id)).indexOf(t.id)&&n.hits.push(t)),e.closePath(),s.paintNodeText(e,t),e.beginPath(),e.fillStyle="#FFF",t.connected?s.isLeader(t)&&(e.fillStyle="#000"):e.fillStyle="#000",e.font="bold 20px courier new",e.fillText(t.id,t.pos[0]-12,t.pos[1]+5),e.closePath()})),t.selectedElementId&&t.nodes.filter((e=>e.id===t.selectedElementId)).forEach((t=>{e.beginPath(),e.strokeStyle="#F497A4",e.lineWidth=5,e.arc(t.pos[0],t.pos[1],s.nodeRadius+5,0,2*Math.PI),e.stroke(),e.closePath()})),e.restore(),[o,i]}const be=e=>({offsetX:16&e[0],offsetY:32&e[0]}),we=e=>({hoveredElement:e[12],offsetX:e[4],offsetY:e[5]});function xe(t){let n;return{c(){n=y("p"),E(n,"class","svelte-1jb7q7x")},m(e,t){m(e,n,t)},p:e,d(e){e&&g(n)}}}function ke(e){let t;return{c(){t=y("span"),t.textContent="unlock"},m(e,n){m(e,t,n)},d(e){e&&g(t)}}}function Ee(e){let t;return{c(){t=y("span"),t.textContent="lock"},m(e,n){m(e,t,n)},d(e){e&&g(t)}}}function Se(e){let t,n,s,i,r,a,c,v,x,S,T,I,O,N,P,C,A,j,M,L,R,D,_,q;let F=xe(e);function H(e,t){return e[7]?Ee:ke}let W=H(e),B=W(e);const z=e[28].hover,U=l(z,e,e[27],we);return{c(){t=y("div"),n=y("div"),F.c(),s=w(),i=y("button"),B.c(),r=w(),a=y("button"),a.textContent="Reset",c=w(),v=y("div"),x=y("button"),x.textContent="-",S=w(),T=y("p"),I=b(e[10]),O=b("x"),N=w(),P=y("button"),P.textContent="+",C=w(),A=y("canvas"),M=w(),U&&U.c(),L=w(),R=y("div"),R.innerHTML="<span>Pan: <kbd>LeftCtrl</kbd> + Hold <kbd>MouseLeft</kbd></span> \n    <span>Zoom: <kbd>LeftCtrl</kbd> + <kbd>MouseWheel</kbd></span>",E(T,"class","svelte-1jb7q7x"),E(v,"class","zoom svelte-1jb7q7x"),E(n,"class","controls-section svelte-1jb7q7x"),E(A,"class",j=h(e[11].hoveredElement?"clickable":e[9]?"moving":e[7]&&e[8]?"movable":"")+" svelte-1jb7q7x"),E(A,"id",e[0]),E(A,"width","640"),E(A,"height","480"),E(t,"class","canvas-wrapper svelte-1jb7q7x"),E(R,"class","help svelte-1jb7q7x")},m(o,l){m(o,t,l),f(t,n),F.m(n,null),f(n,s),f(n,i),B.m(i,null),f(n,r),f(n,a),f(n,c),f(n,v),f(v,x),f(v,S),f(v,T),f(T,I),f(T,O),f(v,N),f(v,P),f(t,C),f(t,A),e[31](A),f(t,M),U&&U.m(t,null),m(o,L,l),m(o,R,l),D=!0,_||(q=[k(i,"click",e[13]),k(a,"click",e[18]),k(x,"click",e[29]),k(P,"click",e[30]),k(A,"mousemove",e[16]),k(A,"mousedown",e[14]),k(A,"mouseup",e[15]),k(A,"mouseleave",e[17]),k(t,"drop",Te),k(t,"dragover",Ie)],_=!0)},p(e,t){F.p(e,t),W!==(W=H(e))&&(B.d(1),B=W(e),B&&(B.c(),B.m(i,null))),(!D||1024&t[0])&&$(I,e[10]),(!D||2944&t[0]&&j!==(j=h(e[11].hoveredElement?"clickable":e[9]?"moving":e[7]&&e[8]?"movable":"")+" svelte-1jb7q7x"))&&E(A,"class",j),(!D||1&t[0])&&E(A,"id",e[0]),U&&U.p&&(!D||134217776&t[0])&&u(U,z,e,e[27],D?d(z,e[27],t,be):p(e[27]),we)},i(e){D||(Q(U,e),D=!0)},o(e){Y(U,e),D=!1},d(n){n&&g(t),F.d(),B.d(),e[31](null),U&&U.d(n),n&&g(L),n&&g(R),_=!1,o(q)}}}function $e(e){return e.preventDefault(),e.stopPropagation(),!1}function Te(e){}function Ie(e){}function Oe(t,n,s){let o,i,r=e,l=()=>(r(),r=a(f,(e=>s(35,o=e))),f),c=e,d=()=>(c(),c=a(m,(e=>s(11,i=e))),m);t.$$.on_destroy.push((()=>r())),t.$$.on_destroy.push((()=>c()));let{$$slots:u={},$$scope:p}=n,{id:h}=n,{configStore:f}=n;l();let{stateStore:m}=n;d();let{paintFn:g=ye}=n,{minWidth:v=100}=n,{minHeight:y=100}=n,{paintOptions:b}=n,{onElementSelected:w=(e=>{})}=n,{onElementHovered:x=(e=>{})}=n,{onElementHoverEnd:k=(()=>{})}=n,E=ue(void 0);const S=e=>{E.update((t=>e)),x(e)},$=()=>{E.set(void 0),k()};function T(e){m.update((t=>({...t,selectedElementId:e.id}))),w(e),E.set(void 0)}let I,O=null,N=null,P=50,M=0,R=!0;let D=!1;function _(e){17===e.keyCode&&s(8,D=!0)}function q(e){17===e.keyCode&&s(8,D=!1)}const F=e=>m.update(e),H=()=>{O&&O.remove(),O=function(e,t,{subscribe:n},s=ye,o={autoAlign:"CENTER"},{onHover:i,onHoverEnd:r,onClick:a,updateState:l}={}){let c=1,d=[0,0],u=!1,p=null;n((e=>{p=e}));const h=e.getContext("2d",{alpha:!1});var f=e.getBoundingClientRect();e.width=1*f.width,e.height=1*f.height,h.scale(1,1);const m={hits:[],position:[0,0]},g=t=>{if(e.style.cursor="default",m.hits.length>0){const e=m.hits[0];i&&i(e)}else r&&r();let n=t.clientX+document.body.scrollLeft-e.offsetLeft,s=t.clientY+document.body.scrollTop-e.offsetTop;m.position=[n+window.scrollX,s+window.scrollY],m.hits=[]};e.addEventListener("mousemove",g);const v=()=>{if(m.hits[0]){let e=m.hits[0];p.selectedElementId=e.id,l&&l((t=>({...t,selectedElementId:e.id}))),a&&a(e)}};e.addEventListener("mousedown",v);let y={fps:0},b=[0,0],w=0,x=0,k=!1;var E=[];return e.width!==e.parentElement.clientWidth&&(e.width=e.parentElement.clientWidth,e.height=e.parentElement.clientHeight),function t(){"TOP_TO_BOTTOM"===o.autoAlign&&x>e.height&&(e.height=x,e.parentElement.style.overflowY="scroll",u&&e.parentElement.scrollTo(0,e.parentElement.scrollHeight)),h.fillStyle="#FFF",h.fillRect(0,0,e.width,e.height),h.scale(c/1,c/1);let n=d[0],i=d[1];switch(o.autoAlign){case"TOP_TO_BOTTOM":n=d[0]+b[0]/2-w/2,i=10;break;case"CENTER":n=d[0]+b[0]/2-w/2,i=d[1]+b[1]/2-x/2}h.translate(n,i),b=[e.width/2,e.height/2],[w,x]=s(h,p,m,o);const r=performance.now();for(;E.length>0&&E[0]<=r-1e3;)E.shift();E.push(r),y.fps=E.length,h.translate(-n,-i),h.scale(1/c,1/c),k||requestAnimationFrame(t)}(),{context:h,debugInfo:y,zoom:e=>{c=e||1},pan:e=>{d=e},setLock:e=>{u=e},remove:()=>{k=!0,h.fillStyle="#FFF",h.fillRect(0,0,640,480),e.removeEventListener("mousedown",v),e.removeEventListener("mousemove",g)}}}(N,0,{subscribe:e=>m.subscribe(e)},g,b,{onHover:S,onHoverEnd:$,onClick:T,updateState:F}),z=[N.width/5,N.height/5],O.pan(z)};function W(){const e=document.getElementById(h),t=e.parentElement;e&&t&&(e.height=Math.max(y,t.clientHeight),e.width=Math.max(v,t.clientWidth))}let B=!1;let z=[0,0];let U=1;function G(e){R&&D&&(e.preventDefault(),e.stopPropagation(),X(-.001*e.deltaY))}function X(e){s(10,U=Math.round(10*Math.min(Math.max(.5,U+e),2))/10),O.zoom(U)}C((()=>{const e=document.getElementById(h);s(4,I=e.offsetLeft),s(5,P=e.offsetTop),e.addEventListener("wheel",G,{passive:!1}),window.addEventListener("scroll",$e,!1),window.addEventListener("resize",W,!0),document.addEventListener("keydown",_),document.addEventListener("keyup",q),f.subscribe(H),W()}));let J=b;A((()=>{J!==b&&(H(),X(0),J=b)}));let Q=setInterval((()=>{s(6,M=O.debugInfo.fps)}),500);j((()=>{window.removeEventListener("resize",W),N.removeEventListener("wheel",G),window.removeEventListener("scroll",$e),document.removeEventListener("keydown",_),document.removeEventListener("keyup",q),O&&O.remove(),Q&&clearInterval(Q)}));return t.$$set=e=>{"id"in e&&s(0,h=e.id),"configStore"in e&&l(s(1,f=e.configStore)),"stateStore"in e&&d(s(2,m=e.stateStore)),"paintFn"in e&&s(20,g=e.paintFn),"minWidth"in e&&s(21,v=e.minWidth),"minHeight"in e&&s(22,y=e.minHeight),"paintOptions"in e&&s(23,b=e.paintOptions),"onElementSelected"in e&&s(24,w=e.onElementSelected),"onElementHovered"in e&&s(25,x=e.onElementHovered),"onElementHoverEnd"in e&&s(26,k=e.onElementHoverEnd),"$$scope"in e&&s(27,p=e.$$scope)},[h,f,m,N,I,P,M,R,D,B,U,i,E,function(){s(7,R=!R),O&&O.setLock(!R)},function(){R&&D&&s(9,B=!0)},function(){s(9,B=!1)},function(e){if(B&&R&&D){const t=1/U;z=[z[0]+t*e.movementX,"TOP_TO_BOTTOM"===b.autoAlign?0:z[1]+t*e.movementY],O.pan(z)}},function(){s(9,B=!1)},function(){s(10,U=1),O.zoom(U),z=[0,0],O.pan(z)},X,g,v,y,b,w,x,k,p,u,()=>X(-.1),()=>X(.1),function(e){L[e?"unshift":"push"]((()=>{N=e,s(3,N)}))}]}class Ne extends oe{constructor(e){super(),se(this,e,Oe,Se,r,{id:0,configStore:1,stateStore:2,paintFn:20,minWidth:21,minHeight:22,paintOptions:23,onElementSelected:24,onElementHovered:25,onElementHoverEnd:26},null,[-1,-1])}}function Pe(e){let t;return{c(){t=b("pause")},m(e,n){m(e,t,n)},d(e){e&&g(t)}}}function Ce(e){let t;return{c(){t=b("resume")},m(e,n){m(e,t,n)},d(e){e&&g(t)}}}function Ae(t){let n,s,r,a,l,c,d,u,p,h,v,x,S,T,I,O,N,P,C,A=t[2]*je+"";function j(e,t){return e[1]?Ce:Pe}let M=j(t),L=M(t);return{c(){n=y("div"),s=y("button"),s.textContent="reset",r=w(),a=y("button"),L.c(),l=w(),c=y("button"),d=b("step forward"),p=w(),h=y("div"),v=y("label"),v.textContent="Speed",x=w(),S=y("input"),T=w(),I=y("span"),O=b(A),N=b("x"),E(s,"type","button"),E(s,"class","svelte-air56o"),E(a,"type","button"),E(a,"class","svelte-air56o"),E(c,"type","button"),c.disabled=u=!t[1],E(c,"class","svelte-air56o"),E(v,"for","SpeedInput"),E(S,"id","SpeedInput"),E(S,"type","range"),E(S,"min","0"),E(S,"max",5/je),S.value=t[2],E(h,"class","svelte-air56o"),E(n,"class","anim-controls svelte-air56o")},m(e,o){m(e,n,o),f(n,s),f(n,r),f(n,a),L.m(a,null),f(n,l),f(n,c),f(c,d),f(n,p),f(n,h),f(h,v),f(h,x),f(h,S),f(h,T),f(h,I),f(I,O),f(I,N),P||(C=[k(s,"click",(function(){i(t[0].reset)&&t[0].reset.apply(this,arguments)})),k(a,"click",(function(){i(t[0].pauseOrPlay)&&t[0].pauseOrPlay.apply(this,arguments)})),k(c,"click",(function(){i(t[0].stepForwards)&&t[0].stepForwards.apply(this,arguments)})),k(S,"change",t[3])],P=!0)},p(e,[n]){M!==(M=j(t=e))&&(L.d(1),L=M(t),L&&(L.c(),L.m(a,null))),2&n&&u!==(u=!t[1])&&(c.disabled=u),4&n&&(S.value=t[2]),4&n&&A!==(A=t[2]*je+"")&&$(O,A)},i:e,o:e,d(e){e&&g(n),L.d(),P=!1,o(C)}}}const je=.25;function Me(e,t,n){let{stateStore:s}=t,{controls:o}=t,i=!1,r=1/je;let a;return C((()=>{a=s.subscribe((e=>{e?(n(1,i=e.paused),n(2,r=e.speed/je)):n(1,i=!0)}))})),j((()=>{a&&a()})),e.$$set=e=>{"stateStore"in e&&n(4,s=e.stateStore),"controls"in e&&n(0,o=e.controls)},[o,i,r,e=>{try{n(2,r=parseInt(e.target.value))}catch(t){console.error("Failed to parse speed")}o.setSpeed(r*je)},s]}class Le extends oe{constructor(e){super(),se(this,e,Me,Ae,r,{stateStore:4,controls:0})}}const Re={linePadding:50,initialLineLength:200,lengthPerTimeStep:10,groupOffset:30,messageOffset:8,maxMessageLength:30,maxMessageOffset:100,vertical:!1,autoAlign:"TOP_TO_BOTTOM",spaceBetweenBroadcasts:!1,getText:e=>e.type};function De(e,t,n,s=Re){if(s={...Re,...s},!t)return[e.canvas.width,e.canvas.height];s.internal={},s.internal.nodeToXMap={},t.nodes.forEach(((e,t)=>{s.internal.nodeToXMap[e.id]=10+t*s.linePadding,s.internal.furthestLineX=s.internal.nodeToXMap[e.id]}));return e.save(),s.internal.lastLineOffset=25,s.internal.maxWidth=s.internal.furthestLineX,t.messages.sort(pe).reduce(he(1e3,((e,t)=>s.getText(e)===s.getText(t))),[]).forEach(_e(e,t,s)),e.restore(),e.save(),t.nodes.forEach(((n,o)=>{let i=10+o*s.linePadding;if(s.internal.nodeToXMap[n.id]=i,t.selectedElementId===n.id){e.beginPath(),e.lineWidth=10,e.strokeStyle=ge;let n=[s.internal.nodeToXMap[t.selectedElementId],25],o=[s.internal.nodeToXMap[t.selectedElementId],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(n=n.reverse(),o=o.reverse()),e.moveTo(...n),e.lineTo(...o),e.stroke(),e.closePath()}e.beginPath(),e.lineWidth=1,e.setLineDash(n.connected?[0]:[5,5]),e.strokeStyle=n.connected?"#000":"#AAA";let r=[s.internal.nodeToXMap[n.id],25],a=[s.internal.nodeToXMap[n.id],Math.max(s.initialLineLength,s.internal.lastLineOffset+s.messageOffset)];s.vertical&&(r=r.reverse(),a=a.reverse()),e.moveTo(...r),e.lineTo(...a),e.stroke(),e.closePath(),e.setLineDash([0]),e.beginPath(),e.fillStyle="#000",e.font="bold 20px courier new",e.fontWeight="bold";let l=[i-7.5,20];s.vertical&&(l=l.reverse()),e.fillText(n.id,...l),e.closePath()})),e.restore(),[s.internal.maxWidth,s.internal.lastLineOffset+s.messageOffset]}function _e(e,t,n,s=0,o=!0){return(i,r)=>{if(Array.isArray(i))return void i.forEach(((s,o)=>_e(e,t,n,o,o===i.length-1)(s,r)));const{nodeToXMap:a,furthestLineX:l}=n.internal;e.beginPath();let c=n.internal.lastLineOffset;0===r&&(c+=n.messageOffset),n.spaceBetweenBroadcasts&&0!==s&&(c+=n.messageOffset);let d=[a[i.fromId],c],u=[a[i.toId],d[1]+(n.spaceBetweenBroadcasts?0:n.maxMessageLength)];if((o||n.spaceBetweenBroadcasts)&&(n.internal.lastLineOffset=u[1],o&&n.spaceBetweenBroadcasts?n.internal.lastLineOffset+=n.groupOffset:n.internal.lastLineOffset+=n.messageOffset),n.vertical&&(d=d.reverse(),u=u.reverse()),i.id===t.selectedElementId&&(e.lineWidth=8,e.strokeStyle=ge,e.moveTo(...d),e.lineTo(...u),e.stroke()),e.lineWidth=1,e.strokeStyle="#000",e.moveTo(...d),e.lineTo(...u),e.stroke(),e.closePath(),0===s){e.beginPath(),e.fillStyle="#000",e.font="15px arial";let t=[l+20,d[1]+(u[1]-d[1])/2];n.spaceBetweenBroadcasts&&(t[1]=d[1]+(n.internal.lastLineOffset-d[1])/2),n.vertical&&(t=t.reverse());const s=n.getText(i);n.internal.maxWidth=Math.max(n.internal.maxWidth,t[0]+15*s.length),e.fillText(s,...t),e.closePath()}}}function qe(e){let t,n,s,o,i,r;const a=[He,Fe],l=[];function c(e,t){return e[11]?0:e[8]?1:-1}return~(o=c(e))&&(i=l[o]=a[o](e)),{c(){t=y("section"),n=y("h1"),n.textContent="State",s=w(),i&&i.c(),E(n,"class","svelte-1y74lh9"),E(t,"class","state-section svelte-1y74lh9")},m(e,i){m(e,t,i),f(t,n),f(t,s),~o&&l[o].m(t,null),r=!0},p(e,n){let s=o;o=c(e),o===s?~o&&l[o].p(e,n):(i&&(X(),Y(l[s],1,1,(()=>{l[s]=null})),J()),~o?(i=l[o],i?i.p(e,n):(i=l[o]=a[o](e),i.c()),Q(i,1),i.m(t,null)):i=null)},i(e){r||(Q(i),r=!0)},o(e){Y(i),r=!1},d(e){e&&g(t),~o&&l[o].d()}}}function Fe(e){let n,s;const o=[e[5],{id:"Canvas_"+e[14].algorithm+"_State"},{paintFn:e[8]},{paintOptions:{autoAlign:"CENTER"}}];let i={};for(let r=0;r<o.length;r+=1)i=t(i,o[r]);return n=new Ne({props:i}),{c(){Z(n.$$.fragment)},m(e,t){ee(n,e,t),s=!0},p(e,t){const s=16672&t?K(o,[32&t&&V(e[5]),16384&t&&{id:"Canvas_"+e[14].algorithm+"_State"},256&t&&{paintFn:e[8]},o[3]]):{};n.$set(s)},i(e){s||(Q(n.$$.fragment,e),s=!0)},o(e){Y(n.$$.fragment,e),s=!1},d(e){te(n,e)}}}function He(e){let t,n,s;var o=e[11];function i(e){return{props:{stateStore:e[0],configStore:e[1]}}}return o&&(t=new o(i(e))),{c(){t&&Z(t.$$.fragment),n=x()},m(e,o){t&&ee(t,e,o),m(e,n,o),s=!0},p(e,s){const r={};if(1&s&&(r.stateStore=e[0]),2&s&&(r.configStore=e[1]),o!==(o=e[11])){if(t){X();const e=t;Y(e.$$.fragment,1,0,(()=>{te(e,1)})),J()}o?(t=new o(i(e)),Z(t.$$.fragment),Q(t.$$.fragment,1),ee(t,n.parentNode,n)):t=null}else o&&t.$set(r)},i(e){s||(t&&Q(t.$$.fragment,e),s=!0)},o(e){t&&Y(t.$$.fragment,e),s=!1},d(e){e&&g(n),t&&te(t,e)}}}function We(e){let t,n,s;var o=e[6];function i(e){return{props:{slot:"algorithm-config",config:e[18]}}}return o&&(t=new o(i(e))),{c(){t&&Z(t.$$.fragment),n=x()},m(e,o){t&&ee(t,e,o),m(e,n,o),s=!0},p(e,s){const r={};if(262144&s&&(r.config=e[18]),o!==(o=e[6])){if(t){X();const e=t;Y(e.$$.fragment,1,0,(()=>{te(e,1)})),J()}o?(t=new o(i(e)),Z(t.$$.fragment),Q(t.$$.fragment,1),ee(t,n.parentNode,n)):t=null}else o&&t.$set(r)},i(e){s||(t&&Q(t.$$.fragment,e),s=!0)},o(e){t&&Y(t.$$.fragment,e),s=!1},d(e){e&&g(n),t&&te(t,e)}}}function Be(e){let n,s,o,i,r,a,l,c,d,u,p,h,v,b,x,k,S,$,T,I,O,N,P,C;const A=[e[5],{id:"Canvas_"+e[14].algorithm+"_Nodes"},{paintFn:ye},{paintOptions:e[10]}];let j={};for(let f=0;f<A.length;f+=1)j=t(j,A[f]);a=new Ne({props:j});const M=[e[5],{id:"Canvas_"+e[14].algorithm+"_Sequence"},{paintFn:De},{paintOptions:e[9]}];let L={};for(let f=0;f<M.length;f+=1)L=t(L,M[f]);p=new Ne({props:L});var R=e[7];function D(e){return{props:{element:e[12],actions:e[4]}}}R&&(k=new R(D(e)));let _=(e[8]||e[11])&&qe(e);return I=new Le({props:{stateStore:e[0],controls:e[13]&&e[13].simulation}}),P=new ce({props:{configStore:e[1],fullLayout:!0,updateOnChange:!0,algorithm:e[3],$$slots:{"algorithm-config":[We,({config:e})=>({18:e}),({config:e})=>e?262144:0]},$$scope:{ctx:e}}}),{c(){n=y("article"),s=y("section"),o=y("section"),i=y("h1"),i.textContent="Node Graph",r=w(),Z(a.$$.fragment),l=w(),c=y("section"),d=y("h1"),d.textContent="Sequence Diagram",u=w(),Z(p.$$.fragment),h=w(),v=y("section"),b=y("h1"),b.textContent="Actions",x=w(),k&&Z(k.$$.fragment),S=w(),_&&_.c(),$=w(),T=y("section"),Z(I.$$.fragment),O=w(),N=y("section"),Z(P.$$.fragment),E(i,"class","svelte-1y74lh9"),E(o,"class","raised graph-panel svelte-1y74lh9"),E(d,"class","svelte-1y74lh9"),E(c,"class","raised graph-panel svelte-1y74lh9"),E(b,"class","svelte-1y74lh9"),E(v,"class","raised actions-panel svelte-1y74lh9"),E(s,"class","canvas-section svelte-1y74lh9"),E(T,"class","controls-section svelte-1y74lh9"),E(N,"class","config-section svelte-1y74lh9"),E(n,"class","full-algorithm svelte-1y74lh9")},m(e,t){m(e,n,t),f(n,s),f(s,o),f(o,i),f(o,r),ee(a,o,null),f(s,l),f(s,c),f(c,d),f(c,u),ee(p,c,null),f(s,h),f(s,v),f(v,b),f(v,x),k&&ee(k,v,null),f(n,S),_&&_.m(n,null),f(n,$),f(n,T),ee(I,T,null),f(n,O),f(n,N),ee(P,N,null),C=!0},p(e,[t]){const s=17440&t?K(A,[32&t&&V(e[5]),16384&t&&{id:"Canvas_"+e[14].algorithm+"_Nodes"},0&t&&{paintFn:ye},1024&t&&{paintOptions:e[10]}]):{};a.$set(s);const o=16928&t?K(M,[32&t&&V(e[5]),16384&t&&{id:"Canvas_"+e[14].algorithm+"_Sequence"},0&t&&{paintFn:De},512&t&&{paintOptions:e[9]}]):{};p.$set(o);const i={};if(4096&t&&(i.element=e[12]),16&t&&(i.actions=e[4]),R!==(R=e[7])){if(k){X();const e=k;Y(e.$$.fragment,1,0,(()=>{te(e,1)})),J()}R?(k=new R(D(e)),Z(k.$$.fragment),Q(k.$$.fragment,1),ee(k,v,null)):k=null}else R&&k.$set(i);e[8]||e[11]?_?(_.p(e,t),2304&t&&Q(_,1)):(_=qe(e),_.c(),Q(_,1),_.m(n,$)):_&&(X(),Y(_,1,1,(()=>{_=null})),J());const r={};1&t&&(r.stateStore=e[0]),8192&t&&(r.controls=e[13]&&e[13].simulation),I.$set(r);const l={};2&t&&(l.configStore=e[1]),8&t&&(l.algorithm=e[3]),4456512&t&&(l.$$scope={dirty:t,ctx:e}),P.$set(l)},i(e){C||(Q(a.$$.fragment,e),Q(p.$$.fragment,e),k&&Q(k.$$.fragment,e),Q(_),Q(I.$$.fragment,e),Q(P.$$.fragment,e),C=!0)},o(e){Y(a.$$.fragment,e),Y(p.$$.fragment,e),k&&Y(k.$$.fragment,e),Y(_),Y(I.$$.fragment,e),Y(P.$$.fragment,e),C=!1},d(e){e&&g(n),te(a),te(p),k&&te(k),_&&_.d(),te(I),te(P)}}}function ze(t,n,s){let o,i,r,l=e,c=()=>(l(),l=a(g,(e=>s(13,o=e))),g),d=e,u=()=>(d(),d=a(f,(e=>s(17,i=e))),f),p=e,h=()=>(p(),p=a(m,(e=>s(14,r=e))),m);t.$$.on_destroy.push((()=>l())),t.$$.on_destroy.push((()=>d())),t.$$.on_destroy.push((()=>p()));let{stateStore:f}=n;u();let{configStore:m}=n;h();let{controlsStore:g}=n;c();let v,{algorithm:y}=n,{algorithms:b}=n,w={},x={stateStore:f,configStore:m},k=y.components.Configuration,E=y.components.Actions,S=y.drawing.paintState,$=y.drawing.seqPaintingOptions||{},T=y.drawing.nodePaintingOptions||{},I=y.components.StateGraph,O=null;return C((()=>{m.subscribe((e=>{let t=b[e.algorithm];s(6,k=t.components.Configuration),s(11,I=t.components.StateGraph),s(7,E=t.components.Actions),s(8,S=t.drawing.paintState),s(9,$=t.drawing.seqPaintingOptions?{...t.drawing.seqPaintingOptions}:{}),s(9,$.autoAlign="TOP_TO_BOTTOM",$),s(10,T=t.drawing.nodePaintingOptions?{...t.drawing.nodePaintingOptions}:{}),s(10,T.autoAlign="CENTER",T)})),f.subscribe((e=>{o&&e&&(v!==e.selectedElementId&&(v=e.selectedElementId),v&&v.indexOf&&0===v.indexOf("M_")?s(12,O=i.messages.find((e=>e.id===v))):s(12,O=i.nodes.find((e=>e.id===v))),O&&s(4,w=o.element(e.nodes.find((e=>e.id===v)))))})),f.update((e=>({...e,selectedElementId:e.nodes.filter((e=>"client"===e.type))[0]}))),s(5,x={stateStore:f,configStore:m})})),t.$$set=e=>{"stateStore"in e&&u(s(0,f=e.stateStore)),"configStore"in e&&h(s(1,m=e.configStore)),"controlsStore"in e&&c(s(2,g=e.controlsStore)),"algorithm"in e&&s(3,y=e.algorithm),"algorithms"in e&&s(15,b=e.algorithms)},[f,m,g,y,w,x,k,E,S,$,T,I,O,o,r,b]}class Ue extends oe{constructor(e){super(),se(this,e,ze,Be,r,{stateStore:0,configStore:1,controlsStore:2,algorithm:3,algorithms:15})}}const Ge={algorithm:"paxos",commandDelay:0,networkDelay:5e3,speed:1,useWorkers:!0,useGlobalState:!1};function Xe(){return new Worker("assets/NodeRunnerWorker.45ac4748.js",{type:"module"})}function Je(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():function(e=6,t=36){return Math.random().toString(t).substring(2,e)}()}class Qe{constructor(e,t){this.neighbors=[],this.node=e,this.neighbors=t&&this.neighbors.concat(t)}getAllNeighbors(){return this.neighbors}getNeighborsOfType(e){return this.neighbors.filter((t=>t.type===e))}getRandomNeighborOfType(e){const t=this.getNeighborsOfType(e);return t[Math.floor(Math.random()*t.length)]}broadcast(e,t){const n=Je(),s=this.node.id;for(const o of t)o!==s&&this.emit({...e,sent:(new Date).toISOString(),id:this.getRandomId(),broadcastKey:n,fromId:s,toId:o})}broadcastToAll(e){const t=this.neighbors.map((e=>e.id));this.broadcast(e,t)}broadcastToType(e,t){const n=this.neighbors.filter((e=>e.type===t)).map((e=>e.id));this.broadcast(e,n)}sendTo(e,t){const n=this.node.id;this.emit({...t,sent:(new Date).toISOString(),fromId:n,toId:e,id:this.getRandomId()})}sendToSync(e,t){const n=this.node.id;return this.emitSync({...t,sent:(new Date).toISOString(),fromId:n,toId:e,id:this.getRandomId()})}emit(e){window.dispatchEvent(new CustomEvent("NetworkEvent",{detail:{...e,nodeId:this.node.id}}))}emitSync(e){const t=Je();return new Promise((n=>{this.emit({...e,resKey:t});const s=this.listen((e=>{e.resKey===t&&(s(),n(e))}))}))}listen(e){const t=(e=>t=>t.detail.toId===this.node.id&&e(t.detail))(e);return window.addEventListener("NetworkEvent",t),()=>{window.removeEventListener("NetworkEvent",t)}}async receive(){return new Promise((e=>{this.listen((t=>{e(t)}))}))}getRandomId(){return"M_"+Je()}}class Ye{constructor(e,t,n,s){this.id=e,this.config=t,this.state=n,this.network=s,this.running=!0,this.connected=!0,this.executedCommands=[],this.scheduledCommands=[]}stop(){this.running=!1}restart(){this.running=!0,this.scheduledCommands.forEach((e=>{e.do(),this.executedCommands.push(e)}))}reconnect(){this.connected=!0}disconnect(){this.connected=!1}invoke(e){const t=Je();let n=e;"function"==typeof n?n={id:t,do:e,undo:()=>console.warn("Undo not implemented")}:n.id=t,this.running?(n.do(),this.executedCommands.push(n)):this.scheduledCommands.push(n),this.updateState()}step(e=!0){if(e&&this.scheduledCommands.length>0){const e=this.scheduledCommands.shift();e.do(),this.executedCommands.push(e)}else if(this.executedCommands.length>0){const e=this.executedCommands.pop();e.undo(),this.scheduledCommands.push(e)}this.updateState()}invokeDo(e){const t={...this.state},n={do:()=>{e()},undo:()=>{this.state=t}};this.invoke(n)}updateState(){this.network.sendTo(void 0,{type:"STATE_CHANGED",isFlow:!0,data:{...this.state,scheduledCommands:this.scheduledCommands.map((({id:e})=>({id:e}))),executedCommands:this.executedCommands.map((({id:e})=>({id:e})))}})}}class Ke extends Ye{constructor(e,t,n,s){super(e,t,n,s),this.type="client"}request(e,t){const n=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{method:"REQUEST",v:t}),this.updateState()},undo:()=>{this.state.text=n}}}onmessage(e){"RESPONSE"===e.method&&this.invoke(this.onAck())}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}requestRandom(e){const t=this.network.getRandomNeighborOfType("proposer")||this.network.getRandomNeighborOfType("node");this.invoke(this.request(t.id,e))}}class Ve{constructor(e,t,n,s){this.id=e,this.config=n,this.parentNode=s,this.network=t,this.state={greatestN:-1,text:"IDLE"}}onPrepare(e){let t={state:{...this.state},parentState:{...this.parentNode.state}};return{do:()=>{if(e.n<=this.parentNode.state.greatestN)return this.state.text="IDLE",void this.network.sendTo(e.fromId,{clientId:e.clientId,n:this.parentNode.state.greatestN,method:"IGNORED"});this.parentNode.state.greatestN=e.n,this.state.text="PROMISED",this.network.sendTo(e.fromId,{method:"PROMISE",clientId:e.clientId,n:e.n})},undo:()=>{this.state=t,this.parentNode.state=t.parentState}}}onAccept(e){let t={state:{...this.state},parentState:{...this.parentNode.state}};return{do:()=>{if(e.n>this.parentNode.state.greatestN){this.state.text="IDLE";const t={clientId:e.clientId,n:this.parentNode.state.greatestN,v:e.v,method:"IGNORED"};this.network.sendTo(e.fromId,t)}else this.state.text="ACCEPTED","contactAllAcceptors"===this.config.learnerImpl?this.network.broadcastToType({clientId:e.clientId,n:e.n,v:e.v,method:"ACCEPTED"},"node"):(this.network.sendTo(e.fromId,{clientId:e.clientId,n:e.n,v:e.v,method:"ACCEPTED"}),this.parentNode.state.log[e.n-1]=e.v),this.parentNode.state.greatestN=e.n},undo:()=>{this.state=t.state,this.parentNode.state=t.parentState}}}}class Ze{constructor(e,t,n,s){this.network=t,this.config=n,this.parentNode=s,this.id=e,this.state={v:null,n:null}}onAccepted(e){const t=this.state.v,n=[...this.parentNode.state.log];return{do:()=>{e.v===this.state.v&&e.n===this.state.n||(this.state.v=e.v,this.state.n=e.n,this.parentNode.state.log[e.n-1]=e.v,this.network.sendTo(e.clientId,{clientId:e.clientId,n:e.n,v:e.v,method:"RESPONSE"}))},undo:()=>{this.state.v=t,this.parentNode.state.log=n}}}}class et{constructor(e,t,n,s){this.id=e,this.config=n,this.parentNode=s,this.network=t,this.type="proposer",this.state={proposals:[],text:"IDLE"}}hasMajority(e,t="promises"){const n=this.state.proposals.find((t=>t.n===e));if(!n)return;const s=this.network.getNeighborsOfType("acceptors").length||this.network.getNeighborsOfType("node").length;return n[t].length>=Math.floor(.5*s)+1}onRequest(e){let t={state:{...this.state},parentState:{...this.parentNode.state}};return{do:()=>{this.state.isProposer=!0,this.state.text="PREPARING",this.parentNode.state.greatestN+=1,this.state.proposals.push({clientId:e.fromId,v:e.v,n:this.parentNode.state.greatestN,promises:[],acceptances:[],ignoredBy:[]});let t=this.network.getNeighborsOfType("acceptor");t&&0!==t.length||(t=this.network.getNeighborsOfType("node")),this.parentNode.state.log[this.parentNode.state.greatestN-1]=e.v,this.network.broadcast({clientId:e.fromId,method:"PREPARE",n:this.parentNode.state.greatestN},t.map((e=>e.id)))},undo:()=>{this.state=t.state,this.parentNode.state=t.parentState}}}onPromise(e){const t={...this.state};return{do:()=>{const t=this.state.proposals.find((t=>t.n===e.n));t&&(this.hasMajority(e.n)?t.promises.push(e.fromId):(t.promises.push(e.fromId),this.hasMajority(e.n)&&(this.network.broadcastToType({clientId:e.clientId,method:"ACCEPT",n:t.n,v:t.v},"node"),this.state.text="PROMISED")))},undo:()=>{this.state=t}}}onAccepted(e){const t={...this.state};return{do:()=>{const t=this.state.proposals.find((t=>t.n===e.n));t&&(this.hasMajority(e.n,"acceptances")?t.acceptances.push(e.fromId):(t.acceptances.push(e.fromId),this.hasMajority(e.n,"acceptances")&&(this.state.text="IDLE"),this.state.isProposer=!1))},undo:()=>{this.state=t.state,this.parentNode.state=t.parentState}}}onIgnored(e){let t={state:{...this.state},parentState:{...this.parentNode.state}};return{do:()=>{if(e.n>this.parentNode.state.greatestN)return this.parentNode.state.greatestN=e.n,void(this.state.isProposer=!1);if(e.n<this.parentNode.state.greatestN)return;const t=this.state.proposals.findIndex((t=>t.n===e.n));t<0||!this.state.proposals[t]||(this.state.proposals=this.state.proposals.map((t=>t.n===e.n?{...t,acceptances:t.acceptances.filter((t=>t.acceptorId!==e.fromId)),promises:t.promises.filter((t=>t.acceptorId!==e.fromId))}:t)))},undo:()=>{this.state=t}}}}class tt extends Ye{constructor(e,t,n,s,o="node"){super(e,t,n,s),this.type=o,this.state.log=[],this.state.greatestN=0,"node"!==o&&"acceptor"!==o||(this.acceptor=new Ve(e,s,t,this),this.state.acceptor=this.acceptor.state),"node"!==o&&"learner"!==o||(this.learner=new Ze(e,s,t,this),this.state.learner=this.learner.state),"node"!==o&&"proposer"!==o||(this.proposer=new et(e,s,t,this),this.state.proposer=this.proposer.state)}onmessage(e){this.proposer&&this.handleProposerMessage(e),this.acceptor&&this.handleAcceptorMessage(e),this.learner&&this.handleLearnerMessage(e)}handleProposerMessage(e){switch(e.method){case"REQUEST":this.invoke(this.proposer.onRequest(e));break;case"PROMISE":this.invoke(this.proposer.onPromise(e));break;case"ACCEPTED":this.invoke(this.proposer.onAccepted(e));break;case"IGNORED":this.invoke(this.proposer.onIgnored(e))}}handleAcceptorMessage(e){switch(e.method){case"PREPARE":this.invoke(this.acceptor.onPrepare(e));break;case"ACCEPT":this.invoke(this.acceptor.onAccept(e))}}handleLearnerMessage(e){if("ACCEPTED"===e.method)this.invoke(this.learner.onAccepted(e))}}function nt(e,t,n,s){return"client"===n.type?new Ke(n.id,e,n,s):new tt(n.id,e,n,s,n.type||"all")}class st extends Ye{constructor(e,t,n,s){super(e,t,n,s),this.type="client"}request(e,t){const n=this.state.state;return{do:()=>{this.state.text="WAITING",this.network.sendTo(e,{command:"REQUEST",tx:t,timestamp:(new Date).getTime()}),this.updateState()},undo:()=>{this.state.text=n}}}onAck(){const e=this.state.text;return{do:()=>{this.state.text="DONE"},undo:()=>{this.state.text=e}}}onmessage(e){"RESPONSE"===e.method&&this.invoke(this.onAck())}requestRandom(e){const t=this.network.getRandomNeighborOfType("node");this.invoke(this.request(t.id,e))}}const ot={header:{prevHeaderHash:null,merkleRoot:null},height:0,timestamp:new Date("2009-01-03T19:15:00.000Z").getTime(),transactions:[]};async function it(e,t="",n="sha-256"){if("undefined"==typeof crypto||!crypto||!crypto.subtle)return JSON.stringify(e)+t;const s=(o=JSON.stringify(e)+t,(new TextEncoder).encode(o));var o;const i=await crypto.subtle.digest(n,s);return Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("")}async function rt(e,t,n="",s="sha-256"){if("undefined"==typeof crypto||!crypto||!crypto.subtle){return JSON.stringify(t)+n===e}return await it(t,n,s)===e}const at=1e3;class lt extends Ye{constructor(e,t,n,s){super(e,t,n,s),this.type="node",this.state.text="IDLE",this.state.chain=[ot],this.state.mempool=[],this.getBlocks(),this.sync=!0}onmessage(e){switch(e.command){case"getblocks":super.invoke(this.onGetBlocks(e));break;case"REQUEST":super.invokeDo(this.sendRawTransaction(e));break;case"blocks":super.invoke(this.onBlocks(e));break;case"rawtransaction":super.invokeDo(this.onRawTransaction(e));break;case"submitblock":super.invokeDo(this.onSubmitBlock(e))}}onBlocks(e){return{do:async()=>{for(let t of e.entries){if(!(await rt(t.header.prevHeaderHash,this.state.chain.at(-1).header)))return;this.state.chain.push(t)}},undo:()=>{}}}onGetBlocks(e){return{do:()=>{this.network.sendTo(e.fromId,{command:"blocks",entries:this.state.chain})},undo:()=>{}}}getBlocks(){if(0===this.network.neighbors.length)return;const e=this.network.getNeighborsOfType("node");if(0===e.length)return;const t=e[Math.floor(Math.random()*e.length)];this.network.sendTo(t.id,{command:"getblocks",headerHashes:[this.state.chain.at(-1).hash]})}sendRawTransaction(e){return()=>{const t=this.state.mempool.find((t=>e.tx===t)),n=this.state.chain.find((t=>t.transactions.find((t=>t===e.tx))));if(!t&&!n){this.timeout&&clearTimeout(this.timeout);const t=4e3*Math.random()+at;this.timeout=setTimeout(this.tryMining(),t),this.state.mempool.push(e.tx),this.network.broadcastToType({timestamp:e.timestamp,tx:e.tx,command:"rawtransaction"},"node")}}}onRawTransaction(e){return()=>{this.sendRawTransaction(e)()}}onSubmitBlock(e){return()=>{this.state.chain.find((t=>t===e.block||((e,t)=>()=>0===e.transactions.filter(((e,n)=>e!==t.transactions[n])).length)(e.block,t)))||(this.state.mempool=this.state.mempool.filter((t=>!e.block.transactions.find((e=>e!==t)))),this.state.chain.push(e.block))}}stop(){super.stop(),this.timeout&&clearTimeout(this.timeout)}restart(){super.restart();const e=4e3*Math.random()+at;this.timeout=setTimeout(this.tryMining(),e)}tryMining(){return async()=>{if(0===this.state.mempool.length)return;const e=Math.random().toFixed(8),t={header:{prevHeaderHash:await it(this.state.chain.at(-1),e),merkleRoot:null,nonce:e},height:this.state.chain.length,timestamp:(new Date).getTime(),transactions:this.state.mempool};this.state.mempool=[],this.state.chain.push(t),this.network.broadcastToType({block:t,command:"submitblock"},"node")}}validate(e){return rt(e.header.prevHeaderHash,{...e,hash:void 0})}}function ct(e,...t){switch(e){case"paxos":return nt(...t);case"bitcoin_pow":return function(e,t,n,s){switch(n.type){case"client":return new st(n.id,e,n,s);case"node":return new lt(n.id,e,n,s)}}(...t);default:throw"Algorithm not implemented"}}class dt{constructor(e,t){this.setupNetwork=(e,t)=>new Qe(e,t),this.id=Je(),this.config=e,this.network=null,this.nodeStates=t,this.nodes=[]}terminate(){this.stopListening&&this.stopListening()}buildMessageEventHandler(){return e=>{const t=e.data;if(console.log(`NodeRunner for "${this.nodeStates?this.nodeStates.map((e=>e.id)).join(", "):"?"}" got:`,t),t.isFlow)this.onFlowMessage(t);else if(t.toId){const e=this.nodes.find((e=>e.id===t.toId));e&&e.running&&e.connected&&e.onmessage(t)}}}setupNodes(e,t,n){this.nodeStates=t,t.forEach((async t=>{const s=this.setupNetwork(t,n),o=ct(e.algorithm,e,null,t,s);o&&(o.updateState(),this.nodes.push(o),console.log("Starting node with id ",o.id,"and type",o.type))}))}onFlowMessage(e){const{nodeId:t}=e;switch(e.type){case"CLIENT_REQUEST":if(t){const n=this.nodes.find((e=>e.id===t));if(n&&"client"===n.type){const{v:t}=e;n.requestRandom(t)}}break;case"SETUP":case"RESET":this.setupNodes(e.config,e.nodes,e.neighbors),this.postMessageToMain({isFlow:!0,type:"STATE_CHANGED",state:"IDLE"});break;case"STEP":this.nodes.forEach((t=>t.step(e.forward)));break;case"DISCONNECT":case"RECONNECT":case"STOP":case"RESTART":if(t){const n=this.nodes.find((e=>e.id===t));n&&("RECONNECT"===e.type?n.reconnect():"DISCONNECT"===e.type?n.disconnect():"RESTART"===e.type?n.restart():"STOP"===e.type&&(this.postMessageToMain({isFlow:!0,type:"COMMANDS",commands:n.executedCommands}),n.stop()))}break;default:console.error("Flow message type not recognized")}}onmessage(){console.warn("onmessage is not implemented")}onerror(){console.warn("onerror is not implemented")}postMessage(e){this.messageEventHandler||(this.messageEventHandler=this.buildMessageEventHandler());const t={data:e};this.messageEventHandler(t)}postMessageToMain(e){window.dispatchEvent(new CustomEvent("NodeRunnerEvent",{detail:{...e,nodeRunnerId:this.id}}))}startListening(){const e=e=>e.detail.nodeRunnerId===this.id||0!==this.nodeStates.filter((t=>t.id===e.detail.nodeId||t.id===e.detail.toId)).length,t=(n=this.onmessage,t=>e(t)&&n({data:t.detail}));var n;window.addEventListener("NodeRunnerEvent",t),window.addEventListener("NetworkEvent",t),this.stopListening=()=>{window.removeEventListener("NodeRunnerEvent",t),window.removeEventListener("NetworkEvent",t)}}}function ut(e,t,n){return s=>{var o;s.done&&n[s.id]&&!n[s.id].resolved&&(n[s.id].onCompleted(s),n[s.id].resolved=!0,null===(o=n[s.id])||void 0===o||o.resolve(s));if(s.done)return s;const i=function(e,t,n,s){const o=t<=0?1:n/(t/e.speed);return Math.min(s+(e.paused?0:o),1)}(e,t,10,s.progress),r=e.nodes.filter((e=>e.id===s.fromId))[0],a=e.nodes.filter((e=>e.id===s.toId))[0];if(!r||!a)return alert(`got ${s.fromId} ${s.toId}`),s;const l=r.pos,c=a.pos;if(s.pos=[l[0]+Math.min(i,1)*(c[0]-l[0]),l[1]+Math.min(i,1)*(c[1]-l[1])],i>=1)if(s.done=!0,n[s.id]){if(s.progress<1){var d;n[s.id].onCompleted(s),n[s.id].resolved=!0,null===(d=n[s.id])||void 0===d||d.resolve({...s,done:!0})}}else console.warn("onCompletedMap missing key");return s.progress=i,s}}function pt(e,t,n,s,o){const i=e=>n((t=>{const n=e(t);return{...t,...n}})),r={setSpeed:e=>n((t=>({...t,speed:e}))),stepForwards:()=>i(e.useGlobalState?ht(e,t,!0):ft(e,t,!0)),stepBackwards:()=>i(e.useGlobalState?ht(e,t,!1):ft(e,t,!1)),pauseOrPlay:()=>i(function(e,t,n){return e=>{if(Object.values(t).forEach((t=>t.postMessage({isFlow:!0,nodeId:n,type:e.paused?"RESTART":"STOP"}))),e.paused){const n=e.messages.filter((e=>e.deleted)).sort(gt);if(n.length>0&&n[0]){const e=n[0].fromId;t[e].postMessage({isFlow:!0,nodeId:e,type:"STEP",forward:!0})}}return{paused:void 0===e.paused||!e.paused,messages:e.paused?e.messages.filter((e=>!e.deleted)):e.messages,nodes:e.nodes.filter((e=>!n||e.id===n)).map((e=>({...e,running:!e.running})))}}}(0,t,void 0)),reset:()=>i(yt(e,t,void 0,s,o)),terminate:vt(e,t,s)},a=n=>({connectOrDisconnect:()=>i(function(e,t,n){return e=>{if(n&&t[n])return t[n].postMessage({isFlow:!0,type:e.nodes.find((e=>e.id===n)).connected?"DISCONNECT":"RECONNECT",nodeId:n}),{nodes:e.nodes.map((e=>({...e,connected:n&&e.id===n?!e.connected:e.connected})))}}}(0,t,n.id)),restart:()=>i(yt(e,t,n.id))});return{simulation:r,element:s=>({...a(s),delete:()=>n((e=>({...e,selectedElementId:void 0,messages:e.messages.filter((t=>t.id!==e.selectedElementId))}))),modify:e=>()=>n((t=>({...t,messages:t.messages.filter((e=>e.id!==t.selectedElementId)).concat(e)}))),createNewAction:s=>()=>{n((n=>{const o=s(e,n,t);return{...n,...o}}))}})}}function ht(e,t,n=!0){return e=>{if(window.states||(window.stateIdx=-1,window.states=[]),!n||0!==window.states.length&&window.stateIdx!==window.states.length-1)return n?(window.stateIdx+=1,window.states[window.stateIdx]):(window.stateIdx=Math.max(0,window.stateIdx-1),window.states[window.stateIdx]);{const n={messages:(t=[],s=e.messages,s.map((e=>{const n=-1==t.findIndex((t=>t.id===e.id));return e.done||e.deleted&&n||(e.deleted=!1,e.progress=e.progress<.5?.5:1,e.done=e.progress>=1),e}))),nodes:e.nodes};return window.states.push(n),n}var t,s}}function ft(e,t,n=!0){return e=>{if(n){return{messages:e.messages.map((e=>(e.done||e.deleted||(e.progress=e.progress<.5?.5:1,e.done=e.progress>=1),e)))}}{const n=[],s=e.messages.sort(gt(!0)),o=s.reduce(mt(s),[]),i=s.filter((e=>-1===o.indexOf(e))).reduce(mt(s),[]),r=e.messages.map((e=>(-1!==o.indexOf(e)?e.progress>.5?(e.progress=.5,e.done=!1,e.deleted=!1):(e.progress=0,e.deleted=!0,e.done=!0,n.push(e)):-1!==i.indexOf(e)&&(e.done=!1,e.progress=.5),e))).filter((e=>!e.deleted));return n.map((e=>e.fromId)).filter(bt).forEach((e=>{t[e].postMessage({isFlow:!0,type:"STEP",forward:!1})})),{messages:r}}}}function mt(e){return(t,n)=>{if(0===e.length)return[];const s=e[0].broadcastKey;return s?(s&&s===n.broadcastKey&&t.push(n),t):[e[0]]}}function gt(e=!1){return(t,n)=>{const s=new Date(t.sent).getTime(),o=new Date(n.sent).getTime();return s>o?e?-1:1:s<o?e?1:-1:0}}function vt(e,t,n){return()=>{n(),Object.values(t).forEach((e=>e.terminate()))}}function yt(e,t,n,s,o){return i=>{if(n&&t[n]){const s=i.nodes.find((e=>e.id===n));t[n].postMessage({config:e,isFlow:!0,type:"RESET",nodeId:n,nodes:[s],neighbors:i.nodes.filter((e=>e.id!==s.id))})}else if(!n)return s&&s(),o&&o();return{}}}const bt=(e,t,n)=>n.indexOf(e)===t;function wt({value:e,update:t},{value:n,update:s},o){const i=function(e,t){const n={0:()=>{}};let s=[];const o=setInterval((()=>{e((e=>{const o=[...s];return s=[],Object.keys(n).forEach((t=>{e.messages.find((e=>e.id===t))||o.find((e=>e.id===t))||(n[t]=void 0)})),{...e,messages:e.messages.concat(...o).map(ut(e,t,n)).filter(((e,t,n)=>n.findIndex((t=>t.id===e.id))===t))}}))}),10);return{stop:()=>clearInterval(o),push:async(e,t,o)=>new Promise((i=>{n[t.id]={resolve:i,onCompleted:o};const r={...t};r.progress=0,r.id=t.id,s.push(r),r.pos=e.nodes.filter((e=>e.id===t.fromId))[0].pos}))}}(s,e.networkDelay/n.speed),r={};for(const l of n.nodes){const o=e.useWorkers?new Xe({type:"module",name:l.id}):new dt(e,[l]),a=e=>{const t=e.data;if(t.isFlow)switch(t.type){case"STATE_CHANGED":if(!t.data)break;s((e=>({...e,commands:(e.commands||[]).concat(...t.data.scheduledCommands||[]),nodes:[...e.nodes.map((e=>e.id===l.id?{...e,...t.data}:e))]})))}else i.push(n,t,(e=>{e.toId&&r[e.toId].postMessage(e)}))};o.onmessage=a,o.onerror=e=>{console.error(e.message,e.error,e),t((e=>({...e,useWorkers:!1})))},e.useWorkers||o.startListening(),o.postMessage({isFlow:!0,type:"SETUP",config:e,nodes:[l],neighbors:n.nodes.filter((e=>e.id!==l.id))}),r[l.id]=o}const a=pt(e,r,s,i.stop,o);return[r,a]}function xt(e){const t={selectedElementId:void 0,started:new Date,speed:1,nodes:[],messages:[]};return t.nodes=function(e){const t=[];if(e.numberOfClients<1)throw"IllegalAmountOfClients";for(let n=0;n<e.numberOfClients;n++)t.push({id:"C"+(n+1),type:"client",running:!0,connected:!0,state:"IDLE",pos:[50+60*n,50]});if(e.useSingleNodes){if(e.numberOfNodes<1)throw"IllegalAmountOfNodes";const n=130,s=function(e,t){const n=[];for(let s=0;s<e;s++){const o=2*Math.PI*((s+1)/e);n.push([t*Math.cos(o)+t,t*Math.sin(o)+t])}return n}(e.numberOfNodes,100);for(let o=0;o<e.numberOfNodes;o++)t.push({id:"N"+(o+1),type:"node",running:!0,connected:!0,state:"IDLE",pos:[s[o][0]+50,s[o][1]+n]});return t}if(e.numberOfProposers<1)throw"IllegalAmountOfProposers";for(let n=0;n<e.numberOfProposers;n++)t.push({id:"P"+(n+1),type:"proposer",state:"IDLE",running:!0,connected:!0,pos:[100+60*n,150]});if(e.numberOfAcceptors<1)throw"IllegalAmountOfAcceptors";for(let n=0;n<e.numberOfAcceptors;n++)t.push({id:"A"+(n+1),type:"acceptor",state:"IDLE",running:!0,connected:!0,pos:[100+60*n,250]});if(e.numberOfLearners<1)throw"IllegalAmountOfLearners";for(let n=0;n<e.numberOfLearners;n++)t.push({id:"L"+(n+1),type:"learner",state:"IDLE",running:!0,connected:!0,pos:[50+60*n,350]});return t}(e),t}const kt={algorithm:"paxos",numberOfClients:1,numberOfProposers:1,numberOfAcceptors:3,numberOfLearners:2,numberOfNodes:5,useSingleNodes:!0,learnerImpl:"none",electLeader:!0},Et={...Re,getText:e=>{let t=e.method;switch(e.method){case"REQUEST":t+=` (${e.v})`;break;case"PROMISE":case"PREPARE":case"IGNORED":t+=` (${e.n})`;break;case"ACCEPT":case"ACCEPTED":t+=` (${e.n+", "+e.v})`}return t}},St={padding:2};function $t(e){let t,n,s,i,r,a,l,c,d,u,p,h,v,x,$,I;return{c(){t=y("div"),n=y("label"),s=b("Number of Proposers\r\n                "),i=y("input"),r=w(),a=y("div"),l=y("label"),c=b("Number of Acceptors\r\n                "),d=y("input"),u=w(),p=y("div"),h=y("label"),v=b("Number of Learners\r\n                "),x=y("input"),E(i,"type","number"),E(i,"min","1"),E(i,"max","10"),E(t,"class","input-group"),E(d,"type","number"),E(d,"min","1"),E(d,"max","10"),E(a,"class","input-group"),E(x,"type","number"),E(x,"min","1"),E(x,"max","10"),E(p,"class","input-group")},m(o,g){m(o,t,g),f(t,n),f(n,s),f(n,i),T(i,e[1].numberOfProposers),m(o,r,g),m(o,a,g),f(a,l),f(l,c),f(l,d),T(d,e[1].numberOfAcceptors),m(o,u,g),m(o,p,g),f(p,h),f(h,v),f(h,x),T(x,e[1].numberOfLearners),$||(I=[k(i,"input",e[4]),k(d,"input",e[5]),k(x,"input",e[6])],$=!0)},p(e,t){2&t&&S(i.value)!==e[1].numberOfProposers&&T(i,e[1].numberOfProposers),2&t&&S(d.value)!==e[1].numberOfAcceptors&&T(d,e[1].numberOfAcceptors),2&t&&S(x.value)!==e[1].numberOfLearners&&T(x,e[1].numberOfLearners)},d(e){e&&g(t),e&&g(r),e&&g(a),e&&g(u),e&&g(p),$=!1,o(I)}}}function Tt(e){let t,n,s,o,i,r;return{c(){t=y("div"),n=y("label"),s=b("Number of Nodes\r\n                "),o=y("input"),E(o,"type","number"),E(o,"min","1"),E(o,"max",15),E(t,"class","input-group")},m(a,l){m(a,t,l),f(t,n),f(n,s),f(n,o),T(o,e[1].numberOfNodes),i||(r=k(o,"input",e[3]),i=!0)},p(e,t){2&t&&S(o.value)!==e[1].numberOfNodes&&T(o,e[1].numberOfNodes)},d(e){e&&g(t),i=!1,r()}}}function It(t){let n,s,i,r,a,l,c,d,u,p,h,v,x,$,O;function N(e,t){return e[1].useSingleNodes?Tt:$t}let P=N(t),C=P(t);return{c(){n=y("div"),s=y("div"),i=y("label"),r=b("Number of Clients\r\n            "),a=y("input"),l=w(),C.c(),c=w(),d=y("div"),u=y("label"),p=b("Learner Implementation\r\n            "),h=y("select"),v=y("option"),v.textContent="none",x=y("option"),x.textContent="contact all acceptors",E(a,"type","number"),E(a,"min","1"),E(a,"max",5),E(s,"class","input-group"),v.__value="none",v.value=v.__value,x.__value="contactAllAcceptors",x.value=x.__value,void 0===t[1].learnerImpl&&F((()=>t[7].call(h))),E(d,"class","input-group"),E(n,"class","algorithm-specific-options")},m(e,o){m(e,n,o),f(n,s),f(s,i),f(i,r),f(i,a),T(a,t[1].numberOfClients),f(n,l),C.m(n,null),f(n,c),f(n,d),f(d,u),f(u,p),f(u,h),f(h,v),f(h,x),I(h,t[1].learnerImpl),$||(O=[k(a,"input",t[2]),k(h,"change",t[7])],$=!0)},p(e,[t]){2&t&&S(a.value)!==e[1].numberOfClients&&T(a,e[1].numberOfClients),P===(P=N(e))&&C?C.p(e,t):(C.d(1),C=P(e),C&&(C.c(),C.m(n,c))),2&t&&I(h,e[1].learnerImpl)},i:e,o:e,d(e){e&&g(n),C.d(),$=!1,o(O)}}}function Ot(t,n,s){let o,i=e,r=()=>(i(),i=a(l,(e=>s(1,o=e))),l);t.$$.on_destroy.push((()=>i()));let{config:l}=n;return r(),t.$$set=e=>{"config"in e&&r(s(0,l=e.config))},[l,o,function(){o.numberOfClients=S(this.value),l.set(o)},function(){o.numberOfNodes=S(this.value),l.set(o)},function(){o.numberOfProposers=S(this.value),l.set(o)},function(){o.numberOfAcceptors=S(this.value),l.set(o)},function(){o.numberOfLearners=S(this.value),l.set(o)},function(){o.learnerImpl=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),l.set(o)}]}const Nt={byNodeType:{leader:"A leader primarily has the role of the proposer.",follower:"A follower primarily has the role of the acceptor.",node:"A paxos Node follows all three roles of the paxos protocol.",proposer:"A proposer tries to have the acceptors agree on a value v send by a client.",acceptor:"An acceptor votes on proposals sent from the proposer. Only then a value can be stored",learner:"A learner makes sure an accepted value is stored and distributed.",client:"Clients want to store data or run actions inside the paxos network. The client is most likely another server system."},byNodeState:{},byMessageMethod:{RESPONSE:"Clients may be informed about the outcome of the voting.",REQUEST:"Clients can send requests to the current leader if they want to store an input to the replicated log of the cluster.",PREPARE:"A leader node (or proposer) sends followers its generation n. It prepares to commit a value v.",PROMISE:"Followers (or acceptors) answer to the PREPARE requests with a PROMISE message",ACCEPT:"After getting all promises from the acceptor the proposer wants all acceptors to accept a value v",ACCEPTED:"If an acceptor accepts a value v it sends an ACCEPTED message back to the proposer",IGNORED:"If an acceptor does not accept a value v it sends an IGNORED message back to the proposer. The proposer must try again with a higher generation"}};function Pt(e){let t,n,s,r,a,l,c,d,u,p,h,v,x,S,T,I,O,N,P,C,A,j,M,L,R,D,_,q,F,H,W=e[0].id+"",B=(Nt.byNodeType[e[0].type]||"No information")+"",z=(Nt.byNodeState[e[0].state]||"")+"",U=e[0].type+"",G=e[0].state+"",X=e[0].connected?"disconnect":"reconnect",J="client"!==e[0].type&&jt(e),Q="client"===e[0].type&&Mt(e);return{c(){t=y("h1"),n=b("Node "),s=b(W),r=w(),a=y("p"),l=y("span"),c=b(B),d=w(),u=y("span"),p=b(z),h=w(),v=y("ul"),x=y("li"),S=b("type: "),T=y("span"),I=b(U),O=w(),N=y("li"),P=b("state: "),C=y("span"),A=b(G),j=w(),J&&J.c(),M=w(),Q&&Q.c(),L=w(),R=y("button"),R.textContent="restart",D=w(),_=y("button"),q=b(X),E(T,"class","svelte-1muk73i"),E(x,"class","svelte-1muk73i"),E(C,"class","svelte-1muk73i"),E(N,"class","svelte-1muk73i"),E(v,"class","property-list svelte-1muk73i")},m(o,g){m(o,t,g),f(t,n),f(t,s),m(o,r,g),m(o,a,g),f(a,l),f(l,c),f(a,d),f(a,u),f(u,p),m(o,h,g),m(o,v,g),f(v,x),f(x,S),f(x,T),f(T,I),f(v,O),f(v,N),f(N,P),f(N,C),f(C,A),f(v,j),J&&J.m(v,null),m(o,M,g),Q&&Q.m(o,g),m(o,L,g),m(o,R,g),m(o,D,g),m(o,_,g),f(_,q),F||(H=[k(R,"click",(function(){i(e[1].restart)&&e[1].restart.apply(this,arguments)})),k(_,"click",(function(){i(e[1].connectOrDisconnect)&&e[1].connectOrDisconnect.apply(this,arguments)}))],F=!0)},p(t,n){e=t,1&n&&W!==(W=e[0].id+"")&&$(s,W),1&n&&B!==(B=(Nt.byNodeType[e[0].type]||"No information")+"")&&$(c,B),1&n&&z!==(z=(Nt.byNodeState[e[0].state]||"")+"")&&$(p,z),1&n&&U!==(U=e[0].type+"")&&$(I,U),1&n&&G!==(G=e[0].state+"")&&$(A,G),"client"!==e[0].type?J?J.p(e,n):(J=jt(e),J.c(),J.m(v,null)):J&&(J.d(1),J=null),"client"===e[0].type?Q?Q.p(e,n):(Q=Mt(e),Q.c(),Q.m(L.parentNode,L)):Q&&(Q.d(1),Q=null),1&n&&X!==(X=e[0].connected?"disconnect":"reconnect")&&$(q,X)},d(e){e&&g(t),e&&g(r),e&&g(a),e&&g(h),e&&g(v),J&&J.d(),e&&g(M),Q&&Q.d(e),e&&g(L),e&&g(R),e&&g(D),e&&g(_),F=!1,o(H)}}}function Ct(e){let t,n,s,r,a,l,c,d,u,p,h,v,x,S,T,I,O,N,P,C,A,j,M,L,R,D=e[0].id+"",_=e[0].toId+"",q=e[0].fromId+"",F=Nt.byMessageMethod[e[0].method]+"",H=e[0].method+"",W=-1!==["REQUEST","ACCEPTED","ACCEPT"].indexOf(e[0].method),B=-1!==["ACCEPT","ACCEPTED","PROMISE","PREPARE","IGNORED"].indexOf(e[0].method),z=W&&Lt(e),U=B&&Rt(e);return{c(){t=y("h1"),n=b("Message "),s=b(D),r=w(),a=y("p"),l=b(_),c=b("  "),d=b(q),u=w(),p=y("p"),h=b(F),v=w(),x=y("ul"),S=y("li"),T=b("method: "),I=y("span"),O=b(H),N=w(),z&&z.c(),P=w(),U&&U.c(),C=w(),A=y("button"),A.textContent="delete",j=w(),M=y("button"),M.textContent="modify",E(I,"class","svelte-1muk73i"),E(S,"class","svelte-1muk73i"),E(x,"class","property-list svelte-1muk73i")},m(o,g){m(o,t,g),f(t,n),f(t,s),m(o,r,g),m(o,a,g),f(a,l),f(a,c),f(a,d),m(o,u,g),m(o,p,g),f(p,h),m(o,v,g),m(o,x,g),f(x,S),f(S,T),f(S,I),f(I,O),f(x,N),z&&z.m(x,null),f(x,P),U&&U.m(x,null),m(o,C,g),m(o,A,g),m(o,j,g),m(o,M,g),L||(R=[k(A,"click",(function(){i(e[1].delete)&&e[1].delete.apply(this,arguments)})),k(M,"click",(function(){i(e[1].modify)&&e[1].modify.apply(this,arguments)}))],L=!0)},p(t,n){e=t,1&n&&D!==(D=e[0].id+"")&&$(s,D),1&n&&_!==(_=e[0].toId+"")&&$(l,_),1&n&&q!==(q=e[0].fromId+"")&&$(d,q),1&n&&F!==(F=Nt.byMessageMethod[e[0].method]+"")&&$(h,F),1&n&&H!==(H=e[0].method+"")&&$(O,H),1&n&&(W=-1!==["REQUEST","ACCEPTED","ACCEPT"].indexOf(e[0].method)),W?z?z.p(e,n):(z=Lt(e),z.c(),z.m(x,P)):z&&(z.d(1),z=null),1&n&&(B=-1!==["ACCEPT","ACCEPTED","PROMISE","PREPARE","IGNORED"].indexOf(e[0].method)),B?U?U.p(e,n):(U=Rt(e),U.c(),U.m(x,null)):U&&(U.d(1),U=null)},d(e){e&&g(t),e&&g(r),e&&g(a),e&&g(u),e&&g(p),e&&g(v),e&&g(x),z&&z.d(),U&&U.d(),e&&g(C),e&&g(A),e&&g(j),e&&g(M),L=!1,o(R)}}}function At(t){let n;return{c(){n=y("span"),n.textContent="No valid element select"},m(e,t){m(e,n,t)},p:e,d(e){e&&g(n)}}}function jt(e){let t,n,s,o,i=(e[0].greatestN||0)+"";return{c(){t=y("li"),n=b("generation: "),s=y("span"),o=b(i),E(s,"class","svelte-1muk73i"),E(t,"class","svelte-1muk73i")},m(e,i){m(e,t,i),f(t,n),f(t,s),f(s,o)},p(e,t){1&t&&i!==(i=(e[0].greatestN||0)+"")&&$(o,i)},d(e){e&&g(t)}}}function Mt(e){let t,n,s,r,a;return{c(){t=y("input"),n=w(),s=y("button"),s.textContent="request",E(t,"type","text")},m(o,l){m(o,t,l),T(t,e[2]),m(o,n,l),m(o,s,l),r||(a=[k(t,"input",e[7]),k(s,"click",(function(){i(e[4])&&e[4].apply(this,arguments)}))],r=!0)},p(n,s){e=n,4&s&&t.value!==e[2]&&T(t,e[2])},d(e){e&&g(t),e&&g(n),e&&g(s),r=!1,o(a)}}}function Lt(e){let t,n,s,o,i;return{c(){t=y("li"),n=b("value: "),s=y("input"),E(s,"type","text"),E(t,"class","svelte-1muk73i")},m(r,a){m(r,t,a),f(t,n),f(t,s),T(s,e[0].v),o||(i=k(s,"input",e[5]),o=!0)},p(e,t){1&t&&s.value!==e[0].v&&T(s,e[0].v)},d(e){e&&g(t),o=!1,i()}}}function Rt(e){let t,n,s,o,i;return{c(){t=y("li"),n=b("generation: "),s=y("input"),E(s,"type","text"),E(t,"class","svelte-1muk73i")},m(r,a){m(r,t,a),f(t,n),f(t,s),T(s,e[0].n),o||(i=k(s,"input",e[6]),o=!0)},p(e,t){1&t&&s.value!==e[0].n&&T(s,e[0].n)},d(e){e&&g(t),o=!1,i()}}}function Dt(t){let n;function s(e,t){return e[0]?e[3]?Ct:Pt:At}let o=s(t),i=o(t);return{c(){n=y("div"),i.c(),E(n,"class","node-actions-panel")},m(e,t){m(e,n,t),i.m(n,null)},p(e,[t]){o===(o=s(e))&&i?i.p(e,t):(i.d(1),i=o(e),i&&(i.c(),i.m(n,null)))},i:e,o:e,d(e){e&&g(n),i.d()}}}function _t(e,t,n){let{element:s}=t,{actions:o}=t;function i(e,t,n){n[s.id].postMessage({nodeId:s.id,isFlow:!0,type:"CLIENT_REQUEST",v:r})}let r="777",a="",l=!1,c=()=>{};return A((()=>{o&&!l&&s&&"client"===s.type&&n(4,c=o.createNewAction(i)),s&&a!==s.id&&(n(2,r=s.id),a=s.id,n(3,l=s&&s.fromId))})),e.$$set=e=>{"element"in e&&n(0,s=e.element),"actions"in e&&n(1,o=e.actions)},[s,o,r,l,c,function(){s.v=this.value,n(0,s)},function(){s.n=this.value,n(0,s)},function(){r=this.value,n(2,r)}]}function qt(e,t,n){const s=e.slice();return s[2]=t[n],s}function Ft(e,t,n){const s=e.slice();return s[5]=t[n],s}function Ht(e){let t,n=e[1].nodes.filter(Ut),s=[];for(let o=0;o<n.length;o+=1)s[o]=Bt(qt(e,n,o));return{c(){for(let e=0;e<s.length;e+=1)s[e].c();t=x()},m(e,n){for(let t=0;t<s.length;t+=1)s[t].m(e,n);m(e,t,n)},p(e,o){if(2&o){let i;for(n=e[1].nodes.filter(Ut),i=0;i<n.length;i+=1){const r=qt(e,n,i);s[i]?s[i].p(r,o):(s[i]=Bt(r),s[i].c(),s[i].m(t.parentNode,t))}for(;i<s.length;i+=1)s[i].d(1);s.length=n.length}},d(e){v(s,e),e&&g(t)}}}function Wt(e){let t,n,s=e[5]+"";return{c(){t=y("li"),n=b(s),E(t,"class","entry svelte-1o1yvcd")},m(e,s){m(e,t,s),f(t,n)},p(e,t){2&t&&s!==(s=e[5]+"")&&$(n,s)},d(e){e&&g(t)}}}function Bt(e){let t,n,s,o,i,r,a,l=e[2].id+"",c=e[2].log,d=[];for(let u=0;u<c.length;u+=1)d[u]=Wt(Ft(e,c,u));return{c(){t=y("li"),n=y("h1"),s=b(l),o=w(),i=y("ul");for(let e=0;e<d.length;e+=1)d[e].c();a=w(),E(n,"class","svelte-1o1yvcd"),E(i,"class",r=h(e[1].selectedElementId===e[2].id?"selected":"")+" svelte-1o1yvcd"),E(t,"class","log svelte-1o1yvcd")},m(e,r){m(e,t,r),f(t,n),f(n,s),f(t,o),f(t,i);for(let t=0;t<d.length;t+=1)d[t].m(i,null);f(t,a)},p(e,t){if(2&t&&l!==(l=e[2].id+"")&&$(s,l),2&t){let n;for(c=e[2].log,n=0;n<c.length;n+=1){const s=Ft(e,c,n);d[n]?d[n].p(s,t):(d[n]=Wt(s),d[n].c(),d[n].m(i,null))}for(;n<d.length;n+=1)d[n].d(1);d.length=c.length}2&t&&r!==(r=h(e[1].selectedElementId===e[2].id?"selected":"")+" svelte-1o1yvcd")&&E(i,"class",r)},d(e){e&&g(t),v(d,e)}}}function zt(t){let n,s,o=t[0]&&Ht(t);return{c(){n=y("div"),s=y("ul"),o&&o.c(),E(s,"class","nodes svelte-1o1yvcd"),function(e,t,n,s){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,s?"important":"")}(n,"overflow","auto")},m(e,t){m(e,n,t),f(n,s),o&&o.m(s,null)},p(e,[t]){e[0]?o?o.p(e,t):(o=Ht(e),o.c(),o.m(s,null)):o&&(o.d(1),o=null)},i:e,o:e,d(e){e&&g(n),o&&o.d()}}}const Ut=e=>"node"===e.type&&e.log;function Gt(t,n,s){let o,i=e,r=()=>(i(),i=a(l,(e=>s(1,o=e))),l);t.$$.on_destroy.push((()=>i()));let{stateStore:l}=n;return r(),t.$$set=e=>{"stateStore"in e&&r(s(0,l=e.stateStore))},[l,o]}const Xt="paxos",Jt={seqPaintingOptions:Et,nodePaintingOptions:{isLeader:e=>{var t;return null===(t=e.proposer)||void 0===t?void 0:t.isProposer}},paintState:function(e,t,n,s=St){return t?(s={...St,...s},t.nodes.forEach(((t,n)=>{var o;const i=30*n;e.beginPath(),e.fillStyle="#000",e.font="20px courier new";let r=[0,i+12];e.fillText(t.id,...r),e.closePath();let a=20*t.id.length+St.padding;(null===(o=t.proposer)||void 0===o?void 0:o.log)&&t.proposer.log.filter((e=>e)).forEach((t=>{e.beginPath(),e.lineWidth=2,e.strokeStyle="#000";const n=10*t.length;e.rect(a-s.padding,i,n+2*s.padding,10),e.stroke(),e.closePath(),e.beginPath(),e.fillStyle="#000",e.font="12px courier new";let o=a+12*t.length+2,r=[o,i+8];a=o,e.fillText(t,...r),e.closePath()}))})),[0,30*(t.nodes.length+1)]):[e.canvas.width,e.canvas.height]}},Qt={Configuration:class extends oe{constructor(e){super(),se(this,e,Ot,It,r,{config:0})}},Actions:class extends oe{constructor(e){super(),se(this,e,_t,Dt,r,{element:0,actions:1})}},StateGraph:class extends oe{constructor(e){super(),se(this,e,Gt,zt,r,{stateStore:0})}}};const Yt={[Xt]:Object.freeze(Object.defineProperty({__proto__:null,title:"Paxos",key:Xt,drawing:Jt,components:Qt,setupNode:nt,generateState:xt,defaultConfig:kt},Symbol.toStringTag,{value:"Module"}))};function Kt(e=Yt.paxos){let t={...Ge};t={...t,...e&&e.defaultConfig?e.defaultConfig:kt};const n=ue(t);n.subscribe((e=>{t=e}));const s=ue((e&&e.generateState?e.generateState:xt)(t));s.subscribe((e=>{}));const o=ue(null);o.subscribe((e=>{}));const i=function(e,t,n,s,o){let i=null;return t=>{if(i&&i.key===t.algorithm&&i.useWorkers===t.useWorkers)return i=t,t;if(i=t,e.key!==t.algorithm){(e=Yt[t.algorithm])||console.error("algorithm not supported");const n={};Object.keys(Ge).forEach((e=>{n[e]=t[e]})),t={...n,...e.defaultConfig}}return Vt(e,t,n,s,o),t}}(e,0,s,o,n);return n.subscribe(i),i(t),[n,s,o]}function Vt(e,t,n,s,o){const i=(0,e.generateState)(t);n.update((()=>i));const[r,a]=wt(Zt(t,o),Zt(i,n),(()=>Vt(e,t,n,s,o)));return s.update((e=>(e&&e.simulation&&e.simulation.terminate(),a))),i}function Zt(e,t){let n=e;return t.subscribe((e=>n=e)),{value:n,update:t.update}}function en(t){let n,s,o,i;return{c(){n=y("span"),s=b("Layout '"),o=b(t[0]),i=b("' not supported")},m(e,t){m(e,n,t),f(n,s),f(n,o),f(n,i)},p(e,t){1&t&&$(o,e[0])},i:e,o:e,d(e){e&&g(n)}}}function tn(e){let n,s;const o=[e[1]];let i={};for(let r=0;r<o.length;r+=1)i=t(i,o[r]);return n=new Ue({props:i}),{c(){Z(n.$$.fragment)},m(e,t){ee(n,e,t),s=!0},p(e,t){const s=2&t?K(o,[V(e[1])]):{};n.$set(s)},i(e){s||(Q(n.$$.fragment,e),s=!0)},o(e){Y(n.$$.fragment,e),s=!1},d(e){te(n,e)}}}function nn(e){let t,n,s,o;const i=[tn,en],r=[];function a(e,t){return"full"===e[0]?0:1}return t=a(e),n=r[t]=i[t](e),{c(){n.c(),s=x()},m(e,n){r[t].m(e,n),m(e,s,n),o=!0},p(e,[o]){let l=t;t=a(e),t===l?r[t].p(e,o):(X(),Y(r[l],1,1,(()=>{r[l]=null})),J(),n=r[t],n?n.p(e,o):(n=r[t]=i[t](e),n.c()),Q(n,1),n.m(s.parentNode,s))},i(e){o||(Q(n),o=!0)},o(e){Y(n),o=!1},d(e){r[t].d(e),e&&g(s)}}}function sn(e,t,n){let{layout:s="full"}=t,{registerAlgorithm:o}=t,{unregisterAlgorithm:i}=t;const[r,a,l]=Kt();let c,d;r.subscribe((e=>{c=Yt[e.algorithm],c.labels})),a.subscribe((e=>{window.states||(window.stateIdx=-1,window.states=[]);const{nodes:t,messages:n}=e;window.stateIdx+=1,window.states.push({nodes:t,messages:n})})),l.subscribe((e=>{d=e})),C((()=>{o&&o(r,a)})),j((()=>{i&&i(r,a),d&&d.simulation.terminate()}));const u={configStore:r,stateStore:a,controlsStore:l,algorithm:c,algorithms:Yt};return e.$$set=e=>{"layout"in e&&n(0,s=e.layout),"registerAlgorithm"in e&&n(2,o=e.registerAlgorithm),"unregisterAlgorithm"in e&&n(3,i=e.unregisterAlgorithm)},[s,u,o,i]}class on extends oe{constructor(e){super(),se(this,e,sn,nn,r,{layout:0,registerAlgorithm:2,unregisterAlgorithm:3})}}function rn(t){let n;return{c(){n=y("footer"),n.innerHTML='<div class="content svelte-4jochn"><div class="brand svelte-4jochn"><img alt="logo" src="/favicon/android-icon-48x48.png" class="svelte-4jochn"/><span class="svelte-4jochn">Visual Consensus</span></div> \n        <div class="links svelte-4jochn"><p>Links</p> \n            <a href="https://github.com/jojahn/visual-consensus" class="svelte-4jochn">Source Code</a> \n            <a href="https://github.com/jojahn/visual-consensus/blob/main/latex/thesis.pdf" class="svelte-4jochn">Thesis</a> \n            <a href="about.html#ThirdPartyLicenses" class="svelte-4jochn">Third Party Licenses</a></div></div> \n    <div><p class="rights svelte-4jochn">Licensed under <a href="https://github.com/jojahn/visual-consensus/LICENSE" class="svelte-4jochn">MIT</a></p> \n        <p class="rights svelte-4jochn">2022 <a href="https://github.com/jojahn/visual-consensus/graphs/contributors" class="svelte-4jochn">contributers</a></p></div>',E(n,"class","svelte-4jochn")},m(e,t){m(e,n,t)},p:e,i:e,o:e,d(e){e&&g(n)}}}class an extends oe{constructor(e){super(),se(this,e,null,rn,r,{})}}function ln(e,t,n){const s=e.slice();return s[5]=t[n],s}function cn(e){let t,n,s,o,i,r,a=e[5].title+"";return{c(){t=y("li"),n=y("button"),s=b(a),E(n,"class","svelte-1slpat4"),E(t,"class",o=h(e[0]===e[5].key?"active":"")+" svelte-1slpat4")},m(o,a){m(o,t,a),f(t,n),f(n,s),i||(r=k(n,"click",e[1](e[5].key)),i=!0)},p(n,s){e=n,1&s&&o!==(o=h(e[0]===e[5].key?"active":"")+" svelte-1slpat4")&&E(t,"class",o)},d(e){e&&g(t),i=!1,r()}}}function dn(t){let n,s,o,i,r,a=Object.values(Yt),l=[];for(let e=0;e<a.length;e+=1)l[e]=cn(ln(t,a,e));return{c(){n=y("header"),s=y("nav"),o=y("ul");for(let e=0;e<l.length;e+=1)l[e].c();i=w(),r=y("li"),r.innerHTML='<a href="/about.html" class="svelte-1slpat4">About</a>',E(r,"class","svelte-1slpat4"),E(o,"class","svelte-1slpat4"),E(s,"class","svelte-1slpat4"),E(n,"class","svelte-1slpat4")},m(e,t){m(e,n,t),f(n,s),f(s,o);for(let n=0;n<l.length;n+=1)l[n].m(o,null);f(o,i),f(o,r)},p(e,[t]){if(3&t){let n;for(a=Object.values(Yt),n=0;n<a.length;n+=1){const s=ln(e,a,n);l[n]?l[n].p(s,t):(l[n]=cn(s),l[n].c(),l[n].m(o,i))}for(;n<l.length;n+=1)l[n].d(1);l.length=a.length}},i:e,o:e,d(e){e&&g(n),v(l,e)}}}function un(e,t,n){let{selectedAlgorithm:s}=t,{changeAlgorithm:o}=t,{share:i}=t;return e.$$set=e=>{"selectedAlgorithm"in e&&n(0,s=e.selectedAlgorithm),"changeAlgorithm"in e&&n(2,o=e.changeAlgorithm),"share"in e&&n(3,i=e.share)},[s,e=>()=>o(e),o,i]}class pn extends oe{constructor(e){super(),se(this,e,un,dn,r,{selectedAlgorithm:0,changeAlgorithm:2,share:3})}}var hn,fn={};function mn(e){let t=e;return t=fn.pack(e),t=window.btoa?btoa(t):t,t}function gn(e,t){const n="/?config="+mn(e)+"&state="+mn(t);!function(e){const t="Visual Consensus",n={additionalInformation:"URL"};window.history.pushState(n,t,e)}(),navigator.clipboard.writeText(location.origin+n)}hn=fn,function(e,t){var n=t();for(var s in n)hn[s]=n[s]}(0,(function(){var e=function(e){return"string"!=typeof e?e:e.replace(/[\+ \|\^\%]/g,(function(e){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[e]}))},t=function(e){return"string"!=typeof e?e:e.replace(/\+|%2B|%7C|%5E|%25/g,(function(e){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[e]}))},n=function(e){return Number.prototype.toString.call(e,36).toUpperCase()},s=function(e){return parseInt(e,36)},o=Array.prototype.indexOf||function(e,t){for(var n=t||0,s=this.length;n<s;n++)if(this[n]===e)return n;return-1};return{JSON:JSON,pack:function(t,s){var i=(s=s||{}).verbose||!1;i&&console.log("Normalize the JSON Object"),t="string"==typeof t?this.JSON.parse(t):t,i&&console.log("Creating a empty dictionary");var r={strings:[],integers:[],floats:[]};i&&console.log("Creating the AST");var a=function t(s){i&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(s));var a,l=typeof s;if(null===s)return{type:"null",index:-3};if(void 0===s)return{type:"undefined",index:-5};if(s instanceof Array){var c=["@"];for(var d in s)s.hasOwnProperty(d)&&c.push(t(s[d]));return c}if("object"===l){for(var u in c=["$"],s)s.hasOwnProperty(u)&&(c.push(t(u)),c.push(t(s[u])));return c}if(""===s)return{type:"empty",index:-4};if("string"===l)return-1==(a=o.call(r.strings,s))&&(r.strings.push(e(s)),a=r.strings.length-1),{type:"strings",index:a};if("number"===l&&s%1==0)return-1==(a=o.call(r.integers,s))&&(r.integers.push(n(s)),a=r.integers.length-1),{type:"integers",index:a};if("number"===l)return-1==(a=o.call(r.floats,s))&&(r.floats.push(s),a=r.floats.length-1),{type:"floats",index:a};if("boolean"===l)return{type:"boolean",index:s?-1:-2};throw new Error("Unexpected argument of type "+typeof s)}(t),l=r.strings.length,c=r.integers.length;r.floats.length,i&&console.log("Parsing the dictionary");var d=r.strings.join("|");return d+="^"+r.integers.join("|"),d+="^"+r.floats.join("|"),i&&console.log("Parsing the structure"),d+="^"+function e(t){if(i&&console.log("Calling a recursiveParser with "+this.JSON.stringify(t)),t instanceof Array){var s=t.shift();for(var o in t)t.hasOwnProperty(o)&&(s+=e(t[o])+"|");return("|"===s[s.length-1]?s.slice(0,-1):s)+"]"}var r=t.type,a=t.index;if("strings"===r)return n(a);if("integers"===r)return n(l+a);if("floats"===r)return n(l+c+a);if("boolean"===r)return t.index;if("null"===r)return-3;if("undefined"===r)return-5;if("empty"===r)return-4;throw new TypeError("The item is alien!")}(a),i&&console.log("Ending parser"),s.debug?{dictionary:r,ast:a,packed:d}:d},unpack:function(e,n){n=n||{};var o=e.split("^");n.verbose&&console.log("Building dictionary");var i=[],r=o[0];if(""!==r){r=r.split("|"),n.verbose&&console.log("Parse the strings dictionary");for(var a=0,l=r.length;a<l;a++)i.push(t(r[a]))}if(""!==(r=o[1]))for(r=r.split("|"),n.verbose&&console.log("Parse the integers dictionary"),a=0,l=r.length;a<l;a++)i.push(s(r[a]));if(""!==(r=o[2]))for(r=r.split("|"),n.verbose&&console.log("Parse the floats dictionary"),a=0,l=r.length;a<l;a++)i.push(parseFloat(r[a]));r=null,n.verbose&&console.log("Tokenizing the structure");var c="",d=[],u=o[3].length;for(a=0;a<u;a++){var p=o[3].charAt(a);"|"===p||"$"===p||"@"===p||"]"===p?(c&&(d.push(s(c)),c=""),"|"!==p&&d.push(p)):c+=p}var h=d.length,f=0;return n.verbose&&console.log("Starting recursive parser"),function e(){var t=d[f++];if(n.verbose&&console.log("Reading collection type "+("$"===t?"object":"Array")),"@"===t){for(var s=[];f<h;f++){var o=d[f];if(n.verbose&&console.log("Read "+o+" symbol"),"]"===o)return s;if("@"===o||"$"===o)s.push(e());else switch(o){case-1:s.push(!0);break;case-2:s.push(!1);break;case-3:s.push(null);break;case-5:s.push(void 0);break;case-4:s.push("");break;default:s.push(i[o])}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(s)),s}if("$"===t){for(s={};f<h;f++){var r=d[f];if("]"===r)return s;if(r=-4===r?"":i[r],"@"===(o=d[++f])||"$"===o)s[r]=e();else switch(o){case-1:s[r]=!0;break;case-2:s[r]=!1;break;case-3:s[r]=null;break;case-5:s[r]=void 0;break;case-4:s[r]="";break;default:s[r]=i[o]}}return n.verbose&&console.log("Parsed "+this.JSON.stringify(s)),s}throw new TypeError("Bad token "+t+" isn't a type")}()}}}));function vn(t){let n;return{c(){n=y("span"),n.textContent="Layout not supported!"},m(e,t){m(e,n,t)},p:e,i:e,o:e,d(e){e&&g(n)}}}function yn(t){let n,s;return n=new on({props:{registerAlgorithm:t[4],unregisterAlgorithm:t[5],layout:wn}}),{c(){Z(n.$$.fragment)},m(e,t){ee(n,e,t),s=!0},p:e,i(e){s||(Q(n.$$.fragment,e),s=!0)},o(e){Y(n.$$.fragment,e),s=!1},d(e){te(n,e)}}}function bn(e){let t,n,s,o,i,r,a,l,c;s=new pn({props:{layout:wn,changeAlgorithm:e[3],selectedAlgorithm:e[1],share:e[2]}});const d=[yn,vn],u=[];return i=0,r=u[0]=d[0](e),l=new an({}),{c(){t=y("main"),n=w(),Z(s.$$.fragment),o=w(),r.c(),a=w(),Z(l.$$.fragment)},m(e,i){m(e,t,i),f(t,n),ee(s,t,null),f(t,o),u[0].m(t,null),f(t,a),ee(l,t,null),c=!0},p(e,[t]){const n={};2&t&&(n.selectedAlgorithm=e[1]),s.$set(n),r.p(e,t)},i(e){c||(Q(false),Q(s.$$.fragment,e),Q(r),Q(l.$$.fragment,e),c=!0)},o(e){Y(false),Y(s.$$.fragment,e),Y(r),Y(l.$$.fragment,e),c=!1},d(e){e&&g(t),te(s),u[0].d(),te(l)}}}let wn="full";function xn(e,t,n){let s=[],o="paxos";return[s,o,function(){s&&s[0]&&gn(s[0])},function(e){n(1,o=e),s&&s[0]&&s[0].config.update((t=>({...t,algorithm:e})))},function(e,t){s.push({config:e,state:t})},function(e,t){n(0,s=s.filter((n=>n.config!==e&&n.state&&t)))}]}new class extends oe{constructor(e){super(),se(this,e,xn,bn,r,{})}}({target:document.getElementById("app")})}}}))}();
